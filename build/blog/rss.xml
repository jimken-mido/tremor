<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Tremor Blog</title>
        <link>https://www.tremor.rs/blog</link>
        <description>Tremor Blog</description>
        <lastBuildDate>Sat, 24 Sep 2022 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Hygienic error handling and validation for pipelines]]></title>
            <link>https://www.tremor.rs/blog/2022/09/24/LFX-Blog-Carol</link>
            <guid>https://www.tremor.rs/blog/2022/09/24/LFX-Blog-Carol</guid>
            <pubDate>Sat, 24 Sep 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Carol’s Tremor Mentorship Report]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Hello, my name's Carol Geng, a current sophomore pursuing a Bachelor's degree in Computer Science at Texas A&amp;M University. Over Summer 2022, I have contributed to Tremor as part of the LFX Mentorship Program with my mentors Heinz Gies and Matthias Wahl, and this blog will show how valuable and enjoyable the experience was.</p><h1>About the Project</h1><p>Tremor is an event processing engine that uses pipelines and connectors for data to be passed through. However, errors could be made by the user when linking the ports of the pipelines, and those errors are not easily displayed to the user. There were cases where the location of the error wasn’t printed, nothing was printed at all, or even cases where the program would work as if everything was all fine. My mentorship project was focused on creating the messages that would be displayed to the user in a clear and concise manner through the console.</p><h1>The Mentorship Journey</h1><p>Before this mentorship, I had only worked in open-source a few times on projects and had no knowledge of how to code in Rust. This mentorship therefore allowed me to build on what I already knew while also giving me an opportunity to learn a new language. Throughout this mentorship, I was able to get a start in DevOps and learn how to work on the compiler and source code for a software program while contributing to the user experience of everyone who uses Tremor and whoever will use Tremor in the future.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-tremor">Starting Tremor<a href="#starting-tremor" class="hash-link" aria-label="Direct link to Starting Tremor" title="Direct link to Starting Tremor">​</a></h2><p>To learn how to contribute to Tremor’s source code, I had to first understand how Tremor worked and what it did. I was introduced to pipelines, ports, and scripts and was allowed to mess around with the code. Tremor’s code allowed the user to go into several commands to process and change the input into the desired output. Through playing around with Tremor, I decided to add a function to reverse a string with Tremor’s pipelines. Because tremor did not have a built-in reverse string function, I went into the source code to implement a reverse function in Rust along with several tests and documentation for the reverse function. This relatively simple function is where I made my first pull request and also where I first started getting familiar with Tremor.</p><p>Additionally, I had used other programming languages in my academic career, and therefore did not have any experience with Rust beforehand. This is when I got introduced to Rustlings, which had small exercises to help me with starting with Rust syntax and writing code in Rust. There were also a lot of functions unique to Rust in terms of how the code worked, which included enums, move semantics, and structs. This also included constructs like <code>Ok()</code> and concepts like async/await which I would end up utilizing in my project.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-code">Understanding Code<a href="#understanding-code" class="hash-link" aria-label="Direct link to Understanding Code" title="Direct link to Understanding Code">​</a></h2><p>A large portion of my mentorship focused on understanding the errors that were printed out. There were several different kinds of errors, such as ones that dealt with the console input, console output, pipeline input, and more, which validated whether the input or output existed in the code and where it led to, another connector or the console. While this may seem simple, this ended up leading me into the rabbit hole of the source code as I traversed through numerous files and functions to determine where the error went through and what I could do to the preexisting code to read and perform functions onto the error.</p><p>To do a lot of this, I learned the process of error logging. I defined each error there in great detail, such as what it is, what it does currently, what it’s supposed to do, and gradually updated it every time it was needed. Throughout implementing messages to these errors, I also learned more about version control with git. While I did have practice on the basics like git pull and git push, I also learned about git rebase, git merge, and more.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-handling">Error Handling<a href="#error-handling" class="hash-link" aria-label="Direct link to Error Handling" title="Direct link to Error Handling">​</a></h2><p>Error handling was the main focus of the project. As my mentor suggested, I focused on one error at a time from the error logs. First, I focused on the worst case- a case where nothing was printed and the program ran as if everything was normal, except there was no output. </p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="pipeline_out_errortroy">pipeline_out_error.troy<a href="#pipeline_out_errortroy" class="hash-link" aria-label="Direct link to pipeline_out_error.troy" title="Direct link to pipeline_out_error.troy">​</a></h6><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Our main flow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define flow main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # import the `tremor::connectors` module</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  use tremor::connectors;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  use lib::pipelines;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # create an instance of the console connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  create connector console from connectors::console;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # create an instance of the passthrough pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  create pipeline main from pipelines::main;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # connect the console (STDIN) to our pipeline input</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  connect /connector/console/out to /pipeline/main;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # then connect the pipeline output to the console (STDOUT)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # no doesn't exist, bad error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  connect /pipeline/main/no to /connector/console/in;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Deploy the flow so tremor starts it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deploy flow main;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This error focused on the fact that the output did not exist, so to fix the error, I wrote a separate function that checked whether the output existed, then connected it to the <code>ConnectInput</code> structs while sending an error statement and a status report to the system. This process introduced me to focusing on small incremental steps rather than solving the problem as a whole and allowed me to not get overwhelmed. Additionally, <code>outputs</code> had to be added to the <code>Executable Graph</code> struct, which led me to implementing outputs in related functions and building a hashmap for the representation of its graph. With that, the basic problem of catching the errors was solved for that error problem.</p><p>After that led to defining what the error was, which involved adding a <code>port</code> struct to both <code>ConnectInput</code> and <code>ConnectOutput</code> to connect inputs. This port struct wasn’t needed before but with changes that were made later on, <code>port</code> proved to be very useful in defining what the port was to be able to be used in other code. Because this field was added to the struct, changes then had to be made to all the functions that used this struct and a port had to be defined in those functions.</p><p>Last was implementing where the code was to the user. This focused heavily on adding transmitters and receivers to output the status and mapping the status when the user’s code had errors. The transmitters and receivers, <code>tx</code> and <code>rx</code> had to be added to the <code>ConnectInput</code> and <code>ConnectOutput</code> structs, then weaved together with the other types of code to be defined and used. This involved many functions to be modified in order to return a result. In this process, there were also bugs to be fixed in the preexisting code and tests that had to be corrected in order to make sure <code>tx</code> and <code>rx</code> were properly working. Afterwards, <a href="https://doc.rust-lang.org/std/result/enum.Result.html#method.map_err" target="_blank" rel="noopener noreferrer"><code>Result::map_err</code></a> was used in order to map out the results with its parameters through <code>rx</code> if a user inputted errors.</p><p>Throughout the programming, I had to search for the files to determine where the code was and what function utilized the next function. This led me to search into files to see where the error travels through and trace where the error goes as I searched through the declarations, definitions, and references of variables and functions. I also got to learn several handy keyboard shortcuts throughout this process as demonstrated from my mentor.</p><h1>Conclusion</h1><p>Overall, working with Tremor was extremely fun and valuable as I not only got to contribute to an incredible project, but also got to learn more about programming and the open-source world.  I was able to while meeting amazing people to guide me with my work, and I can not imagine it to be any other way.</p>]]></content:encoded>
            <category>cncf</category>
            <category>mentorship</category>
        </item>
        <item>
            <title><![CDATA[Support for the ClickHouse database in Tremor]]></title>
            <link>https://www.tremor.rs/blog/2022/07/07/LFX-Blog-Sasha</link>
            <guid>https://www.tremor.rs/blog/2022/07/07/LFX-Blog-Sasha</guid>
            <pubDate>Thu, 07 Jul 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Sasha's Mentorship experience]]></description>
            <content:encoded><![CDATA[<p>I'm Sasha, a Computer Science student living in south-eastern France. I contributed to Tremor as part of the <a href="https://mentorship.lfx.linuxfoundation.org/project/5c828028-f91c-4969-b4de-9efdb27bb869" target="_blank" rel="noopener noreferrer">Database Connector mentorship</a> proposed by the <a href="https://lfx.linuxfoundation.org/tools/mentorship/" target="_blank" rel="noopener noreferrer">LFX Mentorship Program</a> for Spring 2022. I was mentored by Matthias Wahl and got help from Darach Ennis, Heinz Gies and Ramona Łuczkiewicz.</p><p>This blogpost summarizes my work at Tremor as a mentee and shows what could be done next.</p><h1>About Tremor</h1><p>Tremor is an event processing system with the goal of allowing users to handle a high volume of messages by viewing them as a stream flowing between different nodes of a graph. Events go in and out of this graph thanks to connectors.</p><p>The interactions between each node and the connector configuration are defined using the <a href="https://www.tremor.rs/docs/edge/language/" target="_blank" rel="noopener noreferrer"><code>troy</code></a> programming language.</p><h1>Abstract</h1><p>My mentorship at Tremor was focused on building a connector for the <a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer">ClickHouse</a> database engine. More specifically, I was focused on the <em>sink</em> part, the one that allows data to flow out of the Tremor application.</p><p><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer">ClickHouse</a> is a database management system designed to allow for real-time analysis of high volumes of non-aggregated data. Its initial goal was to power the Yandex.Metrica analytics platform.</p><h1>The ClickHouse connector</h1><p>The next subsections describe what I did during the mentorship.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interacting-with-a-clickhouse-database-in-rust">Interacting with a ClickHouse database in Rust<a href="#interacting-with-a-clickhouse-database-in-rust" class="hash-link" aria-label="Direct link to Interacting with a ClickHouse database in Rust" title="Direct link to Interacting with a ClickHouse database in Rust">​</a></h2><p>My first goal was to find a way to send requests to a ClickHouse node from a Rust program. It was a good start because it allowed me to experiment on the ClickHouse side without caring about what was happening in Tremor. I spent around three weeks playing on a separate repository named <a href="https://github.com/scrabsha/plays-with-clickhouse" target="_blank" rel="noopener noreferrer"><code>scrabsha/plays-with-clickhouse</code></a> and getting extensive knowledge from Matthias about how Tremor works from the inside.</p><p>I found two Rust crates that could help us send requests to a ClickHouse database: <a href="https://crates.io/crates/clickhouse" target="_blank" rel="noopener noreferrer"><code>clickhouse</code></a> and <a href="https://crates.io/crates/clickhouse-rs" target="_blank" rel="noopener noreferrer"><code>clickhouse-rs</code></a>. <code>clickhouse</code> is the first one I considered. I had to discard it because it was focused on concrete Rust types and needed to know <em>at compile time</em> what each datatype is composed of. The second crate was a bit more low-level and allowed us to do what we need.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="writing-a-super-simple-sink">Writing a super simple sink<a href="#writing-a-super-simple-sink" class="hash-link" aria-label="Direct link to Writing a super simple sink" title="Direct link to Writing a super simple sink">​</a></h2><p>Once I got every ClickHouse detail right, I started playing with the Tremor side. There were multiple connectors already implemented in Tremor. I picked the simplest ones and started copying parts of it and quickly got something working.</p><p>The only challenge I encountered is that Tremor defines its own <code>Value</code> type, representing a value whose type is not really known at compile time, and uses it <em>a lot</em>. It was a bit disconcerting doing such things in Rust, as I felt I was writing dynamically-typed code in a statically-typed language, but I managed to get through it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="converting-tremor-values-to-clickhouse-values">Converting Tremor values to ClickHouse values<a href="#converting-tremor-values-to-clickhouse-values" class="hash-link" aria-label="Direct link to Converting Tremor values to ClickHouse values" title="Direct link to Converting Tremor values to ClickHouse values">​</a></h2><p>Once I was able to insert data in a database from Tremor, I started writing a conversion bridge for ClickHouse types, i.e. something that would handle the conversion of native Tremor values to their corresponding ClickHouse types. </p><p>Most of the conversions are quite simple: an integer can be obtained from an integer, a string can be obtained from any string, and so on.</p><p>Some other conversions were less obvious. For instance, in order to create a ClickHouse IPv4 type, we could either use a string representing the address, or an array of four integers. The goal was to make every ClickHouse type constructible from a Tremor value. I tried to make every conversion as obvious as possible, and to document them as much as possible.</p><p>The first implementation of this mapping function was huge. It was about 250 lines of tricky and slightly incorrect code. I managed to rewrite it from scratch using another approach and it got way better.</p><p>Working on this specific part led me to open three pull request to the <code>clickhouse-rs</code> crate:</p><ul><li><a href="https://github.com/suharev7/clickhouse-rs/pull/171" target="_blank" rel="noopener noreferrer">Make Value fully constructible (#171)</a></li><li><a href="https://github.com/suharev7/clickhouse-rs/pull/172" target="_blank" rel="noopener noreferrer">Compare IP adresses properly (#172)</a></li><li><a href="https://github.com/suharev7/clickhouse-rs/pull/173" target="_blank" rel="noopener noreferrer">Allow for Enum8 and DateTime64 value comparison (#173)</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h2><p>The conversion function described in the previous subsection was fairly complex. Each possible conversion and cast has been carefully tested in order to ensure that it behaves correctly. These tests were greatly simplified thanks to the use of declarative macro.</p><p>Some other tests were focused on testing the sink as a whole, and how it would interact with a ClickHouse database. In this kind of test, we would run ClickHouse Docker containers, create a ClickHouse sink, plug the sink to the container, send some events, and see what has been inserted in the ClickHouse side.</p><h1>What to do next?</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="improving-the-sink">Improving the sink<a href="#improving-the-sink" class="hash-link" aria-label="Direct link to Improving the sink" title="Direct link to Improving the sink">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automatically-getting-the-table-schema">Automatically getting the table schema<a href="#automatically-getting-the-table-schema" class="hash-link" aria-label="Direct link to Automatically getting the table schema" title="Direct link to Automatically getting the table schema">​</a></h3><p>It turns out that ClickHouse has a <a href="https://clickhouse.com/docs/en/sql-reference/statements/describe-table" target="_blank" rel="noopener noreferrer"><code>DESCRIBE TABLE</code> statement</a>, which allows to gather information about each column of a specific table. We currently rely on the end-user to provide us valid information about the table columns. Using this statement would reduce the amount of information we require from them, hence making it simpler to use.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inserting-data-concurrently">Inserting data concurrently<a href="#inserting-data-concurrently" class="hash-link" aria-label="Direct link to Inserting data concurrently" title="Direct link to Inserting data concurrently">​</a></h3><p>The current implementation of the ClickHouse container uses a single database connection object, which is reused across insertions. A good way to improve this system is to use multiple concurrent connections, so that we could insert multiple batch of events at once.</p><p>A similar pattern has already been implemented in Tremor as part of the <a href="https://www.tremor.rs/docs/edge/reference/connectors/elastic" target="_blank" rel="noopener noreferrer"><code>elastic</code></a> connector. As such, most of the required machinery is already there.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-source-part">The source part<a href="#the-source-part" class="hash-link" aria-label="Direct link to The source part" title="Direct link to The source part">​</a></h2><p>This mentorship was focused on building a sink for ClickHouse. The next step could be to add a source connector, so that coming from a ClickHouse database can be ingested directly into a Tremor application.</p><p>ClickHouse has a feature allowing to watch for updates in a given table. This way, we can simulate a stream of data, and make it flow in the Tremor system. Each time some data is inserted in the table, we can retrieve it, convert it into Tremor value and make it flow into the graph of nodes described earlier.</p><p>This is something that we totally want to see in Tremor in the future. We can't wait for the <a href="https://clickhouse.com/docs/en/sql-reference/statements/watch/" target="_blank" rel="noopener noreferrer"><code>WATCH</code> statement</a> to be considered stable.</p>]]></content:encoded>
            <category>Database</category>
            <category>ClickHouse</category>
        </item>
        <item>
            <title><![CDATA[TDengine colaboration]]></title>
            <link>https://www.tremor.rs/blog/2022/06/15/tdengine-colaboration</link>
            <guid>https://www.tremor.rs/blog/2022/06/15/tdengine-colaboration</guid>
            <pubDate>Wed, 15 Jun 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[The best aspect of open source software is collaboration, not only of systems but of the people involved. It is wonderful to see them come together to take multiple parts to build something bigger out of them.]]></description>
            <content:encoded><![CDATA[<p>The best aspect of open source software is collaboration, not only of systems but of the people involved. It is wonderful to see them come together to take multiple parts to build something bigger out of them.</p><p>In this spirit, we had the chance to collaborate on a little project with the crew from <a href="https://tdengine.com/" target="_blank" rel="noopener noreferrer">TDengine</a>. For those that don’t know them yet, TDengine is an exciting new time-series database focusing on scalability, performance, and using SQL as a way to interact. Better yet using the <a href="https://docs.tdengine.com/reference/taosadapter" target="_blank" rel="noopener noreferrer">adapter</a> allows using a number of protocols including the Influx Line Protocol.</p><p>This does compliment tremor extremely well, as what we build can be described as an event processing engine focusing on performance and usability, using SQL as a way to manipulate data. I’m pretty sure you can already see how those two pieces fit together.</p><p>But, we don’t want to go much into the technical details here the post over at the <a href="https://tdengine.com/2022/06/14/6434.html" target="_blank" rel="noopener noreferrer">TDengine blog</a> does a wonderful job at that.</p><p>Working with Shuduo on this was a lot of fun, it was a fascinating forth and back of ideas and possible improvements. The integration was super painless with both systems supporting the same protocols, and it was really great to learn some tricks from the experts, like how queries work best in TDengine.</p><p>The most interesting part of this is however that both systems not only create the proverbial, larger sum than their parts are but also grow in the process.</p><p>And the speed the folks at TDengine do that is amazing, during the time of the collaboration, they not only released <a href="https://grafana.com/grafana/plugins/tdengine-datasource/" target="_blank" rel="noopener noreferrer">an official grafana data source</a>, released a <a href="https://github.com/taosdata/TDengine/releases/tag/ver-2.6.0.1" target="_blank" rel="noopener noreferrer">new version of TDengine itself</a>, but also created and published a <a href="https://grafana.com/grafana/dashboards/16388" target="_blank" rel="noopener noreferrer">grafana dashboard</a> for system monitoring that made it extremely easy to add this.</p><p>For tremor we have discovered that we’re really starting to miss sliding windows, they have been on the roadmap for a while, but never with any direct requirement other than “it would be nice to have them”. While talking about real-time alerting, sliding windows have significant advantages over tumbling windows, so this collaboration revived that discussion - which means we’ll hopefully add them sooner rather than later.</p>]]></content:encoded>
            <category>collaboration</category>
            <category>tdengine</category>
        </item>
        <item>
            <title><![CDATA[Automating the tremor release process]]></title>
            <link>https://www.tremor.rs/blog/2022/06/03/LFX-Blog-Prashant</link>
            <guid>https://www.tremor.rs/blog/2022/06/03/LFX-Blog-Prashant</guid>
            <pubDate>Fri, 03 Jun 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Prashant's Mentorship experience]]></description>
            <content:encoded><![CDATA[<p>It was a pleasant night. I was waiting for LFX to send acceptance/rejection e-mails. And there it was, <code>"Congratulations! You were accepted to CNCF - Tremor"</code> . It was a great and exciting feeling to start this journey! And here I am, at the end of it, writing this blog. It was wonderful, everything that I expected it to be, and even more so in the 3 months! I am writing this blog about my experience in this mentorship.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>My name's Prashant (Also known as Pimmy on the internet), a 2nd-year university student pursuing my Bachelor's degree in Information Technology. This blog will talk about my project experience in contributing to <a href="https://www.tremor.rs" target="_blank" rel="noopener noreferrer">Tremor</a> as part of LFX Mentorship Program Spring 2022.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The Problem<a href="#the-problem" class="hash-link" aria-label="Direct link to The Problem" title="Direct link to The Problem">​</a></h2><p>We all hate manual tasks, don't we? No seriously if anyone loves doing things on their own, it's totally fine. Of course not everything can be automated. But in this case, it was something more tedious. Here's a flowchart for basic explanation: </p><p><img loading="lazy" src="https://user-images.githubusercontent.com/23097199/171433037-99f4d443-7b84-4dc0-b026-972831108889.png" alt="Flow" class="img_ev3q"></p><p>This is how it was done, but manually. Each process had to be checked by someone to ensure a smooth sailing. It was quite the work, and so making a release candidate was never easy.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-approach">The Approach<a href="#the-approach" class="hash-link" aria-label="Direct link to The Approach" title="Direct link to The Approach">​</a></h2><p>The first thing was to divide the tasks into smaller sections and work on this. As my mentors at tremor always used to say, make notes! Keep documenting stuff, really helps. These notes helped me divide the tasks of the current CI process into individual sets of goal, and then I started working on it. </p><p>Now I did have to test <em>a lot</em>, 400+ workflows just to get this finally done. So I will explain how the release process works. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="drafting-the-release">Drafting the release<a href="#drafting-the-release" class="hash-link" aria-label="Direct link to Drafting the release" title="Direct link to Drafting the release">​</a></h3><ol><li>We select which version we want to release, as shown in the code snippet taken from github actions workflow yaml file.</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">workflow_dispatch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">new-version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> choice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">description</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Which version you'd like to release?"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> major (_.X.X)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> minor (X._.X)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> patch (X.X._)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> rc (X.X.X</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">rc)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> release (removes rc)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">required</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Extract the version input (we want major, minor, patch, etc without the brackets), and bumping cargo packages, as shown below. As you can see I extracted the old version before the bump, and put it into <code>$GITHUB_ENV</code> , which is creating env variables with these values. Similarly done for new version after the bump. They are needed for creating the PR. </li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Extracting version from input</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          VERSION=$(echo "${{github.event.inputs.new-version}}" | sed 's/ (.*)$//')</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          echo "VER=$VERSION" &gt;&gt; $GITHUB_ENV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Bump new version in TOML files</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          OLD_VERSION=$(cargo pkgid | cut -d# -f2 | cut -d: -f2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          echo "OLD=$OLD_VERSION" &gt;&gt; $GITHUB_ENV</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          cargo set-version --workspace --bump ${{ env.VER }}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          NEW_VERSION=$(cargo pkgid | cut -d# -f2 | cut -d: -f2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          echo "NEW=$NEW_VERSION" &gt;&gt; $GITHUB_ENV   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Commit, push, and Pull Request is created automatically with <code>Release</code> tag for the release. From there, the maintainers will do all the necessary reviews, and merge once the CI passes.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishing-release">Publishing Release<a href="#publishing-release" class="hash-link" aria-label="Direct link to Publishing Release" title="Direct link to Publishing Release">​</a></h3><ul><li>So, the Draft Release pull request is merged, great! It automatically triggers the release workflow, which by the way only works if the PR has the <code>Release</code> tag, and ignores all other. This is achieved using the conditional statement:</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token key atrule">if</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> github.event.pull_request.merged </span><span class="token important">&amp;&amp;</span><span class="token plain"> contains( github.event.pull_request.labels.</span><span class="token important">*.name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> 'Release')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Changelog is automatically extracted using this <a href="https://github.com/ffurrer2/extract-release-notes" target="_blank" rel="noopener noreferrer">great workflow action</a>, and the release is made.</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Extract release notes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">release</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">notes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ffurrer2/extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">release</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">notes@v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Create release</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> actions/create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">release@v1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>To trigger the publish crates workflow, I used this <a href="https://github.com/benc-uk/workflow-dispatch" target="_blank" rel="noopener noreferrer">workflow dispatch action</a> as shown below:</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Trigger publish crates workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> benc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">uk/workflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">dispatch@v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">workflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Publish crates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> secrets.PAT_TOKEN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And that's it for the release!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishing-crates">Publishing crates<a href="#publishing-crates" class="hash-link" aria-label="Direct link to Publishing crates" title="Direct link to Publishing crates">​</a></h3><p>The Publish crates workflow is now triggered as mentioned in the previous state. There are 4 main crates to be published, and one job to trigger the draft release workflow for tremor-language-server repo (All automated!). Github actions makes it really great to see which job is interconnected.</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/23097199/171507584-c8a1bb81-0cbc-4a70-966e-b998758e6430.png" alt="image" class="img_ev3q"></p><p>With all the crates published, including the language-server which follows the exact same process. Tremor has successfully released a new version! Congratulations!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-thoughts">My thoughts<a href="#my-thoughts" class="hash-link" aria-label="Direct link to My thoughts" title="Direct link to My thoughts">​</a></h2><p>The tremor community has been extremely helpful in guiding me through the entire mentorship. They have this principle of "Never <em>worry</em>, have fun" that will always stay forever with me, and forward in my career. Special mention for <a href="https://github.com/Licenser" target="_blank" rel="noopener noreferrer">Heinz</a> who mentored me throughout the months and helped me. And to the tremor community in general, my thanks to all of them!
I didn't know much about github actions or DevOps in general. But now I can confidently say that I can indeed, <em>make processes boring by automating them</em>. I will continue to engage in open source projects, and guide others to the same, cheers!</p>]]></content:encoded>
            <category>DevOps</category>
            <category>CI</category>
            <category>mentorship</category>
            <category>cncf</category>
        </item>
        <item>
            <title><![CDATA[Tremors - May '22]]></title>
            <link>https://www.tremor.rs/blog/2022/06/02/tremor-tremors</link>
            <guid>https://www.tremor.rs/blog/2022/06/02/tremor-tremors</guid>
            <pubDate>Thu, 02 Jun 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Welcome, Tremor Enthusiasts! This post is another in a series intended to inform and entertain Tremor Technologists with recent changes in the tremor project. We'll mostly focus these posts on Pull Requests and other notable developments. With these posts, you can stay informed and learn more about the project without having to read pull requests, or wait for release notes.]]></description>
            <content:encoded><![CDATA[<p>Welcome, Tremor Enthusiasts! This post is another in a series intended to inform and entertain Tremor Technologists with recent changes in the <code>tremor</code> project. We'll mostly focus these posts on Pull Requests and other notable developments. With these posts, you can stay informed and learn more about the project without having to read pull requests, or wait for release notes.</p><p>Have you ever cleaned the house for company, to make it seem like nobody lives there? That’s basically what we’ve been up to getting ready for 0.12.0. It’s a big deal. We're trying to make the codebase spotless with plenty of sweeping up. We also thank our contributors for all the hard work put into automation and new stuff this month!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-stuff">New Stuff<a href="#new-stuff" class="hash-link" aria-label="Direct link to New Stuff" title="Direct link to New Stuff">​</a></h2><p>Most exciting of all: <a href="https://github.com/tremor-rs/tremor-runtime/releases/tag/v0.12.0" target="_blank" rel="noopener noreferrer">We made the 0.12.0 release</a>! We put a lot of cool stuff in right before releasing, so finish the article before you jump in!</p><p>Being able to make a new tremor project has been a pain point from some of our users. We wanted <a href="https://www.tremor.rs/docs/0.12/getting-started/" target="_blank" rel="noopener noreferrer">getting started</a> to be as easy as typing a command. Now it is! You can simply call our <a href="https://github.com/tremor-rs/tremor-runtime/pull/1671" target="_blank" rel="noopener noreferrer">fancy new command</a> to make a <code>new</code> tremor template. Quick and easy!</p><p>Our elasticsearch integrations got some upgrades with support for <a href="https://github.com/tremor-rs/tremor-runtime/pull/1653" target="_blank" rel="noopener noreferrer">raw elastic payloads</a> through our connector, and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1663" target="_blank" rel="noopener noreferrer">native support for auth</a> between elastic &lt;-&gt; tremor. No more need for custom headers on connectors! Check out the links provided for more details, and we'll update the docs soon.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ci">CI<a href="#ci" class="hash-link" aria-label="Direct link to CI" title="Direct link to CI">​</a></h2><p>The CI has been changed heavily in the last month. We have <a href="https://github.com/PrimalPimmy" target="_blank" rel="noopener noreferrer">PrimalPimmy</a> on GitHub to thank for much of the contributions. Thank you!</p><p>We've tweaked our CI when we <a href="https://github.com/tremor-rs/tremor-runtime/pull/1679" target="_blank" rel="noopener noreferrer">create a release</a> that should prevent creating crates unexpectedly. We also trigger <a href="https://github.com/tremor-rs/tremor-runtime/pull/1673" target="_blank" rel="noopener noreferrer">many workflows across our projects</a> from a release flow in tremor-runtime. We also decided that publishing in <a href="https://github.com/tremor-rs/tremor-runtime/pull/1649" target="_blank" rel="noopener noreferrer">many steps</a> would help to prevent <a href="https://github.com/tremor-rs/tremor-runtime/pull/1644" target="_blank" rel="noopener noreferrer">single points</a> of failure.</p><p>We can also better provide <a href="https://github.com/tremor-rs/tremor-runtime/pull/1624" target="_blank" rel="noopener noreferrer">descriptive options</a> when we create a release. We can also provide <a href="https://github.com/tremor-rs/tremor-runtime/pull/1609" target="_blank" rel="noopener noreferrer">better options for publishing</a>.</p><p>Lastly, we tweaked <a href="https://github.com/tremor-rs/tremor-runtime/pull/1682/files" target="_blank" rel="noopener noreferrer">how much we use sed</a> when we cut a release. This one is great for a quick example:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> tremor-script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">"s/^tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${old}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string" style="color:rgb(255, 121, 198)">/tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${new}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string" style="color:rgb(255, 121, 198)">/"</span><span class="token plain"> -i.release </span><span class="token string" style="color:rgb(255, 121, 198)">"Cargo.toml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">"s/^tremor-influx = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${old}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string" style="color:rgb(255, 121, 198)">/tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${new}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string" style="color:rgb(255, 121, 198)">/"</span><span class="token plain"> -i.release </span><span class="token string" style="color:rgb(255, 121, 198)">"Cargo.toml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">"s/^tremor-value = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${old}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string" style="color:rgb(255, 121, 198)">/tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${new}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\"</span><span class="token string" style="color:rgb(255, 121, 198)">/"</span><span class="token plain"> -i.release </span><span class="token string" style="color:rgb(255, 121, 198)">"Cargo.toml"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where we used to manually edit each project's <code>.toml</code> file, we now do this as part of our <a href="https://github.com/tremor-rs/tremor-runtime/actions" target="_blank" rel="noopener noreferrer">GitHub Actions workflow</a> elsewhere.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sweeping-up">Sweeping Up<a href="#sweeping-up" class="hash-link" aria-label="Direct link to Sweeping Up" title="Direct link to Sweeping Up">​</a></h2><p>As we mentioned before, there was a lot of sweeping up we wanted to finish before the newest release.</p><p>One of the more interesting fixes we put in was a small bug for <code>tremor run</code>. Something that had gone unnoticed for a while was an <a href="https://github.com/tremor-rs/tremor-runtime/pull/1582" target="_blank" rel="noopener noreferrer">upper limit</a> when running tremor scripts. After 150 seconds, the script would time out. A strange and small feature limitation we didn't notice.</p><p>We had a lot of work specifically to do on connectors.</p><ul><li>Some connectors wrote <a href="https://github.com/tremor-rs/tremor-runtime/pull/1662" target="_blank" rel="noopener noreferrer">more events</a> than they should</li><li>Edge cases existed where we would acknowledge error events <a href="https://github.com/tremor-rs/tremor-runtime/pull/1670" target="_blank" rel="noopener noreferrer">without processing them</a>.</li><li>Some <a href="https://github.com/tremor-rs/tremor-runtime/pull/1651" target="_blank" rel="noopener noreferrer">bench connectors</a> would not stop as expected.</li><li>Show errors on <a href="https://github.com/tremor-rs/tremor-runtime/pull/1606" target="_blank" rel="noopener noreferrer">unknown connector</a> types, instead of silently failing.</li><li>Make destructive connector actions <a href="https://github.com/tremor-rs/tremor-runtime/pull/1668" target="_blank" rel="noopener noreferrer">much more difficult</a> to accidentally stumble upon.</li></ul><p>We also removed a limitation we had for code coverage. Where our contributors would have to avoid <a href="https://github.com/tremor-rs/tremor-runtime/pull/1666" target="_blank" rel="noopener noreferrer">functionally any drop at all</a> in code coverage, we now allow a <code>.1</code> percent drop.</p><p>If you were a using the <code>tremor api</code> sub command, you should be aware that we've <a href="https://github.com/tremor-rs/tremor-runtime/pull/1650" target="_blank" rel="noopener noreferrer">completely deprecated</a> the subcommand.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fixes">Bug Fixes<a href="#bug-fixes" class="hash-link" aria-label="Direct link to Bug Fixes" title="Direct link to Bug Fixes">​</a></h2><p>Our bug fixes were pretty few over ht elast month. We had some <a href="https://github.com/tremor-rs/tremor-runtime/pull/1655" target="_blank" rel="noopener noreferrer">publishing</a>, <a href="https://github.com/tremor-rs/tremor-runtime/pull/1702" target="_blank" rel="noopener noreferrer">connecting</a>, and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1677" target="_blank" rel="noopener noreferrer">regular expressions</a> patches. We updated our new <a href="https://github.com/tremor-rs/tremor-runtime/pull/1676" target="_blank" rel="noopener noreferrer">code coverage tool</a>, codecov, to more accurately track our coverage. We also found that piping information to tremor would <a href="https://github.com/tremor-rs/tremor-runtime/pull/1701" target="_blank" rel="noopener noreferrer">sometimes cause issues</a> and fixed that.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thank-you">Thank You<a href="#thank-you" class="hash-link" aria-label="Direct link to Thank You" title="Direct link to Thank You">​</a></h2><p>The Tremor project as strong as the community around it. Reading this article, making contributions, and generally being involved in the project makes us more successful. Thank you for reading and contributing! See you next time.</p><ul><li>Gary, and the Tremor team.</li></ul>]]></content:encoded>
            <category>collaboration</category>
            <category>wayfair</category>
            <category>tremors</category>
        </item>
        <item>
            <title><![CDATA[Tremors - April '22]]></title>
            <link>https://www.tremor.rs/blog/2022/05/03/tremor-tremors</link>
            <guid>https://www.tremor.rs/blog/2022/05/03/tremor-tremors</guid>
            <pubDate>Tue, 03 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Welcome, Tremor Enthusiasts! This is the first post in a series intended inform and entertain Tremor Technologists with recent changes in the tremor project. We'll mostly focus these posts on Pull Requests and other notable developments. With these posts, you can stay informed and learn more about the project without having to read pull requests, or wait for release notes.]]></description>
            <content:encoded><![CDATA[<p>Welcome, Tremor Enthusiasts! This is the first post in a series intended inform and entertain Tremor Technologists with recent changes in the <code>tremor</code> project. We'll mostly focus these posts on Pull Requests and other notable developments. With these posts, you can stay informed and learn more about the project without having to read pull requests, or wait for release notes.</p><p>This posts' theme is <em>open and improved communication</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="release-candidates">Release Candidates<a href="#release-candidates" class="hash-link" aria-label="Direct link to Release Candidates" title="Direct link to Release Candidates">​</a></h2><p>Where's the next release of Tremor?!</p><p>Tremor's release schedule is becoming a bit more regular. We're releasing <a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer">about twice a year</a>, every 6 to eight months. The next release of Tremor should include an exciting new way to write plugins with the <a href="https://github.com/tremor-rs/tremor-runtime/issues/791" target="_blank" rel="noopener noreferrer">plugin development kit</a>, along with other goodies for faster, <a href="https://github.com/tremor-rs/tremor-runtime/pull/1571/files" target="_blank" rel="noopener noreferrer">well understood tremor scripts</a> and plenty of other <a href="https://github.com/tremor-rs/tremor-runtime/pull/1539" target="_blank" rel="noopener noreferrer">performance</a> and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1537" target="_blank" rel="noopener noreferrer">bug fixes</a>.</p><p>Most notable as an update for us all is that Tremor has a <a href="https://github.com/tremor-rs/tremor-runtime/releases/tag/v0.12.0-rc.1" target="_blank" rel="noopener noreferrer">release candidate</a> live. If we're pleased with it, then a new version of tremor is soon to be released!</p><p>In this article, Let's dive into three topics: <a href="#ci">CI</a>, <a href="#pdk-plugin-development-kit">PDK</a>, and <a href="#performance">performance</a>!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ci">CI<a href="#ci" class="hash-link" aria-label="Direct link to CI" title="Direct link to CI">​</a></h2><p>One of my favorite parts of working with tremor, or any project, is using automation. Running a bunch of stuff on my machine can be quicker, but less reliable than a well established automation platform. Tremor makes an effort to improve Continuous integration regularly; and this month is no exception.</p><p>One of our active members of the Tremor Community, <a href="https://github.com/PrimalPimmy" target="_blank" rel="noopener noreferrer">Pimmy</a> has taken it upon himself to dramatically improve the CI and relase process for <code>tremor-runtime</code>.</p><p>The <a href="https://github.com/tremor-rs/tremor-runtime/pull/1545/files" target="_blank" rel="noopener noreferrer">new process</a> will automatically publish a release when we're ready. Using this automatino, we can bump versions appropriately with specially named branches and some fancy <a href="https://github.com/tremor-rs/tremor-runtime/runs/6026528631?check_suite_focus=true" target="_blank" rel="noopener noreferrer">GitHub Actions</a>. This lets the Tremor team take full advantage of the seamless GitHub experience from merge -&gt; release, complete with logs and links directly from the Pull Request. We can even extract release notes and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1563/files" target="_blank" rel="noopener noreferrer">bump versions automatically</a>. Once again, truly great work from our community here!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pdk-plugin-development-kit">PDK (Plugin Development Kit)<a href="#pdk-plugin-development-kit" class="hash-link" aria-label="Direct link to PDK (Plugin Development Kit)" title="Direct link to PDK (Plugin Development Kit)">​</a></h2><p>I won't spend too much time on this point, since the lovely <a href="https://github.com/marioortizmanero" target="_blank" rel="noopener noreferrer">marioortizmanero</a> has already taken the time to write out <a href="https://nullderef.com/blog/plugin-abi-stable/" target="_blank" rel="noopener noreferrer">a full blog post</a> or <a href="https://nullderef.com/blog/plugin-impl/" target="_blank" rel="noopener noreferrer">two</a> on the topic. We'll give a full breakdown another time. For now: know that Tremor is currently in the works of creating an easier way for developers to plug their own binaries into the system to run connectors and pipelines.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">​</a></h2><p>Tremor cares <a href="https://www.tremor.rs/community/development/benchmarks/LogstashBenchmark" target="_blank" rel="noopener noreferrer">a lot about performance</a>. As you may already know from <a href="https://www.youtube.com/watch?v=xsowS5hEKRg&amp;list=PLNTN4J6tdf20vy14FVOazLTdou_8xyvfe&amp;index=4" target="_blank" rel="noopener noreferrer">TremorCon 2021's fabulous talks</a>; it was originally created and adopted for performance gains in Wayfair's event processing infrastructure. There are plenty of performance gains to make in a project as large as Tremor, both inside the project and through dependencies.</p><p>One such dependency we depend on <a href="https://simdjson.org/" target="_blank" rel="noopener noreferrer">to parse gigabytes of JSON per second</a> is <a href="https://docs.rs/simd-json/0.3.18/simd_json/index.html" target="_blank" rel="noopener noreferrer">simd_json</a>. <code>simd_json</code> is a port of the simdjson c++ library into rust. It can not only parse from JSON into Rust, but aid the <code>serde</code> library that can easily serialize and deserialize Rust data structures. That's pretty handy for an event processing project that will have to marshal plenty of events from disparate sources of all data forms! As you might imagine, a project like <code>simd_json</code> comes with a lot of configuration options, and optimizations behind those options.</p><p>Further than just the configuration that you might give <code>serde</code>, or <code>simd_json</code>, is the options you may give to the <a href="https://github.com/simd-lite/simd-json/blob/main/.cargo/config" target="_blank" rel="noopener noreferrer">rust compiler</a>. The compiler, by default, <a href="https://docs.rs/simd-json/latest/simd_json/index.html" target="_blank" rel="noopener noreferrer">compiles for the largest compatability.</a> For best performance on a specific plaform, we make use of the <code>target-feature</code> flag. This will allow us to target specific features available on different platforms and CPUs.</p><p>It should be no surprise that we continue this effort within the Tremor team. Know that we also depend on our community, such as a <a href="https://github.com/tremor-rs/tremor-runtime/pull/1522" target="_blank" rel="noopener noreferrer">pull request from scarabsha</a>. Sasha idenfitifed additional target-features for the target <code>x86_64-unknown-linux-gnu</code> that speed up the performance of <code>simd-json</code>. There's not a benchmark to show exactly how much faster this made json processing, but we appreciate the fact that it will undoubtedly increase performance for some clients of Tremor.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thank-you">Thank You<a href="#thank-you" class="hash-link" aria-label="Direct link to Thank You" title="Direct link to Thank You">​</a></h2><p>The Tremor project as strong as the community around it. Reading this article, making contributions, and generally being involved in the project makes us more successful. Thank you for reading and contributing! See you next time.</p><ul><li>Gary, and the Tremor team.</li></ul>]]></content:encoded>
            <category>collaboration</category>
            <category>wayfair</category>
            <category>tremors</category>
        </item>
        <item>
            <title><![CDATA[Collaboration - Using Redpanda with Tremor]]></title>
            <link>https://www.tremor.rs/blog/2021/12/13/redpanda</link>
            <guid>https://www.tremor.rs/blog/2021/12/13/redpanda</guid>
            <pubDate>Mon, 13 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Like all good projects in the open source community, great collaborations start with ad hoc interactions.]]></description>
            <content:encoded><![CDATA[<p>Like all good projects in the open source community, great collaborations start with ad hoc interactions.</p><p><img loading="lazy" alt="Redpanda Rocket" src="/assets/images/redpanda-rocket-0282422a2035a2f4d294d7ce8fe8f473.png" width="2000" height="1403" class="img_ev3q"></p><p>A recent set of discussions between the Tremor maintainers and our community brought <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> to our attention.</p><p>Some of our community would like to replace their Kafka deployments with <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>, a Kafka API-compatible streaming
data platform, to realize gains in performance and reduce their total cost of operations. . As we already have Kafka
connectivity, enabling this shouldn’t be too complex, right? Let’s find out.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>We are always looking out for interesting technology, and recently we read a <a href="https://vectorized.io/blog/wasm-architecture/" target="_blank" rel="noopener noreferrer">very interesting article</a> on the Redpanda
blog about using WASM as server-side filters for subscription. Being as excitable as we are, we obviously had to give
Redpanda a shot.</p><p>To our joy this turned out to be painless, Redpanda reuses the Kafka API so our existing connectors for Kafka work
out of the box — and as a bonus we could get rid of a whole bunch of docker-compose YAML dancing that we needed to
set up Zookeeper.</p><p>Alex Gallego, founder of Redpanda, reached out to us and we started experimenting with Tremor and Redpanda in this
repo: <a href="https://github.com/tremor-rs/tremor-redpanda" target="_blank" rel="noopener noreferrer">github.com/tremor-rs/tremor-redpanda</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-tremor-and-redpanda">Setting up Tremor and Redpanda<a href="#setting-up-tremor-and-redpanda" class="hash-link" aria-label="Direct link to Setting up Tremor and Redpanda" title="Direct link to Setting up Tremor and Redpanda">​</a></h2><p>So, let’s get our hands dirty and actually connect Redpanda and tremor in a real-world project.</p><p>We have prepared a fully equipped workshop for this occasion. Give it a shot <a href="https://www.tremor.rs/docs/0.11/recipes/redpanda_elastic_correlation/README" target="_blank" rel="noopener noreferrer">here</a>
if you are impatient.</p><p>Tremor can flexibly act as a Redpanda/Kafka consumer or producer, make use of auto-commit for offset management or manually commit
when events are completely handled by the tremor pipeline. Here we are configuring Tremor only committing offsets when events have been successfully handled.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">onramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">brokers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">topics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">group_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> redpanda_es_correlation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">retry_failed_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">rdkafka_options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">enable.auto.commit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This tremor application is reporting success or failure of ingesting the received events into elasticsearch via another Redpanda topic.
Configuring this is also straightforward, here we have a <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> consumer ready for copy-pasting:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">group_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tremor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">brokers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tremor</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here you go. A fully working setup for orchestrating document ingestion with <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> delivering the documents and receiving acknowledgements.
For more details check out this Redpanda <a href="/docs/0.11/recipes/redpanda_elastic_correlation">recipe</a> on our website.</p><p>Tremor is designed to be robust when faced with high volumetric data streams. It comes with batteries included for traffic shaping,
QoS and data distribution. With those tremor can guarantee at-least-once message delivery. We try to reduce CPU and memory footprint
for a given workload and at the same time provide a “just works” experience for operators. And we think we found a soulmate project in <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>.</p><p>And most importantly, it is working like a charm. In fact we just dropped in <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> and expected some hours of troubleshooting, but this hope
was cut short by a smooth transition:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.828694200+00:00 INFO tremor_runtime::system - Binding onramp tremor://localhost/onramp/redpanda-in/01/out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.830056300+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Starting kafka onramp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.831848100+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscribing to: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"tremor"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.832735600+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscription initiated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.833342+00:00 INFO tremor_runtime::onramp - Onramp tremor://localhost/onramp/redpanda-in/01/out started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.828694200+00:00 INFO tremor_runtime::system - Binding onramp tremor://localhost/onramp/redpanda-in/01/out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.830056300+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Starting kafka onramp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.831848100+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscribing to: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"tremor"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.832735600+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscription initiated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.833342+00:00 INFO tremor_runtime::onramp - Onramp tremor://localhost/onramp/redpanda-in/01/out started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Both in terms of operator friendliness and performance we root for <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>.</p><p>We started using it in our integration test suite, so users can be 100% sure <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> connectivity just works.</p>]]></content:encoded>
            <category>collaboration</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Connectors for Streaming to AWS S3]]></title>
            <link>https://www.tremor.rs/blog/2021/12/04/LFX-Blog-Daksh</link>
            <guid>https://www.tremor.rs/blog/2021/12/04/LFX-Blog-Daksh</guid>
            <pubDate>Sat, 04 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Daksh's Mentorship summary report]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3><p>Hi folks, I'm Daksh, a senior year CS student at Indian Institute of Technology, Jammu. This blog talks about my project and experience contributing to <a href="https://www.tremor.rs" target="_blank" rel="noopener noreferrer">Tremor</a> as part of LFX Mentorship Program Fall 2021.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="learning-about-tremor">Learning about Tremor<a href="#learning-about-tremor" class="hash-link" aria-label="Direct link to Learning about Tremor" title="Direct link to Learning about Tremor">​</a></h3><p>I came across <a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">rust</a> in early 2020, and I absolutely loved its design,  the syntax and how approachable it was to a beginner. I discovered Tremor while looking for open source projects written in rust. Tremor is an event processing system (think kafka) for unstructured data with rich support for structural pattern-matching, filtering and transformation. Over the summers, I did a few minor PR's. Going through the examples and the <a href="https://www.tremor.rs/docs/index/" target="_blank" rel="noopener noreferrer">docs</a> I could set up Tremor and start hacking on!!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="my-project">My Project<a href="#my-project" class="hash-link" aria-label="Direct link to My Project" title="Direct link to My Project">​</a></h3><p>It is very common in event processing to stream data to a persistent storage engine for later processing or archival purposes. My job was to add connectors to stream data to AWS S3. You may find more information in the github <a href="https://github.com/tremor-rs/tremor-runtime/issues/1176" target="_blank" rel="noopener noreferrer">issue</a>.</p><p>So what is a connector?
A connector is the component of an Event Processing System that provides the functionality of communicating with the outside world. This would enable current, and future users of Tremor to now connect and stream events to any endpoint which supports the S3 API.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="aws-s3-connectors">AWS S3 Connectors<a href="#aws-s3-connectors" class="hash-link" aria-label="Direct link to AWS S3 Connectors" title="Direct link to AWS S3 Connectors">​</a></h4><p>I would explain the sink via an example. To connect to S3, one would require the s3 credentials. Due to lack of support from the sdk only public-secret key credentials are supported <em>(to be extended once the sdk supports other means for credentials)</em>.
Tremor would read the key names specified in the config from the environment.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="s3demotroy">s3demo.troy<a href="#s3demotroy" class="hash-link" aria-label="Direct link to s3demo.troy" title="Direct link to s3demo.troy">​</a></h6><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define flow s3demo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    define connector s3conn from s3 with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    codec="json",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config={</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "aws_access_token": "AWS_ACCESS_KEY_ID",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "aws_secret_access_key": "AWS_SECRET_ACCESS_KEY",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "aws_region": "AWS_REGION",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "bucket": "tremordemo",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "min_part_size": 5242880,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    define connector files3 from file with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    code="json",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config={</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mode": "read",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "path": "sample.json",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    preprocessors=["lines"]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    define pipeline s3pipe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        define script s3Event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let e = event;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let $s3 = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "key": e.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            let payload = e.payload;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            payload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        create script s3Event;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select event from in into s3Event;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select event from s3Event into out;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create connector s3conn;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create connector files3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create pipeline s3pipe;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect /connector/files3 to /pipeline/s3pipe;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect /pipeline/s3pipe to /connector/s3conn;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deploy flow s3demo;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="samplejson">sample.json<a href="#samplejson" class="hash-link" aria-label="Direct link to sample.json" title="Direct link to sample.json">​</a></h6><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"key"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"key1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token property">"payload"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"event1"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"hello1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token property">"key2"</span><span class="token operator">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"key"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"key2"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token property">"payload"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"event3"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"nested Obj"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"vec1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"vec2"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"vec3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"key"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"key3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token property">"payload"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"event3"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token null keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This configuration reads the file <code>sample.json</code> <em>delimited by lines</em> for events. The <code>s3pipe</code> pipeline destructures the line contents to set the <code>data</code> for the object to upload and its <code>key</code> as meta-data. The s3-sink would then upload the data to AWS S3 with key set to $key inside the bucket <code>tremordemo</code> <em>or anything that is given in the config</em></p><p><img loading="lazy" alt="Sample Working" src="/assets/images/s3diagram-295f6786ca081822d2571d86683d629d.png" width="626" height="217" class="img_ev3q"></p><p>The sink also has the <code>min_part_size</code> configuration parameter. S3 support uploading larger objects in multiple parts. One can send multiple events with the same <strong>key</strong> consecutively, and Tremor would append the content of all those events, and whenever the content size gets larger than the <strong>min_part_size</strong>, a part is uploaded to s3. Whenever the key changes or Tremor stops, the upload for the previous key is completed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ending-thoughts">Ending Thoughts<a href="#ending-thoughts" class="hash-link" aria-label="Direct link to Ending Thoughts" title="Direct link to Ending Thoughts">​</a></h4><p>I had a very productive and fun time with the Tremor Community. The Tremor principle of "never <strong>worry</strong> about it" has helped me to deal with clueless moments during this mentorship. I would like to express my regards and gratitude to Matthias, Heinz, and Darach for giving me this wonderful opportunity and helping me develop as an open-source contributor and as a joyful person. A special thanks to Matthias for being there to clarify my doubts and fix my mistakes and for being really helpful.
I would continue to be a part of the Tremor Community and hope to engage with more newcomers to open-source. I would wish to be part of future CNCF events. You may see me around at the Tremor <a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer">Discord</a>.</p>]]></content:encoded>
            <category>connectors</category>
            <category>s3</category>
            <category>mentorship</category>
            <category>cncf</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Dead Code Detection in PHP]]></title>
            <link>https://www.tremor.rs/blog/2021/11/09/php-dead-code-detection</link>
            <guid>https://www.tremor.rs/blog/2021/11/09/php-dead-code-detection</guid>
            <pubDate>Tue, 09 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Identified Need]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>We have a humongous PHP application - around 20 million lines of code. It’s believed that there are certain parts of the codebase that are no longer used, but it’s hard to reliably find out which ones. Due to the dynamic nature of PHP, attempts at static analysis have failed. We decided that dynamic analysis was needed, and created a PHP extension that logs all the calls to all functions and methods. That’s a lot of data, and we used tremor to aggregate it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>We need to be able to aggregate a lot of data (the extension sends one message for each HTTP request, which can be at the order of hundreds per second for some servers), counting the number of calls to each function or method in the codebase and send it to our service which does further aggregation and presents the data.
<img loading="lazy" alt="High Level Architecture" src="/assets/images/dead_code_detection_diagram-ed8ac4fbb8b9c7d345902e0c616d0bfc.png" width="4810" height="910" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h2><p>We used Unix Sockets (which were added as a source to tremor during this project) and then a simple script that aggregates the data. We’re hoping to use custom aggregate functions in the future (there’s an open RFC, waiting for the official voting) to further simplify the pipeline.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>We are currently testing the solution with smaller applications, seeing minimal performance impact and no impact on stability. We were able to delete unused code from those applications without affecting their operation.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Unified Observability Platform]]></title>
            <link>https://www.tremor.rs/blog/2021/11/08/uop</link>
            <guid>https://www.tremor.rs/blog/2021/11/08/uop</guid>
            <pubDate>Mon, 08 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[As Wayfair's technology organization modernizes its infrastructure services to meet]]></description>
            <content:encoded><![CDATA[<p>As Wayfair's technology organization modernizes its infrastructure services to meet
new volumetric peaks they continually adapt, adopt and atrophy out systems and services.</p><p>This is particularly difficult with shared infrastructure and services that are ever-present
but seldom seen by many of the engineers in the organization.</p><p>The rise of OpenTelemetry provides an opportunity for developers to consolidate on SDKs that
are consistent across programming languages and frameworks. For our SRE's and operators it
offers ease of integration and ease of migration of services.</p><p>Tremor is a core enabling component of Wayfair's migration strategy. Tremor supports
but is endpoint, protocol and service agnostic. This allows our operational teams to
switch from on-premise to cloud native services with minimal coordination with others.</p><p>This also allows switching from in-house to managed or out of the box services supported
by cloud providers.</p><p>Moving 1000s of developers to a new technology stack when you are operating continuously
with no downtime and at a large scale is hard.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>Tremor emerged from production needs in existing systems, specifically
in the logging and metrics or observability domains in a large
hypergrowth and heavily speciated and specialized production environment
that operates 24x7x365.</p><p>As this infrastructure is migrated from a largely on-premise data-centre
based environment to a cloud native environment and the wider technology
organization it operates within doubles in size, change is inevitable.
You can bet your roadmap on it.</p><p>One great emerging de facto standard is the observability sub-domain
that cloud-native computing is propelling forward with standards such as
the CNCF’s OpenTelemetry.</p><p>Tremor added initial support for OpenTelemetry in February 2021.  </p><p>For decades, observability - whether logging, metrics or distributed
tracing has been common. But, lacking in a unified approach, lacking in
a core set of interoperable and interworking standards.</p><p>OpenTelemetry has good support for capturing and distributing logs,
metrics and trace spans. It has sufficient out of the box to suit the
most common needs, most of the time. It affords developers an
opportunity to rationalize libraries and frameworks around shared
concepts, shared understanding and shared effort. This is especially
valuable in large, complex production operations such as Wayfair’s
eCommerce production estate.</p><p>Languages and platforms change over time. System and component
infrastructure are continuously evolving. As SaaS environments continue
to evolve and innovate new forms of observability; or production
operations, system reliability engineers or network operations teams who
often need to move faster than the pace of application or infrastructure
developers can develop new software and systems - this is a hard
problem.</p><p>By targeting OpenTelemetry - developers can depend on a consistent set
of SDKs for most common observability needs. Production focused teams
can depend on a consistent wire-format and protocol allowing them to
move from data-centre to the cloud, and rewire the infrastructure and
services just in time.  </p><p>Through OpenTelemetry, we can normalize the concepts, the code and the
inner workings of our cloud-based systems and services - whilst
introducing far more flexibility than ever before as observability
services and software vendors provide a standards-based and
interoperable path.  </p><p>It is a win-win for all concerned.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p><img loading="lazy" alt="High level architecture - current system" src="/assets/images/image1-32716253b3dd4aa772701e3b429e0bc2.png" width="936" height="546" class="img_ev3q"></p><p>In production at Wayfair, logging and metrics data distribution
pipelines are all handled by tremor. With OpenTelemetry, distributed
tracing can now be standardized across our production estate.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>Standardize an Tremor and OpenTelemetry together.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>The introduction of OpenTelemetry allows developers to standardize on
Observability in applications, services and code for logging, metrics
and distributed tracing. As OpenTelemetry is natively supported in
tremor, it means only minor configuration changes to our existing
logging and metrics services.</p><p><img loading="lazy" alt="The new OpenTelemetry normal" src="/assets/images/image2-ca3c064f5ad4349f47324fcf1e51d363.png" width="958" height="544" class="img_ev3q"></p><p>With OpenTelemetry, distributed tracing can benefit from the same
traffic shaping and adaptive rate limiting as the rest of our
observability stack. The unification of the source, collector and
distribution tiers via kafka provides scalable and recoverable telemetry
shipping and distribution.</p><p>Tremor adds adaptive load shedding and traffic shaping that are tunable
in production. Tremor also allows legacy observability frameworks to
co-exist with OpenTelemetry for a gradual migration across the
programming languages and frameworks in production use. Finally, tremor
enables multiple downstream services to participate in the overall
solution.</p><p>As a heterogeneous ecosystem of interconnected services - the unified
observability platform based on tremor has no preferred upstream or
downstream endpoint. It is system and service agnostic. It is
bendable.  </p><p>This allows teams that prefer the GCP ecosystem to normalize to those
native services for visualization, debugging and troubleshooting. For
our ElasticSearch population, Elastic’s APM may be a better alternative.
For other teams, and our operational staff and folk with more ad hoc
needs - DataDog may be preferable.</p><p>It’s a cloud native decentralized rock’n’roll observability world out
there. Getting 5000 and growing engineers to choose a single
observability path is impossible. So, as the population cannot bend, the
unified observability leans on tremor for this purpose.</p><p>As improved services, frameworks and methods are onboarded our
tremor-based systems can be incrementally adjusted to meet changing
demands.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insights">Insights<a href="#insights" class="hash-link" aria-label="Direct link to Insights" title="Direct link to Insights">​</a></h3><p>This application of tremor does not introduce new features or
capabilities per se.</p><p>However, it is the first unified tremor-based system that spans the
entire observability spectrum. It centralizes common capabilities and
facilities for greater operational freedom, whilst decentralizing the
point-to-point endpoint connectivity for the widest applicability across
our production estate.</p><p>As tremor exposes OpenTelemetry as a client, and as an embedded server -
it is effectively used to disintermediate, interpose and intework with
legacy environments and to standardise on OpenTelemetry.  </p><p>It does this as an incremental update. Existing users have time to
migrate their systems to the new OpenTelemetry-based best-practice.
Existing processes, practices and battle-tested systems are
maintained.  </p><p>Operators have better tools to manage the production estate and to tune
capacity, performance and cost.</p><p>This is also the first tremor-based system where tremor is a key
architectural primitive allowing our observability community to
bend to the changing needs of our development and operational community
with minimal effort, and at short notice.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>As tremor expands to new domains such as search, service orchestration
and supply-chain and logistics to name but a few - our early adopters in
the logging domain have evolved from using tremor as a point solution
for traffic shaping - to building our entire observability
infrastructure based on tremor.  </p><p>New domains will extend tremor’s capabilities in multi-participant
transaction processing and distributed orchestration. The now unified
observability domain will further expand and extract capabilities that
enhance modularity and flexibility of tremor to build large distributed
systems with a relatively simple and easy to program and growing set of
languages designed for large-scale event-based processing.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Multi-Participant Transaction Orchestration]]></title>
            <link>https://www.tremor.rs/blog/2021/11/07/search</link>
            <guid>https://www.tremor.rs/blog/2021/11/07/search</guid>
            <pubDate>Sun, 07 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[The support for multi-participant transaction orchestration in tremor]]></description>
            <content:encoded><![CDATA[<p>The support for multi-participant transaction orchestration in tremor
originates with this use case from Wayfair's Search platform services
team.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>One of the frequent requests made of the tremor team by peers in the
Infrastructure organization at Wayfair has come from the search domain.
Search is a critical service at Wayfair and it is the powerplant behind
many other services - ranging from recommendation engines through to
auditing of data streams that are continually being ingested and indexed
into multiple searchable databases.</p><p>At a very high level - streams of documents need to be elementized and
broken down into one or many indexable items of interest - these items
then need to be indexed ( successfully ) into one or many search
engines.</p><p>Many of the use cases that are battle tested with tremor are relevant in
this domain:</p><ul><li>Cleansing, normalization and enrichment of documents and indexable
elementization and tracking documents and elementized items</li><li>Rate limiting, capacity-based load-shedding, with domain classification
similar to the traffic shaping use cases where tremor started</li><li>Sourcing, transformation and distribution of documents and the
synthetic events in real-time at low or very low latencies</li></ul><p>But, for the use case at hand, there are additional needs:</p><ul><li>All documents must be processed transactionally, without loss and
with proper reporting of processing outcome to upstream services and
the documents must be processed in arrival order. The guaranteed
delivery and circuit-breaker mechanisms in tremor now need to be
multi-pipeline.</li><li>All indexable elements of all documents must be indexed in multiple
downstream engines successfully ( or operator errors produced for
exceptions ) while all possible error cases need to be caught and
reported upstream in order to issue retries or let operators
intervene. This is a reasonably orchestration mapping processed elements and tracing
back to the documents the elements were produced from before publication
down stream.</li><li>There is significant variability, variant on a case by case basis, to the exact semantics
required for different document types to be processed to a varying number of downstream
indexing systems and technologies. The solution needs to be modular</li></ul><p>Gathering and aggregating multiple parallel processing outcomes and
subsuming them under a common transaction is outside of the baseline
scope of message-based and message-like systems as they typically only
support point-to-point transactions. Correlation across multiple event
streams usually needs to be solved on the application level. Where
systems support orchestrated transactions - these are typically
constrained by transport/protocol or other factors beyond the
application authors control, and therefore inflexible under variant (
and often fast-changing ) production needs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Expand on tremor’s QoS facilities so that multi-participant transaction
orchestration is possible, easily composable and user programmable.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>The original use cases for tremor were relatively straightforward and
data distribution applications with a requirement for traffic shaping
and rate limiting for data streams when downstream systems were prone to
being overwhelmed at peak traffic conditions.</p><p>These occurrences were rare - but their impact was high when they
happened. And in an infrastructure with higher high peaks year on year
this is an ever-present hazard of doing business.</p><p>More recently, delivery guarantees are expanding as new domains adopt
tremor in production. In these domains data loss, even user defined and
strictly capacity managed traffic shaping, is not tolerable.  </p><p>Like with many real-time systems - the percentage of the overall
in-flight volumetric that requires transactional delivery is typically a
small subset of the overall firehose. Take financial trading systems for
example - orders and trades are transactional and they need to be
processed, each and every one, correctly - as there are fiscal and
regulatory conditions that need to be strictly met.  </p><p>But pricing - the ability to buy or sell and equity, or the current
currency rate is often naturally continuously changing due to supply and
demand, and naturally redundant - as you can buy or sell the same stock
on many different venues.</p><p>The search case stretches the QoS mechanisms in tremor and the internal
mechanisms used to track events as they are processed from a single set
of flows and a small set of participants - to larger and more complex
user defined flows that orchestrate transactions of arbitrary
complexity.  </p><p>This is compounded by tremor-based applications today being large,
increasingly sophisticated and modular. So the QoS mechanisms that were
originally constrained to the boundary of a single pipeline - now need
to be preserved and propagated across an entire deployment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h2><p>Tremor’s core processing element - pipelines - are executable
directed-acyclic graphs.</p><p>A tremor user designs a workflow or pipeline using the tremor query
language.</p><p>Tremor converts this to a directed graph and makes sure that it is
acyclic.</p><p>Tremor transforms and optimizes the user defined graph to an executable
form that is well-structured for easily supporting easy to understand
and easy to define qualities of service.</p><p>If we imagine the pipeline graph as a single larger directed-acyclic
graph we have what tremor actually uses for event distribution
internally. Tremor can distribute and process user defined events -
these are business or data events that originate from connectors or user
defined logic.  </p><p>Tremor can inject control events - these are runtime events that tremor
uses for quality of service and they are not ordinarily user visible.
Tremor can also inject events originating at outputs ( or that propagate
from downstream systems ) backwards to inputs ( or for propagation to
upstream systems ). But, we can do so without introducing cycles.</p><p>The user-defined graph is acyclic. But the tremor runtime has, in
effect, the ability to coordinate acknowledgements for user-defined
events and an ability to signal upstream breaks in connectivity to
downstream systems, or downstream breaks to upstream systems. These
runtime control events - we call them signal-flow and contra-flow - are
transparent to users.  </p><p>Our <code>wal</code> ( write-ahead-log ) operator produces and consumes
signal-flow and contra-flow events.  </p><p>So, given a simple tremor application that has no defined QoS ( it does
not use guaranteed delivery )  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">/etc/tremor/config/lossy.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select patch event of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  insert hostname = system::hostname()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="we-can-configure-the-wal-operator">We can configure the <code>wal</code> operator<a href="#we-can-configure-the-wal-operator" class="hash-link" aria-label="Direct link to we-can-configure-the-wal-operator" title="Direct link to we-can-configure-the-wal-operator">​</a></h3><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">/etc/tremor/config/mostly_guaranteed.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use tremor::system;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator in_memory_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> read_count = 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select patch event of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  insert hostname = system::hostname()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in into in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in_memory_wal into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a logically equivalent application - but we can tolerate a lag
of up to 1000 events or 1 megabyte of data before losing data. Under the
hood of course - events are now tracked and traced. If connectors are
QoS aware then we now have a more robust application.</p><p>So if we are consuming from a kafka cluster upstream and distributing to
another kafka cluster downstream ( such as in another data center ) -
those systems can go offline briefly or be disconnected. The connectors
themselves handle lossless delivery ( that’s handled by kafka in both
cases in this example ). Connectors with less strong guarantees can
still be ( mostly ) lossless - so if our downstream system is HTTP-based
( like elasticsearch ) - we can tolerate transient service loss and
fully recover.  </p><p>What if tremor or the host it is deployed on is rebooted?</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">/etc/tremor/config/mostly_guaranteed.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use tremor::system;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator in_memory_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dir = ”./recovery”, # Persistent file-based recovery file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  read_count = 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select patch event of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  insert hostname = system::hostname()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in into in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in_memory_wal into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The tremor developer doesn’t need to be too concerned with the internal
mechanisms, or their implementation. And for simple applications with a
single primary data flow, its as easy as the examples above to
selectively introduce grades of guaranteed delivery with a spectrum of
robustness that derives from choice of connectivity ( kafka vs http ) or
how the <a href="https://www.tremor.rs/docs/tremor-query/operators/" target="_blank" rel="noopener noreferrer">qos</a>
operators are chosen, placed in a flow, and configured.</p><p>Orchestration however, is different. In an orchestrated transaction the
user defined logic provided by the tremor developer also needs to do
some tracking. This is achieved through using tremor’s state mechanism
alongside the <code>qos</code> capabilities and operators that tremor provides to
compose a solution.  </p><p>So, in our search case - let us say we have two downstream search
engines - and both need to index a different set of items of interest
elementized from a single document - we use the state mechanism to track
progress of the items for each participant - and when all participants
have indexes up to date - we issue a synthetic event ( that can be
recorded in a wal ) that publishes the document processing status
downstream.</p><p><img loading="lazy" alt="search logic" src="/assets/images/image1-cb4dd9235b1af1100251fcd71cac1652.png" width="960" height="720" class="img_ev3q"></p><p>So our document source is kafka, our indexing engines for elementized
items and our destination for successfully elementized documents ( which
may now be enriched with elementization metadata and index metadata )
can now be published ( let’s assume kafka again for simplicity ) to an
audited topic.  </p><p>The state mechanism in tremor is a readable/writable value - so
persistent and recoverable state is a relatively simple composition:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script remember</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let state = event;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator forget_me_not</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dir = "./brain",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  read_count = 1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script remember;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator forget_me_not;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into remember;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from remember into forget_me_not;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from forget_me_not into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Please don’t run out of disk space!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Most of the changes required to evolve tremor form supporting great qos
for simple single pipeline applications to complex multi-pipeline and
multi-participant stateful orchestrations did not expose new features to
the tremor developer or user.  </p><p>It has been a significant change to tremor internals, however and the
work reaches a stable point with our <code>0.12</code> release - the ability to
<code>pause</code> and <code>resume</code> connectors, and the ability for the tremor
runtime itself to detect and act on <code>quiescence</code> will mean that tremor
is flexible enough for the demands and use cases that originated in the
search domain.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Modularity, Oh My]]></title>
            <link>https://www.tremor.rs/blog/2021/11/06/modularity</link>
            <guid>https://www.tremor.rs/blog/2021/11/06/modularity</guid>
            <pubDate>Sat, 06 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Identified Need]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>The adoption growth of tremor inside Wayfair is such that we have
production customers with 3.5 years of experience operating tremor in
production with very large, complex tremor-based services - and fresh
demands from new domains such as Search - whose requirements for
multi-participant transaction orchestration are driving enhancements to
qualify of service, guaranteed delivery and circuit breaker capabilities
within tremor’s core processing engine.</p><p>Some usage patterns are becoming common enough that sharing tremor
application logic across teams, across organizations, and across domains
is now common. For example - tremor has good support for HTTP based
interactions and already interfaces with a number of HTTP-based and REST
APIs, and it can expose HTTP-based interfaces to participants and act as
a REST-based or HTTP-based service. Many of these services share the
same needs around handling HTTP errors and routing errors and alerts.</p><p>At the event flow or query level - similar levels of sophistication are
emerging in the installed user base.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Expand tremor’s domain specific languages to support modularity,
starting with the scripting language but extending into the query
language to maximise reuse of user-defined processing logic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>Provide standard mechanism and syntax to discover, reference and consume
functional units of logic that can be shared by all tremor domain
specific languages.</p><p>A new lexical preprocessing phase has been introduced allowing source to
be packaged within a modular set of paths through a <code>TREMOR_PATH</code> environment
variable. Since V0.8 of tremor the scripting and query languages both
support modules, and share the same module syntax and semantics.</p><p>The tremor API was upgraded to supported preprocessed or non-modular
source so that no API changes were required to extend the deployment
mechanisms to support modularity.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modular-scripting">Modular scripting<a href="#modular-scripting" class="hash-link" aria-label="Direct link to Modular scripting" title="Direct link to Modular scripting">​</a></h3><p>In a nutshell - this added support for user defined constants and user
defined functions.</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">my_mod.tremor</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Tail recursive implementation of fibonacci</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn fib_(a, b, n) of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case (a, b, n) when n &gt; 0 =&gt; recur(b, a + b, n - 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  default =&gt; a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn fib(n) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fib_(0, 1, n)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The module can be loaded via the module path and used in other script or query sources:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">fib.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># A streaming fibonacci service*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script fibber</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  use my_mod;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    my_mod::fib(event)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script fib from fibber;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into fib;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from fib into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modules can be file-based, or defined inline in the scripting or query
language. A standard set of system modules is provided by tremor out of the box.</p><p><a href="https://www.tremor.rs/docs/tremor-script/modules" target="_blank" rel="noopener noreferrer">Tremor Modules</a>  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modularity-in-the-query-language">Modularity in the query language<a href="#modularity-in-the-query-language" class="hash-link" aria-label="Direct link to Modularity in the query language" title="Direct link to Modularity in the query language">​</a></h3><p>In the query language windows, scripts and pluggable operators may be
defined and shared across queries.</p><p>There is an RFC for modular sub-query to allow query sub-graphs to be
defined and shared which is being delivered as part of a tremor LFX
mentorship.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modularity-in-the-deployment-language">Modularity in the deployment language<a href="#modularity-in-the-deployment-language" class="hash-link" aria-label="Direct link to Modularity in the deployment language" title="Direct link to Modularity in the deployment language">​</a></h3><p>Modular deployments through replacing the YAML configuration syntax with
a deployment language will embed the modular query language, which in turn
embeds the modular scripting language.  </p><p>This work is under development and will span multiple releases - but it
is being designed in such a way that as clustering capabilities are added to tremor, that
clustered or  distributed deployments will be modularly composable by end users using
the same  tooling as the other DSLs within tremor.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h2><p>The support for modularity is thematic. The scripting language now
supports a functional programming paradigm and file-based or nested
inline modules. The query language can embed modular scripts using the
same module mechanism and definitions in the query language are also
modular.</p><p>Modular sub-query and the introduction of the deployment language are
planned and in progress and will extend modularity to the administration
of running tremor nodes.</p><p>And, in the fullness of time, clustering will further extend modularity
in tremor to maximize operator and tremor developer productivity through
efficient reuse and sharing of common tasks.</p><p>The first set of connectivity to benefit from modularity is the support
for CNCF OpenTelemetry. This is the first set of tremor connectors to be
delivered that ships with its own set of modules designed to make
designing OpenTelemetry based services in tremor easier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>As tremor grows into new domains, and the algorithm and solution
complexity of traditional production domains for tremor increase in
sophistication, size, complexity, the subject of modularity has evolved
and new demands continue to emerge.  </p><p>We expect the <code>modularity</code> theme to be long-lived, but its origins
derive from production needs. When tremor was developed the user defined
logic was small, relatively simple and applications built with tremor
were fairly monolithic.  </p><p>Today, multi-pipeline and medium to large tremor-based applications are
common. And adoption of the modular scripting and query language
primitives is now driving larger and more sophisticated use cases.</p><p>Another dimension of modularity is the ongoing expansion of connectivity
in tremor. Modularity here reflects a different production-driven need (
and a few maintainer conveniences ). A plugin development kit is being
developed that will allow connectors and other plugins to be developed
in separately managed and maintained projects. This in turn allows the
core of tremor to be managed independently of connectivity.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Kubernetes and Tremor Sidecars]]></title>
            <link>https://www.tremor.rs/blog/2021/11/05/kubernetes-sidecars</link>
            <guid>https://www.tremor.rs/blog/2021/11/05/kubernetes-sidecars</guid>
            <pubDate>Fri, 05 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Happened Before]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>The simplified architecture of our systems is currently:</p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-546e9398e3b74c01fefca8fa7450da0e.png" width="598" height="168" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>Wayfair’s technology organization is continuously expanding, evolving
and growing. When work on tremor began we were running almost entirely
in our own data centres, on our own hardware.</p><p>Today, we are running largely in the cloud. Whether cloud-native or
bare-metal the sidecar pattern has proven to be a significantly popular
deployment pattern with tremor-based systems in production at Wayfair.  </p><p>Tremor is equally happy with clustered ( just a bunch of event
processors ) centralized deployments or with sidecar deployments; on
containerized virtual machines, or alongside our growing Kubernetes
estate.</p><p>With the rise of Kubernetes and cloud-native at Wayfair - we had an
interesting challenge as an infrastructure organization serving the
1000’s of developers in our wider technology group. How do we continue
to deliver a single pane of glass to our developers?  </p><p>Although the over-simplified architecture diagram above looks simple -
its far more complex in practice. We have multiple independent search
and visualization clusters. And we have many more infrastructure
services and clusters sitting behind these frontends.  </p><p>For our application developers - this looks like a vanilla installation
of ElasticSearch and Kibana. In reality its an always-changing and
forever-speciating set of services running 24x7x365 offering a
single-pane-of-glass for our developers convenience.  </p><p>By this state of use case evolution and adoption of Tremor at Wayfair -
tremor is at the centre of a lot of the internal data distribution and
processing - whilst offering no protocols, APIs or transports of its
own - entirely invisible to our target developer community.  </p><p>Our Kubernetes team developed helm charts for tremor to preserve the
convenience of this illusion; whilst accelerating the operationalisation
of our emergent cloud-native infrastructure services.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Boldly go cloud-native, in such a way that no-one truly notices.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>No new features or capabilities were developed for this use case by the
tremor team.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>Adopt helm-based deployments of tremor for our cloud-native and
kubernetes-enabled applications and services. The helm charts have since
been open sourced in collaboration with our Kubernetes Team as a part of
tremor, and have been extended to support OpenShift by the tremor
community ( waves to <strong>Anton Whalley</strong> of <a href="https://www.meetup.com/Rust-Dublin/" target="_blank" rel="noopener noreferrer">Rust Dublin</a> fame! ).</p><p><a href="https://github.com/tremor-rs/tremor-k8s-helm" target="_blank" rel="noopener noreferrer">Tremor Helm Charts</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Shortly before tremor was open-sourced and donated to the Linux
Foundation it became cloud-native itself through the combined efforts of
the Infrastructure group at Wayfair - especially our Platform
Engineering, SRE’s and our Kubernetes teams' hard work.  </p><p>We hope to productize and open source other solution packs that enable
the wider tremor community to quickly bootstrap production environments
based on the tremor-based systems we already have in productioning in
our Logging, Metrics, Observability, Kubernetes and Search teams.  </p><p>In a large way - the early successes of tremor and our adoption of
cloud-native and cloud-based computing aligned the goals of the tremor
project with those of the Linux Foundation and the Cloud Native Compute
Foundation where tremor is now an early stage sandbox project.  </p><p>If you’re reading this - and the work and philosophy resonates with your
organization, your people and you believe similar benefits could elevate
your production environments - then please reach out to us in the tremor
community and get involved, join us and help us shape tremor’s future.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
            <category>k8s</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Data Flow with Tremor]]></title>
            <link>https://www.tremor.rs/blog/2021/11/04/data-flow</link>
            <guid>https://www.tremor.rs/blog/2021/11/04/data-flow</guid>
            <pubDate>Thu, 04 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Happened Before]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>The simplified architecture of our systems is currently:  </p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-546e9398e3b74c01fefca8fa7450da0e.png" width="598" height="168" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>The need to route and process data from multiple sources to multiple
destinations with one or many potentially overlapping streams of data
processing is already evident in the first 2 phases of Tremor’s
emergence as a mission critical piece of infrastructure at Wayfair.</p><p>Growing adoption and the increased sophistication of processing needs
now results in the emergence of event/data flow or pipeline processing
by our production users. We summarise multiple phases of evolution here
and conflate them into a single case study.  </p><p>In reality the use case captured in this synopsis composes multiple
smaller projects related by the same identified need spanning multiple
releases into a single case study.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Our systems specialists are writing increasingly complex, layered and
rich business logic within tremor’s domain specific language
<code>tremor-script</code> and are inhibited by our pipeline model which uses the
YAML format for describing data flow graphs.</p><p>YAML is hard to write, and hard to debug, and the embedded scripting
language is an odd fit into the pipeline configuration which is
described in YAML.</p><p>Preserving the internal pipeline processing and execution mechanisms -
replace the verbose YAML syntax with a statement oriented query language
that extends the expression oriented scripting language.  </p><p>This allows hygienic and helpful error reporting with suggested
workarounds and fixes, better IDE integration and a more intuitive means
to express data flow operations on multiple data streams that the
pipeline mechanisms expose to tremor systems application developers.  </p><p>A structured query-like language suitably captures the directed-acyclic
graph nature of data flows but we need to support rich nested JSON-like
data structures with leverage of the processing capabilities of the
scripting language - whilst opening up new capabilities to extend the
processing capabilities through custom operators, embeddable scripting
logic and extensions and enhancements to QoS and non-functional
primitives.</p><p>For the metrics domain - the ability to aggregate tumbling windows of
events and to provide multiple aggregation dimensions with flexible
grouping policies is a new requirement.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>Replace the YAML-based pipeline configuration with a structured
query-like language that embeds the scripting language, providing top
grade support for processing rich data structures, extensibility through
custom operators, and windowing semantics to support multi-resolution
event aggregation.</p><p>The initial solution was the introduction of the tremor query language.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>The query language not only replaces the YAML-based event flow syntax
for describing data flow pipelines and processing - which is useful for
every domain using tremor in production at Wayfair - but, it has special
considerations for the metrics or other analytic domains that require
rich means of grouping and aggregate processing of in-flight streaming
data. The embedding of scripting logic allows the traditional domain of
ETL and data processing and transformation to be natively supported with
a more intuitive syntax.</p><p>A rate limiting or traffic shaping example ( common to multiple usage
domains ):</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># File traffic.trickle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Very basic traffic shaping algorithm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Define a bucket grouping operator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define grouper::bucket operator kfc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Logic for categorizing events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script categorize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let $rate = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let $class = event.`group`;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { "event": event, "rate": $rate, "class": $class };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># An instance of the grouper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator kfc from kfc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># An instance of the categorizer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script categorize;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stream ingested events into the categorizer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into categorize;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stream categorized events into the grouper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from categorize into kfc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stream categorized and group batched events downstream</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from kfc into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The relatively simple structured query-like language allows script and
window definitions to be reused. The <code>define</code> statements do not create
operator instances in the data flow graph; they create named reusable
definitions that encompass the desired semantics. The <code>create</code>
statements create the nodes of the directed acyclic graph. The
<code>select</code> statement is a builtin operator that is used for linking
nodes in the graph together to form a data flow or event processing
graph.</p><p>Although the sample logic in the example is a simplified version of what
our logging and metrics service teams actually develop and maintain for
our production systems - it replaces 1000s of lines of cryptic YAML with
hundreds of lines of easy to debug and reason about query code.</p><p>An aggregation example from the metrics or analytics domain. This example
is a complete but simplified example of a tremor event processing application:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">aggregator.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Aggregate events using a high dynamic range histogram with 10 second, 1 minute, 10 minute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># and 1 hour aggregate summaries.*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "measurement": event.measurement,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "tags": patch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event.tags of insert "window" =&gt; window </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # Windowed histogram - for median and a selection of quartiles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "stats": aggr::stats::hdr(event.fields[group[2]], [ "0.5","0.9", "0.99", "0.999" ]),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "class": group[2],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "timestamp": aggr::win::first(event.timestamp),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The higher resolution aggregates are merged into lower resolution aggregates to conserve memory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in[`10secs`, `1min`, `10min`, `1h`]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where event.measurement == "udp_lb"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == "kafka-proxy.endpoints"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == "burrow_group"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == "burrow_partition"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == "burrow_topic"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The operator maintains a user defined composited set of group partitions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Each group maintains its own set of aggregation windows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by set(event.measurement, event.tags,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">each(record::keys(event.fields)))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into normalize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Discard computed events with a small sample set</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">having event.stats.count \&gt; 100;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In most real world tremor-based systems - the synthetic events computed
in processing pipelines are tailored to conform to the schemas expected
by multiple downstream systems:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">normalize.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Prepare computed histogram summaries for downstream systems ( eg: telegraf/influx )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "measurement": event.measurement,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "tags": event.tags,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  "fields": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "count_#{event.class}": event.stats.count,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "min_#{event.class}": event.stats.min,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "max_#{event.class}": event.stats.max,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "mean_#{event.class}": event.stats.mean,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "stdev_#{event.class}": event.stats.stdev,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "var_#{event.class}": event.stats.var,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "p42_#{event.class}": event.stats.percentiles["0.42"],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "p50_#{event.class}": event.stats.percentiles["0.5"],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "p90_#{event.class}": event.stats.percentiles["0.9"],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "p99_#{event.class}": event.stats.percentiles["0.99"],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "p99.9_#{event.class}": event.stats.percentiles["0.999"]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from normalize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compared to the disparate services and software elements that tremor
replaces - the query language affords an intuitive and easy to reason
about high level domain specific language to configure rich event
processing and data enrichment and transformation pipelines - with a
minimally terse yet easy to read form.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Tremor’s core mission and mandate includes the efficient declaration of
arbitrarily complex directed-acyclic pipeline processing graphs that are
memory and compute efficient under the hood whilst preserving
transparency or remaining <code>hidden</code> to most of the developers in our
organization by continuing to conform to external transports, protocols
and service interfaces in the surrounding production infrastructure
estate.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Data Distribution]]></title>
            <link>https://www.tremor.rs/blog/2021/11/03/data-distribution</link>
            <guid>https://www.tremor.rs/blog/2021/11/03/data-distribution</guid>
            <pubDate>Wed, 03 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Happened Before]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>After the initial production success of tremor as a point solution for capacity
management during our peak trading cycles at Wayfair, the focus shifted a little
to the next key set of issues with our traditional observability platforms.</p><p>The simplified architecture of our logging systems is currently:  </p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-638996ab9adf5b141b60cdeb4ab8a2de.png" width="598" height="168" class="img_ev3q"></p><p>The traffic shaping use case was a huge win for Wayfair's SRE and operational
teams who manage our production estate.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>But we could do a lot better. The development lifecycle to capture, normalize,
enrich, enhance and standardize logs from 1000's of engineers, 1000's of applications
built in a diversity of programming languages was a have task for our observability
engineers.</p><p>Their environment still looks pretty grim:</p><p><img loading="lazy" alt="new pipeline" src="/assets/images/image3-931314084952fca9c5dc4a5d63edad3d.png" width="598" height="168" class="img_ev3q"></p><p>Displace and replace a plethora of in-house, open-source and commercial
off the shelf log capture, metrics capture and data distribution
technologies with a single cost-effective at hyperscale dynamically
load-adaptive solution.</p><p>The decision was taken to expand the processing capabilities of tremor beyond
traffic shaping, classification and rate limiting rules to general purpose
data processing of unstructured hierarchic JSON-like data streams. The shape
of data most common within the observability domain we were focused upon.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Our systems specialists and service reliability engineers can
consolidate knowledge and tune to a unified operating experience and
center of excellence in our production estate based on a single well
known and cost efficient easy to operate alternative.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>It is understood that data will be captured from and distributed to a
diverse and ever-changing set of production systems - built in many
programming languages and environments and distributed to an unknowable
set of destination systems.  </p><p>These systems include, but are not limited to: Graylog Extended Log
Format, Syslog,<br>
<!-- -->Kafka, TCP, UDP, Telegraf, Influx Line Protocol, ElasticSearch and many
more...</p><blockquote><p>Connectivity must be flexible enough to capture data from and
distributed data to synchronous, asynchronous protocols, transports
and systems without developers needing to learn or integrate with a
new technology. The solution must be invisible to developers.</p></blockquote><p>The unit economics of the existing system is hard to measure, hard to
plan and hard to remediate; especially given the rising year on year
firehose volumetrics, with rising velocity and rising peak loads.</p><blockquote><p>99% of the data either originates as JSON, or is transformed to JSON
just in time.</p></blockquote><p>The target systems for displacement and replacement have very well
understood and extract, load, transform, enrichment and normalization
algorithms that are coded and configured differently in each system.
This is difficult to maintain, enhance and evolve in an environment
where infrastructure and services are continuously evolving.</p><blockquote><p>A rich set of ETL and data manipulation and mutation primitives are
required so that all existing methods used for data processing across
the target systems can be replaced by a single easy to understand,
easy to program and optimized alternative.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>Tremor has already established itself in the traffic shaping domain in
the logging and metrics domains - adding just-in-time traffic shaping
capabilities when needed; and preserving the original system’s
operational semantics and behaviours during normal operating conditions
when the system is operating within planned capacity constraints.</p><p><img loading="lazy" alt="new pipeline" src="/assets/images/image2-546e9398e3b74c01fefca8fa7450da0e.png" width="598" height="168" class="img_ev3q"></p><p>The mandate now expands to replacing many of our event capture systems
deployed on on-premise and cloud-native operating environments across
multiple data-centres globally.</p><p>Instead of our operations and service reliability teams needing to learn
and manage the service deployment and administrative lifecycle of
multiple components in this evolution we displace and replace those
systems - typically operating as sidecars on source systems where our
applications run on virtual machines, bare metal or containerized
environments with tremor.</p><p>The relatively primitive domain specific language developed as part of
the initial solution for traffic shaping is replaced with a new domain
specific language <code>tremor-script</code> designed for expressive data
filtration, extraction, enrichment and transformation to support:</p><ul><li>Classification, Categorization and rate limiting for Traffic Shaping</li><li>Enrichment, Normalization and micro-format parsing</li><li>Structural pattern matching over hierarchical nested JSON-like data</li><li>The ability to patch, merge and iterate over JSON-like data</li><li>A familiar expression language like in regular programming languages
with arithmetic, multiplicative and other common operations on
numeric and string data</li><li>Testing string encoded data for regular expression and other
micro-formats such as the logstash <code>grok</code>, <code>dissect</code>, <code>kv</code>
or stringified embedded json</li></ul><p>The resulting language and interpreter for <code>tremor-script</code> forms the
basis of the solution and is largely designed around the needs of the
logging domain - but delivered in a more generally useful incarnation
that is more widely applicable to other domains - such as in flight data
analytics, in flight ETL or processing metrics to name a few.</p><p>Most of the in-flight events are JSON or JSON-like. Inspired by a tweet
the tremor team happens upon the work of Daniel Lemire et al and
SIMD-accelerated JSON processing. Heinz ports this to rust and tremor’s
sister project and organization simd-lite is born. The tremor team also
maintains the rust port of simd-json with other maintainers interested
in fast and efficient data parallel parsing of JSON.</p><p>Finally, tremor undergoes a steady pace of innovation with benchmark
driven performance optimizations. The combined effect of an efficient
interpreter, the ability to easily benchmark synthetic analogs of real
world use cases in our benchmark system, and the adoption of more
workload appropriate and efficient low level memory allocators such as
<code>jemalloc</code>, then <code>mimalloc</code>, then <code>snmalloc</code> by Microsoft Research
results an order of magnitude level of infrastructure cost savings. The
production estate shrinks by 10x in terms of the number of deployed
systems, the compute capacity required, and the committed memory
required when compared to the displaced and replaced systems.  </p><p>Further - tremor uses far less memory and resources on the source
systems making it a much improved sidecar on our source hosts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Tremor’s core mission and mandate now extends from high quality of
service data distribution with load-adaptive traffic management for the
1% ( and typically less ) of time our systems are under-resourced; and,
the other 99% of the time is 10x more cost efficient.</p><p>Tremor preserves its facility to remain invisible to developers during
this phase of expansion whilst drastically improving the lives of our
operational engineers and service reliability engineers. The measured
and validated cost-efficiencies offer compounding value that further
drives the mandate of the project and pushes it into its next phase of
evolution.</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Case Study - Traffic Shaping]]></title>
            <link>https://www.tremor.rs/blog/2021/11/02/traffic-shaping</link>
            <guid>https://www.tremor.rs/blog/2021/11/02/traffic-shaping</guid>
            <pubDate>Tue, 02 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Happened Before]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>This is our origin story. The simplified high level architecture of our
logging systems at  the time of tremor’s birth is:</p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-95f99ee914c307a91b9baa2c9b73c4ef.png" width="598" height="168" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>Enable load shedding and consistent capacity management at production
scale of the logging and metrics firehoses within Wayfair’s production,
staging and development environments; even when our live production
working set exceeds planned capacity, but especially when catastrophic
failure of infrastructure overwhelms our storage tier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Our network operations center, system reliability and service
organization engineers should never be in a position where in-flight
mission-critical events are unavailable or lagging ( seconds or even
minutes ) the live working set state of our production systems.</p><p>Stale operational events direct limited resources under time constraints
and production service level objective pressures to curing or tending to
the wrong problems, at the wrong times and lead to missed opportunities
for early and cheap resolution.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>It is understood that, if a critical system ( such as a production
database ) fails - query failures won’t have a single point of origin in
the logs - whether over time, or across application or business units.
When under extreme load beyond capacity - only a subset of the firehose
is required for in-flight diagnostics of our production estate.</p><blockquote><p>In-flight categorization, classification &amp; rate limiting enables
<strong>just-in-time traffic shaping</strong>, load-shedding and bending critical
infrastructure to available capacity even as capacity   changes in
planned or surprising ways.</p></blockquote><p>It is understood that, regardless of the system state - that some logs
from a subset of systems, applications or services are relatively more
important than others. This is even more true when our systems and
services are under extraordinary strain due to unplanned failures and
outages. Unplanned failures and outages are expected at Wayfair
production scale.</p><blockquote><p>The <strong>relative priority</strong> of classified and categorized events is known
and the relative priority is subject to change over time, as are the event
classifications and categorizations.</p></blockquote><p>It is likely impossible to convince thousands of engineers in hundreds
of teams across our technology organization to stop using JSON format in
the short, medium and possibly even longer term.</p><p>Snot. It’s a JSON rock’n’roll world. I guess we’ll just have to deal
with it</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>This works fine 99% of the time - but under extreme load it just does
not work at our scale and the impact to our network operations and
service reliability and technical communities is severe at the exact
moments when we are at peak trading periods and impact to the business
is highest - a perfect storm.</p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image2-927514e3e7f7524272fe3cd0eb67b856.png" width="598" height="84" class="img_ev3q"></p><p>In our ELK ( ElasticSearch, Logstash, Kibana ) based logging and Influx
( Telegraf, Chronograf, InfluxDB ) based metrics environments there are
limited means to dynamically tune the production system to accommodate
highly variant working sets. As we are an online eCommerce system we
often go through sustained periods of nominal activity followed by
insane periods of extreme peak activity - often hitting peaks we’ve
never before experienced.</p><p>We do however, have a very experienced infrastructure and platform
engineering organization that are deeply attuned to our working set and
changing business and operational needs.</p><p>The initial version of tremor simply preserved the overall pipeline:</p><ul><li>Applications in a number of programming languages generate logs</li><li>A Logstash sidecar receives, normalizes and forwards logs to
elasticsearch</li><li>ElasticSearch indexes logs for display by SRE’s and developers in
Kibana</li></ul><p>The processing stages remained unchanged ( and largely serviced by
Logstash ):</p><ul><li>Enrich raw logs with business unit, organization, application and
environment metadata</li><li>Normalize schemas - map logs to a common structure and well known
field names</li><li>Known unknowns - isolate user defined fields and extensions to a
well known slush field</li></ul><p>But added an extra processing stage, a tremor cluster that added
back-pressure detection and load-adaptive rate-limiting based on
in-flight analysis of the business events in the firehose based on
real-time categorization and classification of those event streams.</p><p>Now, in the ( significantly less than 1% ) of time when our systems are
over-capacity or experiencing catastrophic unplanned events - tremor can
<em>discard</em> events based rate limits and event classifications that can be
tuned by our SRE, NOC and systems architects and developers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Tremor’s core mission and mandate started out with, and continues to be
the non-functional quality of service of mission critical at scale event
based systems. Providing system operators with first class means to
shape and tune capacity, load and production countermeasures of the
production firehose without compromising the business with system
downtime is the core requirement.</p><p>The most effective way to achieve this in a highly fluid and ever
changing environment is what has yielded the tremor project as it became
to be - a general purpose event processing system designed for at scale
distributed mission critical systems.</p><p>When at or over capacity systems no longer bend to the business - tremor
is how we inject a little elasticity into our production quality of
service - enriching our systems and services with just-in-time
load-adaptive bendability.</p><p><img loading="lazy" alt="new pipeline" src="/assets/images/image3-638996ab9adf5b141b60cdeb4ab8a2de.png" width="598" height="168" class="img_ev3q"></p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Wayfair Case Study]]></title>
            <link>https://www.tremor.rs/blog/2021/11/01/wayfair-case-studies</link>
            <guid>https://www.tremor.rs/blog/2021/11/01/wayfair-case-studies</guid>
            <pubDate>Mon, 01 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[wayfair]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="wayfair" src="/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png" width="2709" height="638" class="img_ev3q"></p><p>Development on Tremor started in the autumn of 2018 as a point solution
for introducing a configurable traffic-shaping mechanism for our
infrastructure platform engineering organization.</p><p>There were two use cases being considered at the time- the traffic-shaping use case, which had the highest priority; and a distributed data replication use case for our Kafka-based environments.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-origin-of-tremor">The Origin of Tremor<a href="#the-origin-of-tremor" class="hash-link" aria-label="Direct link to The Origin of Tremor" title="Direct link to The Origin of Tremor">​</a></h2><p>The <a href="/blog/2021/11/02/traffic-shaping">Traffic Shaping</a>
use case required that log information streaming from various systems be
categorized and classified in-flight, so that temporally bound rate
limits could be applied when our production estate has a
working set that is in excess of our current capacity. As a
24x7x365 eCommerce environment with year-on-year higher peaks,
higher volumetrics and higher loads on our systems, this is a frequent
occurrence. Tremor was designed to remove the burden of scaling these
systems from our system reliability and network operations center
engineers.  </p><p>This use case saw the birth of Tremor, which was delivered in 6 weeks,
just in time for Cyber 5 (the long bank-holiday weekend in the US centered around Thanksgiving,
where US folk go peak shopping!). At the time, Tremor was inflexible; only
supported connectivity to Kafka for Ingres and Elasticsearch downstream; and, the classification
and rate-limiting logic was more or less hardwired- but it worked flawlessly!</p><p>Although designed with our logging systems in mind, our metrics systems
team saw that Tremor would work for their environment (InfluxDB downstream rather than Elasticsearch, but the logic was
basically the same). Tremor was designed to detect backpressure on downstream systems, and to intelligently- based on user defined
logic- react by adaptively tuning the data distribution to
selectively discard or forward data based on a classification system and rate limits.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-rise-of-event-processing">The Rise of Event Processing<a href="#the-rise-of-event-processing" class="hash-link" aria-label="Direct link to The Rise of Event Processing" title="Direct link to The Rise of Event Processing">​</a></h2><p>The user-defined logic required by our logging and metrics teams very
quickly became sophisticated. A fairly quick succession of releases saw
the logic change from fairly simple filtering, classification (enrichment)
and rate limiting (selective dropping due to backpressure) to richer needs to slice and dice nested JSON-like data, to normalize
these datasets. This rising need for sophistication in processing along with the adoption of Tremor to replace Logstash and other log shipping frameworks in our
source nodes, and to replace Telegraf in our metrics environments, gave birth to Tremor as an <a href="/blog/2021/11/03/data-distribution">event processing engine</a> in its own right.</p><p>With richer programming primitives, Tremor advanced from traffic shaping,
and log and metrics shipping to log and metrics cleansing, normalisation,
enrichment and transformation, to impose a common symbology and structure
on logs and metrics generated from many different programming languages,
platforms and tools across our production estate- from system logs
originated via Syslog, to those via GELF, or Prometheus.</p><p>The YAML-based configuration of the query pipelines quickly became error-prone and cumbersome as the sophistication, complexity and size of
application logic grew. In addition, the success of our scripting
language, <a href="/blog/2021/11/01/docs/0.11/tremor-script/index">tremor-script</a>,
and its hygienic set of tooling and IDE integration encouraged the addition a
query language, thus enabling <a href="/blog/2021/11/04/data-flow">data flow processing</a> with Tremor.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-native-migration">Cloud Native Migration<a href="#cloud-native-migration" class="hash-link" aria-label="Direct link to Cloud Native Migration" title="Direct link to Cloud Native Migration">​</a></h2><p>At the same time, our technology organisation was preparing for migration
from on-premise data centres to cloud-based systems. Our legacy VM-based
systems were now being containerised and deployed via Kubernetes in our
on-premise environments. Simultaneously, our Cloud-native infrastructure, configuration as code,
secrets management, developer scaling and many other infrastructure and
development platform teams were building out the services that would
allow our line of business service engineers to migrate to the cloud.</p><p>Tremor was already battle-hardened as a sidecar deployment, and this was
extended to Cloud-native deployments by our kubernetes team who packaged
Tremor for kubernetes as a set of <a href="/blog/2021/11/05/kubernetes-sidecars">helm charts</a>.</p><p>As a relatively fast-paced technology organisation, our logging and
metrics teams weren’t stalled- the scripting and query languages
enabled rapid development. However, lack of native support in Tremor to
modularise and reuse logic became a limiting factor. Thus, over the span of approximately a year, most of the <a href="/blog/2021/11/06/modularity">modularity mechanisms</a>, now standard in Tremor, were developed.</p><p>Tremor was now battle-tested, battle-hardened and widely adopted, having
gone through many enhancements and replacing many disparate tools and
frameworks with a single, easy-to-operate solution.  </p><p>Tremor is the first major component of in-house critical infrastructure
that was open-sourced by Wayfair and contributed to the Linux Foundation
under the Cloud Native Computing Foundation.</p><p>The Tremor team then selected a panel of experts and friends, who had early
access to Tremor, to assist with the open-sourcing process.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tremor-today">Tremor Today<a href="#tremor-today" class="hash-link" aria-label="Direct link to Tremor Today" title="Direct link to Tremor Today">​</a></h2><p>Today, Tremor is planned and progresses in the open. Anyone can
contribute, and with contribution comes maintainership. Tremor is now a CNCF
community (sandbox) project, and maintainership has grown beyond
Wayfair.</p><p>At Wayfair, Tremor has been adopted for our search environments. Our
search domain has some complex use cases for audited document
elementisation and indexing that are multi-participant and that need to
occur transactionally.</p><p>Tremor’s QoS mechanisms were extended to support <a href="/blog/2021/11/07/search">transaction orchestration</a> to enable this and similar use cases. Our search teams are also
leveraging Tremor for its traditional areas of strength in traffic
shaping and adaptive rate limiting.</p><p>Our logging and metrics teams are now recalibrating our technology
organisation's philosophy and core infrastructure that supports
observability across our production estate. The rise of CNCF
OpenTelemetry offers developers a consistent and stable set of
primitives for logs, metrics and distributed tracing. It’s a lingua
franca that offers developers consistency.  </p><p>Even more important to large or extreme scale organisations is
flexibility to make infrastructure and service decisions based on
capacity, cost, or other concerns. Through CNCF OpenTelemetry as a core
building block, now natively supported in Tremor, our observability
teams can now unify our production support, operations and services
around Tremor-based OpenTelemetry- preserving the key values that
Tremor adds, whilst opening up the Cloud Native new possibilities that
OpenTelemetry and <a href="/blog/2021/11/08/uop">OpenTelemetry-based services</a> offer.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tremor-tomorrow">Tremor Tomorrow<a href="#tremor-tomorrow" class="hash-link" aria-label="Direct link to Tremor Tomorrow" title="Direct link to Tremor Tomorrow">​</a></h2><p>As the tremor community grows, we have seen great contributions from the
growing tremor community adding support for many different types of
systems - ranging from the addition of AMQP support by Nokia
Communications through to our ongoing collaboration with Microsoft
Research on the <code>snmalloc</code> allocator which tremor defaults to. </p><p>The latest production solution based on tremor at Wayfair is from our
Developer Platforms technology organization - who have used an extension
to PHP to identify <a href="/blog/2021/11/09/php-dead-code-detection">dead code</a> in our legacy PHP monolith. This solution is
based on tremor and included contributions to tremor in the form of the
<code>unix_socket</code> connectivity. Thank you Ramona!</p><p>The Tremor maintainers also work on the Rust port of simd-json- SIMD
accelerated JSON, which is a sister project to Tremor. Mentorships via
the Linux Foundation are also producing some wonderful new capabilities
and enhancements to the system, ranging from better support for
developing gRPC-based connectors in Tremor, to GCP connectivity,
or work to add a plugin development kit to Tremor.  </p><p>Wayfair is already benefiting from community interest and contributions
to the project - and the Tremor team has hired its newest member as a
result of open-sourcing the project. We are hoping to package and open-source more components of Wayfair’s Tremor-based systems through the
Tremor Project, and through other open-source projects at Wayfair
through our new Open Source Program Office.</p><p>If you are interested, hop on over to our <a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer">community chat
server</a> and say hello!</p>]]></content:encoded>
            <category>case-study</category>
            <category>wayfair</category>
        </item>
        <item>
            <title><![CDATA[Property Based Testing of Tremor Script]]></title>
            <link>https://www.tremor.rs/blog/2021/07/06/Blog-Rohit-Property-Based-Testing</link>
            <guid>https://www.tremor.rs/blog/2021/07/06/Blog-Rohit-Property-Based-Testing</guid>
            <pubDate>Tue, 06 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Rohit's Experience working with Tremor as a LFX Spring 2021 Mentee.]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3><p>Hey, I am <a href="https://www.linkedin.com/in/kurious-diru/" target="_blank" rel="noopener noreferrer">Rohit Dandamudi</a> from India, about to complete my undergrad in CSE and will be working as a Software Engineer soon. I will be sharing my expereince at Tremor :)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="main-motivation-for-applying">Main motivation for applying<a href="#main-motivation-for-applying" class="hash-link" aria-label="Direct link to Main motivation for applying" title="Direct link to Main motivation for applying">​</a></h3><p>My work involved writing "Property-based tests for tremor-script" and some of the reasons for applying are:</p><ul><li>It involved a new type of testing I never heard of</li><li>Be part of a sandbox project where I can learn and grow with the community</li><li>The concept of learning Erlang + Rust was very interesting to me and frankly out of my comfort zone, as a person used to Python and web development in general.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-concepts-i-learned-specific-to-my-work">New concepts I learned specific to my work<a href="#new-concepts-i-learned-specific-to-my-work" class="hash-link" aria-label="Direct link to New concepts I learned specific to my work" title="Direct link to New concepts I learned specific to my work">​</a></h3><ul><li>Erlang and Rust<ul><li>My work mostly revolved around Erlang and a little Rust and I was completely new to this ecosystem, it didn't help to not find much resources or actively accessible community for Erlang.</li><li>I took this as a challenge and went through <a href="https://github.com/diru1100/learn_erlang" target="_blank" rel="noopener noreferrer">various resources to learn Erlang</a>, functional programming in general and I was able to see why this Language was involved to do the task at hand, <a href="https://twitter.com/heinz_gies" target="_blank" rel="noopener noreferrer">my mentor</a> is very passionate about Erlang and shared his thought-process, experience which helped me broaden my knowledge and how to approach any concept while learning something completely new.</li></ul></li></ul><ul><li><p>Tremor-script</p><ul><li>It is an interpreted expression-oriented language designed for the filtering, extraction, transformation and streaming of structured data in a stream or event-based processing system which is explicitly turing incomplete used to write programs specific to Tremor use-cases.</li><li>It is written using Rust but tested using Erlang</li></ul></li><li><p>Property based testing</p><ul><li><p>We have seen various types of testing approaches like Unit testing, Integration testing, End2End testing etc.</p></li><li><p>The purpose of tests is to check if our code is failing anywhere and test the same with various inputs.</p></li><li><p>Fig 1 shows different types of tests to help understand which features are specialised in what.</p><p>  <img loading="lazy" src="/assets/images/tests-comparison-graph-84a1c4d9ca841172c69e84e7762a3e3f.png" width="379" height="368" class="img_ev3q"></p><p>  Fig 1. Showing various tests wrt Feature compilance and Input scope covered <!-- -->[1]</p></li><li><p>Property based testing takes a new appraoch which has the right balance of randomness and examples. They also have this nice feature of called shrinking which shows a simplified version of sample input which is failing your tests. However, Property based testing is not an ideal solution to use everywhere but it fits our use-case here i.e testing features of a custom-language.</p></li><li><p>Some of the resources I kept below may help understand Property based testing better</p></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="property-based-testing-in-tremor-script">Property Based testing in tremor-script<a href="#property-based-testing-in-tremor-script" class="hash-link" aria-label="Direct link to Property Based testing in tremor-script" title="Direct link to Property Based testing in tremor-script">​</a></h3><ul><li><p>Property based testing is implemented using <a href="http://quviq.com/documentation/eqc/" target="_blank" rel="noopener noreferrer">EQC</a></p></li><li><p>Quickcheck is the original library written for Haskell to do property based testing ( similar to xUnit for unit-tests) and EQC is the Erlang version of it</p></li><li><p>Erlang quickcheck or EQC is the version used here</p><ul><li>Implemented by QuviQ</li><li>Free version is <a href="http://www.quviq.com/downloads/" target="_blank" rel="noopener noreferrer">quickcheck mini</a></li></ul></li><li><p>Components in Property based test</p><ul><li>Property is an abstraction of a test case</li><li>Properties are written in erlang in tremor</li></ul></li><li><p>The files shown in Fig 2 make the <a href="https://github.com/tremor-rs/tremor-runtime/tree/main/tremor-script/eqc" target="_blank" rel="noopener noreferrer">eqc part of Tremor</a></p><p>  <img loading="lazy" src="/assets/images/eqc-files-895a5c614b7b6e41f139c7b9531eb806.png" width="498" height="284" class="img_ev3q"></p><p>  Fig 2. Files related to eqc</p><ul><li><strong>gen_script:</strong> This file contains functions which create the structure of the expected expression for a partticular feature/operation that we will be testing in tremor-script</li><li><strong>model.erl:</strong> Here, we run the model specification of each operation implemented in Erlang natively.</li><li><strong>pbt.erl:</strong> Some supporting headers needed by other files</li><li><strong>spec.erl:</strong> We make use of EQC functions here to create the input generators to test a feature.</li><li><strong>test_eqc.erl:</strong> The main property of the property based test is kept here.</li><li><strong>util.erl:</strong> Utility functions to support operations for easier handling.</li></ul></li><li><p>On a high level Fig 3 explains how the property we consider is checked</p></li></ul><p><img loading="lazy" src="/assets/images/tremor-script-testing-workflow-f445d06e6edd4bdcd7386403fcced49f.png" width="2874" height="1874" class="img_ev3q"></p><p>Fig 3. Highlevel overview of Property based testing in termor-script</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-thought-process">Example thought process<a href="#example-thought-process" class="hash-link" aria-label="Direct link to Example thought process" title="Direct link to Example thought process">​</a></h3><ul><li><p>Here, I will explain about property based testing by going through a step-by-step approach on how a Property based test is written for an operation in termor-script</p></li><li><p><a href="/blog/2021/07/06/docs/0.11/tremor-script/index#patch">Patch</a> is a operation in tremor-script that is performed on Expressions(everthing in tremor-script is an expression :p ) which contains multiple record(data-type) level field operations to be applied to a target record in order to transform a targetted record.</p></li><li><p>As patch has multiple operations inside it which have to be seperately created in every step, here is where the concept of incremental implementation comes into picture, if one makes sures if the PatchOperation is implemented before, we can take advantage of that here. For example: Merge is a seperate operation on records but it also is one of the patch operation.</p></li><li><p>gen_script.erl: The following code creates the structure needed for a patch operation as shown in Fig 4.</p><p>  <img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAd0AAABRCAYAAACXOHx5AAAaVElEQVR4Ae1dC4wd1Xk+Xgw22Ng7dxcw9hocL7YXe+vHnbusvRhYYxvs7tqm2KEODlBjKI/wSNGWmpACComBkJQ+ELSGhorKaSkIQQVFFo2pSlSlgqaUlEaKk9gKApIgRCtIbLLGp/rO+r977uzcnTn3njNzZ+5/pdHMnNec8/2P77zmjhD8YwQYAUaAEWAEGAFGgBFgBBgBOwj03yMnd299eqjjvLve8BZeeailfYUUnj/mmNDWc3TK3E3vF7p3vDi1c+MqO0/nUhgBRoARYAQYgSZBYMkVz1/fvuS6X500Z4Ps2vi47LvxdTnwtU/khvvlmAPhK295Uy689Ek5pfPSTyZ1XPyG8ErdTQIVN5MRYAQYAUaAEagdgcWXP//cpI6L5KLNe+TgriNjSDaMePWw7s8+JSfOuODwcaf1baq9FpyTEWAEGAFGgBHIOQIg3ClzL1EjV51ITa/7h34sT5i55lPhFb+Qc8i4eYwAI8AIMAKMgDkCmFLGCBdTxaYkG5YexNvSvuKoaPVvNq8N52AEGAFGgBFgBHKKADZNYQ0XU8phBFpr2IINu+WEwjlHhFcczCl03CxGgBFgBBgBRsAMAexSxqapWtZwowj5+Bn9UnjFj3hzlZlMODUjwAgwAoxAThHAa0HYpRxFoLXEz+zbKYVXOiRa/X05hY+bxQgwAowAI8AIxEcA7+HitaBaSDUqT+nqffRu79uiUFwev1ackhFgBBgBRoARyCEC+OOLau/hRpFqVDzKVX+qUSi+Jjz/wRzCx01iBBgBRoARYAQMEPB8J6NcIuQR0vXfFYXSawa14qSMACPACDACjEAOEUiCdEf+QnI4h+hxkxgBRoARYAQYAQMEkiNdaVArTsoIMAKMACPACOQQASbdHAqVm8QIMAKMACPQmAgw6TamXLhWjAAjwAgwAjlEgEk3h0LlJjECjAAjwAi4Q6C1Z6ko+PeK1uLLwvMPCM8/FPb922phtNPYxbnaMzl87PeJU8bkbeH5rwrPv4/fqXZnqlwyI8AIZBmB1qVzhFd6SXj+e6LVf0wUSlvEtOJZYk7/5NjNMhjprhr6key7/rvywtt/Gvs1owoiiV0pTpg4AoXeDvU/2YXSQ8Lz96sOHPSLf4wAI8AIMAJCiLaeNcLzP1J/OnHKwqk1Y2JAul7nOikmtcvea77DpFsz4FnI2D9R6ZXnf8gfrMiCvLiOjAAj4BYBNcIF4Vr4gk9M0h346mHZMmWWPHn2eXJw1zCTrlsJN0bpIx27D9XsSWPUiGvBCDACjEAKCIxMKdv5W8WYpFvc9qzxKBdrxDy9nIJ+2Hwk1nixV4B/jAAjwAg0JQLYNIU13HqmlHXgYpLumecOyda5a2KPcGlTFpOuDnYWr9VU837eXJVF2XGdGQFGoH4E1C5l/7H6CzpWQkzSvfiuDyQOItO4ZyZda5JKr6CRzVV2ZlbSawU/mRFgBBiBGhDw/FfULuUasoZlaWlfftTVV4ZW3X6Qp5fDQM9aGPYO4HUi/jECjAAj0HQI4D1cvBZk6Tf1rC0/d/U93XkDjzDpWpJTqsWo14n8t1OtAz+cEWAEGIFUEPD8YSH6J9p6dmHxjme6Nj5uPG0cZ3p5+tnbiHQPClVvW7XmchJHAF+K4h8jwAgwAk2HgGXnd2LH4DmTz1j/m8FdR6wS7+o73pETCj0jpFvwX+Dv6WZcUy3rXcbR4OozAoxA0yDgwPlNnr3u9UWb91gl3WkLttIoF+dvqz9baBoh5bChDvQuhyhxkxgBRiB3CLhwfm1+18QZ5x9aecubVogX09XaruUDwiu+xa+cZFwTXehdxiHh6jMCjEAzIODK+bX1rDlh1toj9RIvCLc8rYy6ev5u/nOFHCimK73LATTcBEaAEcgzAi6dX6Fne0t779H5A49I0zVerOEGppRBuM+pP/LwSt15FklTtM2l3jUFgNxIRoARyCYCrp1foWf7BK9n+LhTV8rTe4dk8aq9stp7vHgPF68FYZdyYHRLhPsTK/8PnU1J5avWrvUuX2hxaxgBRiA3CCTh/Eb+6P5j4fm/1tZm9XXa8a7xPd/dIyNcCx9kyI3gMt6QJPQu4xBx9RkBRiCPCCTl/Nr8LuGV9grP/6Xw/O+PkGjVD68fFHgtSO1SLr6l1nB5Sjlf2peU3uULNW4NI8AIZB6BpJ0fPrCA/3vG3wB6/qEqI99h9R6u5z/Iu5Qzr2HhDUha78JrwaGMACPACCSMADu/hAHnxykEWO9YERgBRqApEWDn15RiT73RrHepi4ArwAgwAmkgwM4vDdT5max3rAOMACPQlAiw82tKsafeaNa71EXAFWAEGIE0EGDnlwbq/EzWO9YBRoARaEoE2Pk1pdhTbzTrXeoi4AowAoxAGgiw80sDdX4m6x3rACPACDQlAuz8mlLsqTea9S51EXAFGAFGIA0E2PmlgTo/k/WuuXWg/x45uXvr00Md5931hrfwykMt7SvG+y/Y1OImtPUcnTJ30/uF7h0vTu3cuCoRqcE4sn44BsqW/qQmX5v4ZF1XuP7V7d22ntgsL6QsW3Zp6v9SseOQ9jds0JIrnr++fcl1vzppzgaJb3f23fh61a+gbLhfWvkod63l4Oss+D7pwkuflFM6L/1kUsfFbwjX/0nr+fJbr8jMHspgHGqfTf1JS75W4cm4vmRZ113W3bodoXPj8GfTLk39dSp27BBLq0Uvvvz55yZ1XCQXbd5j/L1PU0G4SN/92afkxBkXHD7utL5NVoHRC8u4E63opertsnDtWn+Skq8FKEaLyLi+uCSuLJdt3Y4ckq5ruzT15YnY8agFNu4VBDNl7iVq5GgKYiOl7x/6sTxh5ppPhVf8ghO0M+5ErTuLYyAnpT9JyNeq3mRcX7JMjC7rbt2OHJFuUnZpygHO7diqETsoDFMPGOFiqtYUvEZMD4G2tK84Klr9m63DlXEnat1ZCCGS1h/X8rWqMxnXF5fEleWyrduRA9JN2i5NucCpHVs1YsuFYXEda7iYUjYFrZHTL9iwW04onHNEeJY/9J1xJ2rbWaSlPy7la9XEMq4vWSZGl3W3bUeqPIuKl5ZdmnKCMzu2iKX1orBLGZumBncdyRXpQvjHz+iXwit+ZHVzVcadqG1nkab+uJKvVSPLuL64JK4sl23bjmyTbpp2aUq8TuzYqhFbLgyvBWGXsilQWUg/s2+nFF7pkGj191mDLeNO1LazSFN/HMl3WIj+iawv2d2hnwSZ27Yj26Sbpl2acoMTO7ZmwA4Kwnu4eC3IFKgspC9dvY/esXtbFIrLrcDHpFsBY5r640i+B8S04lkVjaznJuP6kgSBZfEZVkm30NshPP/tetQsmDdNuzTlBid2HASkke7xxxd4j8oUqCykR7uUcRSKrwnPf9AK7hl3oladhRAiTf1xJN9XRFvPGiu6gkIyri9ZJMQk6mzVjrDvxPNftaZzKdulKTc4sWObYFovy/MblnAHdw3L1Tt/pg5TQVL6EdL13xWF0mtWsMu4E7XqLACoA/256Mu/UDJf/5WPI3XTunwL/r2i1f+yFV05hk8SJBD3GQ+/8H/yz5//ILN/7hK3na7TWbWjQukha4MCUlwHdkk+Neo88NXDyn7XfumdSPulsqzbMeEQ63xKz4xx00XFj5s5JDJB4fRd/105f90DsueqF2MJA4QrJrWrg4RjetaMYzik9eZBBqTbu+4G2dW7ueJAmGuHMF75Gh52/gHHov5A3iedtqwsc+hKlLy19tiRL0a5nv9Da+u6NerLkguulL+3c498/J+HI/Xlnr/+b3nHw/8emQ56semab8hzN35x3LQ33vuCXNj3u7J9Tq88tbNPrv3c3fKhZ38xbp7xdK6euLC2wYb+4Bv7UqkPtUXTuzrtqH+i8Pz91pa/yKNZtMsoGwzGw8/Db8OWg3HV7jU849lxvTxYkR/vaxVKL1VdV4qKJ9DjnhMUDpwohDG796ZYwrBMunUaxzFADZwonNZvX7VL3v5n/1Y+7nz0P3LiLEbxqGZIpuFz++9U+jGrdK1c/vv/Ii+49QeReqIZqx35YhOV5/9AeMXPxzWhcdPVqC87vvSU9Gb7ivDI0Vc7xyFSyhuV9nO37pYntXcpwv/ak/vlXbvfkKW11yoCToN4w+qLTsH9ew7kw448/z7RWnx5XB2qJTJBvx608zpJN54d18qD04rbRMF/T/mNMq4oDEdr8dNQ8o2KLxcU88JAOCBLHOfe+D3Z0XODbFuwSS7e8kTZMQLsM88dkqecvVnFnV7cXh7VIs+0Of3KqU45vUeVs+Syv1V51939v2oEfNriy1U+PAMOVyfd/tv+p/zMhRselph6Dgo77N66UzZ0onCe5PD085V/+KS89YGXy3GY9oODgWP7+t//TML5oTePEc9vrdymSJvyo0yMAK675zmVB9cUF3V2gUcY7mFhmHZatOkv5amLLlNyBslCxkiL2Q/oBTplhXkDSj8uvuuDSBlbbw/MZvqyktrYYmNDVR36Ah1Bxw0yhS5ghIqZk+KFV8ubdr2kwqErCDtj0VqlC9Ab0gHox4qBm5X+oKy/2ntYpUEY7qFXIFSUQXmmz1wqQWp0T+d5pUuUTuIenUik2Xbbt9SIGCPPbz79bkUexKFsHEhP5aB+IEzoMPQdzzZtG+k/lYmObP/mP1LP0u2N7GjoT/5VYYbRu25zlL+WsxW9G5lV+bDqACumCw9NZuDXYZfw4+R/P3P+zooOb5jfD/rg3mu+I2csvVL5fnBDHSPd+KQ7Hk8GQdHJlji0nIYC6BwkXwqnczC+XFDMCwPhAEgcx7d2qqmDCSfOUPdEnhjJYkoBoEMAFA/CLV3xjyof8k88+UyVrvPCuyXW7WhKceqsFcrhIh5l6aRLZVEdituejXTIcOZWjEOH0tCJVhvpwhEcP/0zkka+cFxwHHAAcFItU89QjgJTjFtu+As5qTCvPMUHJ4tREJwnyo87tYiyXeARRrBhYeiMQX4nzz6vrB/QpVVDP1JkDLnr+hVnTch6e0jWWNv1/A/r3lRlqC86aYCgQKaQG0gSB/QGZ+gDdAedNJAwSBF5iTA3XP2AnNV1oboHQaPzBhIC0SEv9Abpkbdz2aB6BuKhk+gABokIdUEZCEcZSAd9RRnnXzKk6klT4dBL6CwRKogc18iLTgR0Fx2IdZ//isRoGu2BnqNtIOuotkH/CScQNsoHmcJugAPKwLPIjlBvPAOYoN7BDkKwrXHu69M7NZtyn9Iv23/eQ/pr4NfJLuG34ZPhaye1LZQYDCkfeszvB30wDbjg2xGHAwMx8uc1Ti+bkW4UD4aRLeUhrCqESZE4E7nqYfo1xZv2zg2EQ4R34e0/VcI4e+BPlZPECBbCQY8JZ4xQQLQkTFqbC5te7v6dx1QZIFw9P6YXddIlB4zeGOpBZYY5dz2sAs8yyHVcGDrR0+efX3VNF44JDgjOAL3wR//p47KzQDg5MTgBfaQBp3PZTY+qtHEchJ7GBR463tWuIU/I7QRvvupoIR1mQhCG2RHco0dtIlvksd4eXTUKpS3C899X03+txS+KNr9LzOmfrCeJvDbUF+qkgVRAJkQgkCHIEKNEdLJAxkQ8IEF9nRYbpUBcwSlY6BPSghRJJ5BGnDhT3aNcGllTPJ3xLOgd7oNlQG9BZrT+Cl2mfDijbtB1XKN8jMD1eFzHbRvS6qQ7Z/H6ClsAiU89rVuN6kG6QTvC8xEefL7pvbHeYQ0RBDuyaWq/0ilTXx2pbFqCmH6d7BJkCX+Lg3wsfLOysWOku/Km19Q9xcNeEQ/frdttYtPLOv/RNfHgyctuK08jU1zwXIYrGFG+L/5XhaDL4fR916h4Sjf2DODiHAAWBwSD9EFwl279u/IUIdJRz4gIMox0ydGSAPV66KRL4ZSeyqTwaufxMRuLRZz0cQ0UBk6OsVoeOCisoemjCziFoPOD44KzQzm606lWbrXwOO0zTVMNez0c08rQCUwdUzjpAwweYaayRR7TuqaRvposguGQOXXSMC2LURylAflCT9D5AmmCkEm3gqRLZEN59XMwLUagRLr3/s0PFWHpnT3Ki5GoTro6ySMNkRlGxCB83OsHwvV0VC7O6ECibSg/qm1Ir+s/6o4Rsl4ewtCuMDuieurpa7lOQ49Mn0l2Nt6Z7JJ8u34mH0th5PfnXbRL2TL5bIoHH+BZQV4Y7/kUZ9q26ukNeHAc0v2eWtv1/EOi4D8R8rDKeNPeU8weEcAhcAn8ZZf/gwrDSBej25Yps9T9Odv3qlFr0ImSkyVhoUyMclAupqNJADhj1GuddMsg13FhOHIhxxhm2JgahBOAo8X0F6UJcxaYBqTRre50KE/cc4X+1AFDOWtM/SFd8TrXleWMqSzIHmu8kHlQX3R9qHZtvT3lhlm6sKAv0BMsN+gjV10HgkSKaWeQGNZwg3oRTKuTLo1Yw5YrQIaYDkZ5wTIQhuch37V//IxaKw4+l+6DpEdto+lnpBuvbcF4EDytbyMObQDpotwwOwo+n+ples6C3lWzGT2c7FIf6cLv4ghOL5PfD/pxWhaiJb+6STeO6Y0ZdPqVPDh92WrFl63FT6qOeMvPGS2sshAi06j4ckExL2I6TQiKSBfTyhjVTj5lsQrrWv/NCoLEtASIF2t3yEM9JpqOxlw/pjVwnHfzf1aMiFEuFvKDZZKimDpm68ZhwYnCwDGawFoaRjBwOBi5UI8dzgL3NN2MKTM4F9owpTul1J1FTP3Bu7eYWoY+oHeNdSDSHxg+5GsqW6WTo/YQby0opllYS2ZBX4gYaS0S9yAP6tBhFEnrsqQPiMeyBd1DpzDtHCRMKpvSYX0WnUDsWkYYiJv2FGAkjDCUgU4gjYhRD0zpYrYGZAfdxSid4pGPdDdIevR8encYHYtg24LT1br+Y10Za7b0LNgT4lFPJt3oGUzdLjEAwoYo+G6s75Jdkt+vRrp42wBp0KGG/6Zlo4TWdMN5kgwYvInBahj5UhpFEnhliEa2RLaUAE5mvHhKF/cc02nqpEsL5Zg+hqBoLRZkSVPK2InaOndNBelCwLSDGUKiES96SFi4J+FixAzhQcgUllXSRa9bP+BQ4BBWX3anxOYpchZwXBgtUA8dJAvnhfS6E0Je3eng3uRw0Qkh2USd0cki4oVcoSvUIUNeJt1RIg3KFORC07ZYx8T7s0S66JyBKEF8iENekBz0Bmu/2FCF9NCtKNIFyYJ48Sysh0InUba+6xdlIA4HnoHyiaTxbFpzRjg6AyiDpsqRHmSotw9T6dXaho4G8sAWqG26/qPtsCPEIRzPA5GjfCbdaNKF3eFNEcw2ke+GbcIfw14RTz64Gulivw35epRBe3mck64JD4aRb5kjFan6T1TdRh4VXy4o5kUNpAvwAXTYKx2YkkD8eK/00D8OEVmTs0aZyBsMp/hazi5IRncYLq51ZwEHQiNeG89ygYeJXKAX2GSHKagw/TEpC2mttyem2cROZjDSjZIvdAEHddSC6RGn7w1APEgLZBtMG3UP8kV5NLrW0xNxU5pq9UFelIF0ev6wa6TDUa0sxAXbppeDkfJ4+fW0Nq6zoHemtkS+G/7ZNC/Sw3/TlLRpfmM8a+VBIl/kL/8q/imjHDp6ERU/mjLeVY2kawpqWumNhRmFmkUnWs34ddKtlqbWcBd4pCVbPNd6e6LkbxqfgL7Uqgu15iPSrTV/HvJlQe/StEvTZxvjWS8P1pvf1A9UpDcgXUz54ojzn7imoLtKbyzMCnBCbhJwohiZ0PuWth2UCzxcyS5OudbbEyLyuoIS0BfbOhJVHr0aFJUuz/FZ0Ls49tMoaRoez7qcQCBzS/vyo3n9ytCq2w/aHwll3InaVu409ceJfAP2UfdtxvUlz8RZT9ts21HdehYoIE27NCXyTNhxAN+6bqeeteXnef2e7ryBR5h0AxutbDuLNPXHiXzrsqaQzEy6keu59ZBfWnlt21GI5tQVlKZdmpJuJuy4LmkEMhcW73ima+PjNS2cm4KbdPrpZ28j0j0oPD/e1ysC+Iy5zbgTte0s0tQfJ/IdI/A6AzKuL2mRWqM/17Yd1allY7KnaZemfj4TdjwG4ToCTuwYPGfyGet/M7jrSK6Id/Ud78gJhZ4R0i34L/D3dEdeLbLtLNLSH2fyrcOWQrMy6fJIN1Qx3AamZZemhJsZO7Ytrsmz172+aPOeXJHutAVbaZSL87etfSQ6407UNulCF9PQH2fytW1cGdeXRh9xplU/F3ZkW/XSsEtT0s2MHdsWDv7IfeKM8w+tvOXNXBAvpss1ozggvOJb1j4SnXEnquGivadWp0YlrD+h8sVn0hrxl3F9SYvUGv25TuzItv4mbJemhBtqx4XictswNG55bT1rTpi19kjWiReCLE8r4wVoz99t9SPRGXeizpxFQvrjXL62LTTj+tLo5JdW/ZzZkW39S8guayFcp37aNo7Oyiv0bG9p7z06f+ARmbU1XqwNBKYqQLjPCc9/T3ilbmuYZdyJOnUWDvUnMflaU5RjBWVcX9IitUZ/rlM7sq2DDu3SlGwza8e2ZVJRXqFn+wSvZ/i4U1fK03uHZPGqvbJR3+PF+13Ybo7db4FeExHuT9Q3LCsaWOdNxp2oc2dhUX9SkW+d6jEme8b1pdHJL636ObejMYpUZ4BFuzQl2lzYcZ3wR2fH+pjnfyw8/9cVyjUyXauvlzbi9QE1paxGuMXB6MYapsgGBvHkYtj02Mnd6o9b+cZuZMyEedIXbku4XcVUhdSTubXLcGyq60y27DgR4bX5XcIr7RWe/0vh+d8fmaat7aPvCRD3QYHXgtQu5eJbag3X5pRyGODVlclU+dJLH9YuW2F29Sd5+drCgcrJg75wG8JtlWSchbNduwzHo7qeZN+OE5Fxa89SUfDvFZ7/qvrcYHVATQVgM/2weg/X8x+0tks5CtzGxMEM06g22oi3oz+j8m3UXcpRWOVBX7gN4fYVJftGjLdjl+F4VNeTUTtuql3KjagAXCdGgBFgBBgBRiBhBP4fTJWcevlKl/cAAAAASUVORK5CYII=" width="477" height="81" class="img_ev3q"></p><p>  Fig 4. Diagram showing Patch operation <!-- -->[4]</p><div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">%% the input are 'patch' keyword, an Expression </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">%% and the Operation to be performed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gen_({patch, Expr, PatchOperation}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ["(", "patch ", gen_(Expr), " of ",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     lists:join(",",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [[patch_operation(Operation)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         || Operation &lt;- PatchOperation]),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     " end", ")"];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>model.erl:</p><ul><li><p>One of the ast_eval function in this file matches with patch_operation where the following input is passed  <code>{patch, Expr, PatchOperation}</code>.</p></li><li><p>An anonymous function is there to update the PatchOperatoin into the respective structure needed for us to evaluate.</p></li><li><p>At the end we take advantage of floding in lists to implemente the Erlang implementation to get the required output.</p><div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">% Operations covered by the folowing patch_operation are</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {merge, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {merge, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {insert, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {upsert, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {update, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {erase, Key}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">patch_operation({insert, Key, Value}, Acc) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    maps:put(Key, Value, Acc);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">patch_operation({merge, Key, Value}, Acc) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    maps:fold(fun combine_values/3, #{Key =&gt; Value}, Acc);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">patch_operation({upsert, Key, Value}, Acc) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    % does what we expect from upsert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    maps:put(Key, Value, Acc);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">patch_operation({erase, Key}, Acc) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    maps:remove(Key, Acc).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-spec ast_eval(#vars{}, {}) -&gt; {#vars{},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                integer() | float() | boolean() | binary()}.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ast_eval(#vars{} = S, {patch, Expr, PatchOperation}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {_, ExprUpdate} = ast_eval(S, Expr),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    UpdatdPatchOperation = lists:map(fun ({erase, Key}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedKey} = ast_eval(S, Key),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {erase, UpdatedKey};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     ({merge, Key}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedKey} = ast_eval(S, Key),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {merge, UpdatedKey};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     ({insert, Key, Value}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedKey} = ast_eval(S, Key),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedValue} = ast_eval(S,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      Value),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {insert, UpdatedKey, UpdatedValue};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     ({upsert, Key, Value}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedKey} = ast_eval(S, Key),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedValue} = ast_eval(S,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      Value),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {upsert, UpdatedKey, UpdatedValue};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     ({update, Key, Value}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedKey} = ast_eval(S, Key),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedValue} = ast_eval(S,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      Value),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {update, UpdatedKey, UpdatedValue};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     ({merge, Key, Value}) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedKey} = ast_eval(S, Key),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {_, UpdatedValue} = ast_eval(S,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      Value),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         {merge, UpdatedKey, UpdatedValue};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     (X) -&gt; X</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     end,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                     PatchOperation),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {S,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     lists:foldl(fun patch_operation/2, ExprUpdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         UpdatdPatchOperation)};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>spec.erl:</p><ul><li><p>The randomised input that we provide to test patch-feature comes from here, patch falls as a unary operation which can be performed on a records and has sub operations.</p></li><li><p>The randomisation is obtained by the frequency function we calls different generators.</p><div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">% Operations generated by patch_operation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {merge, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {merge, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {insert, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {upsert, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {update, Key, Value}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% {erase, Key}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">patch_operation(S, N) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    frequency([{1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {insert, spec_inner_string(S, N - 1),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         spec_inner_no_float(S, N - 1)}},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           {1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {upsert, spec_inner_string(S, N - 1),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         spec_inner_no_float(S, N - 1)}},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         {1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {update, spec_inner_string(S, N - 1),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         spec_inner_no_float(S, N - 1)}},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           {1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {merge, spec_inner_string(S, N - 1),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         spec_inner_record(S, N - 1)}},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           {1, {erase, spec_inner_string(S, N - 1)}},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           {1, {merge, spec_inner_string(S, N - 1)}}]).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">% spec_uop_record function returns {patch, generated_record, patch_operations}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec_uop_record(S, N) when N =&lt; 1 -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ?SHRINK({patch, literal_record(S, N - 1),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         ?SUCHTHAT(X, (list(1, patch_operation(S, N - 1))),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               (length(X) &gt;= 1))},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [literal_record(S, N - 1)]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec_uop_record(S, N) -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ?SHRINK({patch, spec_inner_record(S, N - 1),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         ?SUCHTHAT(X, (list(1, patch_operation(S, N - 1))),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               (length(X) &gt;= 1))},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [spec_inner_record(S, N - 1)]). </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ending-thoughts-and-future-plans">Ending thoughts and future plans:<a href="#ending-thoughts-and-future-plans" class="hash-link" aria-label="Direct link to Ending thoughts and future plans:" title="Direct link to Ending thoughts and future plans:">​</a></h3><p>All in all, I had/will have wonderful time at Tremor. Over the past 3-months I learned how to learn new tech-stack, got developer wisdom and understood what truely working as a team is. I want to thank Heinz, Matthias, Darach and Ana for making it fun, collaborative and inclusive environment. Although, I didn't had a lot of knowledge in this area before, I am now confident I have the right mindset to pickup new things and grow together with the team.</p><p>I would like to continue contributing to the project and explore the rust part of it more. Apart from that I want to take more responsibilty, engage with new-comers and be part of other CNCF community events.</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-resources-i-compiled-while-going-through-the-mentorship-which-yall-might-find-useful-">Other resources I compiled while going through the mentorship which y'all might find useful 🙂<a href="#other-resources-i-compiled-while-going-through-the-mentorship-which-yall-might-find-useful-" class="hash-link" aria-label="Direct link to Other resources I compiled while going through the mentorship which y'all might find useful 🙂" title="Direct link to Other resources I compiled while going through the mentorship which y'all might find useful 🙂">​</a></h3><ol><li><a href="https://medium.com/criteo-engineering/introduction-to-property-based-testing-f5236229d237" target="_blank" rel="noopener noreferrer">Introduction to Property Based Testing</a></li><li><a href="https://www.youtube.com/watch?v=QyJZzq0v7Z4" target="_blank" rel="noopener noreferrer">Why isn't functional programming the norm</a></li><li><a href="https://github.com/kurious-diru/learn_rust" target="_blank" rel="noopener noreferrer">https://github.com/kurious-diru/learn_rust</a></li><li><a href="/blog/2021/07/06/docs/0.11/tremor-script/index#patch">Tremor script patch</a></li><li>Better to use tools: <ul><li><ul><li>cat - bat - <a href="https://github.com/sharkdp/bat" target="_blank" rel="noopener noreferrer">https://github.com/sharkdp/bat</a></li></ul></li><li><ul><li>grep - ripgrep - <a href="https://github.com/BurntSushi/ripgrep" target="_blank" rel="noopener noreferrer">https://github.com/BurntSushi/ripgrep</a></li></ul></li><li><ul><li>top - htop - <a href="https://github.com/hishamhm/htop" target="_blank" rel="noopener noreferrer">https://github.com/hishamhm/htop</a></li></ul></li><li><ul><li>hexdump - hexyl - <a href="https://github.com/sharkdp/hexyl" target="_blank" rel="noopener noreferrer">https://github.com/sharkdp/hexyl</a></li></ul></li></ul></li><li>Related to EQC:<ul><li><a href="https://www.erlang-factory.com/upload/presentations/19/quickchecktutorial_tartsjhughes.pdf" target="_blank" rel="noopener noreferrer">https://www.erlang-factory.com/upload/presentations/19/quickchecktutorial_tartsjhughes.pdf</a></li><li>Resources mentioned in this issue <a href="https://github.com/tremor-rs/tremor-runtime/issues/721" target="_blank" rel="noopener noreferrer">https://github.com/tremor-rs/tremor-runtime/issues/721</a></li></ul></li></ol>]]></content:encoded>
            <category>testing</category>
            <category>mentorship</category>
            <category>cncf</category>
            <category>tremorscript</category>
        </item>
        <item>
            <title><![CDATA[Support for the Syslog Protocol]]></title>
            <link>https://www.tremor.rs/blog/LFX-Blog-Nupur</link>
            <guid>https://www.tremor.rs/blog/LFX-Blog-Nupur</guid>
            <pubDate>Mon, 05 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Nupur's experience contributing to Tremor and work overview.]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Hey folks, I am Nupur Agrawal, a third year student at Indian Institute of Technology Roorkee. This blog describes my experience of contributing to Tremor,
CNCF sandbox project in the 2021 spring chapter of <a href="https://lfx.linuxfoundation.org/tools/mentorship/" target="_blank" rel="noopener noreferrer">LFX Mentorship Program</a>, under the mentorship of
Matthias Wahl, Anup Dhamala and Heinz Gies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-abstract">Project Abstract<a href="#project-abstract" class="hash-link" aria-label="Direct link to Project Abstract" title="Direct link to Project Abstract">​</a></h2><p><a href="https://www.tremor.rs/" target="_blank" rel="noopener noreferrer">Tremor</a> is an event processing system originally designed for the needs of platform engineering and infrastructure. It is built for
the users that have a high message volume to deal with and want to build pipelines to process, route, or limit this event stream.</p><p>At the beginning of the program, I was given walkthrough of the project by Matthias and he patiently explained me the components and working of tremor.
Tremor is nicely documented and the <a href="https://www.tremor.rs/" target="_blank" rel="noopener noreferrer">docs</a> can be very useful for referring many things.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-project">My Project<a href="#my-project" class="hash-link" aria-label="Direct link to My Project" title="Direct link to My Project">​</a></h2><p>My project's aim was to enable tremor to receive and send <a href="https://tools.ietf.org/html/rfc5424" target="_blank" rel="noopener noreferrer">Syslog Protocol Messages</a>, a standard protocol used to send
system log or event messages. It was desired to support both the standard IETF format and the old BSD format via UDP and TCP/TLS. More detailed description
can be found <a href="https://github.com/tremor-rs/tremor-runtime/issues/12" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="work-summary">Work-Summary<a href="#work-summary" class="hash-link" aria-label="Direct link to Work-Summary" title="Direct link to Work-Summary">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="syslog-codec-support-via-udp">Syslog codec (support via UDP)<a href="#syslog-codec-support-via-udp" class="hash-link" aria-label="Direct link to Syslog codec (support via UDP)" title="Direct link to Syslog codec (support via UDP)">​</a></h3><p>The syslog codec encodes and decodes sylog messages (IETF and BSD format) to and from <code>Value</code> respectively. Tremor can now receive syslog data via UDP (onramp) and turn syslog messages into structured events. Also, structured events can be turned into textual syslog messages and send out via UDP (offramp).</p><p>For example, the following Syslog message </p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;165&gt;1 2021-03-18T20:30:00.123Z mymachine.example.com evntslog - ID47 [exampleSDID@32473 iut=\"3\" eventSource=\"Application\" eventID=\"1011\"] BOMAn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">application event log entry..."</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>gets translated to:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"severity"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"notice"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"facility"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"local4"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"hostname"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"mymachine.example.com"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"appname"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"evntsog"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"msg"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"BOMAn application event log entry..."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"procid"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token null keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"msgid"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ID47"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"protocol"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RFC5424"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"protocol_version"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"structured_data"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token property">"exampleSDID@32473"</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"iut"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"eventSource"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Application"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"eventID"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1011"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"timestamp"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1616099400123000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Code for the syslog codec can be found <a href="https://github.com/tremor-rs/tremor-runtime/pull/856" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="textual-length-prefix-pre-and-postprocessor">textual-length-prefix pre and postprocessor<a href="#textual-length-prefix-pre-and-postprocessor" class="hash-link" aria-label="Direct link to textual-length-prefix pre and postprocessor" title="Direct link to textual-length-prefix pre and postprocessor">​</a></h3><p>In order to support syslog messages over TCP, it was needed to add support for the <a href="https://datatracker.ietf.org/doc/html/rfc5425" target="_blank" rel="noopener noreferrer">RFC 5425</a> transport protocol, that contains a textual length prefix before each message.
textual-length-prefix <code>preprocessor</code> and <code>postprocessor</code> were implemented to handle the buffers accordingly. The message starts with a number of digits, denoting the message length followed by a space and then the message. The processor gets the length and then wait until the buffer is long enough, to extract the right amount of bytes.
The implementation can be found <a href="https://github.com/tremor-rs/tremor-runtime/pull/957" target="_blank" rel="noopener noreferrer">here</a>.</p><p><a href="https://github.com/altsysrq/proptest" target="_blank" rel="noopener noreferrer">Proptest</a> is something new and amazing I learnt while working on this. It is a property testing framework which allows to test certain properties of code for arbitrary inputs. We utilised this for testing the functioning of our preprocessor for all types of inputs possible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-support-for-tcp">TLS support for TCP<a href="#tls-support-for-tcp" class="hash-link" aria-label="Direct link to TLS support for TCP" title="Direct link to TLS support for TCP">​</a></h3><p>Unlike UDP, Tremor did not support TLS over TCP onramp, which was needed to add. This work can be broadly divided into two parts:</p><p><strong>Add support for receiving TLS encrypted data via TCP onramp</strong></p><p><code>tls</code> option was added to the tcp onramp configuration options which addresses the keys and certificate required for authentiction.</p><p>An example of TCP onramp config with TLS is as follows:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">onramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tcp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">preprocessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> lines</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">cert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"path/to/cert.pem"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"path/to/key.pem"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code can be found <a href="https://github.com/tremor-rs/tremor-runtime/pull/1055" target="_blank" rel="noopener noreferrer">here</a>.</p><p><strong>Add support for sending TLS encrypted data via TCP offramp</strong></p><p><code>tls</code> option added to offramp tls config contains either the tls config or boolean value indiacting the use of TLS session for transport level encryption. If false is provided then the default TCP stream will be used and if true is provided then TLS stream will be used with default certificates and domain same as hostname. Other option is to provide tls config with <code>domain</code> and <code>cafile</code>. In case of <code>domain</code> not being specified, the hostname will be used.</p><p>An example of TCP offramp config with TLS:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tcp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">cafile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"path/to/cafile"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code can be found <a href="https://github.com/tremor-rs/tremor-runtime/pull/1057" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="concluding-thoughts">Concluding Thoughts<a href="#concluding-thoughts" class="hash-link" aria-label="Direct link to Concluding Thoughts" title="Direct link to Concluding Thoughts">​</a></h2><p>The tremor community is very helpful and friendly. The mentors helped me a lot from silly rust doubts to nerve breaking code debugging and testing. There were periodic code reviews and live coding sessions which motivated me to improvise and keep going. The key focus was always on the learning rather than getting the work done.</p><p>It was undoubtedly one of the most fruitful and learning experiences I had have and I wish to continue the contribution to community and project.</p>]]></content:encoded>
            <category>codecs</category>
            <category>mentorship</category>
            <category>cncf</category>
        </item>
        <item>
            <title><![CDATA[Google Cloud Storage and Pub/Sub Connectors]]></title>
            <link>https://www.tremor.rs/blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud</link>
            <guid>https://www.tremor.rs/blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud</guid>
            <pubDate>Tue, 29 Jun 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Jigyasa's LFX spring Mentorship experience report.]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3><p>Hello folks! I'm Jigyasa, a final-year computer science engineering student at Indira Gandhi Delhi Technical University for Women pursuing my bachelor's in Technology. This blog is about my experience contributing to <a href="https://www.tremor.rs/" target="_blank" rel="noopener noreferrer">Tremor</a> as part of the LFX Mentorship program.
i</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="learning-about-tremor">Learning about Tremor<a href="#learning-about-tremor" class="hash-link" aria-label="Direct link to Learning about Tremor" title="Direct link to Learning about Tremor">​</a></h3><p>Tremor is an event processing system for unstructured data with rich support for structural pattern matching, filtering, and transformation. It is built for users that have a high message volume to deal with and want to build pipelines to process, route, or limit this event stream. It has a scripting language called tremor-script and a query language as well called tremor-query or trickle.</p><p>I had never worked on an event processing system before this internship. In fact, my first major contribution to open-source was through this mentorship program. To get started with it, my mentor <a href="https://www.linkedin.com/in/darach-ennis-789866?lipi=urn%3Ali%3Apage%3Ad_flagship3_search_srp_all%3BnRZIYeLfRAWJpWsDNlzweA%3D%3D" target="_blank" rel="noopener noreferrer">Darach Ennis</a>, suggested me some documents that helped me learn more about it:</p><p><a href="https://github.com/tremor-rs/tremor-www-docs/blob/main/docs/overview.md" target="_blank" rel="noopener noreferrer">/docs/overview/ (deprecated)</a></p><p><a href="https://github.com/tremor-rs/tremor-www-docs/tree/main/course" target="_blank" rel="noopener noreferrer">/docs/course (deprecated)</a></p><p>Apart from that, learning more about the tremor-query, tremor-script, and going through the workshops in the docs can be really helpful.</p><p>The codebase of Tremor is in Rust, and since I had no prior experience with Rust, I started learning the language.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="learning-rust">Learning Rust<a href="#learning-rust" class="hash-link" aria-label="Direct link to Learning Rust" title="Direct link to Learning Rust">​</a></h3><p>Getting started with Rust was very intimidating. It involved working with things like memory management, borrow checker, lifetimes, and the expressive types which was very new to me and hence, confusing</p><p>While getting started with a new language, I try to follow along some interactive tutorials/videos. These are some resources that I found helpful: </p><p><a href="https://serokell.io/blog/learn-rust" target="_blank" rel="noopener noreferrer">https://serokell.io/blog/learn-rust</a></p><p><a href="https://fasterthanli.me/articles/a-half-hour-to-learn-rust" target="_blank" rel="noopener noreferrer">https://fasterthanli.me/articles/a-half-hour-to-learn-rust</a></p><p><a href="https://doc.rust-lang.org/book/" target="_blank" rel="noopener noreferrer">https://doc.rust-lang.org/book/</a></p><p>However, while coding I used to run into a lot of errors. My mentor suggested me a good practice which is to document those errors and always make good notes of anything and everything I learn. So the next time I come across something similar, I can refer to my notes instead of searching that up on the internet. I used to document the little things like a new <code>vi</code> or <code>git</code> command that I learned and found helpful. It's also very important to keep those notes organized so that it's faster and easier to find what you're looking for. Compiling notes of all the new things learned in a day can be very helpful.</p><p>At times when I used to get stuck with some Rust errors, I used to reach out to my mentor or anyone from the Tremor community and they would help me. Apart from that, these discord servers can be of great help too:</p><p><a href="https://discord.gg/rust-lang-community" target="_blank" rel="noopener noreferrer">Rust programming language community server</a></p><p><a href="https://discord.gg/4BUXJEB2" target="_blank" rel="noopener noreferrer">Firepit</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="my-project">My Project<a href="#my-project" class="hash-link" aria-label="Direct link to My Project" title="Direct link to My Project">​</a></h3><p>My task during the internship was to add support for the Google Cloud connectors in Tremor. I worked on adding the Google Cloud Storage and Google Cloud Pub/Sub connectors. A detailed description of it can be found here:</p><p><a href="https://github.com/tremor-rs/tremor-runtime/issues/724" target="_blank" rel="noopener noreferrer">https://github.com/tremor-rs/tremor-runtime/issues/724</a></p><p>Before explaining more about it, here's what a connector involves:</p><p><strong>Sources:</strong> Ingest data from the outside world and deserialise to events ( onramps )</p><p><strong>Sinks:</strong> Send serialised events to the outside world ( offramps )</p><p>Connectors serve the purpose of sending events to and receiving events from the outside world. A connector can be an event <code>source</code> (a.k.a. <code>onramp</code>) or an event <code>sink</code> (a.k.a. <code>offramp</code>) or both.</p><p><img loading="lazy" alt="Connector" src="/assets/images/connector-b5049c7dbfe33de71b96d2ee25136f23.png" width="739" height="201" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-storage-connector">Google Cloud Storage connector:<a href="#google-cloud-storage-connector" class="hash-link" aria-label="Direct link to Google Cloud Storage connector:" title="Direct link to Google Cloud Storage connector:">​</a></h4><p>I wrote a GCS sink that can issue the basic GCS Operations such as list buckets and objects, create, insert and delete objects from the Google Cloud Platform cloud storage service. The docs can be found here: <a href="/docs/0.11/artefacts/offramps#gcs">GCS offramp docs</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-pubsub-connector">Google Cloud Pub/Sub connector:<a href="#google-cloud-pubsub-connector" class="hash-link" aria-label="Direct link to Google Cloud Pub/Sub connector:" title="Direct link to Google Cloud Pub/Sub connector:">​</a></h4><p>The gpub sink can issue the operation of sending a message to a Google Cloud Pub/Sub topic. It also allows creating a subscription to a topic to receive messages in it, with the option to enable/disable message ordering. The gsub source allows receiving messages via a subscription in batches as well as one after another. The docs can be found here:
<a href="/docs/0.11/artefacts/offramps#gpub">gpub offramp</a> and <a href="/docs/0.11/artefacts/onramps#gsub">gsub onramp</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="walk-through-guide">Walk-Through Guide<a href="#walk-through-guide" class="hash-link" aria-label="Direct link to Walk-Through Guide" title="Direct link to Walk-Through Guide">​</a></h2><p>To get started, you need a service account on GCP and you will need a GCP pem file for certificates authentication and a service token json file.</p><p>The command used to get the service token <code>json</code> file:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gcloud iam service-accounts keys create key-file.json -iam-account</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token plain">iam-account-name</span><span class="token operator">&gt;</span><span class="token plain">@</span><span class="token operator">&lt;</span><span class="token plain">project-id</span><span class="token operator">&gt;</span><span class="token plain">.iam.gserviceaccount.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gcloud iam service-accounts keys create key-file.json -iam-account</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token plain">mail-id-of-service-account</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Go to GCP dashboard → IAM &amp; Admin → Service Accounts and get the email-id mentioned which is the <code>&lt;mail-id-of-service-account&gt;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-storage">Google Cloud Storage<a href="#google-cloud-storage" class="hash-link" aria-label="Direct link to Google Cloud Storage" title="Direct link to Google Cloud Storage">​</a></h3><p>The following is a usage example of the gcs connector. The following files are required:</p><p><strong>outbound.trickle</strong></p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>inbound.trickle</strong></p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>test.yaml</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> stdout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> stdout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> gcs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> gcs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">postprocessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> gzip   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">preprocessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> gzip </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">linked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">pem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> &lt;path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">to</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">pem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">onramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> stdin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /dev/stdin   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">binding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> example</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">links</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/onramp/stdin/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/pipeline/outbound/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/pipeline/outbound/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/offramp/stdout/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/offramp/gcs/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/offramp/gcs/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/pipeline/inbound/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/pipeline/inbound/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/offramp/stdout/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">mapping</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">"/binding/example/passthrough"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"passthrough"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above config receives <code>json</code> on stdin, sends it to Google Cloud Storage service (and stdout) and writes the response received from GCS (since <code>linked: true</code>) to stdout.</p><p>The instance variable (in the binding) is replaced by the value passthrough in the mapping upon deployment, so it is possible to define multiple bindings (deployments) for a single mapping (template).
Supported preprocessors, that can be configured in yaml file can be found here: <a href="/docs/0.11/artefacts/preprocessors">preprocessors</a>. Supported postprocessors and more about it: <a href="/docs/0.11/artefacts/postprocessors">postprocessors</a>.
Supported codecs, that can be configured in yaml file can be found here: <a href="/docs/0.11/artefacts/codecs">codecs</a></p><ul><li>Set the env variable</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"&lt;path-to-service-token-json-file&gt;"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Command used to run tremor:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">tremor server run -f outbound.trickle inbound.trickle test.yaml </span><span class="token operator">|</span><span class="token plain"> jq </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For a detailed guide on the Operations that can be performed, refer the <a href="/docs/0.11/artefacts/offramps#gcs">docs</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-pubsub">Google Cloud Pub/sub<a href="#google-cloud-pubsub" class="hash-link" aria-label="Direct link to Google Cloud Pub/sub" title="Direct link to Google Cloud Pub/sub">​</a></h3><p>Google Cloud Pub/Sub guarantees delivery of all messages, whether low throughput or high throughput, so there should be no concern about messages being lost.</p><p>Pub/Sub guarantees at-least-once message delivery, which means that occasional duplicates are to be expected since we acknowledge the messages once they are received.</p><p>The following is a usage example of the pub/sub connector. These are the files required:</p><p><strong>outbound trickle:</strong> </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>inbound.trickle:</strong></p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select {"data": event, "meta": $} from in into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>test.yaml:</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> stdout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> stdout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> gpub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> gpub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">postprocessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> gzip    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">linked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">pem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> &lt;path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">to</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">pem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">onramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> stdin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /dev/stdin  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> gsub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> gsub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">preprocessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> gzip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">pem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> &lt;path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">to</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">pem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">subscription</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'&lt;name-of-subscription&gt;'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">binding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> example</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">links</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/onramp/stdin/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/pipeline/outbound/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/pipeline/outbound/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/offramp/stdout/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/offramp/gpub/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/offramp/gpub/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/pipeline/inbound/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/pipeline/inbound/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/offramp/stdout/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">'/onramp/gsub/{instance}/out'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/pipeline/inbound/{instance}/in'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">mapping</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">"/binding/example/passthrough"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"passthrough"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above config receives <code>json</code> on stdin, sends it to Google Pub/sub service (and stdout) and writes the response received from Google Pub/sub (since <code>linked</code> is set to true) to stdout. At the same time, it also receives the messages for the configured subscription from Google pub/sub and writes those messages to stdout.</p><p>Supported preprocessors, that can be configured in yaml file can be found here: <a href="/docs/0.11/artefacts/preprocessors">preprocessors</a>.
Supported postprocessors and more about it: <a href="/docs/0.11/artefacts/postprocessors">postprocessors</a>.
Supported codecs, that can be configured in yaml file can be found here: <a href="/docs/0.11/artefacts/codecs">codecs</a></p><p><img loading="lazy" alt="Tremor Dot Diagram" src="/assets/images/dot-diagram-38e419be865fb5bf57190638508a7b39.png" width="380" height="251" class="img_ev3q"></p><ul><li>Create a topic using the following <code>gcloud</code> command:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gcloud pubsub topics create </span><span class="token operator">&lt;</span><span class="token plain">topic-name</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Set the env variable</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"&lt;path-to-service-token-json-file&gt;"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Command used to run tremor:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">tremor server run -f outbound.trickle inbound.trickle test.yaml </span><span class="token operator">|</span><span class="token plain"> jq </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Refer to the <a href="/docs/0.11/artefacts/offramps#gpub">gpub</a> and <a href="/docs/0.11/artefacts/onramps#gsub">gsub</a> docs to perform opertaions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-for-gsub-onramp-pubsub">Testing for gsub onramp (Pub/sub)<a href="#testing-for-gsub-onramp-pubsub" class="hash-link" aria-label="Direct link to Testing for gsub onramp (Pub/sub)" title="Direct link to Testing for gsub onramp (Pub/sub)">​</a></h2><p>Google Cloud Pub/Sub guarantees delivery of all messages and also preserves the order of messages if the subscription has <code>message-ordering</code> set.</p><p>However, we wish to test the property of guranteed delivery and message-ordering for gsub in events like poor network connectivity. In order to test, before sending the message to pub/sub, we add a field <code>count</code> in the event (json) that increments every time we send a message. This would be done in the outbound trickle file. To validate that all the messages are received in order, we have a validation logic in the inbound trickle file that checks if the difference between the <code>count</code> value of the current message and the previous message is one, the order is maintained.</p><p>For this purpose, we also use a write-ahead log or <code>wal</code> that builds on circuit breaker and acknowledgement mechanisms to provide guaranteed delivery. The write-ahead log is useful in situations where sources/onramps do not offer guaranteed delivery themselves, but the data being distributed downstream can benefit from protection against loss and duplication.</p><p>We have 3 different configurations for the outbound trickle file - using a <a href="https://github.com/tremor-rs/tremor-www/docs/0.11/recipes/transient_gd" target="_blank" rel="noopener noreferrer">transient wal</a>, <a href="https://github.com/tremor-rs/tremor-www/docs/0.11/recipes/persistent_gd" target="_blank" rel="noopener noreferrer">persistent wal</a> and no wal. The cofigurations are as follows:</p><p><strong>No wal</strong></p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script counter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let count = match state==null of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case true =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    default =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      state.count + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let state = {"count": count};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {"command": "send_message", "project":"&lt;project-id&gt;", "topic":"&lt;topic-name&gt;", "data": merge event of {"count": state.count} end, "ordering_key": "&lt;ordering-key&gt;"}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script counter;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into counter;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from counter into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Transient-wal</strong></p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator in_memory_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  read_count = 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script counter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let count = match state==null of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case true =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    default =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      state.count + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let state = {"count": count};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {"command": "send_message", "project":"&lt;project-id&gt;", "topic":"&lt;topic-name&gt;", "data": merge event of {"count": state.count} end, "ordering_key": "&lt;ordering-key&gt;"}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script counter;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into counter;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from counter into in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in_memory_wal into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Persistent-wal</strong></p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator on_disk_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  read_count = 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator on_disk_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script counter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let count = match state==null of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case true =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    default =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      state.count + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let state = {"count": count};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {"command": "send_message", "project":"&lt;project-id&gt;", "topic":"&lt;topic-name&gt;", "data": merge event of {"count": state.count} end, "ordering_key": "&lt;ordering-key&gt;"}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script counter;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into counter;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from counter into on_disk_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from on_disk_wal into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the <strong>inbound</strong> trickle, we have the validation logic as follows:</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script validate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match state == null of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case true =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let valid = match event.data.count == 0 of </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        case true =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          true      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        default =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      end,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let state = {"prev": event.data.count},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {"response": event, "valid": valid} </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    default =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let valid = match state.prev + 1 == event.data.count of </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        case true =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        default =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      end,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let state = {"prev": event.data.count},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {"response":event, "valid": valid}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script validate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select {"data": event, "meta": $} from in into validate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from validate into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the testing, we run the sink (a.k.a offramp) to send messages and source (a.k.a onramp) to receive messages separately.</p><p><img loading="lazy" alt="Testing gsub" src="/assets/images/validation-testing-image-35e388fced29a6888b362e9ab78e7da2.png" width="1066" height="741" class="img_ev3q"></p><hr><p><strong><em>Note:</em></strong>
<em>On stopping the server and resarting right afterwards, we see that we lost 1 message (id 7) which was acknwledged inside tremor but not yet fully delivered to the console by gsub.</em></p><hr><p>In all the 3 cases, we obtain similar results. We observe that on restarting tremor, we may lose in flight messages (events) that were already acknowledged at the time the server went down and thus not fully delivered by the downstream system. We may also observe duplicate messages (messages being received more than once). However, the order of messages is preserved.
Hence, for the <code>gsub</code> onramp, a <code>wal</code> can assist with partial recovery of downstream system but it is not guarenteed to be lossless.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-failure-recovery">Network Failure Recovery<a href="#network-failure-recovery" class="hash-link" aria-label="Direct link to Network Failure Recovery" title="Direct link to Network Failure Recovery">​</a></h2><p><img loading="lazy" alt="Network Failure Recovery testing" src="/assets/images/network-failure-testing-7b192bf0cc0bad6271046fd9ae4cc2f5.png" width="670" height="341" class="img_ev3q"></p><p>While testing in poor connectivity, the pivot point (where it works) was observed when downlink and uplink packets dropped varies between 47%-50%. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-of-connectors">Use of Connectors<a href="#use-of-connectors" class="hash-link" aria-label="Direct link to Use of Connectors" title="Direct link to Use of Connectors">​</a></h2><ul><li>Bulk batch rolling event/log storage to GCS</li><li>Distribution of openTelemetry logs/trace/metrics over GCP pub/sub</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-tremor-community">The Tremor community<a href="#the-tremor-community" class="hash-link" aria-label="Direct link to The Tremor community" title="Direct link to The Tremor community">​</a></h2><p>The Tremor community is absolutely great. As I was contributing to it as a part of my internship, I was lucky to have direct access to the Tremor developers working at Wayfair whenever I had any questions. We used to have a lot of meetings in the General Voice channel on discord with the Tremor developers and anyone could join in and ask questions, discuss ideas and share what they are working on. This used to be super helpful.</p><p>Apart from that, on the first Tuesday of every month we used to have office hours where everyone joins in and there used to be discussions on topics like: "Why did tremor go open source", "Good practices for contributing to open-source", and Q/As. They used to be a lot of fun.</p><p>I am so grateful to my mentors: Darach, Heinz and Matthias for being super kind and always encouraging me to ask questions and clarifying all my doubts. Also, thanks to Ana for always being so nice and helping with my Rust errors. They all are amazing and I thank them for their time and help.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-thoughts">Final Thoughts<a href="#final-thoughts" class="hash-link" aria-label="Direct link to Final Thoughts" title="Direct link to Final Thoughts">​</a></h2><p>It was an overall great journey contributing to Tremor. I learned so much in these 3 months' time with the support of my mentors. I'm very grateful to CNCF for organizing this mentorship program as it gave me an opportunity to learn about event processing, distributed systems, Rust, Cloud-Native technologies, etc. I wouldn't have learned so much in these 3 months' time had I not been a part of this mentorship program. It was definitely a fun learning experience.</p>]]></content:encoded>
            <category>connectors</category>
            <category>mentorship</category>
            <category>cncf</category>
            <category>gpc</category>
        </item>
        <item>
            <title><![CDATA[Releasing Tremor v0.10!]]></title>
            <link>https://www.tremor.rs/blog/2021/02/12/v010-release</link>
            <guid>https://www.tremor.rs/blog/2021/02/12/v010-release</guid>
            <pubDate>Fri, 12 Feb 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Releasing Tremor v0.10.]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="v0.10" src="/assets/images/tremor-release-0.10-73915b9f37ba2d7d04ff55f8433f1bd3.jpg" width="960" height="936" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>This release is the last minor release before we start turning Tremor into a truly distributed event processing and data distribution engine. We focused on small things that improve usability and ironed out some rough edges here and there.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">TL;DR<a href="#tldr" class="hash-link" aria-label="Direct link to TL;DR" title="Direct link to TL;DR">​</a></h2><ul><li>We extended our type system and codecs by the <code>binary</code> type.</li><li>Elasticsearch offramp now supports Linked Transport.</li><li>String interpolation done right, now with <code>#{}</code> instead of just <code>{}</code></li><li>Release now includes prebuilt binaries, DEB packages and RPMs</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-release-artefacts">New Release Artefacts<a href="#new-release-artefacts" class="hash-link" aria-label="Direct link to New Release Artefacts" title="Direct link to New Release Artefacts">​</a></h2><p>To make your life easier installing and Tremor more pleasant, we added new release artefacts. We've now got <a href="https://github.com/tremor-rs/tremor-runtime/releases/download/v0.10.0/tremor-0.10.0-x86_64-unknown-linux-gnu.tar.gz" target="_blank" rel="noopener noreferrer">prebuilt binaries</a> wrapped up in a <code>tar.gz</code> for <code>amd64</code> linux, <a href="https://github.com/tremor-rs/tremor-runtime/releases/download/v0.10.0/tremor_0.10.0_amd64.deb" target="_blank" rel="noopener noreferrer">DEB</a>, and <a href="https://github.com/tremor-rs/tremor-runtime/releases/download/v0.10.0/tremor-0.10.0-1.x86_64.rpm" target="_blank" rel="noopener noreferrer">RPM</a> packages. And, lets not forget our well-known <a href="https://hub.docker.com/repository/docker/tremorproject/tremor" target="_blank" rel="noopener noreferrer">Docker Image</a>.</p><p><img loading="lazy" alt="install prebuilt binary" src="/assets/images/2021-02-19_prebuilt_binary-a89e5b823e2cb5e6dbdd817ce0973fc2.gif" width="972" height="620" class="img_ev3q"></p><p>We are going to explore more channels for release artefacts in the future to get you up and running with Tremor in no time.</p><p>In addition to those new release channels, we enabled thin-lto for all builds, which should improve compile-time while providing all the benefits of full link time optimization (LTO). We also link OpenSSL, now statically, to avoid incompatibilities with OpenSSL versions provided by the OS.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="binary-type-and-binary-codec">Binary Type and Binary Codec<a href="#binary-type-and-binary-codec" class="hash-link" aria-label="Direct link to Binary Type and Binary Codec" title="Direct link to Binary Type and Binary Codec">​</a></h2><p>Tremor is built for handling JSON-like structured data. It can effectively handle wire formats like JSON, YAML, msgpack and many more. We can represent them all with the same internal model of dynamic structured values. One blind spot up to now has been binary data. The reason for this was that most of the aforementioned formats do not support raw binary data (except msgpack). But times have changed.</p><p>With Tremor, you can now receive, assemble and send binary data. Receiving is done by configuring your onramp of choice with the <code>binary</code> codec. Imagine building a HTTP proxy with Tremor, that is not interested in the actual body payload but does its internal routing work only by looking at the headers. Previously, Tremor had to parse and deserialize the whole body payload. Now, it is able to conveniently pass those bytes through without ever touching them, and thus be even faster and more efficient for similar use cases.</p><p>Here is an example config for the needed onramps and offramps;</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">onramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> http_input</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> rest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> binary</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">linked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 0.0.0.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> http_output1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> rest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> binary</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">linked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">endpoint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//host01.example.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">method</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> GET</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And here is a very simple corresponding pipeline:</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where $request.method == "GET" &amp;&amp; array::contains($request.headers["content-type"], "application/json")</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You are able to assemble complex binary events from structured data within tremor-script itself, like TCP packets:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">let tcp_packet = &lt;&lt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event.src.port:16,  event.dst.port:16,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event.seq:32,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event.ack:32,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event.offset:4, event.res:4, event.flags:8, event.win:16,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event.checksum:16, event.urgent:16,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event.data/binary</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;&gt;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="elasticsearch-offramp-as-linked-transport">Elasticsearch Offramp as Linked Transport<a href="#elasticsearch-offramp-as-linked-transport" class="hash-link" aria-label="Direct link to Elasticsearch Offramp as Linked Transport" title="Direct link to Elasticsearch Offramp as Linked Transport">​</a></h2><p>We enhanced our <a href="https://docs.tremor.rs/artefacts/offramps/#elastic" target="_blank" rel="noopener noreferrer"><code>elastic</code> offramp</a> to emit 1 event back to Tremor for each document indexed to Elasticsearch, be it successful or not. You will get all the Elasticsearch metadata like the <code>_version</code> and <code>_id</code> of the indexed document and also the whole payload to be indexed, which is especially useful in the face of indexing errors, e.g. from mismatched document schemas.</p><p>An <code>elastic</code> offramp configured like this:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> elastic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> elastic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">linked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> elastic01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> elastic02</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> elastic03</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>will, for an event like this:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>send you back a response payload like this if everything went well via the offramps <code>out</code> port:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"source"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"event_id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1:0:0"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"origin"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tremor-file://root/data.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"payload"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"data"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"success"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>with the following document metadata in <code>$elastic</code>:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"TxQutncB0ovN9WdBcg2i"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"index"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tremor_test"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"doc_type"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"_doc"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"version"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And, in case indexing failed, you would get an event like this via the offramps <code>err</code> port:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token property">"source"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"event_id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1:0:0"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"origin"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tremor-file://root/data.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"payload"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"data"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"success"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"error"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"caused_by"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token property">"reason"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Current token (VALUE_NUMBER_INT) not of boolean type\n at [Source: (byte[])\"POST //_bulk HTTP/1.1\r\ncontent-type: application/json\r\ncontent-length: 346\r\nuser-agent: reqwest/0.9.24\r\naccept: */*\r\naccept-encoding: gzip\r\nhost: 127.0.0.1:9200\r\n\r\n{\"index\":{\"_index\":\"tremor_test\",\"_type\":\"_doc\"}}\n{\"data\":\"[1, 2, 3]\"}\n\"[truncated 10 bytes]; line: 1, column: 13]"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token property">"type"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"json_parse_exception"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"reason"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"failed to parse field [data] of type [boolean] in document with id 'TxQutncB0ovN9WdBcg2i'. Preview of field's value: '1'"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"type"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"mapper_parsing_exception"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Such an error message will also contain the same metadata behing the <code>$elastic</code> metadata key.
Having detailed error data and the original payload at hand will enable users to handle success and error in new ways: Retries in case of errors, signalling upstream applications, try something completely different with that event payload.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="string-interpolation-done-right">String Interpolation Done Right<a href="#string-interpolation-done-right" class="hash-link" aria-label="Direct link to String Interpolation Done Right" title="Direct link to String Interpolation Done Right">​</a></h2><p>We changed the syntax for string interpolation to now use <code>#{}</code> for interpolating arbitrary expressions into a string literal, as we discovered some quirks in how it worked before (with <code>{}</code>). Creating JSON object strings <code>{"key": "value"}</code> or regex quantifiers <code>[1-9][0-9]{2, 3}</code> have been inconvenient to write and there were surprises together with using the <code>string::format</code> function.</p><p>Where we previously had written:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">let json_string = """</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{{ "key": "value"}}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">""";</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let regex = "[1-9][0-9]\{2, 3\}";</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>we can now express as:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">let json_string = """</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{ "key": "value"}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">""";</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let regex = "[1-9][0-9]{2, 3}";</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which is much better e.g. for templating purposes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="questionscomments">Questions/Comments<a href="#questionscomments" class="hash-link" aria-label="Direct link to Questions/Comments" title="Direct link to Questions/Comments">​</a></h2><p>On the Community Discord: <a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer">https://chat.tremor.rs</a></p>]]></content:encoded>
            <category>releases</category>
        </item>
        <item>
            <title><![CDATA[Releasing Tremor v0.9!]]></title>
            <link>https://www.tremor.rs/blog/2020/10/16/v09-release</link>
            <guid>https://www.tremor.rs/blog/2020/10/16/v09-release</guid>
            <pubDate>Fri, 16 Oct 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Releasing Tremor v0.9]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p><img loading="lazy" alt="v0.9" src="/assets/images/v0.9-dd17baf55d40136f0602538d35280d68.png" width="600" height="316" class="img_ev3q"></p><p><a href="https://www.tremor.rs/" target="_blank" rel="noopener noreferrer">Tremor</a> is an open source event processing and data distribution engine designed to interpose or intercept data in complex systems primarily to inject quality of service, correct data flows and to enrich or support complex traffic shaping, routing and load-balancing based on contextual, situational or content derived dynamic conditions.</p><p>Tremor has a powerful ETL language designed for flexibly pattern matching structured data such as JSON efficiently (SIMD-accelerated), and a declarative flow-based SQL language designed for rich JSON-like data to describe data processing and data flow graphs with declarative QoS constraints.</p><p>Tremor has been in large scale global production at Wayfair for 2 years now, and is gaining adoption in other organizations.</p><p>In this release, we return to Tremor’s roots and focus on quality of service by adding linked-transports to interpose RPC-like and synchronous-blocking protocols. We add circuit breakers to manage upstream and downstream byzantine events, and we provide mechanisms that offer shades of delivery guarantees or intrinsic transactions that, when combined with suitable upstream or downstream systems, can produce lossless data transfers for certain routes whilst remaining best-effort for routes that do not support lossless delivery or recovery in and of themselves with minimal loss.</p><p>Lastly, but most importantly, this is the first release of Tremor as a Linux Foundation/CNCF early-stage sandbox project. We would like to thank everyone at Wayfair in Boston and Berlin, the Linux Foundation and the CNCF who facilitated, helped, nurtured, transitioned DNS entries and worked with the legals to make this transition to fully open governance happen. A huge thanks to Chris and Amye at the Linux Foundation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">TL;DR<a href="#tldr" class="hash-link" aria-label="Direct link to TL;DR" title="Direct link to TL;DR">​</a></h2><p>Read on for details after these headings:</p><ul><li>Refactored Concurrency Model</li><li>Unified Command Line Interface</li><li>Linked Transports</li><li>Circuit Breakers &amp; ‘Guaranteed’ Delivery</li><li>Behavioural Changes</li></ul><p>Stop here, unless you like details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="refactored-concurrency-model">Refactored Concurrency Model<a href="#refactored-concurrency-model" class="hash-link" aria-label="Direct link to Refactored Concurrency Model" title="Direct link to Refactored Concurrency Model">​</a></h2><p>The maturity of concurrency and synchronization primitives within the rust programming language has transformed massively over the past 18 months. As these primitives have now stabilised and libraries based on these primitives are now stabilising, we have migrated the tremor runtime model to be fully internally asynchronous, non-blocking and task-driven, where possible.</p><p>There are still code paths within tremor, such as in kafka adapters that integrate with native libraries where a configurable number of threads can be configured and spun up- but we no longer have a thread per pipeline model.</p><p>This means that tremor application designers can now configure, deploy and run 1000s of pipelines in the same instance of tremor. In concert with the modularity theme in tremor v0.8, the quality of life/service theme of v0.9 further expands the flexibility available to tremor application designers and operators to design very high performance and highly efficient data processing and distribution solutions based on tremor.</p><p><img loading="lazy" alt="08_09_comparison" src="/assets/images/08_09_comparison-85fbc837cf4d80875fc4ec74b9fa9c25.png" width="579" height="319" class="img_ev3q"></p><p><em>Feel the awesome power of asynchronous runtimes</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="unified-command-line-interface">Unified Command Line Interface<a href="#unified-command-line-interface" class="hash-link" aria-label="Direct link to Unified Command Line Interface" title="Direct link to Unified Command Line Interface">​</a></h2><p>Tremor has matured to the point that we have outgrown the legacy developer and operator tooling. In this release, we have unified, enhanced and extended developer and operator tooling to boldly go into a much improved quality of life for tremor users.</p><p>The new <a href="/blog/2020/10/16/docs/0.11/operations/cli">unified command line tool</a> <code>tremor</code> can generate auto-completion for your shell (anything from zsh to powershell), generate documentation for your modules, run Tremor, debug the language intermediate forms, and has benchmark, integration, command-driven and unit testing frameworks built in.</p><p><img loading="lazy" alt="cli1" src="/assets/images/cli1-76cc67c05002dff55b07bf515438e2a4.gif" width="622" height="558" class="img_ev3q">
<img loading="lazy" alt="cli2" src="/assets/images/cli2-ab613b9f427c1e9fdbd6b8089c736057.gif" width="622" height="558" class="img_ev3q"></p><p>Everything is syntax-highlighted and should conform to whichever theme you have running in your terminal. It’s like a universal tool - but more reliable because it's German but cool, because it's a Berliner(in the JFK, not cake sense...)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="linked-transports">Linked Transports<a href="#linked-transports" class="hash-link" aria-label="Direct link to Linked Transports" title="Direct link to Linked Transports">​</a></h2><p><a href="/docs/0.11/operations/linked-transports/">Linked Transports</a> allow bidirectional event flows in a request/response style to be built and routed through a tremor pipeline. This enables Tremor users to introspect, route, or even directly reply to incoming messages and intercept and manipulate outgoing responses. Tremor can thus be used as proxy, load-balancer or API-Gateway before or in between existing REST APIs or websocket servers.</p><p>Users can now support and implement their own domain specific REST APIs that can interact with the wider ecosystem of systems interconnected with Tremor- roll your own control plane and consolidate to a single plane of control- without deploying a separate solution or service.</p><p><img loading="lazy" alt="linked-transports" src="/assets/images/linked-transports-21946463c946ee3affd9be5e40a50d54.png" width="771" height="311" class="img_ev3q"></p><p>(note: replies can only be delivered to feet in 0.9, we’re trying to extend that to other limbs in later releases).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="circuit-breakers--guaranteed-delivery">Circuit breakers &amp; “Guaranteed” delivery<a href="#circuit-breakers--guaranteed-delivery" class="hash-link" aria-label="Direct link to Circuit breakers &amp; “Guaranteed” delivery" title="Direct link to Circuit breakers &amp; “Guaranteed” delivery">​</a></h2><p>The signal and contraflow control events within Tremor have been built upon in v0.9 to provide an event acknowledgement mechanism- this, in turn, provides the foundation for <a href="/docs/0.11/operations/gdcb/">guaranteed delivery and circuit breakers</a>, which enables finer-grained declarative quality of service mechanisms within tremor.</p><p>We can now configure Tremor applications or algorithms to <code>pick up where they left off</code> even if the tremor processes are stopped and restarted. Under certain conditions (based on configuration), we can recover entire end-to-end flows- such as the lossless distribution of messages across kafka sources and sinks regardless of which participant stops and restarts.</p><p>If you choose UDP, we cannot guarantee lossless delivery; but Tremor, even on a horrible quality network, should still minimise loss and recover gracefully- it won’t do so without message loss unless there’s some application-level handling of recovery.</p><p>Fully lossless transactional delivery is 10% the throughput of regular data distribution. It's as slow as Apache Kafka for now- but we will put effort into tuning performance here if the use case arises.</p><p>Circuit breakers enable us to detect downstream system failures beyond backpressure, and make informed decisions: to either discard, reroute or stop dataflow. This allows a more ingrained control over behaviour in non-optimal conditions compared to “always drop” earlier tremor versions implemented.</p><p>Delivery Guarantees describes a set of functionality that improves the delivery guarantees of a tremor system. What guarantees can be given depends heavily on the upstream and downstream systems, and the protocols used to communicate with them.</p><p><img loading="lazy" alt="cb-gd" src="/assets/images/cb-gd-0ebef8ee34d7f344851730d4d7acb0de.gif" width="992" height="250" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="open-source-community-changes">Open Source Community Changes<a href="#open-source-community-changes" class="hash-link" aria-label="Direct link to Open Source Community Changes" title="Direct link to Open Source Community Changes">​</a></h2><p>Tremor’s proposal to to adjoin the CNCF as an early stage standbox project was accepted by the CNCF TOC, and formal onboarding into the CNCF began and completed on time in September. This means that the tremor project’s copyright is now held by the Linux Foundation on behalf of the maintainers.</p><p>In practice, what does this mean? Day to day, there is no impact- currently all maintainers of the tremor project are sponsored by Wayfair. But the project now also has the support of the Linux Foundation and the CNCF and this, in turn, makes it easier for external organizations to adopt and contribute to it in support of their own business needs and open source governance strategies.</p><p>Tremor is visible on the <a href="https://www.cncf.io/sandbox-projects/" target="_blank" rel="noopener noreferrer">CNCF Sandbox Project page</a> and via the <a href="https://landscape.cncf.io/" target="_blank" rel="noopener noreferrer">CNCF Landscape</a>. The tremor project can now access development services from the CNCF and LF, ranging from artwork and website design through to visibility, marketing and promotion of the project at LF, CNCF and other conferences and events.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="behavioral-changes">Behavioral Changes<a href="#behavioral-changes" class="hash-link" aria-label="Direct link to Behavioral Changes" title="Direct link to Behavioral Changes">​</a></h2><ul><li><p><strong>REST offramp/sink:</strong></p><ul><li>In an effort to streamline, the REST sink no longer adds newlines for batched events; this can now be done using the “lines” postprocessor.</li><li><code>put</code>, as an option, is no longer supported; instead, <code>method</code> is now used.</li><li>Only supports one <code>endpoint</code> instead of multiple. The Round-robin operator with multiple offramps can be used as a much more capable replacement.</li></ul></li><li><p><strong>Heredocs:</strong></p><ul><li>Leading indentation is no longer stripped.</li><li>Heredocs now perform string interpolation, allowing it to be used for templating of textual content. In result, {and} needs to be escaped.</li></ul></li></ul><ul><li>The <strong>tremor-server</strong>, <strong>tremor-query</strong>, <strong>tremor-script</strong>, and <strong>tremor-tool</strong> binaries are now all unified in the self-name <strong>tremor</strong> binary. The binary also replaces the legacy benchmark and integration testing frameworks: the 3rd party coyote command, test harness, and introduces a new unit testing facility for tremor-script. It’s one command to rule them all.</li></ul><ul><li><strong>Circuit breakers</strong> are enabled and active by default- this is a significant behavioral change in sinks/offramps that completely disconnect; this will now stop the message flow on sources/onramps. Care should be taken in a production environment with non-resilient, non-robust and non-redundant downstream connectivity as this is now an operational concern that can benefit from a much finer-grained configuration surface.</li></ul><ul><li><p>The <strong>generic::backpressure</strong> operator has been renamed <strong>qos::backpressure</strong>. Using the old name will emit a warning in this release, but this backwards compatibility consideration will be addressed and the old name removed in the next release.</p></li><li><p>The operators <strong>runtime::tremor</strong>, <strong>grouper::bucket</strong> and <strong>script</strong> inside of <strong>trickle</strong> have their <strong>error</strong> output renamed <strong>err</strong>.</p></li><li><p><strong>Linked transports</strong> introduce a source nature to sinks and a sink nature to sources. This feature is in preview mode and how to configure it is very likely to change as usability issues or misconceptions are ironed out. (v0.10)</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="questionscomments">Questions/Comments<a href="#questionscomments" class="hash-link" aria-label="Direct link to Questions/Comments" title="Direct link to Questions/Comments">​</a></h2><p>On the our <a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer">discord server</a>.</p>]]></content:encoded>
            <category>releases</category>
        </item>
        <item>
            <title><![CDATA[To async or Not to async]]></title>
            <link>https://www.tremor.rs/blog/2020/08/06/to-async-or-not-to-async</link>
            <guid>https://www.tremor.rs/blog/2020/08/06/to-async-or-not-to-async</guid>
            <pubDate>Thu, 06 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Moving from threads to async tasks.]]></description>
            <content:encoded><![CDATA[<p>With the upcoming Tremor release, 0.9.0, we're moving from threads as a basis for ramps and pipelines to async tasks.</p><p>Let's talk about why this is significant, what is changing, and how the architecture is changing.</p><p>Note that this is not a comprehensive treatise on threads or async tasks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-tremor-that-was-threads">The Tremor That Was (threads)<a href="#the-tremor-that-was-threads" class="hash-link" aria-label="Direct link to The Tremor That Was (threads)" title="Direct link to The Tremor That Was (threads)">​</a></h2><p>Threads are a basic building block of programs that run multiple pieces of code concurrently.
The operating system is responsible for coordinating across competing resource demands.</p><p>The OS can preempt, pause, and resume threads. We can leverage infinite or tight loops without the risk of completely blocking the system. These guarantees make concurrent code more accessible, with tools like<code>crossbeam-channels</code> to build upon.</p><p>Threads work especially well in use cases where the system and logical concurrency models are well aligned; or, we can map application threads to logical cores on the system being used. Each thread can happily work away on its part of the logic and pass the result on to the next. The one thread per core model is what tremor 0.8 and earlier used. We had a thread for the onramp, a thread for the pipeline, and a thread for the offramp. As the computational cost of decoding, processing, and encoding was often in the same ballpark, this worked exceptionally well. We managed to push up to 400MB/s of JSON through the system this way (including parsing, tremor-script logic, and serialization).</p><p>This design can degenerate badly if there are more ramps and pipelines than cores on the system in use. Throughput degrades rapidly (as in up to 2 orders of magnitude worse at 30:1 ratio). At the time of writing this, the deployment model was one pipeline/ramp group on a four-core system, so it worked well in practice.</p><p>However, this places a burden on operators having to think about concurrency and parallelism to tune tremor for optimal performance and capacity.</p><p>In SMP systems, we observe other undesireable effects: The moment two communicating threads don't share the same underlying cache, performance plummets. This scenario exists when threads reside on two different CPUs or CCXs (<a href="https://blog.licenser.net/2020/01/multithreaded-rust-on-threadripper/" target="_blank" rel="noopener noreferrer">thank you AMD for making me learn so much about CPU caches</a>). As long as two communicating threads share the same cache, data shared between them can avoid trips to main memory and cache coherency protocol overheads. When two threads communicate across different caches, reads/writes may catastrophically collide and introduce overheads that drastically reduce overall performance.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="asyncfutures">Async/Futures<a href="#asyncfutures" class="hash-link" aria-label="Direct link to Async/Futures" title="Direct link to Async/Futures">​</a></h2><p>Futures, and in rust <code>async/await</code> (short async from here on), work differently than threads. With threads, the operating system has ultimate control over which thread is scheduled to work when. With async we can more flexibly manage scheduling in application code. This has many advantages in systems software.</p><p>Instead of the operating system preempting a thread, tasks require coordination within the application. The advantage is that since we can control where we take a pause, we can provide soft guarantees that the thread of control yields to the task schedulers in a way that better fits the application. A good example is async-io, where we allow another task to work whenever we have to wait for some IO.</p><p>In Tremor, we use channels extensively to coordinate event flows. They connect sources, sinks, and pipelines. Every time a channel is empty or full, we have to wait for a event that fills or drains a now blocked channel: This is a good juncture to let other tasks get ahead with their work. In tremor, these opportunities are fairly common.</p><p>The cooperative model is not without issues: If we select the wrong time to let other tasks work, we can hurt performance or even break the system. Giving up control in the right moment is especially tricky since it is sometimes happening implicitly. A task that loops without yielding forever is an extreme example. In OS managed threads, the OS can preempt a thread of control, so this is a non-issue. In user-managed tasks, however, this is an issue that needs to be protected against.</p><p>In rust, calling <code>.await</code> is effectively, not a guarantee. We cannot know if an async function ever yields. We can ensure that we yield control via yield_now. However, this comes at a cost: namely, that we might yield in situations where it is not strictly necessary.</p><p>With regards to performance, tasks are typically cheaper from a context switching perspective, and we have finer grained control. On the other hand, we lose control over where a task runs, while we can pin threads to cores to schedule affinity on SMP systems, tasks may migrate across cores or runners move freely.</p><p>In Tremor, we have adopted the <code>smol</code> small and fast async runtime. When two tasks can run consecutively on the same executor, <code>smol</code> will schedule them in different executors. A significant improvement over the thread-based tremor runtime is that <code>smol</code> does not aggressively steal work from other schedulers if they are not overloaded. This avoids the runtime trashing CPU caches based on <a href="https://github.com/async-rs/async-std/issues/848" target="_blank" rel="noopener noreferrer">micro-benchmarking results</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="behavioural-improvements">Behavioural Improvements<a href="#behavioural-improvements" class="hash-link" aria-label="Direct link to Behavioural Improvements" title="Direct link to Behavioural Improvements">​</a></h2><p>In previous releases of Tremor, the runtime focused on situations where applications had a limited and bounded number of stable long-lived concurrent pipelines in each instance. While multiple running artefacts were supported, in practice, tremor was deployed on systems with up to 4 logical cores.</p><p>This works exceptionally well with plain old threads. Starting with v0.9, Tremor is expanding to support an arbitrary number of running artefacts in a typical running instance, with a different logical core topology than production deployments to date.</p><p>Deploying a higher number of pipelines per instance changes our needs of the underlying concurrency mechanisms considerably. The plain old threads design will no longer scale to meet these changing requirements and the move to task-based scheduling with executors favours emerging workloads whilst incurring a negligible overhead to classic tremor workloads.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-results">Initial Results<a href="#initial-results" class="hash-link" aria-label="Direct link to Initial Results" title="Direct link to Initial Results">​</a></h2><p>Ab initio, the switch has some practical implications, mainly an improvement in performance.</p><p>In Tremor v0.8.0, colocating pipelines required careful capacity planning and tuning by experienced operators. In tremor v0.9.0, this constraint has been lifted and the capacity planning burden drastically simplified. Improvements in <code>smol</code> itself over the last few versions means that we have broken the 500MB/s throughput barrier for the first time with the new task-based runtime, which is quite a nice bonus.</p><p>Let's end with some pretty graphs. After all, a picture says more than a thousand words.</p><p>As a short explanation, this uses the json-throughput benchmark we have developed for Tremor running with deployments of one onramp, one pipeline, and one offramp to 64 onramps, 64 pipelines, and one offramp.</p><p><img loading="lazy" alt="3 core performance" src="/assets/images/async-3-cores-afcbd1a0052cfec4bd1e0810535a910c.png" width="568" height="342" class="img_ev3q"></p><p><img loading="lazy" alt="48 core performance" src="/assets/images/async-48-cores-cb4557c688e68d35251683aba21454f8.png" width="572" height="339" class="img_ev3q"></p>]]></content:encoded>
            <category>dev</category>
            <category>rust</category>
        </item>
        <item>
            <title><![CDATA[Rust & Tell Berlin- March 2020]]></title>
            <link>https://www.tremor.rs/blog/2020/03/31/rust-and-tell</link>
            <guid>https://www.tremor.rs/blog/2020/03/31/rust-and-tell</guid>
            <pubDate>Tue, 31 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Presenting Tremor at Rust & Tell Berlin- March 2020.]]></description>
            <content:encoded><![CDATA[<p>We had the great pleasure of spending some time with the crowd of Rust &amp; Tell today. At the meetup, we got the chance to share some of the stories of tremor and Event Processing Cartography. Long story short, if you're curious, the talk was <a href="https://youtu.be/43KS_nCqiIM?t=1932" target="_blank" rel="noopener noreferrer">recorded</a>, and we got <a target="_blank" href="/assets/files/2020-03-31-RustAndTellBerlin-functions-e9243d5d0591e3b6a8a3c67edf46ff00.pdf">the slides</a> right here!</p>]]></content:encoded>
            <category>talks</category>
        </item>
        <item>
            <title><![CDATA[Improving our Influx Parser- A Story in Four Acts]]></title>
            <link>https://www.tremor.rs/blog/2020/03/06/influx-perf</link>
            <guid>https://www.tremor.rs/blog/2020/03/06/influx-perf</guid>
            <pubDate>Fri, 06 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[The process of improving the performance of our influx line protocol parser.]]></description>
            <content:encoded><![CDATA[<p>Yesterday, we spent the day on a report <a href="https://github.com/tremor-rs/tremor-runtime/issues/82" target="_blank" rel="noopener noreferrer">that our influx parser was slow</a>, and it turns out it was indeed.</p><p>This is an exciting topic as a few days ago, we <a href="https://bobkonf.de/2020/ennis-gies.html" target="_blank" rel="noopener noreferrer">gave a talk at BoBKonf 2020</a> on this topic, so this is a great opportunity to show some of the topics and our process in action.</p><p>All the topics in this blog are links; the main one above this text is to the pull request, the titles of each section link to the commit that implements the topic discussed. Go ahead, click on some, and take a look!</p><p>There are two tools worth introducing here that we used during this performance session.</p><p>One is <a href="http://brendangregg.com/perf.html" target="_blank" rel="noopener noreferrer">perf</a>, which we used with a minimal setup of <code>perf record</code> and <code>perf report</code>. We use this to get a glance at where code is spending time. This is not perfect, but it is quick for decent results.</p><p>The other one is <a href="https://docs.rs/criterion/0.3.1/criterion/" target="_blank" rel="noopener noreferrer">criterion</a>, an excellent Rust framework for microbenchmarks based on the <a href="https://hackage.haskell.org/package/criterion" target="_blank" rel="noopener noreferrer">haskell framework</a> with the same name. It is so helpful since it allows us to show changes in performance between changes. That makes it perfect for the kind of incremental improvements our process favors.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="act-1---allocation"><a href="https://github.com/tremor-rs/tremor-runtime/pull/87/commits/42ee11637bc5cd3a215cce1cb841afe791b944b4" target="_blank" rel="noopener noreferrer">Act 1 - Allocation</a><a href="#act-1---allocation" class="hash-link" aria-label="Direct link to act-1---allocation" title="Direct link to act-1---allocation">​</a></h2><p>We talked a bit about allocations and how they can slow down programs in our talk. We tackled two main areas there, and both of them applied to this benchmark.</p><p>First, we switched our allocator to ensure we use the same allocator in both our builds, and the benchmark can make a significant difference!</p><p>Second, we found a few places where we used <code>String::new()</code> and then push to this String - this is one of the patterns we mentioned in our talk, and as you can see in this PR, something we still do wrong at times.</p><p>From prior experience, we know that tag names, values, and field names rarely, if ever, are larger than <code>256</code> characters, so we preallocate with this to eliminate almost all string relocations during parsing.</p><p>As you can see, this change already had a decent impact on performance.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">base-value            time:   [540.03 ns 540.27 ns 540.53 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-14.017% -13.948% -13.884%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int-value               time:   [314.67 ns 314.90 ns 315.14 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-8.9227% -8.8709% -8.8179%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 13 outliers among 100 measurements (13.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 12 (12.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">str-value               time:   [460.68 ns 460.92 ns 461.16 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-11.668% -11.617% -11.564%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 4 outliers among 100 measurements (4.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2 (2.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">escaped-value           time:   [477.57 ns 478.02 ns 478.51 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-13.262% -12.894% -12.594%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 1 outliers among 100 measurements (1.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high mild</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="act-2---degeneralisation"><a href="https://github.com/tremor-rs/tremor-runtime/pull/87/commits/d1490fb940ad99ca3570e4af8c5f5407c4d054e6" target="_blank" rel="noopener noreferrer">Act 2 - Degeneralisation</a><a href="#act-2---degeneralisation" class="hash-link" aria-label="Direct link to act-2---degeneralisation" title="Direct link to act-2---degeneralisation">​</a></h2><p>When we originally wrote the code, what we did is generalize the "find a character" logic between the cases where we were looking for one, two, or three distinct characters to terminate a token.</p><p>That made sense from the perspective of not duplicating code, however looking at the output of perf, it showed that we're spending an awful lot of time in this one particular function.</p><p>So we split this function into its three cases and implemented each on its own, allowing simplified code for one and two termination characters. This simplifies the logic and, in result, improves performance for those cases.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">base-value            time:   [533.13 ns 534.49 ns 536.02 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-1.5482% -1.3801% -1.1996%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 3 outliers among 100 measurements (3.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2 (2.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int-value               time:   [287.45 ns 287.61 ns 287.78 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-8.5277% -8.4504% -8.3783%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">str-value               time:   [428.11 ns 428.38 ns 428.68 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-7.2129% -7.1458% -7.0775%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 2 outliers among 100 measurements (2.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">escaped-value           time:   [446.53 ns 447.30 ns 448.53 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-6.6970% -6.5679% -6.4161%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 7 outliers among 100 measurements (7.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 6 (6.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high severe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="act-3---outside-help"><a href="https://github.com/tremor-rs/tremor-runtime/pull/87/commits/6c9ee7ce64d1474bbd609f7ad99e4303b0ee98df" target="_blank" rel="noopener noreferrer">Act 3 - Outside help</a><a href="#act-3---outside-help" class="hash-link" aria-label="Direct link to act-3---outside-help" title="Direct link to act-3---outside-help">​</a></h2><p>Not all performance improvements have to be written in code, sometimes asking the right question and looking for the right thing can do the trick.</p><p><a href="https://docs.rs/lexical/" target="_blank" rel="noopener noreferrer">lexical</a> is a rust library that implements a faster version of number parsing, which is a significant part of what influx line protocol is.</p><p>The changes are minimal, and as you can see, the impact isn't that huge, but every percentage point counts.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">base-value            time:   [522.24 ns 522.45 ns 522.69 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-0.3955% -0.2589% -0.1477%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Change within noise threshold.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 13 outliers among 100 measurements (13.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2 (2.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 4 (4.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 7 (7.00%) high severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int-value               time:   [295.19 ns 295.38 ns 295.56 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-1.9771% -1.6929% -1.5006%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 5 outliers among 100 measurements (5.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3 (3.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">str-value               time:   [421.03 ns 421.25 ns 421.46 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-3.0571% -2.9466% -2.8421%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 8 outliers among 100 measurements (8.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3 (3.00%) low severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3 (3.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">escaped-value           time:   [433.66 ns 434.61 ns 435.77 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-2.9065% -2.7290% -2.5090%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 4 outliers among 100 measurements (4.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3 (3.00%) high severe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="act-4---borrow-vs-owned"><a href="https://github.com/tremor-rs/tremor-runtime/pull/87/commits/eb24fd9c3f5982a2dae743abd41a75a4253eec07" target="_blank" rel="noopener noreferrer">Act 4 - Borrow vs. Owned</a><a href="#act-4---borrow-vs-owned" class="hash-link" aria-label="Direct link to act-4---borrow-vs-owned" title="Direct link to act-4---borrow-vs-owned">​</a></h2><p>The last act is a bit more exciting, so we'll spend extra time on it (both here and when implementing it).</p><p>This touches on something we didn't discuss in detail during our talk for the sake of time. It is that owned values instead of borrowed values are
significantly more expensive.</p><p>While 'owned' and 'borrowed' are very Rust-specific terms, you can think about it this way:</p><p>An owned value is a value that has its own memory, on creation, it allocates that memory copies the data in, and when it gets freed, the memory too gets freed.</p><p>A borrowed value doesn't own the memory it refers to. Instead, it borrows the memory from another value, and now those two are tied to each other. Rust uses lifetimes to represent this- this is a vast topic of its own, so we'll not go into details here, but think about it that a borrowed value in some way is a pointer to someone else's memory.</p><p>For influx data, a lot of the strings can are perfectly fine represented inside the initial memory; they don't need modification or change to be then used in the final data representation.</p><p>The first implementation ignored this fact and always created a newly owned data structure - this is expensive (as you will see below). However, it's not only that. Not all strings can be passed, pointing to the original memory. Influx uses some escaping in its line protocol that makes this impossible.</p><p>Fortunately, Rust has a data structure that allows representing the situation where we often return borrowed data but sometimes need to own it- it's named a <code>Cow</code>. No, not that cow, it doesn't eat grass, it is a Copy On Write structure that we can use to cover the "we sometimes need to own the data" situation.</p><p>In short, a <code>Cow&lt; '_, str&gt;</code> allows returning either a borrowed <code>&amp;str</code> or an owned String - perfect for our use case!</p><p>Since most of the time we can return the <code>&amp;str</code> we use a trick I picked up from the <a href="https://github.com/maciejhirsz/json-rust/blob/master/src/codegen.rs#L67-L99" target="_blank" rel="noopener noreferrer">json crate</a> that is to split out the logic in a base and a complex case where the base case can perform the common operation quickly and only if it is required we switch to the complex and more costly implementation.</p><p>In our case, this means we assume that all strings can be returned as borrowed, and only if we find an escape sequence, we switch to a more complex implementation. While this has some extra cost on the rare case, it makes the typical case rather cheap.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">base-value            time:   [385.62 ns 385.85 ns 386.06 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-25.171% -25.122% -25.073%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 5 outliers among 100 measurements (5.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3 (3.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int-value               time:   [240.91 ns 241.37 ns 241.97 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-18.169% -18.051% -17.905%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 1 outliers among 100 measurements (1.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) high severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">str-value               time:   [308.08 ns 308.17 ns 308.27 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-26.978% -26.901% -26.833%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 8 outliers among 100 measurements (8.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low severe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 4 (4.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3 (3.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">escaped-value           time:   [368.73 ns 369.05 ns 369.38 ns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       change: [-15.303% -15.233% -15.160%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 3 outliers among 100 measurements (3.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1 (1.00%) low mild</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion"><a href="https://github.com/tremor-rs/tremor-runtime/pull/87" target="_blank" rel="noopener noreferrer">Conclusion</a><a href="#conclusion" class="hash-link" aria-label="Direct link to conclusion" title="Direct link to conclusion">​</a></h2><p>So we performed 3 rudimentary and one more complex tweaks, and this doubled the performance of our influx parsing. As you can see, a few tweaks, when added together, can have some massive impact.</p><p>The most important take away here, however, is the process and that it is iterative.</p><p>We begin each round by looking at measurements, in this case, perf data. Then collect baseline data, in this case, with criterion. From there, we form a theory what could improve the results, implement a solution based on this theory, and finally validate the results with another run of criterion to see the relative diference.</p><p>And here the final results of all changes combined:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Gnuplot not found, using plotters backend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">base-value            time:   [376.98 ns 377.26 ns 377.52 ns]                         </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        change: [-55.627% -55.569% -55.518%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 3 outliers among 100 measurements (3.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2 (2.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1 (1.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int-value               time:   [233.04 ns 233.19 ns 233.34 ns]                      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        change: [-47.584% -47.507% -47.435%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">str-value               time:   [302.36 ns 302.43 ns 302.50 ns]                      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        change: [-58.246% -58.202% -58.159%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 6 outliers among 100 measurements (6.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2 (2.00%) low mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4 (4.00%) high mild</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">escaped-value           time:   [364.08 ns 364.35 ns 364.67 ns]                          </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        change: [-52.159% -52.084% -52.004%] (p = 0.00 &lt; 0.05)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        Performance has improved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 8 outliers among 100 measurements (8.00%)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  8 (8.00%) high severe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>perf</category>
        </item>
        <item>
            <title><![CDATA[Tremor is now Open Source!]]></title>
            <link>https://www.tremor.rs/blog/2020/02/22/welcome</link>
            <guid>https://www.tremor.rs/blog/2020/02/22/welcome</guid>
            <pubDate>Sat, 22 Feb 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Announcement of Tremor as an OSS project.]]></description>
            <content:encoded><![CDATA[<blockquote><p>The tremor project was released as an Open Source software project
on 22nd February 2020 at 20:02:02.</p></blockquote><p>Catch us at <a href="https://bobkonf.de/2020/en/" target="_blank" rel="noopener noreferrer">BOB2020</a> on 28th February,
2020 in Berlin where we will be <a href="https://bobkonf.de/2020/ennis-gies.html" target="_blank" rel="noopener noreferrer">talking</a> about our usage of the <a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">Rust</a> programming language to build high performance and high density production systems with Tremor.</p>]]></content:encoded>
            <category>hello</category>
            <category>welcome</category>
            <category>announcement</category>
            <category>open-source</category>
        </item>
    </channel>
</rss>