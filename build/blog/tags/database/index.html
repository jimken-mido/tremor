<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">One post tagged with &quot;Database&quot; | Tremor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.tremor.rs/blog/tags/database"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;Database&quot; | Tremor"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.tremor.rs/blog/tags/database"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/blog/tags/database" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/blog/tags/database" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8fde9d3c.css">
<link rel="preload" href="/assets/js/runtime~main.0a24082e.js" as="script">
<link rel="preload" href="/assets/js/main.fe542851.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/0.12/getting-started/">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" positition="left" href="/docs/0.12">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/0.12/guides/">Guides</a></li><li><a class="dropdown__link" href="/docs/0.12/reference/">Reference Documentation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.12/">0.12</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/edge/">edge</a></li><li><a class="dropdown__link" href="/docs/0.12/">0.12</a></li><li><a class="dropdown__link" href="/docs/0.11/">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-0.12,docs-rfc-current"></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/24/LFX-Blog-Carol">Hygienic error handling and validation for pipelines</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/07/LFX-Blog-Sasha">Support for the ClickHouse database in Tremor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/15/tdengine-colaboration">TDengine colaboration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/03/LFX-Blog-Prashant">Automating the tremor release process</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/02/tremor-tremors">Tremors - May &#x27;22</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;Database&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/07/07/LFX-Blog-Sasha">Support for the ClickHouse database in Tremor</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-07T00:00:00.000Z" itemprop="datePublished">July 7, 2022</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/scrabsha/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Sasha Pourcelot</span></a></div><small class="avatar__subtitle" itemprop="description">Tremor 2022 Spring Mentee</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I&#x27;m Sasha, a Computer Science student living in south-eastern France. I contributed to Tremor as part of the <a href="https://mentorship.lfx.linuxfoundation.org/project/5c828028-f91c-4969-b4de-9efdb27bb869" target="_blank" rel="noopener noreferrer">Database Connector mentorship</a> proposed by the <a href="https://lfx.linuxfoundation.org/tools/mentorship/" target="_blank" rel="noopener noreferrer">LFX Mentorship Program</a> for Spring 2022. I was mentored by Matthias Wahl and got help from Darach Ennis, Heinz Gies and Ramona Łuczkiewicz.</p><p>This blogpost summarizes my work at Tremor as a mentee and shows what could be done next.</p><h1>About Tremor</h1><p>Tremor is an event processing system with the goal of allowing users to handle a high volume of messages by viewing them as a stream flowing between different nodes of a graph. Events go in and out of this graph thanks to connectors.</p><p>The interactions between each node and the connector configuration are defined using the <a href="https://www.tremor.rs/docs/edge/language/" target="_blank" rel="noopener noreferrer"><code>troy</code></a> programming language.</p><h1>Abstract</h1><p>My mentorship at Tremor was focused on building a connector for the <a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer">ClickHouse</a> database engine. More specifically, I was focused on the <em>sink</em> part, the one that allows data to flow out of the Tremor application.</p><p><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer">ClickHouse</a> is a database management system designed to allow for real-time analysis of high volumes of non-aggregated data. Its initial goal was to power the Yandex.Metrica analytics platform.</p><h1>The ClickHouse connector</h1><p>The next subsections describe what I did during the mentorship.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interacting-with-a-clickhouse-database-in-rust">Interacting with a ClickHouse database in Rust<a href="#interacting-with-a-clickhouse-database-in-rust" class="hash-link" aria-label="Direct link to Interacting with a ClickHouse database in Rust" title="Direct link to Interacting with a ClickHouse database in Rust">​</a></h2><p>My first goal was to find a way to send requests to a ClickHouse node from a Rust program. It was a good start because it allowed me to experiment on the ClickHouse side without caring about what was happening in Tremor. I spent around three weeks playing on a separate repository named <a href="https://github.com/scrabsha/plays-with-clickhouse" target="_blank" rel="noopener noreferrer"><code>scrabsha/plays-with-clickhouse</code></a> and getting extensive knowledge from Matthias about how Tremor works from the inside.</p><p>I found two Rust crates that could help us send requests to a ClickHouse database: <a href="https://crates.io/crates/clickhouse" target="_blank" rel="noopener noreferrer"><code>clickhouse</code></a> and <a href="https://crates.io/crates/clickhouse-rs" target="_blank" rel="noopener noreferrer"><code>clickhouse-rs</code></a>. <code>clickhouse</code> is the first one I considered. I had to discard it because it was focused on concrete Rust types and needed to know <em>at compile time</em> what each datatype is composed of. The second crate was a bit more low-level and allowed us to do what we need.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="writing-a-super-simple-sink">Writing a super simple sink<a href="#writing-a-super-simple-sink" class="hash-link" aria-label="Direct link to Writing a super simple sink" title="Direct link to Writing a super simple sink">​</a></h2><p>Once I got every ClickHouse detail right, I started playing with the Tremor side. There were multiple connectors already implemented in Tremor. I picked the simplest ones and started copying parts of it and quickly got something working.</p><p>The only challenge I encountered is that Tremor defines its own <code>Value</code> type, representing a value whose type is not really known at compile time, and uses it <em>a lot</em>. It was a bit disconcerting doing such things in Rust, as I felt I was writing dynamically-typed code in a statically-typed language, but I managed to get through it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="converting-tremor-values-to-clickhouse-values">Converting Tremor values to ClickHouse values<a href="#converting-tremor-values-to-clickhouse-values" class="hash-link" aria-label="Direct link to Converting Tremor values to ClickHouse values" title="Direct link to Converting Tremor values to ClickHouse values">​</a></h2><p>Once I was able to insert data in a database from Tremor, I started writing a conversion bridge for ClickHouse types, i.e. something that would handle the conversion of native Tremor values to their corresponding ClickHouse types. </p><p>Most of the conversions are quite simple: an integer can be obtained from an integer, a string can be obtained from any string, and so on.</p><p>Some other conversions were less obvious. For instance, in order to create a ClickHouse IPv4 type, we could either use a string representing the address, or an array of four integers. The goal was to make every ClickHouse type constructible from a Tremor value. I tried to make every conversion as obvious as possible, and to document them as much as possible.</p><p>The first implementation of this mapping function was huge. It was about 250 lines of tricky and slightly incorrect code. I managed to rewrite it from scratch using another approach and it got way better.</p><p>Working on this specific part led me to open three pull request to the <code>clickhouse-rs</code> crate:</p><ul><li><a href="https://github.com/suharev7/clickhouse-rs/pull/171" target="_blank" rel="noopener noreferrer">Make Value fully constructible (#171)</a></li><li><a href="https://github.com/suharev7/clickhouse-rs/pull/172" target="_blank" rel="noopener noreferrer">Compare IP adresses properly (#172)</a></li><li><a href="https://github.com/suharev7/clickhouse-rs/pull/173" target="_blank" rel="noopener noreferrer">Allow for Enum8 and DateTime64 value comparison (#173)</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h2><p>The conversion function described in the previous subsection was fairly complex. Each possible conversion and cast has been carefully tested in order to ensure that it behaves correctly. These tests were greatly simplified thanks to the use of declarative macro.</p><p>Some other tests were focused on testing the sink as a whole, and how it would interact with a ClickHouse database. In this kind of test, we would run ClickHouse Docker containers, create a ClickHouse sink, plug the sink to the container, send some events, and see what has been inserted in the ClickHouse side.</p><h1>What to do next?</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="improving-the-sink">Improving the sink<a href="#improving-the-sink" class="hash-link" aria-label="Direct link to Improving the sink" title="Direct link to Improving the sink">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automatically-getting-the-table-schema">Automatically getting the table schema<a href="#automatically-getting-the-table-schema" class="hash-link" aria-label="Direct link to Automatically getting the table schema" title="Direct link to Automatically getting the table schema">​</a></h3><p>It turns out that ClickHouse has a <a href="https://clickhouse.com/docs/en/sql-reference/statements/describe-table" target="_blank" rel="noopener noreferrer"><code>DESCRIBE TABLE</code> statement</a>, which allows to gather information about each column of a specific table. We currently rely on the end-user to provide us valid information about the table columns. Using this statement would reduce the amount of information we require from them, hence making it simpler to use.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inserting-data-concurrently">Inserting data concurrently<a href="#inserting-data-concurrently" class="hash-link" aria-label="Direct link to Inserting data concurrently" title="Direct link to Inserting data concurrently">​</a></h3><p>The current implementation of the ClickHouse container uses a single database connection object, which is reused across insertions. A good way to improve this system is to use multiple concurrent connections, so that we could insert multiple batch of events at once.</p><p>A similar pattern has already been implemented in Tremor as part of the <a href="https://www.tremor.rs/docs/edge/reference/connectors/elastic" target="_blank" rel="noopener noreferrer"><code>elastic</code></a> connector. As such, most of the required machinery is already there.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-source-part">The source part<a href="#the-source-part" class="hash-link" aria-label="Direct link to The source part" title="Direct link to The source part">​</a></h2><p>This mentorship was focused on building a sink for ClickHouse. The next step could be to add a source connector, so that coming from a ClickHouse database can be ingested directly into a Tremor application.</p><p>ClickHouse has a feature allowing to watch for updates in a given table. This way, we can simulate a stream of data, and make it flow in the Tremor system. Each time some data is inserted in the table, we can retrieve it, convert it into Tremor value and make it flow into the graph of nodes described earlier.</p><p>This is something that we totally want to see in Tremor in the future. We can&#x27;t wait for the <a href="https://clickhouse.com/docs/en/sql-reference/statements/watch/" target="_blank" rel="noopener noreferrer"><code>WATCH</code> statement</a> to be considered stable.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/database">Database</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/click-house">ClickHouse</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCg1hxwEjh9szpYg8SxL0U7Q" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
          Copyright © 2025, Tremor Authors | Documentation Distributed under CC-BY-4.0.<br><br>
              <p style="font-size: smaller;">Hosted by: <a href="https://www.netlify.com/" rel="noreferrer noopener" aria-label="Netlify"><img src="/img/netlify-full-logo.svg" alt="CNCF" style="width: 3%;"></a>
              &nbsp;&nbsp;&nbsp;&nbsp;
              Project of: <a href="https://www.cncf.io/" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 5%;"></a></p>
        <small>© 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.</small>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a24082e.js"></script>
<script src="/assets/js/main.fe542851.js"></script>
</body>
</html>