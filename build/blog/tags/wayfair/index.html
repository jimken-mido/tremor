<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">12 posts tagged with &quot;wayfair&quot; | Tremor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.tremor.rs/blog/tags/wayfair"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="12 posts tagged with &quot;wayfair&quot; | Tremor"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.tremor.rs/blog/tags/wayfair"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/blog/tags/wayfair" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/blog/tags/wayfair" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8fde9d3c.css">
<link rel="preload" href="/assets/js/runtime~main.0a24082e.js" as="script">
<link rel="preload" href="/assets/js/main.fe542851.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/0.12/getting-started/">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" positition="left" href="/docs/0.12">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/0.12/guides/">Guides</a></li><li><a class="dropdown__link" href="/docs/0.12/reference/">Reference Documentation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.12/">0.12</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/edge/">edge</a></li><li><a class="dropdown__link" href="/docs/0.12/">0.12</a></li><li><a class="dropdown__link" href="/docs/0.11/">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-0.12,docs-rfc-current"></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/24/LFX-Blog-Carol">Hygienic error handling and validation for pipelines</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/07/LFX-Blog-Sasha">Support for the ClickHouse database in Tremor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/15/tdengine-colaboration">TDengine colaboration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/03/LFX-Blog-Prashant">Automating the tremor release process</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/02/tremor-tremors">Tremors - May &#x27;22</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>12 posts tagged with &quot;wayfair&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/06/02/tremor-tremors">Tremors - May &#x27;22</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-02T00:00:00.000Z" itemprop="datePublished">June 2, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/GaryPWhite" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/7660110?v=4" alt="Gary + The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/GaryPWhite" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Gary + The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Welcome, Tremor Enthusiasts! This post is another in a series intended to inform and entertain Tremor Technologists with recent changes in the <code>tremor</code> project. We&#x27;ll mostly focus these posts on Pull Requests and other notable developments. With these posts, you can stay informed and learn more about the project without having to read pull requests, or wait for release notes.</p><p>Have you ever cleaned the house for company, to make it seem like nobody lives there? That’s basically what we’ve been up to getting ready for 0.12.0. It’s a big deal. We&#x27;re trying to make the codebase spotless with plenty of sweeping up. We also thank our contributors for all the hard work put into automation and new stuff this month!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-stuff">New Stuff<a href="#new-stuff" class="hash-link" aria-label="Direct link to New Stuff" title="Direct link to New Stuff">​</a></h2><p>Most exciting of all: <a href="https://github.com/tremor-rs/tremor-runtime/releases/tag/v0.12.0" target="_blank" rel="noopener noreferrer">We made the 0.12.0 release</a>! We put a lot of cool stuff in right before releasing, so finish the article before you jump in!</p><p>Being able to make a new tremor project has been a pain point from some of our users. We wanted <a href="https://www.tremor.rs/docs/0.12/getting-started/" target="_blank" rel="noopener noreferrer">getting started</a> to be as easy as typing a command. Now it is! You can simply call our <a href="https://github.com/tremor-rs/tremor-runtime/pull/1671" target="_blank" rel="noopener noreferrer">fancy new command</a> to make a <code>new</code> tremor template. Quick and easy!</p><p>Our elasticsearch integrations got some upgrades with support for <a href="https://github.com/tremor-rs/tremor-runtime/pull/1653" target="_blank" rel="noopener noreferrer">raw elastic payloads</a> through our connector, and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1663" target="_blank" rel="noopener noreferrer">native support for auth</a> between elastic &lt;-&gt; tremor. No more need for custom headers on connectors! Check out the links provided for more details, and we&#x27;ll update the docs soon.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ci">CI<a href="#ci" class="hash-link" aria-label="Direct link to CI" title="Direct link to CI">​</a></h2><p>The CI has been changed heavily in the last month. We have <a href="https://github.com/PrimalPimmy" target="_blank" rel="noopener noreferrer">PrimalPimmy</a> on GitHub to thank for much of the contributions. Thank you!</p><p>We&#x27;ve tweaked our CI when we <a href="https://github.com/tremor-rs/tremor-runtime/pull/1679" target="_blank" rel="noopener noreferrer">create a release</a> that should prevent creating crates unexpectedly. We also trigger <a href="https://github.com/tremor-rs/tremor-runtime/pull/1673" target="_blank" rel="noopener noreferrer">many workflows across our projects</a> from a release flow in tremor-runtime. We also decided that publishing in <a href="https://github.com/tremor-rs/tremor-runtime/pull/1649" target="_blank" rel="noopener noreferrer">many steps</a> would help to prevent <a href="https://github.com/tremor-rs/tremor-runtime/pull/1644" target="_blank" rel="noopener noreferrer">single points</a> of failure.</p><p>We can also better provide <a href="https://github.com/tremor-rs/tremor-runtime/pull/1624" target="_blank" rel="noopener noreferrer">descriptive options</a> when we create a release. We can also provide <a href="https://github.com/tremor-rs/tremor-runtime/pull/1609" target="_blank" rel="noopener noreferrer">better options for publishing</a>.</p><p>Lastly, we tweaked <a href="https://github.com/tremor-rs/tremor-runtime/pull/1682/files" target="_blank" rel="noopener noreferrer">how much we use sed</a> when we cut a release. This one is great for a quick example:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> tremor-script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;s/^tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${old}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string" style="color:rgb(255, 121, 198)">/tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${new}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string" style="color:rgb(255, 121, 198)">/&quot;</span><span class="token plain"> -i.release </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Cargo.toml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;s/^tremor-influx = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${old}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string" style="color:rgb(255, 121, 198)">/tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${new}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string" style="color:rgb(255, 121, 198)">/&quot;</span><span class="token plain"> -i.release </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Cargo.toml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;s/^tremor-value = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${old}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string" style="color:rgb(255, 121, 198)">/tremor-common = { version = </span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${new}</span><span class="token string entity" style="color:rgb(255, 121, 198)">\&quot;</span><span class="token string" style="color:rgb(255, 121, 198)">/&quot;</span><span class="token plain"> -i.release </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Cargo.toml&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where we used to manually edit each project&#x27;s <code>.toml</code> file, we now do this as part of our <a href="https://github.com/tremor-rs/tremor-runtime/actions" target="_blank" rel="noopener noreferrer">GitHub Actions workflow</a> elsewhere.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sweeping-up">Sweeping Up<a href="#sweeping-up" class="hash-link" aria-label="Direct link to Sweeping Up" title="Direct link to Sweeping Up">​</a></h2><p>As we mentioned before, there was a lot of sweeping up we wanted to finish before the newest release.</p><p>One of the more interesting fixes we put in was a small bug for <code>tremor run</code>. Something that had gone unnoticed for a while was an <a href="https://github.com/tremor-rs/tremor-runtime/pull/1582" target="_blank" rel="noopener noreferrer">upper limit</a> when running tremor scripts. After 150 seconds, the script would time out. A strange and small feature limitation we didn&#x27;t notice.</p><p>We had a lot of work specifically to do on connectors.</p><ul><li>Some connectors wrote <a href="https://github.com/tremor-rs/tremor-runtime/pull/1662" target="_blank" rel="noopener noreferrer">more events</a> than they should</li><li>Edge cases existed where we would acknowledge error events <a href="https://github.com/tremor-rs/tremor-runtime/pull/1670" target="_blank" rel="noopener noreferrer">without processing them</a>.</li><li>Some <a href="https://github.com/tremor-rs/tremor-runtime/pull/1651" target="_blank" rel="noopener noreferrer">bench connectors</a> would not stop as expected.</li><li>Show errors on <a href="https://github.com/tremor-rs/tremor-runtime/pull/1606" target="_blank" rel="noopener noreferrer">unknown connector</a> types, instead of silently failing.</li><li>Make destructive connector actions <a href="https://github.com/tremor-rs/tremor-runtime/pull/1668" target="_blank" rel="noopener noreferrer">much more difficult</a> to accidentally stumble upon.</li></ul><p>We also removed a limitation we had for code coverage. Where our contributors would have to avoid <a href="https://github.com/tremor-rs/tremor-runtime/pull/1666" target="_blank" rel="noopener noreferrer">functionally any drop at all</a> in code coverage, we now allow a <code>.1</code> percent drop.</p><p>If you were a using the <code>tremor api</code> sub command, you should be aware that we&#x27;ve <a href="https://github.com/tremor-rs/tremor-runtime/pull/1650" target="_blank" rel="noopener noreferrer">completely deprecated</a> the subcommand.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fixes">Bug Fixes<a href="#bug-fixes" class="hash-link" aria-label="Direct link to Bug Fixes" title="Direct link to Bug Fixes">​</a></h2><p>Our bug fixes were pretty few over ht elast month. We had some <a href="https://github.com/tremor-rs/tremor-runtime/pull/1655" target="_blank" rel="noopener noreferrer">publishing</a>, <a href="https://github.com/tremor-rs/tremor-runtime/pull/1702" target="_blank" rel="noopener noreferrer">connecting</a>, and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1677" target="_blank" rel="noopener noreferrer">regular expressions</a> patches. We updated our new <a href="https://github.com/tremor-rs/tremor-runtime/pull/1676" target="_blank" rel="noopener noreferrer">code coverage tool</a>, codecov, to more accurately track our coverage. We also found that piping information to tremor would <a href="https://github.com/tremor-rs/tremor-runtime/pull/1701" target="_blank" rel="noopener noreferrer">sometimes cause issues</a> and fixed that.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thank-you">Thank You<a href="#thank-you" class="hash-link" aria-label="Direct link to Thank You" title="Direct link to Thank You">​</a></h2><p>The Tremor project as strong as the community around it. Reading this article, making contributions, and generally being involved in the project makes us more successful. Thank you for reading and contributing! See you next time.</p><ul><li>Gary, and the Tremor team.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/collaboration">collaboration</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tremors">tremors</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/05/03/tremor-tremors">Tremors - April &#x27;22</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-05-03T00:00:00.000Z" itemprop="datePublished">May 3, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/GaryPWhite" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/7660110?v=4" alt="Gary + The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/GaryPWhite" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Gary + The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Welcome, Tremor Enthusiasts! This is the first post in a series intended inform and entertain Tremor Technologists with recent changes in the <code>tremor</code> project. We&#x27;ll mostly focus these posts on Pull Requests and other notable developments. With these posts, you can stay informed and learn more about the project without having to read pull requests, or wait for release notes.</p><p>This posts&#x27; theme is <em>open and improved communication</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="release-candidates">Release Candidates<a href="#release-candidates" class="hash-link" aria-label="Direct link to Release Candidates" title="Direct link to Release Candidates">​</a></h2><p>Where&#x27;s the next release of Tremor?!</p><p>Tremor&#x27;s release schedule is becoming a bit more regular. We&#x27;re releasing <a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer">about twice a year</a>, every 6 to eight months. The next release of Tremor should include an exciting new way to write plugins with the <a href="https://github.com/tremor-rs/tremor-runtime/issues/791" target="_blank" rel="noopener noreferrer">plugin development kit</a>, along with other goodies for faster, <a href="https://github.com/tremor-rs/tremor-runtime/pull/1571/files" target="_blank" rel="noopener noreferrer">well understood tremor scripts</a> and plenty of other <a href="https://github.com/tremor-rs/tremor-runtime/pull/1539" target="_blank" rel="noopener noreferrer">performance</a> and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1537" target="_blank" rel="noopener noreferrer">bug fixes</a>.</p><p>Most notable as an update for us all is that Tremor has a <a href="https://github.com/tremor-rs/tremor-runtime/releases/tag/v0.12.0-rc.1" target="_blank" rel="noopener noreferrer">release candidate</a> live. If we&#x27;re pleased with it, then a new version of tremor is soon to be released!</p><p>In this article, Let&#x27;s dive into three topics: <a href="#ci">CI</a>, <a href="#pdk-plugin-development-kit">PDK</a>, and <a href="#performance">performance</a>!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ci">CI<a href="#ci" class="hash-link" aria-label="Direct link to CI" title="Direct link to CI">​</a></h2><p>One of my favorite parts of working with tremor, or any project, is using automation. Running a bunch of stuff on my machine can be quicker, but less reliable than a well established automation platform. Tremor makes an effort to improve Continuous integration regularly; and this month is no exception.</p><p>One of our active members of the Tremor Community, <a href="https://github.com/PrimalPimmy" target="_blank" rel="noopener noreferrer">Pimmy</a> has taken it upon himself to dramatically improve the CI and relase process for <code>tremor-runtime</code>.</p><p>The <a href="https://github.com/tremor-rs/tremor-runtime/pull/1545/files" target="_blank" rel="noopener noreferrer">new process</a> will automatically publish a release when we&#x27;re ready. Using this automatino, we can bump versions appropriately with specially named branches and some fancy <a href="https://github.com/tremor-rs/tremor-runtime/runs/6026528631?check_suite_focus=true" target="_blank" rel="noopener noreferrer">GitHub Actions</a>. This lets the Tremor team take full advantage of the seamless GitHub experience from merge -&gt; release, complete with logs and links directly from the Pull Request. We can even extract release notes and <a href="https://github.com/tremor-rs/tremor-runtime/pull/1563/files" target="_blank" rel="noopener noreferrer">bump versions automatically</a>. Once again, truly great work from our community here!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pdk-plugin-development-kit">PDK (Plugin Development Kit)<a href="#pdk-plugin-development-kit" class="hash-link" aria-label="Direct link to PDK (Plugin Development Kit)" title="Direct link to PDK (Plugin Development Kit)">​</a></h2><p>I won&#x27;t spend too much time on this point, since the lovely <a href="https://github.com/marioortizmanero" target="_blank" rel="noopener noreferrer">marioortizmanero</a> has already taken the time to write out <a href="https://nullderef.com/blog/plugin-abi-stable/" target="_blank" rel="noopener noreferrer">a full blog post</a> or <a href="https://nullderef.com/blog/plugin-impl/" target="_blank" rel="noopener noreferrer">two</a> on the topic. We&#x27;ll give a full breakdown another time. For now: know that Tremor is currently in the works of creating an easier way for developers to plug their own binaries into the system to run connectors and pipelines.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">​</a></h2><p>Tremor cares <a href="https://www.tremor.rs/community/development/benchmarks/LogstashBenchmark" target="_blank" rel="noopener noreferrer">a lot about performance</a>. As you may already know from <a href="https://www.youtube.com/watch?v=xsowS5hEKRg&amp;list=PLNTN4J6tdf20vy14FVOazLTdou_8xyvfe&amp;index=4" target="_blank" rel="noopener noreferrer">TremorCon 2021&#x27;s fabulous talks</a>; it was originally created and adopted for performance gains in Wayfair&#x27;s event processing infrastructure. There are plenty of performance gains to make in a project as large as Tremor, both inside the project and through dependencies.</p><p>One such dependency we depend on <a href="https://simdjson.org/" target="_blank" rel="noopener noreferrer">to parse gigabytes of JSON per second</a> is <a href="https://docs.rs/simd-json/0.3.18/simd_json/index.html" target="_blank" rel="noopener noreferrer">simd_json</a>. <code>simd_json</code> is a port of the simdjson c++ library into rust. It can not only parse from JSON into Rust, but aid the <code>serde</code> library that can easily serialize and deserialize Rust data structures. That&#x27;s pretty handy for an event processing project that will have to marshal plenty of events from disparate sources of all data forms! As you might imagine, a project like <code>simd_json</code> comes with a lot of configuration options, and optimizations behind those options.</p><p>Further than just the configuration that you might give <code>serde</code>, or <code>simd_json</code>, is the options you may give to the <a href="https://github.com/simd-lite/simd-json/blob/main/.cargo/config" target="_blank" rel="noopener noreferrer">rust compiler</a>. The compiler, by default, <a href="https://docs.rs/simd-json/latest/simd_json/index.html" target="_blank" rel="noopener noreferrer">compiles for the largest compatability.</a> For best performance on a specific plaform, we make use of the <code>target-feature</code> flag. This will allow us to target specific features available on different platforms and CPUs.</p><p>It should be no surprise that we continue this effort within the Tremor team. Know that we also depend on our community, such as a <a href="https://github.com/tremor-rs/tremor-runtime/pull/1522" target="_blank" rel="noopener noreferrer">pull request from scarabsha</a>. Sasha idenfitifed additional target-features for the target <code>x86_64-unknown-linux-gnu</code> that speed up the performance of <code>simd-json</code>. There&#x27;s not a benchmark to show exactly how much faster this made json processing, but we appreciate the fact that it will undoubtedly increase performance for some clients of Tremor.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thank-you">Thank You<a href="#thank-you" class="hash-link" aria-label="Direct link to Thank You" title="Direct link to Thank You">​</a></h2><p>The Tremor project as strong as the community around it. Reading this article, making contributions, and generally being involved in the project makes us more successful. Thank you for reading and contributing! See you next time.</p><ul><li>Gary, and the Tremor team.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/collaboration">collaboration</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tremors">tremors</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/redpanda-rocket-0282422a2035a2f4d294d7ce8fe8f473.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/12/13/redpanda">Collaboration - Using Redpanda with Tremor</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-13T00:00:00.000Z" itemprop="datePublished">December 13, 2021</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Like all good projects in the open source community, great collaborations start with ad hoc interactions.</p><p><img loading="lazy" alt="Redpanda Rocket" src="/assets/images/redpanda-rocket-0282422a2035a2f4d294d7ce8fe8f473.png" width="2000" height="1403" class="img_ev3q"></p><p>A recent set of discussions between the Tremor maintainers and our community brought <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> to our attention.</p><p>Some of our community would like to replace their Kafka deployments with <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>, a Kafka API-compatible streaming
data platform, to realize gains in performance and reduce their total cost of operations. . As we already have Kafka
connectivity, enabling this shouldn’t be too complex, right? Let’s find out.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>We are always looking out for interesting technology, and recently we read a <a href="https://vectorized.io/blog/wasm-architecture/" target="_blank" rel="noopener noreferrer">very interesting article</a> on the Redpanda
blog about using WASM as server-side filters for subscription. Being as excitable as we are, we obviously had to give
Redpanda a shot.</p><p>To our joy this turned out to be painless, Redpanda reuses the Kafka API so our existing connectors for Kafka work
out of the box — and as a bonus we could get rid of a whole bunch of docker-compose YAML dancing that we needed to
set up Zookeeper.</p><p>Alex Gallego, founder of Redpanda, reached out to us and we started experimenting with Tremor and Redpanda in this
repo: <a href="https://github.com/tremor-rs/tremor-redpanda" target="_blank" rel="noopener noreferrer">github.com/tremor-rs/tremor-redpanda</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-tremor-and-redpanda">Setting up Tremor and Redpanda<a href="#setting-up-tremor-and-redpanda" class="hash-link" aria-label="Direct link to Setting up Tremor and Redpanda" title="Direct link to Setting up Tremor and Redpanda">​</a></h2><p>So, let’s get our hands dirty and actually connect Redpanda and tremor in a real-world project.</p><p>We have prepared a fully equipped workshop for this occasion. Give it a shot <a href="https://www.tremor.rs/docs/0.11/recipes/redpanda_elastic_correlation/README" target="_blank" rel="noopener noreferrer">here</a>
if you are impatient.</p><p>Tremor can flexibly act as a Redpanda/Kafka consumer or producer, make use of auto-commit for offset management or manually commit
when events are completely handled by the tremor pipeline. Here we are configuring Tremor only committing offsets when events have been successfully handled.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">onramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">brokers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">topics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">group_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> redpanda_es_correlation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">retry_failed_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">rdkafka_options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">enable.auto.commit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This tremor application is reporting success or failure of ingesting the received events into elasticsearch via another Redpanda topic.
Configuring this is also straightforward, here we have a <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> consumer ready for copy-pasting:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">offramp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">codec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">group_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tremor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">brokers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> redpanda</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tremor</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here you go. A fully working setup for orchestrating document ingestion with <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> delivering the documents and receiving acknowledgements.
For more details check out this Redpanda <a href="/docs/0.11/recipes/redpanda_elastic_correlation">recipe</a> on our website.</p><p>Tremor is designed to be robust when faced with high volumetric data streams. It comes with batteries included for traffic shaping,
QoS and data distribution. With those tremor can guarantee at-least-once message delivery. We try to reduce CPU and memory footprint
for a given workload and at the same time provide a “just works” experience for operators. And we think we found a soulmate project in <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>.</p><p>And most importantly, it is working like a charm. In fact we just dropped in <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> and expected some hours of troubleshooting, but this hope
was cut short by a smooth transition:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.828694200+00:00 INFO tremor_runtime::system - Binding onramp tremor://localhost/onramp/redpanda-in/01/out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.830056300+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Starting kafka onramp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.831848100+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscribing to: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tremor&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.832735600+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscription initiated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.833342+00:00 INFO tremor_runtime::onramp - Onramp tremor://localhost/onramp/redpanda-in/01/out started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.828694200+00:00 INFO tremor_runtime::system - Binding onramp tremor://localhost/onramp/redpanda-in/01/out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.830056300+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Starting kafka onramp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.831848100+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscribing to: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tremor&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.832735600+00:00 INFO tremor_runtime::source::kafka - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Source::tremor://localhost/onramp/redpanda-in/01/out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Subscription initiated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">104_redpanda_elastic_correlation-tremor_out-1     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2021</span><span class="token plain">-12-10T15:17:01.833342+00:00 INFO tremor_runtime::onramp - Onramp tremor://localhost/onramp/redpanda-in/01/out started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Both in terms of operator friendliness and performance we root for <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>.</p><p>We started using it in our integration test suite, so users can be 100% sure <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a> connectivity just works.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/collaboration">collaboration</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/09/php-dead-code-detection">Case Study - Dead Code Detection in PHP</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-09T00:00:00.000Z" itemprop="datePublished">November 9, 2021</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Agares" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/303398?v=4" alt="Ramona Łuczkiewicz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Agares" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Ramona Łuczkiewicz</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>We have a humongous PHP application - around 20 million lines of code. It’s believed that there are certain parts of the codebase that are no longer used, but it’s hard to reliably find out which ones. Due to the dynamic nature of PHP, attempts at static analysis have failed. We decided that dynamic analysis was needed, and created a PHP extension that logs all the calls to all functions and methods. That’s a lot of data, and we used tremor to aggregate it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>We need to be able to aggregate a lot of data (the extension sends one message for each HTTP request, which can be at the order of hundreds per second for some servers), counting the number of calls to each function or method in the codebase and send it to our service which does further aggregation and presents the data.
<img loading="lazy" alt="High Level Architecture" src="/assets/images/dead_code_detection_diagram-ed8ac4fbb8b9c7d345902e0c616d0bfc.png" width="4810" height="910" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h2><p>We used Unix Sockets (which were added as a source to tremor during this project) and then a simple script that aggregates the data. We’re hoping to use custom aggregate functions in the future (there’s an open RFC, waiting for the official voting) to further simplify the pipeline.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>We are currently testing the solution with smaller applications, seeing minimal performance impact and no impact on stability. We were able to delete unused code from those applications without affecting their operation.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/08/uop">Case Study - Unified Observability Platform</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-08T00:00:00.000Z" itemprop="datePublished">November 8, 2021</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>As Wayfair&#x27;s technology organization modernizes its infrastructure services to meet
new volumetric peaks they continually adapt, adopt and atrophy out systems and services.</p><p>This is particularly difficult with shared infrastructure and services that are ever-present
but seldom seen by many of the engineers in the organization.</p><p>The rise of OpenTelemetry provides an opportunity for developers to consolidate on SDKs that
are consistent across programming languages and frameworks. For our SRE&#x27;s and operators it
offers ease of integration and ease of migration of services.</p><p>Tremor is a core enabling component of Wayfair&#x27;s migration strategy. Tremor supports
but is endpoint, protocol and service agnostic. This allows our operational teams to
switch from on-premise to cloud native services with minimal coordination with others.</p><p>This also allows switching from in-house to managed or out of the box services supported
by cloud providers.</p><p>Moving 1000s of developers to a new technology stack when you are operating continuously
with no downtime and at a large scale is hard.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>Tremor emerged from production needs in existing systems, specifically
in the logging and metrics or observability domains in a large
hypergrowth and heavily speciated and specialized production environment
that operates 24x7x365.</p><p>As this infrastructure is migrated from a largely on-premise data-centre
based environment to a cloud native environment and the wider technology
organization it operates within doubles in size, change is inevitable.
You can bet your roadmap on it.</p><p>One great emerging de facto standard is the observability sub-domain
that cloud-native computing is propelling forward with standards such as
the CNCF’s OpenTelemetry.</p><p>Tremor added initial support for OpenTelemetry in February 2021.  </p><p>For decades, observability - whether logging, metrics or distributed
tracing has been common. But, lacking in a unified approach, lacking in
a core set of interoperable and interworking standards.</p><p>OpenTelemetry has good support for capturing and distributing logs,
metrics and trace spans. It has sufficient out of the box to suit the
most common needs, most of the time. It affords developers an
opportunity to rationalize libraries and frameworks around shared
concepts, shared understanding and shared effort. This is especially
valuable in large, complex production operations such as Wayfair’s
eCommerce production estate.</p><p>Languages and platforms change over time. System and component
infrastructure are continuously evolving. As SaaS environments continue
to evolve and innovate new forms of observability; or production
operations, system reliability engineers or network operations teams who
often need to move faster than the pace of application or infrastructure
developers can develop new software and systems - this is a hard
problem.</p><p>By targeting OpenTelemetry - developers can depend on a consistent set
of SDKs for most common observability needs. Production focused teams
can depend on a consistent wire-format and protocol allowing them to
move from data-centre to the cloud, and rewire the infrastructure and
services just in time.  </p><p>Through OpenTelemetry, we can normalize the concepts, the code and the
inner workings of our cloud-based systems and services - whilst
introducing far more flexibility than ever before as observability
services and software vendors provide a standards-based and
interoperable path.  </p><p>It is a win-win for all concerned.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p><img loading="lazy" alt="High level architecture - current system" src="/assets/images/image1-32716253b3dd4aa772701e3b429e0bc2.png" width="936" height="546" class="img_ev3q"></p><p>In production at Wayfair, logging and metrics data distribution
pipelines are all handled by tremor. With OpenTelemetry, distributed
tracing can now be standardized across our production estate.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>Standardize an Tremor and OpenTelemetry together.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>The introduction of OpenTelemetry allows developers to standardize on
Observability in applications, services and code for logging, metrics
and distributed tracing. As OpenTelemetry is natively supported in
tremor, it means only minor configuration changes to our existing
logging and metrics services.</p><p><img loading="lazy" alt="The new OpenTelemetry normal" src="/assets/images/image2-ca3c064f5ad4349f47324fcf1e51d363.png" width="958" height="544" class="img_ev3q"></p><p>With OpenTelemetry, distributed tracing can benefit from the same
traffic shaping and adaptive rate limiting as the rest of our
observability stack. The unification of the source, collector and
distribution tiers via kafka provides scalable and recoverable telemetry
shipping and distribution.</p><p>Tremor adds adaptive load shedding and traffic shaping that are tunable
in production. Tremor also allows legacy observability frameworks to
co-exist with OpenTelemetry for a gradual migration across the
programming languages and frameworks in production use. Finally, tremor
enables multiple downstream services to participate in the overall
solution.</p><p>As a heterogeneous ecosystem of interconnected services - the unified
observability platform based on tremor has no preferred upstream or
downstream endpoint. It is system and service agnostic. It is
bendable.  </p><p>This allows teams that prefer the GCP ecosystem to normalize to those
native services for visualization, debugging and troubleshooting. For
our ElasticSearch population, Elastic’s APM may be a better alternative.
For other teams, and our operational staff and folk with more ad hoc
needs - DataDog may be preferable.</p><p>It’s a cloud native decentralized rock’n’roll observability world out
there. Getting 5000 and growing engineers to choose a single
observability path is impossible. So, as the population cannot bend, the
unified observability leans on tremor for this purpose.</p><p>As improved services, frameworks and methods are onboarded our
tremor-based systems can be incrementally adjusted to meet changing
demands.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insights">Insights<a href="#insights" class="hash-link" aria-label="Direct link to Insights" title="Direct link to Insights">​</a></h3><p>This application of tremor does not introduce new features or
capabilities per se.</p><p>However, it is the first unified tremor-based system that spans the
entire observability spectrum. It centralizes common capabilities and
facilities for greater operational freedom, whilst decentralizing the
point-to-point endpoint connectivity for the widest applicability across
our production estate.</p><p>As tremor exposes OpenTelemetry as a client, and as an embedded server -
it is effectively used to disintermediate, interpose and intework with
legacy environments and to standardise on OpenTelemetry.  </p><p>It does this as an incremental update. Existing users have time to
migrate their systems to the new OpenTelemetry-based best-practice.
Existing processes, practices and battle-tested systems are
maintained.  </p><p>Operators have better tools to manage the production estate and to tune
capacity, performance and cost.</p><p>This is also the first tremor-based system where tremor is a key
architectural primitive allowing our observability community to
bend to the changing needs of our development and operational community
with minimal effort, and at short notice.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>As tremor expands to new domains such as search, service orchestration
and supply-chain and logistics to name but a few - our early adopters in
the logging domain have evolved from using tremor as a point solution
for traffic shaping - to building our entire observability
infrastructure based on tremor.  </p><p>New domains will extend tremor’s capabilities in multi-participant
transaction processing and distributed orchestration. The now unified
observability domain will further expand and extract capabilities that
enhance modularity and flexibility of tremor to build large distributed
systems with a relatively simple and easy to program and growing set of
languages designed for large-scale event-based processing.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/07/search">Case Study - Multi-Participant Transaction Orchestration</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-07T00:00:00.000Z" itemprop="datePublished">November 7, 2021</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>The support for multi-participant transaction orchestration in tremor
originates with this use case from Wayfair&#x27;s Search platform services
team.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>One of the frequent requests made of the tremor team by peers in the
Infrastructure organization at Wayfair has come from the search domain.
Search is a critical service at Wayfair and it is the powerplant behind
many other services - ranging from recommendation engines through to
auditing of data streams that are continually being ingested and indexed
into multiple searchable databases.</p><p>At a very high level - streams of documents need to be elementized and
broken down into one or many indexable items of interest - these items
then need to be indexed ( successfully ) into one or many search
engines.</p><p>Many of the use cases that are battle tested with tremor are relevant in
this domain:</p><ul><li>Cleansing, normalization and enrichment of documents and indexable
elementization and tracking documents and elementized items</li><li>Rate limiting, capacity-based load-shedding, with domain classification
similar to the traffic shaping use cases where tremor started</li><li>Sourcing, transformation and distribution of documents and the
synthetic events in real-time at low or very low latencies</li></ul><p>But, for the use case at hand, there are additional needs:</p><ul><li>All documents must be processed transactionally, without loss and
with proper reporting of processing outcome to upstream services and
the documents must be processed in arrival order. The guaranteed
delivery and circuit-breaker mechanisms in tremor now need to be
multi-pipeline.</li><li>All indexable elements of all documents must be indexed in multiple
downstream engines successfully ( or operator errors produced for
exceptions ) while all possible error cases need to be caught and
reported upstream in order to issue retries or let operators
intervene. This is a reasonably orchestration mapping processed elements and tracing
back to the documents the elements were produced from before publication
down stream.</li><li>There is significant variability, variant on a case by case basis, to the exact semantics
required for different document types to be processed to a varying number of downstream
indexing systems and technologies. The solution needs to be modular</li></ul><p>Gathering and aggregating multiple parallel processing outcomes and
subsuming them under a common transaction is outside of the baseline
scope of message-based and message-like systems as they typically only
support point-to-point transactions. Correlation across multiple event
streams usually needs to be solved on the application level. Where
systems support orchestrated transactions - these are typically
constrained by transport/protocol or other factors beyond the
application authors control, and therefore inflexible under variant (
and often fast-changing ) production needs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Expand on tremor’s QoS facilities so that multi-participant transaction
orchestration is possible, easily composable and user programmable.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>The original use cases for tremor were relatively straightforward and
data distribution applications with a requirement for traffic shaping
and rate limiting for data streams when downstream systems were prone to
being overwhelmed at peak traffic conditions.</p><p>These occurrences were rare - but their impact was high when they
happened. And in an infrastructure with higher high peaks year on year
this is an ever-present hazard of doing business.</p><p>More recently, delivery guarantees are expanding as new domains adopt
tremor in production. In these domains data loss, even user defined and
strictly capacity managed traffic shaping, is not tolerable.  </p><p>Like with many real-time systems - the percentage of the overall
in-flight volumetric that requires transactional delivery is typically a
small subset of the overall firehose. Take financial trading systems for
example - orders and trades are transactional and they need to be
processed, each and every one, correctly - as there are fiscal and
regulatory conditions that need to be strictly met.  </p><p>But pricing - the ability to buy or sell and equity, or the current
currency rate is often naturally continuously changing due to supply and
demand, and naturally redundant - as you can buy or sell the same stock
on many different venues.</p><p>The search case stretches the QoS mechanisms in tremor and the internal
mechanisms used to track events as they are processed from a single set
of flows and a small set of participants - to larger and more complex
user defined flows that orchestrate transactions of arbitrary
complexity.  </p><p>This is compounded by tremor-based applications today being large,
increasingly sophisticated and modular. So the QoS mechanisms that were
originally constrained to the boundary of a single pipeline - now need
to be preserved and propagated across an entire deployment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h2><p>Tremor’s core processing element - pipelines - are executable
directed-acyclic graphs.</p><p>A tremor user designs a workflow or pipeline using the tremor query
language.</p><p>Tremor converts this to a directed graph and makes sure that it is
acyclic.</p><p>Tremor transforms and optimizes the user defined graph to an executable
form that is well-structured for easily supporting easy to understand
and easy to define qualities of service.</p><p>If we imagine the pipeline graph as a single larger directed-acyclic
graph we have what tremor actually uses for event distribution
internally. Tremor can distribute and process user defined events -
these are business or data events that originate from connectors or user
defined logic.  </p><p>Tremor can inject control events - these are runtime events that tremor
uses for quality of service and they are not ordinarily user visible.
Tremor can also inject events originating at outputs ( or that propagate
from downstream systems ) backwards to inputs ( or for propagation to
upstream systems ). But, we can do so without introducing cycles.</p><p>The user-defined graph is acyclic. But the tremor runtime has, in
effect, the ability to coordinate acknowledgements for user-defined
events and an ability to signal upstream breaks in connectivity to
downstream systems, or downstream breaks to upstream systems. These
runtime control events - we call them signal-flow and contra-flow - are
transparent to users.  </p><p>Our <code>wal</code> ( write-ahead-log ) operator produces and consumes
signal-flow and contra-flow events.  </p><p>So, given a simple tremor application that has no defined QoS ( it does
not use guaranteed delivery )  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">/etc/tremor/config/lossy.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select patch event of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  insert hostname = system::hostname()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="we-can-configure-the-wal-operator">We can configure the <code>wal</code> operator<a href="#we-can-configure-the-wal-operator" class="hash-link" aria-label="Direct link to we-can-configure-the-wal-operator" title="Direct link to we-can-configure-the-wal-operator">​</a></h3><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">/etc/tremor/config/mostly_guaranteed.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use tremor::system;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator in_memory_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> read_count = 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select patch event of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  insert hostname = system::hostname()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in into in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in_memory_wal into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a logically equivalent application - but we can tolerate a lag
of up to 1000 events or 1 megabyte of data before losing data. Under the
hood of course - events are now tracked and traced. If connectors are
QoS aware then we now have a more robust application.</p><p>So if we are consuming from a kafka cluster upstream and distributing to
another kafka cluster downstream ( such as in another data center ) -
those systems can go offline briefly or be disconnected. The connectors
themselves handle lossless delivery ( that’s handled by kafka in both
cases in this example ). Connectors with less strong guarantees can
still be ( mostly ) lossless - so if our downstream system is HTTP-based
( like elasticsearch ) - we can tolerate transient service loss and
fully recover.  </p><p>What if tremor or the host it is deployed on is rebooted?</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">/etc/tremor/config/mostly_guaranteed.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use tremor::system;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator in_memory_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dir = ”./recovery”, # Persistent file-based recovery file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  read_count = 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select patch event of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  insert hostname = system::hostname()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in into in_memory_wal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in_memory_wal into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The tremor developer doesn’t need to be too concerned with the internal
mechanisms, or their implementation. And for simple applications with a
single primary data flow, its as easy as the examples above to
selectively introduce grades of guaranteed delivery with a spectrum of
robustness that derives from choice of connectivity ( kafka vs http ) or
how the <a href="https://www.tremor.rs/docs/tremor-query/operators/" target="_blank" rel="noopener noreferrer">qos</a>
operators are chosen, placed in a flow, and configured.</p><p>Orchestration however, is different. In an orchestrated transaction the
user defined logic provided by the tremor developer also needs to do
some tracking. This is achieved through using tremor’s state mechanism
alongside the <code>qos</code> capabilities and operators that tremor provides to
compose a solution.  </p><p>So, in our search case - let us say we have two downstream search
engines - and both need to index a different set of items of interest
elementized from a single document - we use the state mechanism to track
progress of the items for each participant - and when all participants
have indexes up to date - we issue a synthetic event ( that can be
recorded in a wal ) that publishes the document processing status
downstream.</p><p><img loading="lazy" alt="search logic" src="/assets/images/image1-cb4dd9235b1af1100251fcd71cac1652.png" width="960" height="720" class="img_ev3q"></p><p>So our document source is kafka, our indexing engines for elementized
items and our destination for successfully elementized documents ( which
may now be enriched with elementization metadata and index metadata )
can now be published ( let’s assume kafka again for simplicity ) to an
audited topic.  </p><p>The state mechanism in tremor is a readable/writable value - so
persistent and recoverable state is a relatively simple composition:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script remember</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let state = event;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define qos::wal operator forget_me_not</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dir = &quot;./brain&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  read_count = 1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script remember;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator forget_me_not;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into remember;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from remember into forget_me_not;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from forget_me_not into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Please don’t run out of disk space!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Most of the changes required to evolve tremor form supporting great qos
for simple single pipeline applications to complex multi-pipeline and
multi-participant stateful orchestrations did not expose new features to
the tremor developer or user.  </p><p>It has been a significant change to tremor internals, however and the
work reaches a stable point with our <code>0.12</code> release - the ability to
<code>pause</code> and <code>resume</code> connectors, and the ability for the tremor
runtime itself to detect and act on <code>quiescence</code> will mean that tremor
is flexible enough for the demands and use cases that originated in the
search domain.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/06/modularity">Case Study - Modularity, Oh My</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-06T00:00:00.000Z" itemprop="datePublished">November 6, 2021</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>The adoption growth of tremor inside Wayfair is such that we have
production customers with 3.5 years of experience operating tremor in
production with very large, complex tremor-based services - and fresh
demands from new domains such as Search - whose requirements for
multi-participant transaction orchestration are driving enhancements to
qualify of service, guaranteed delivery and circuit breaker capabilities
within tremor’s core processing engine.</p><p>Some usage patterns are becoming common enough that sharing tremor
application logic across teams, across organizations, and across domains
is now common. For example - tremor has good support for HTTP based
interactions and already interfaces with a number of HTTP-based and REST
APIs, and it can expose HTTP-based interfaces to participants and act as
a REST-based or HTTP-based service. Many of these services share the
same needs around handling HTTP errors and routing errors and alerts.</p><p>At the event flow or query level - similar levels of sophistication are
emerging in the installed user base.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Expand tremor’s domain specific languages to support modularity,
starting with the scripting language but extending into the query
language to maximise reuse of user-defined processing logic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>Provide standard mechanism and syntax to discover, reference and consume
functional units of logic that can be shared by all tremor domain
specific languages.</p><p>A new lexical preprocessing phase has been introduced allowing source to
be packaged within a modular set of paths through a <code>TREMOR_PATH</code> environment
variable. Since V0.8 of tremor the scripting and query languages both
support modules, and share the same module syntax and semantics.</p><p>The tremor API was upgraded to supported preprocessed or non-modular
source so that no API changes were required to extend the deployment
mechanisms to support modularity.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modular-scripting">Modular scripting<a href="#modular-scripting" class="hash-link" aria-label="Direct link to Modular scripting" title="Direct link to Modular scripting">​</a></h3><p>In a nutshell - this added support for user defined constants and user
defined functions.</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">my_mod.tremor</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Tail recursive implementation of fibonacci</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn fib_(a, b, n) of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case (a, b, n) when n &gt; 0 =&gt; recur(b, a + b, n - 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  default =&gt; a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn fib(n) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fib_(0, 1, n)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The module can be loaded via the module path and used in other script or query sources:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">fib.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># A streaming fibonacci service*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script fibber</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  use my_mod;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    my_mod::fib(event)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script fib from fibber;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into fib;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from fib into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modules can be file-based, or defined inline in the scripting or query
language. A standard set of system modules is provided by tremor out of the box.</p><p><a href="https://www.tremor.rs/docs/tremor-script/modules" target="_blank" rel="noopener noreferrer">Tremor Modules</a>  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modularity-in-the-query-language">Modularity in the query language<a href="#modularity-in-the-query-language" class="hash-link" aria-label="Direct link to Modularity in the query language" title="Direct link to Modularity in the query language">​</a></h3><p>In the query language windows, scripts and pluggable operators may be
defined and shared across queries.</p><p>There is an RFC for modular sub-query to allow query sub-graphs to be
defined and shared which is being delivered as part of a tremor LFX
mentorship.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modularity-in-the-deployment-language">Modularity in the deployment language<a href="#modularity-in-the-deployment-language" class="hash-link" aria-label="Direct link to Modularity in the deployment language" title="Direct link to Modularity in the deployment language">​</a></h3><p>Modular deployments through replacing the YAML configuration syntax with
a deployment language will embed the modular query language, which in turn
embeds the modular scripting language.  </p><p>This work is under development and will span multiple releases - but it
is being designed in such a way that as clustering capabilities are added to tremor, that
clustered or  distributed deployments will be modularly composable by end users using
the same  tooling as the other DSLs within tremor.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h2><p>The support for modularity is thematic. The scripting language now
supports a functional programming paradigm and file-based or nested
inline modules. The query language can embed modular scripts using the
same module mechanism and definitions in the query language are also
modular.</p><p>Modular sub-query and the introduction of the deployment language are
planned and in progress and will extend modularity to the administration
of running tremor nodes.</p><p>And, in the fullness of time, clustering will further extend modularity
in tremor to maximize operator and tremor developer productivity through
efficient reuse and sharing of common tasks.</p><p>The first set of connectivity to benefit from modularity is the support
for CNCF OpenTelemetry. This is the first set of tremor connectors to be
delivered that ships with its own set of modules designed to make
designing OpenTelemetry based services in tremor easier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>As tremor grows into new domains, and the algorithm and solution
complexity of traditional production domains for tremor increase in
sophistication, size, complexity, the subject of modularity has evolved
and new demands continue to emerge.  </p><p>We expect the <code>modularity</code> theme to be long-lived, but its origins
derive from production needs. When tremor was developed the user defined
logic was small, relatively simple and applications built with tremor
were fairly monolithic.  </p><p>Today, multi-pipeline and medium to large tremor-based applications are
common. And adoption of the modular scripting and query language
primitives is now driving larger and more sophisticated use cases.</p><p>Another dimension of modularity is the ongoing expansion of connectivity
in tremor. Modularity here reflects a different production-driven need (
and a few maintainer conveniences ). A plugin development kit is being
developed that will allow connectors and other plugins to be developed
in separately managed and maintained projects. This in turn allows the
core of tremor to be managed independently of connectivity.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/05/kubernetes-sidecars">Case Study - Kubernetes and Tremor Sidecars</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-05T00:00:00.000Z" itemprop="datePublished">November 5, 2021</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>The simplified architecture of our systems is currently:</p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-546e9398e3b74c01fefca8fa7450da0e.png" width="598" height="168" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>Wayfair’s technology organization is continuously expanding, evolving
and growing. When work on tremor began we were running almost entirely
in our own data centres, on our own hardware.</p><p>Today, we are running largely in the cloud. Whether cloud-native or
bare-metal the sidecar pattern has proven to be a significantly popular
deployment pattern with tremor-based systems in production at Wayfair.  </p><p>Tremor is equally happy with clustered ( just a bunch of event
processors ) centralized deployments or with sidecar deployments; on
containerized virtual machines, or alongside our growing Kubernetes
estate.</p><p>With the rise of Kubernetes and cloud-native at Wayfair - we had an
interesting challenge as an infrastructure organization serving the
1000’s of developers in our wider technology group. How do we continue
to deliver a single pane of glass to our developers?  </p><p>Although the over-simplified architecture diagram above looks simple -
its far more complex in practice. We have multiple independent search
and visualization clusters. And we have many more infrastructure
services and clusters sitting behind these frontends.  </p><p>For our application developers - this looks like a vanilla installation
of ElasticSearch and Kibana. In reality its an always-changing and
forever-speciating set of services running 24x7x365 offering a
single-pane-of-glass for our developers convenience.  </p><p>By this state of use case evolution and adoption of Tremor at Wayfair -
tremor is at the centre of a lot of the internal data distribution and
processing - whilst offering no protocols, APIs or transports of its
own - entirely invisible to our target developer community.  </p><p>Our Kubernetes team developed helm charts for tremor to preserve the
convenience of this illusion; whilst accelerating the operationalisation
of our emergent cloud-native infrastructure services.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Boldly go cloud-native, in such a way that no-one truly notices.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>No new features or capabilities were developed for this use case by the
tremor team.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>Adopt helm-based deployments of tremor for our cloud-native and
kubernetes-enabled applications and services. The helm charts have since
been open sourced in collaboration with our Kubernetes Team as a part of
tremor, and have been extended to support OpenShift by the tremor
community ( waves to <strong>Anton Whalley</strong> of <a href="https://www.meetup.com/Rust-Dublin/" target="_blank" rel="noopener noreferrer">Rust Dublin</a> fame! ).</p><p><a href="https://github.com/tremor-rs/tremor-k8s-helm" target="_blank" rel="noopener noreferrer">Tremor Helm Charts</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Shortly before tremor was open-sourced and donated to the Linux
Foundation it became cloud-native itself through the combined efforts of
the Infrastructure group at Wayfair - especially our Platform
Engineering, SRE’s and our Kubernetes teams&#x27; hard work.  </p><p>We hope to productize and open source other solution packs that enable
the wider tremor community to quickly bootstrap production environments
based on the tremor-based systems we already have in productioning in
our Logging, Metrics, Observability, Kubernetes and Search teams.  </p><p>In a large way - the early successes of tremor and our adoption of
cloud-native and cloud-based computing aligned the goals of the tremor
project with those of the Linux Foundation and the Cloud Native Compute
Foundation where tremor is now an early stage sandbox project.  </p><p>If you’re reading this - and the work and philosophy resonates with your
organization, your people and you believe similar benefits could elevate
your production environments - then please reach out to us in the tremor
community and get involved, join us and help us shape tremor’s future.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/04/data-flow">Case Study - Data Flow with Tremor</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-04T00:00:00.000Z" itemprop="datePublished">November 4, 2021</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>The simplified architecture of our systems is currently:  </p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-546e9398e3b74c01fefca8fa7450da0e.png" width="598" height="168" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>The need to route and process data from multiple sources to multiple
destinations with one or many potentially overlapping streams of data
processing is already evident in the first 2 phases of Tremor’s
emergence as a mission critical piece of infrastructure at Wayfair.</p><p>Growing adoption and the increased sophistication of processing needs
now results in the emergence of event/data flow or pipeline processing
by our production users. We summarise multiple phases of evolution here
and conflate them into a single case study.  </p><p>In reality the use case captured in this synopsis composes multiple
smaller projects related by the same identified need spanning multiple
releases into a single case study.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Our systems specialists are writing increasingly complex, layered and
rich business logic within tremor’s domain specific language
<code>tremor-script</code> and are inhibited by our pipeline model which uses the
YAML format for describing data flow graphs.</p><p>YAML is hard to write, and hard to debug, and the embedded scripting
language is an odd fit into the pipeline configuration which is
described in YAML.</p><p>Preserving the internal pipeline processing and execution mechanisms -
replace the verbose YAML syntax with a statement oriented query language
that extends the expression oriented scripting language.  </p><p>This allows hygienic and helpful error reporting with suggested
workarounds and fixes, better IDE integration and a more intuitive means
to express data flow operations on multiple data streams that the
pipeline mechanisms expose to tremor systems application developers.  </p><p>A structured query-like language suitably captures the directed-acyclic
graph nature of data flows but we need to support rich nested JSON-like
data structures with leverage of the processing capabilities of the
scripting language - whilst opening up new capabilities to extend the
processing capabilities through custom operators, embeddable scripting
logic and extensions and enhancements to QoS and non-functional
primitives.</p><p>For the metrics domain - the ability to aggregate tumbling windows of
events and to provide multiple aggregation dimensions with flexible
grouping policies is a new requirement.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>Replace the YAML-based pipeline configuration with a structured
query-like language that embeds the scripting language, providing top
grade support for processing rich data structures, extensibility through
custom operators, and windowing semantics to support multi-resolution
event aggregation.</p><p>The initial solution was the introduction of the tremor query language.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>The query language not only replaces the YAML-based event flow syntax
for describing data flow pipelines and processing - which is useful for
every domain using tremor in production at Wayfair - but, it has special
considerations for the metrics or other analytic domains that require
rich means of grouping and aggregate processing of in-flight streaming
data. The embedding of scripting logic allows the traditional domain of
ETL and data processing and transformation to be natively supported with
a more intuitive syntax.</p><p>A rate limiting or traffic shaping example ( common to multiple usage
domains ):</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># File traffic.trickle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Very basic traffic shaping algorithm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Define a bucket grouping operator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define grouper::bucket operator kfc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Logic for categorizing events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define script categorize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let $rate = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let $class = event.`group`;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { &quot;event&quot;: event, &quot;rate&quot;: $rate, &quot;class&quot;: $class };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># An instance of the grouper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create operator kfc from kfc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># An instance of the categorizer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create script categorize;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stream ingested events into the categorizer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from in into categorize;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stream categorized events into the grouper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from categorize into kfc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stream categorized and group batched events downstream</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select event from kfc into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The relatively simple structured query-like language allows script and
window definitions to be reused. The <code>define</code> statements do not create
operator instances in the data flow graph; they create named reusable
definitions that encompass the desired semantics. The <code>create</code>
statements create the nodes of the directed acyclic graph. The
<code>select</code> statement is a builtin operator that is used for linking
nodes in the graph together to form a data flow or event processing
graph.</p><p>Although the sample logic in the example is a simplified version of what
our logging and metrics service teams actually develop and maintain for
our production systems - it replaces 1000s of lines of cryptic YAML with
hundreds of lines of easy to debug and reason about query code.</p><p>An aggregation example from the metrics or analytics domain. This example
is a complete but simplified example of a tremor event processing application:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">aggregator.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Aggregate events using a high dynamic range histogram with 10 second, 1 minute, 10 minute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># and 1 hour aggregate summaries.*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;measurement&quot;: event.measurement,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;tags&quot;: patch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event.tags of insert &quot;window&quot; =&gt; window </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # Windowed histogram - for median and a selection of quartiles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;stats&quot;: aggr::stats::hdr(event.fields[group[2]], [ &quot;0.5&quot;,&quot;0.9&quot;, &quot;0.99&quot;, &quot;0.999&quot; ]),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;class&quot;: group[2],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;timestamp&quot;: aggr::win::first(event.timestamp),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The higher resolution aggregates are merged into lower resolution aggregates to conserve memory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from in[`10secs`, `1min`, `10min`, `1h`]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where event.measurement == &quot;udp_lb&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == &quot;kafka-proxy.endpoints&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == &quot;burrow_group&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == &quot;burrow_partition&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or event.measurement == &quot;burrow_topic&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The operator maintains a user defined composited set of group partitions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Each group maintains its own set of aggregation windows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by set(event.measurement, event.tags,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">each(record::keys(event.fields)))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into normalize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Discard computed events with a small sample set</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">having event.stats.count \&gt; 100;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In most real world tremor-based systems - the synthetic events computed
in processing pipelines are tailored to conform to the schemas expected
by multiple downstream systems:  </p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">normalize.trickle</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Prepare computed histogram summaries for downstream systems ( eg: telegraf/influx )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;measurement&quot;: event.measurement,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;tags&quot;: event.tags,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;fields&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;count_#{event.class}&quot;: event.stats.count,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;min_#{event.class}&quot;: event.stats.min,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;max_#{event.class}&quot;: event.stats.max,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;mean_#{event.class}&quot;: event.stats.mean,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;stdev_#{event.class}&quot;: event.stats.stdev,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;var_#{event.class}&quot;: event.stats.var,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;p42_#{event.class}&quot;: event.stats.percentiles[&quot;0.42&quot;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;p50_#{event.class}&quot;: event.stats.percentiles[&quot;0.5&quot;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;p90_#{event.class}&quot;: event.stats.percentiles[&quot;0.9&quot;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;p99_#{event.class}&quot;: event.stats.percentiles[&quot;0.99&quot;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;p99.9_#{event.class}&quot;: event.stats.percentiles[&quot;0.999&quot;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from normalize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into out;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compared to the disparate services and software elements that tremor
replaces - the query language affords an intuitive and easy to reason
about high level domain specific language to configure rich event
processing and data enrichment and transformation pipelines - with a
minimally terse yet easy to read form.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Tremor’s core mission and mandate includes the efficient declaration of
arbitrarily complex directed-acyclic pipeline processing graphs that are
memory and compute efficient under the hood whilst preserving
transparency or remaining <code>hidden</code> to most of the developers in our
organization by continuing to conform to external transports, protocols
and service interfaces in the surrounding production infrastructure
estate.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://www.tremor.rs/assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/03/data-distribution">Case Study - Data Distribution</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-03T00:00:00.000Z" itemprop="datePublished">November 3, 2021</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/60009416?s=200&amp;v=4" alt="The Tremor Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">The Tremor Team</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="happened-before">Happened Before<a href="#happened-before" class="hash-link" aria-label="Direct link to Happened Before" title="Direct link to Happened Before">​</a></h2><p>After the initial production success of tremor as a point solution for capacity
management during our peak trading cycles at Wayfair, the focus shifted a little
to the next key set of issues with our traditional observability platforms.</p><p>The simplified architecture of our logging systems is currently:  </p><p><img loading="lazy" alt="old pipeline" src="/assets/images/image1-638996ab9adf5b141b60cdeb4ab8a2de.png" width="598" height="168" class="img_ev3q"></p><p>The traffic shaping use case was a huge win for Wayfair&#x27;s SRE and operational
teams who manage our production estate.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="identified-need">Identified Need<a href="#identified-need" class="hash-link" aria-label="Direct link to Identified Need" title="Direct link to Identified Need">​</a></h2><p>But we could do a lot better. The development lifecycle to capture, normalize,
enrich, enhance and standardize logs from 1000&#x27;s of engineers, 1000&#x27;s of applications
built in a diversity of programming languages was a have task for our observability
engineers.</p><p>Their environment still looks pretty grim:</p><p><img loading="lazy" alt="new pipeline" src="/assets/images/image3-931314084952fca9c5dc4a5d63edad3d.png" width="598" height="168" class="img_ev3q"></p><p>Displace and replace a plethora of in-house, open-source and commercial
off the shelf log capture, metrics capture and data distribution
technologies with a single cost-effective at hyperscale dynamically
load-adaptive solution.</p><p>The decision was taken to expand the processing capabilities of tremor beyond
traffic shaping, classification and rate limiting rules to general purpose
data processing of unstructured hierarchic JSON-like data streams. The shape
of data most common within the observability domain we were focused upon.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-outcome">Required Outcome<a href="#required-outcome" class="hash-link" aria-label="Direct link to Required Outcome" title="Direct link to Required Outcome">​</a></h2><p>Our systems specialists and service reliability engineers can
consolidate knowledge and tune to a unified operating experience and
center of excellence in our production estate based on a single well
known and cost efficient easy to operate alternative.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Direct link to Characteristics" title="Direct link to Characteristics">​</a></h3><p>It is understood that data will be captured from and distributed to a
diverse and ever-changing set of production systems - built in many
programming languages and environments and distributed to an unknowable
set of destination systems.  </p><p>These systems include, but are not limited to: Graylog Extended Log
Format, Syslog,<br>
<!-- -->Kafka, TCP, UDP, Telegraf, Influx Line Protocol, ElasticSearch and many
more...</p><blockquote><p>Connectivity must be flexible enough to capture data from and
distributed data to synchronous, asynchronous protocols, transports
and systems without developers needing to learn or integrate with a
new technology. The solution must be invisible to developers.</p></blockquote><p>The unit economics of the existing system is hard to measure, hard to
plan and hard to remediate; especially given the rising year on year
firehose volumetrics, with rising velocity and rising peak loads.</p><blockquote><p>99% of the data either originates as JSON, or is transformed to JSON
just in time.</p></blockquote><p>The target systems for displacement and replacement have very well
understood and extract, load, transform, enrichment and normalization
algorithms that are coded and configured differently in each system.
This is difficult to maintain, enhance and evolve in an environment
where infrastructure and services are continuously evolving.</p><blockquote><p>A rich set of ETL and data manipulation and mutation primitives are
required so that all existing methods used for data processing across
the target systems can be replaced by a single easy to understand,
easy to program and optimized alternative.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>Tremor has already established itself in the traffic shaping domain in
the logging and metrics domains - adding just-in-time traffic shaping
capabilities when needed; and preserving the original system’s
operational semantics and behaviours during normal operating conditions
when the system is operating within planned capacity constraints.</p><p><img loading="lazy" alt="new pipeline" src="/assets/images/image2-546e9398e3b74c01fefca8fa7450da0e.png" width="598" height="168" class="img_ev3q"></p><p>The mandate now expands to replacing many of our event capture systems
deployed on on-premise and cloud-native operating environments across
multiple data-centres globally.</p><p>Instead of our operations and service reliability teams needing to learn
and manage the service deployment and administrative lifecycle of
multiple components in this evolution we displace and replace those
systems - typically operating as sidecars on source systems where our
applications run on virtual machines, bare metal or containerized
environments with tremor.</p><p>The relatively primitive domain specific language developed as part of
the initial solution for traffic shaping is replaced with a new domain
specific language <code>tremor-script</code> designed for expressive data
filtration, extraction, enrichment and transformation to support:</p><ul><li>Classification, Categorization and rate limiting for Traffic Shaping</li><li>Enrichment, Normalization and micro-format parsing</li><li>Structural pattern matching over hierarchical nested JSON-like data</li><li>The ability to patch, merge and iterate over JSON-like data</li><li>A familiar expression language like in regular programming languages
with arithmetic, multiplicative and other common operations on
numeric and string data</li><li>Testing string encoded data for regular expression and other
micro-formats such as the logstash <code>grok</code>, <code>dissect</code>, <code>kv</code>
or stringified embedded json</li></ul><p>The resulting language and interpreter for <code>tremor-script</code> forms the
basis of the solution and is largely designed around the needs of the
logging domain - but delivered in a more generally useful incarnation
that is more widely applicable to other domains - such as in flight data
analytics, in flight ETL or processing metrics to name a few.</p><p>Most of the in-flight events are JSON or JSON-like. Inspired by a tweet
the tremor team happens upon the work of Daniel Lemire et al and
SIMD-accelerated JSON processing. Heinz ports this to rust and tremor’s
sister project and organization simd-lite is born. The tremor team also
maintains the rust port of simd-json with other maintainers interested
in fast and efficient data parallel parsing of JSON.</p><p>Finally, tremor undergoes a steady pace of innovation with benchmark
driven performance optimizations. The combined effect of an efficient
interpreter, the ability to easily benchmark synthetic analogs of real
world use cases in our benchmark system, and the adoption of more
workload appropriate and efficient low level memory allocators such as
<code>jemalloc</code>, then <code>mimalloc</code>, then <code>snmalloc</code> by Microsoft Research
results an order of magnitude level of infrastructure cost savings. The
production estate shrinks by 10x in terms of the number of deployed
systems, the compute capacity required, and the committed memory
required when compared to the displaced and replaced systems.  </p><p>Further - tremor uses far less memory and resources on the source
systems making it a much improved sidecar on our source hosts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Tremor’s core mission and mandate now extends from high quality of
service data distribution with load-adaptive traffic management for the
1% ( and typically less ) of time our systems are under-resourced; and,
the other 99% of the time is 10x more cost efficient.</p><p>Tremor preserves its facility to remain invisible to developers during
this phase of expansion whilst drastically improving the lives of our
operational engineers and service reliability engineers. The measured
and validated cost-efficiencies offer compounding value that further
drives the mandate of the project and pushes it into its next phase of
evolution.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/case-study">case-study</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/wayfair">wayfair</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tags/wayfair/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCg1hxwEjh9szpYg8SxL0U7Q" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
          Copyright © 2025, Tremor Authors | Documentation Distributed under CC-BY-4.0.<br><br>
              <p style="font-size: smaller;">Hosted by: <a href="https://www.netlify.com/" rel="noreferrer noopener" aria-label="Netlify"><img src="/img/netlify-full-logo.svg" alt="CNCF" style="width: 3%;"></a>
              &nbsp;&nbsp;&nbsp;&nbsp;
              Project of: <a href="https://www.cncf.io/" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 5%;"></a></p>
        <small>© 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.</small>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a24082e.js"></script>
<script src="/assets/js/main.fe542851.js"></script>
</body>
</html>