<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.12 plugin-docs plugin-id-default docs-doc-id-concepts/runtime_capabilities">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Runtime Capabilities | Tremor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.tremor.rs/docs/0.12/concepts/runtime_capabilities"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.12"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.12"><meta data-rh="true" name="docsearch:version" content="0.12"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.12"><meta data-rh="true" property="og:title" content="Runtime Capabilities | Tremor"><meta data-rh="true" name="description" content="The Tremor runtime is the part of the system that takes your Troy configuration, brings it to live and has your CPUs pump events through your pipelines as fast as we could make it do. We tried to follow a few principles we took from years long experience in writing event processing engines, distributes systems and high performance code:"><meta data-rh="true" property="og:description" content="The Tremor runtime is the part of the system that takes your Troy configuration, brings it to live and has your CPUs pump events through your pipelines as fast as we could make it do. We tried to follow a few principles we took from years long experience in writing event processing engines, distributes systems and high performance code:"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.tremor.rs/docs/0.12/concepts/runtime_capabilities"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/docs/0.12/concepts/runtime_capabilities" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/docs/0.12/concepts/runtime_capabilities" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8fde9d3c.css">
<link rel="preload" href="/assets/js/runtime~main.0a24082e.js" as="script">
<link rel="preload" href="/assets/js/main.fe542851.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/0.12/getting-started/">Getting Started</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" positition="left" href="/docs/0.12">Docs</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.12/guides/">Guides</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.12/reference/">Reference Documentation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.12/">0.12</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/edge/concepts/runtime_capabilities">edge</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.12/concepts/runtime_capabilities">0.12</a></li><li><a class="dropdown__link" href="/docs/0.11/">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-0.12,docs-rfc-current"></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.12/">Tremor</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/0.12/getting-started/">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/0.12/guides/">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/0.12/concepts/aggregation">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.12/concepts/aggregation">Aggregations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.12/concepts/batching">Batching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/0.12/concepts/runtime_capabilities">Runtime Capabilities</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/0.12/reference/">Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.12/api/">API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/0.12/language/">Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;Language&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/0.12/operations/api-usage">Operations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/benchmarks">Benchmarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.12/api/">Api</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Runtime Capabilities</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.12</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Runtime Capabilities</h1><p>The Tremor runtime is the part of the system that takes your Troy configuration, brings it to live and has your CPUs pump events through your pipelines as fast as we could make it do. We tried to follow a few principles we took from years long experience in writing event processing engines, distributes systems and high performance code:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="keep-the-hot-path-as-free-from-allocations-as-possible">Keep the hot path as free from allocations as possible<a href="#keep-the-hot-path-as-free-from-allocations-as-possible" class="hash-link" aria-label="Direct link to Keep the hot path as free from allocations as possible" title="Direct link to Keep the hot path as free from allocations as possible">​</a></h4><p>The hot path is the way your events take from the input connector through all pipelines towards the output connector. While we need to allocate some memory for the events themselves and for mutations on those events throughout <a href="/docs/0.12/language/pipelines">Pipeline</a> and <a href="/docs/0.12/language/scripts">Script</a> processing, we try to move events from end to end without additional allocations.</p><p>E.g. for turning JSON encoded data into events, we keep the raw event bytes around and reference that data directly for our JSON strings (with a few exceptions). This avoids one copy of the incoming data.</p><p>We preallocate all the dataßstructures we need for bookkeeping and shuffling events around and try to keep the actual event flwo mechanics as simple as possible. At best we only move some pointers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="execute-each-entity-of-the-runtime-on-their-own-task">Execute each entity of the runtime on their own task<a href="#execute-each-entity-of-the-runtime-on-their-own-task" class="hash-link" aria-label="Direct link to Execute each entity of the runtime on their own task" title="Direct link to Execute each entity of the runtime on their own task">​</a></h4><p>As our runtime is built upon async Rust, our unit of concurrency is a <a href="https://book.async.rs/concepts/tasks.html" target="_blank" rel="noopener noreferrer">Task</a>, which can be scheduled on an executor thread. When and where this task is executed is a decided by the underlying executor. We run every entity, that is <a href="/docs/0.12/language/pipelines">Pipelines</a> and <a href="/docs/0.12/reference/connectors/">Connectors</a>, on their own task. All entities communicate via channels (Multi-producer-multi-consumer queues) and this is also the way events take. This decouples event receiving from event handling and sending and allows for smoother spreading of load to multiple CPUs in parallel, especially in the case of multiple <a href="/docs/0.12/language/#flows">Flows</a> being deployed to a Tremor instance in parallel.</p><p>This has the nice effect, that you can vertically scale high event volumes by pumping them through multiple parallel flows:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define flow kafka_consumer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # import connector and pipeline definitions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    use my_connectors;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    use my_pipelines;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create connector kafka_in from my_connectors::kafka_consumer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        consumer_group = &quot;snot&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        topic = &quot;my_topic&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        brokers = [&quot;localhost:9092&quot;, &quot;example.org:9092&quot;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create connector elastic_out from my_connectors::elastic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create pipeline consume from my_pipelines::consume;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect /connector/kafka_in to /pipeline/consume;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect /pipeline/consume to /connector/elastic_out;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># deploy three instances of the above flow to leverage available CPU and memory resources</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># we will have three kafka consumers in one consumer group, consuming in parallel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 3 pipelines processing in parallel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># and 3 elastic connectors pushing events to elasticsearch in parallel (with configurable concurrency)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deploy flow kafka_consumer_01 from kafka_consumer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deploy flow kafka_consumer_02 from kafka_consumer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deploy flow kafka_consumer_03 from kafka_consumer;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="leverage-your-cpus-capabilities">Leverage your CPUs capabilities<a href="#leverage-your-cpus-capabilities" class="hash-link" aria-label="Direct link to Leverage your CPUs capabilities" title="Direct link to Leverage your CPUs capabilities">​</a></h4><p>Our CPUs have crazy instruction sets (SSE, AVX2, Neon, ...) for data parallel programming that we mostly only use unintended by some optimizing compiler rewriting our crufty loops. Think of them as turning your CPU into a poor mans GPU. Very intelligent people came up with incredibly clever algorithms for leveraging those instruction sets for e.g. parsing JSON, UTF-8 validation or finding bytes in strings. We try to use those whenever possible. Most of the time, we are standing on the shoulders of giants providing all the goodness for us in existing crates we pull in as dependencies, sometimes we roll our own, as we did with a Rust port of <a href="https://github.com/simdjson/simdjson" target="_blank" rel="noopener noreferrer">simdjson</a>: <a href="https://crates.io/crates/simd-json" target="_blank" rel="noopener noreferrer">https://crates.io/crates/simd-json</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="contraflow">Contraflow<a href="#contraflow" class="hash-link" aria-label="Direct link to Contraflow" title="Direct link to Contraflow">​</a></h2><p>Tremors runtime was built to enable traffic shaping and improving quality of service for high volumetric data streams. It was built with very real possibility of failure in mind. In a system of many connected computers, either any computer or the network could fail in arbitrarily scary and harmful ways. Tremor, as the safeguard of downstream systems, the harbinger of quality of service, needs to be a good citizen and stop pounding downstream systems that are already known to be out of service.</p><p>To that end, the contraflow mechanism was built to allow signals to be propagated back along the <a href="/docs/0.12/language/pipelines">Pipeline graph</a> to all upstream <a href="/docs/0.12/reference/connectors/">Connectors</a>.</p><p>All the pipeline graphs you can build form a directed acyclic graph (or <strong>DAG</strong>). The reason for this is that we can take this DAG and turn it around and still have a DAG. This <em>reversed</em> pipeline graph can be used to propagate special events back the pipeline to all reachable inputs.</p><p>Event flow:</p><div class="mermaid" data-mermaid-src="flowchart LR

IN([in]) --&gt; NODE1[operator] --&gt; OUT([out])
NODE1 --&gt; ERR([err])
IN --&gt; SCRIPT[script] --&gt; NODE2[operator] --&gt; OUT
SCRIPT --&gt; ERR
NODE2 --&gt; ERR">flowchart LR

IN([in]) --&gt; NODE1[operator] --&gt; OUT([out])
NODE1 --&gt; ERR([err])
IN --&gt; SCRIPT[script] --&gt; NODE2[operator] --&gt; OUT
SCRIPT --&gt; ERR
NODE2 --&gt; ERR</div><p>Contraflow: </p><div class="mermaid" data-mermaid-src="flowchart LR
OUT([out]) --&gt; NODE1[operator] --&gt; IN([in])
OUT --&gt; NODE2[operator] --&gt; SCRIPT[script] --&gt; IN

ERR([err]) --&gt; NODE1
ERR --&gt; NODE2
ERR --&gt; SCRIPT">flowchart LR
OUT([out]) --&gt; NODE1[operator] --&gt; IN([in])
OUT --&gt; NODE2[operator] --&gt; SCRIPT[script] --&gt; IN

ERR([err]) --&gt; NODE1
ERR --&gt; NODE2
ERR --&gt; SCRIPT</div><p>Contraflow is used to transport signals for successful or failed event delivery, for transmitting topological knowledge between connected connectors (for knowing what other connectors are reachable via the connected pipelines) and for managing the circuit breaker mechanism.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-circuit-breaker-mechanism">The Circuit Breaker Mechanism<a href="#the-circuit-breaker-mechanism" class="hash-link" aria-label="Direct link to The Circuit Breaker Mechanism" title="Direct link to The Circuit Breaker Mechanism">​</a></h3><p>Circuit breakers are used to avoid pounding downstream systems with requests (or events in our case) if we know those are doomed anyways. Then the circuit breaker opens and it fails those events early or buffers them (e.g. when using kafka as a buffer) until the downstream system is healthy again. This mechanism is also builtin to our runtime.</p><p>It is possible for any operator node in a pipeline and for all connectors to open and close the runtimes builtin circuit breaker by sending a special contraflow event to all reachable upstream pipeline operators and connectors. Each upstream connector receiving such a message will stop pulling data from the external system it connects to, thus stopping to send events downstream. The issuer of the circuit breaker message will check if the downstream system is healthy again and if so, it will close the circuit breaker again in order to start receiving events again.</p><p>The runtime even makes use of this mechanism for a controlled start of all elements of a <!-- -->[Flow]<!-- -->. Every connector, when connected as an event-<em>source</em> (on the left hand side of a <a href="/docs/0.12/language/reference/deploy#rule-connect">connect statement</a>), starts with an opened circuit breaker. This ensures that it doesn&#x27;t start sending events before downstream connectors are prepared to receive them. And every event-<em>sink</em> connector (on the right-hand side of a <a href="/docs/0.12/language/reference/deploy#rule-connect">connect statement</a>) will close the circuit breaker upon startup, so that only when all upstream connectors signal their readiness for events, events actually start to flow from event-source to event-sink.</p><p>The <a href="/docs/0.12/reference/operators/backpressure"><code>qos::backpressure</code> operator</a> can be used with <code>method = pause</code> to make use of the circuit breaker mechanism to apply backpressure towards upstream system, otherwise it discards messages by sending them to the <code>overflow</code> port, where they are usually discarded. The <code>pause</code> method is great when backpressure should preserve all events.</p><p>The <a href="/docs/0.12/reference/operators/roundrobin"><code>qos::roundrobin</code> operator</a> will distribute events to the given outputs in a roundrobin fashion and take outputs out of rotation if they error repeatedly or their circuit breaker is triggered. It will only forward circuit breaker contraflow events if all outputs are unavailable.</p><p>Both the <a href="/docs/0.12/reference/connectors/elastic"><code>elastic</code> connector</a> and the <a href="/docs/0.12/reference/connectors/http#client"><code>http_client</code> connector</a> use the circuit breaker mechanism to limit concurrent in-flight outgoing requests and stop upstream connectors from sending further events if the supported concurrency is exceeded.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="garuanteed-delivery">Garuanteed Delivery<a href="#garuanteed-delivery" class="hash-link" aria-label="Direct link to Garuanteed Delivery" title="Direct link to Garuanteed Delivery">​</a></h3><p>Tremor uses the contraflow mechanism to implement <strong>Event delivery acknowledgements</strong>. In a nutshell it works like this:</p><ul><li>When a connector receives an event and handles it successfully without error (e.g. sends it off via TCP) and event delivery acknowledgement is sent backwards via contraflow, if required, which is flagged in each event, usually by the originating connector.</li><li>When a connector fails to handle an event a delivery failure message is sent backwards via contraflow, if required.</li><li>Pipeline operators and connectors emitting events can handle those messages to implement guaranteed delivery.</li></ul><p>An event acknowledgement contraflow message is only handled by the connector (or operator) that did send the event. E.g. a <a href="/docs/0.12/reference/connectors/kafka#consumer"><code>kafka_consumer</code> connector</a> will commit the offset of the event upon receiving an event acknowledgment.</p><p>This has the effect that we have 1 contraflow event flowing backwards for each event reaching its destination. The forward traffic volume will be mirrored by the contraflow volume, just that the contraflow itself is not leaving the system but is handled internally by <a href="/docs/0.12/reference/operators/">Operators</a> and <a href="/docs/0.12/reference/connectors/">Connectors</a>.</p><p>Not all connectors support event acknowledgements, as their nature doesn&#x27;t support the notion of marking parts of a data stream as successfully handled. For example <a href="/docs/0.12/reference/connectors/udp">UDP</a> cannot support this feature. </p><p>Connectors like <a href="/docs/0.12/reference/connectors/kafka#consumer"><code>kafka_consumer</code></a> <a href="/docs/0.12/reference/connectors/wal"><code>wal</code></a> support event delivery acknowledgements and are well suited for implementing workloads that can guarantee *<em>at-least-once</em> delivery.</p><p>For the circuit breaker mechanism a successful event acknowledgement is used a signal for the circuit breaker to close as the downstream system seems to be back to normal.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pause--resume">Pause / Resume<a href="#pause--resume" class="hash-link" aria-label="Direct link to Pause / Resume" title="Direct link to Pause / Resume">​</a></h2><p>With the <a href="#contraflow">Contraflow mechanism</a> and the <a href="#the-circuit-breaker-mechanism">Circuit Breaking</a> we have all the bits and pieces in place to automatically stop upstreams from producing and events when they are not going to be successful. Turns out we can also use this to manually stop events from flowing.</p><p>We do expose API endpoints to change the current status of Flows: <a href="/docs/0.12/api/#tag/flows/operation/patch_flow_status">Patch flow status</a>
and single Connectors inside Flows: <a href="/docs/0.12/api/#tag/connectors/operation/patch_flow_connector_status">Patch flow connector status</a>.</p><p>Here we see that the current status of the flow <code>main</code> is <code>running</code>. It is accepting events from and emitting events into the runtime from stdin.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ curl -s localhost:9898/v1/flows/main | jq .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;alias&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;status&quot;: &quot;running&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;connectors&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;console&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can patch the flow status to <em>pause</em> all connectors inside that flow. It will return the new status of the flow in the response:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -s -XPATCH -H&#x27;application/json&#x27; localhost:9898/v1/flows/main -d&#x27;{&quot;status&quot;: &quot;paused&quot;}&#x27; | jq .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;alias&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;status&quot;: &quot;paused&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;connectors&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;console&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The connector <code>console</code> is receiving string events for each line sent to it via stdin. The whole flow is set up to echo events back to stdout. If we try typing something into the processes terminal, we won&#x27;t see anythign echoed to stdout, because the connector is paused. It will not pull new data from <code>stdin</code> until it is <em>resumed</em> again.</p><p>We can resume the flow by patching its status back to <em>running</em>. It will return the new status of the flow in the response:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -s -XPATCH -H&#x27;application/json&#x27; localhost:9898/v1/flows/main -d&#x27;{&quot;status&quot;: &quot;running&quot;}&#x27; | jq .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;alias&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;status&quot;: &quot;running&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;connectors&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;console&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quiescence">Quiescence<a href="#quiescence" class="hash-link" aria-label="Direct link to Quiescence" title="Direct link to Quiescence">​</a></h2><p>TBD</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/concepts/runtime_capabilities.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/0.12/concepts/batching"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Batching</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/0.12/reference/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#contraflow" class="table-of-contents__link toc-highlight">Contraflow</a><ul><li><a href="#the-circuit-breaker-mechanism" class="table-of-contents__link toc-highlight">The Circuit Breaker Mechanism</a></li><li><a href="#garuanteed-delivery" class="table-of-contents__link toc-highlight">Garuanteed Delivery</a></li></ul></li><li><a href="#pause--resume" class="table-of-contents__link toc-highlight">Pause / Resume</a></li><li><a href="#quiescence" class="table-of-contents__link toc-highlight">Quiescence</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCg1hxwEjh9szpYg8SxL0U7Q" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
          Copyright © 2025, Tremor Authors | Documentation Distributed under CC-BY-4.0.<br><br>
              <p style="font-size: smaller;">Hosted by: <a href="https://www.netlify.com/" rel="noreferrer noopener" aria-label="Netlify"><img src="/img/netlify-full-logo.svg" alt="CNCF" style="width: 3%;"></a>
              &nbsp;&nbsp;&nbsp;&nbsp;
              Project of: <a href="https://www.cncf.io/" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 5%;"></a></p>
        <small>© 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.</small>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a24082e.js"></script>
<script src="/assets/js/main.fe542851.js"></script>
</body>
</html>