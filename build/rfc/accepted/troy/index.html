<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-rfc docs-doc-id-accepted/troy">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">troy | Tremor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.tremor.rs/rfc/accepted/troy"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="troy | Tremor"><meta data-rh="true" name="description" content="- Feature Name: deployment_language"><meta data-rh="true" property="og:description" content="- Feature Name: deployment_language"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.tremor.rs/rfc/accepted/troy"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/rfc/accepted/troy" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/rfc/accepted/troy" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8fde9d3c.css">
<link rel="preload" href="/assets/js/runtime~main.0a24082e.js" as="script">
<link rel="preload" href="/assets/js/main.fe542851.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/0.12/getting-started/">Getting Started</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" positition="left" href="/docs/0.12">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/0.12/guides/">Guides</a></li><li><a class="dropdown__link" href="/docs/0.12/reference/">Reference Documentation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.12/">0.12</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/edge/">edge</a></li><li><a class="dropdown__link" href="/docs/0.12/">0.12</a></li><li><a class="dropdown__link" href="/docs/0.11/">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-0.12,docs-rfc-current"></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rfc/">RFCs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/rfc/accepted/pipeline-state-mechanism">Accepted</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/pipeline-state-mechanism">Pipeline State Mechanism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/sliding-window-mechanism">Sliding Window Mechanism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/plugin-development-kit">Plugin development Kit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/ramp-interface">Ramp Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/script-operator-enhacements">script-operator-enhacements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/binary-type">binary-type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rfc/accepted/troy">troy</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/rfc/implemented/remove-actix-from-tremor-runtime">Implemented</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/rfc/process/template">RFC Process</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Accepted</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">troy</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>troy</h1></header><ul><li>Feature Name: deployment_language</li><li>Start Date: 2020-12-15</li><li>Tremor Issue: <a href="https://github.com/tremor-rs/tremor-runtime/pull/1203" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-runtime#1203</a></li><li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/0000" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0000</a></li></ul><h1>Summary</h1><p>Add a deployment language to tremor with which whole event flows, consisting of connectors, pipelines and flows can be defined, instantiated, run and removed again.</p><p>A <code>connector</code> is an existing artefact and represents a connection between tremor and an external system.</p><p>A <code>pipeline</code> is an existing artefact and is equivalent to a <code>trickle</code> query script which compiles to an executable pipeline as defined in the <code>tremor-pipeline</code> crate.</p><p>A <code>flow</code> is a new construct which replaces the concept of a <code>binding</code> and a <code>mapping</code> in the legacy deployment syntax <code>yaml</code> which this RFC is targetted at replacing.</p><h1>Motivation</h1><p>Current deployments are separated into configuration scopes as follows:</p><ol><li><code>onramps</code> - these define legacy <code>onramp</code> or <code>source</code> connector configurations</li><li><code>offramps</code> - these define legacy <code>offramp</code> or <code>sink</code> connector configurations</li><li><code>pipeline</code> - these are referenced implicitly by name using the file stem ( name minus extension, for a top level pipeline ) passed to the tremor server command line arguments</li><li><code>bindings</code> - which defines how onramps, offramps and pipelines interconnect</li><li><code>mappings</code> - which instanciate and deploy binding.</li></ol><p>The YAML format used for deployment configuration is sub-optimal for tremor application authors.</p><p>With modular tremor scripts, the business logic needed in tremor queries is significantly reduced for well-designed and well-factored tremor streaming applications. With <a href="/rfc/implemented/modular-queries">modular queries</a> entire sub-queries can be modularised and reused allowing the query logic required to compose a query application to be similarly terse.</p><p>This specification provides the same mechanisms and modularity provisions as the query and script language DSLs for deployments by replacing the YAML syntax with a modular deployment domain specific language to achieve the same hygiene factors with minimal additional syntax.</p><p>Also, given our experiences with tremor-script and tremor-query, a DSL that is well suited for the task at hand provides significant benefits:</p><ul><li>Helpful and consistent hygienic errors that are syntax and semantics aware</li><li>Modularization of common definitions as reusable modules (e.g. HTTP proxy setup with sources, sinks, pipeline, and interconnecting flows)</li><li>More expressive - the deployment language embeds the query language, which embeds the scripting language allowing more expressive application authoring.</li><li>Paves the way for a live REPL environment in the future</li></ul><p>The primary advantage is a capability to integrate definitions seamlessly and reuse existing language concepts and idioms. Tremor developers and operators get a consistent experience across the suite of languages and avoid distractions inherent in context switching from native DSLs to YAML which requires a higher degree of knowledge of tremor internals than desireable for new users to tremor.</p><h1>Guide-level explanation</h1><p>A useful tremor deployment always consists of one or more <code>connectors</code>, connected to one or more <code>pipelines</code>. These are deployed as a single unit that captures their interconnections and the overall flow of the deployed
application logic.</p><p>The deployment lifecycle for an artefact follows the form:</p><ul><li>Publish definition (with all configuration) with a unique artefact id.</li><li>Compute a Tremor URL that uniquely identifies the instance being created.</li><li>Incarnate or launch the instance, if not already running given its url.</li><li>Compute the instance id and url and register the instance accordingly.</li><li>Interconnect <code>connectors</code> and <code>pipelines</code> required for correct runtime operation.</li></ul><p>The shutdown or undeployment sequence follows a similar form:</p><ul><li>Pause and disconnect the interlinked artefact instances.</li><li>Stop and remove instances that are no longer referenced ( quiescence )</li><li>Cascade and sweep remove any artefact instances that are no longer in use.</li><li>Cascade and sweep remove any artefact definitions that are no longer in use.</li></ul><p>The Tremor Deployment Language ( <code>troy</code> for short ) is the interface with
the tremor runtime and guarantees that these control interactions follow
the correct sequence of operations.</p><p>The language aims for sufficient expressivity to define complex deployment patterns, whilst providing a syntax that encourages iterative refinement and
development of complex applications from simple working parts.</p><p>When a troy deployment specification is deployed - the definitions, instances and interconnections are created and launched following the lifecycle patterns summarised above by the runtime.</p><p>As with <code>trickle</code>, <code>troy</code> supports modular definition and leverages the same preprocessor <code>mod .. end</code> and <code>use</code> statements and shares the same module path and loading and module resolution mechanisms.</p><p>This allows <code>boilerplate</code> or <code>reusable</code> logic to be shared across multiple
application deployments whether deployed in the same tremor instance or otherwise.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Defines a connector called `my_http_connector` based on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># the builtin `http_server` connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define http_server connector my_http_connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Specifies required, possibly defaulted, arguments and defines</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># the public interface of the `my_http_connector` user defined</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">args</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  server = &quot;Tremor/1.2.3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Defaults builtin `http_server` connector arguments, potentially</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># referencing interface arguments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  codec = &quot;json&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  preprocessors = [ &quot;newline&quot; ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  config = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;headers&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;Server&quot;: args.server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Defines a connector called `my_file` based on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># the builtin `file` connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define file connector my_file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Has an empty interface specification</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Specializes the arguments to the builtin `file` connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;path&quot;: &quot;/snot/badger.json&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    codec = &quot;json&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    preprocessors = [ &quot;newline&quot; ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Define a simple passthrough pipeline called `passthrough`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define pipeline passthrough</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select event from in into out;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Define the `my_flow_application` deployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">define flow my_flow_application</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # This flow will create one instance of `my_http_connector`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  create connector ma_http from my_http_connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # specializing or overriding the `server` interface argument</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server = &quot;Tremor/3.2.1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # This flow will create one instance of `passthrough`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  create pipeline passthrough;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # This flow will create one instance of `my_file`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  create connector my_file;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Link instances by id - may reference pre-existing instances known</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # to the target runtime where this flow is deployed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect &quot;/connector/my_http_connector/ma_http/out&quot; to &quot;/pipeline/passthrough/passthrough/in&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Alternately, may use local identifiers with explicit port assignments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect passthrough/out to my_file/in;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Or, local identifiers with defaulted port assignments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect passthrough/out to my_file/in;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Finally, instruct the runtime to `deploy` our flow application</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deploy flow my_app from my_flow_application;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For an overview of alternatives we considered and discussed, see <a href="#rationale-and-alternatives">Rationale and Alternatives</a></p><h1>Reference-level explanation</h1><p>Troy supports two very basic operations / kinds of statements:</p><ul><li>Definition of artefacts with <code>define</code> statements</li><li>Creation of artefact instances with <code>create</code> statements</li><li>Interlinking of instances with <code>connect</code> statements</li><li>Deployment control plane commands with <code>deploy</code> statements</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="artefact-definitions">Artefact definitions<a href="#artefact-definitions" class="hash-link" aria-label="Direct link to Artefact definitions" title="Direct link to Artefact definitions">​</a></h2><p>Definitions of <code>connector</code>, <code>pipeline</code> and <code>flow</code> specifications
are declared using the <code>define</code> statement. The BNF for which is
provided below</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connector-definitions">Connector definitions<a href="#connector-definitions" class="hash-link" aria-label="Direct link to Connector definitions" title="Direct link to Connector definitions">​</a></h3><p><strong>EBNF grammar:</strong></p><div class="language-ebnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ebnf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connector       = &quot;define&quot; builtin_ref &quot;connector&quot; artefact_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  [ &quot;args&quot; argument_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  [ with_block ]?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  &quot;end&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">builtin_ref     = id      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">artefact_id     = id     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">argument_list   = required_no_default | required_with_default ) [ &quot;,&quot; argument_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">required_no_default = id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">required_with_default = id &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with_block      = &quot;with&quot; assignment_list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment_list = assignment [ &quot;,&quot; assignment_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment      = let_path &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let_path        = id [ &quot;.&quot; id ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The statement declares a user defined connector definition based on a
builtin connector provided by tremor with a user defined id. A set of
specification arguments with required and optionally defaulted parameters
can be provided in the <code>args</code> clause. A set of configuration parameters
required by the builtin connector from which the user defined connector
is being created is provided with the <code>with</code> clause.</p><p>The <code>args</code> specification is the users parameterization of the user defined
connector. It declares the intended interface to users of the connector.</p><p>The <code>with</code> specification provides required configuration to the underlying
builtin tremor connector.</p><p>Defaulted arguments provided in the <code>args</code> block can be used in the <code>with</code>
block. The values are any valid <code>tremor-script</code> expression that ordinarily
returns a value. So <code>match</code> and <code>patch</code> statements or <code>for</code> comprehensions
can be used for values, or literals. But the <code>emit</code> and <code>drop</code> expressions
which ordinarily halt event flow cannot.</p><p>Whitespace and newlines are not significant in the BNF grammar.</p><p><strong>Example:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define http connector my_http</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Specifies the `my_http` user defined connector interface</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">args</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    required_argument,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional_arg_with_default = &quot;default value&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Provides essential configuration to the intrinsic or builtin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># `http` connector on top of which `my_http` is defined.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    codec = &quot;json&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    preprocessors = [ </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;type&quot;: &quot;split&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;config&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;split_by&quot;: &quot;\n&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;base64&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;host&quot;: &quot;localhost&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;port&quot;: args.required_argument, # TODO verify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    err_required = args.optional_arg_with_default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipeline-definitions">Pipeline definitions<a href="#pipeline-definitions" class="hash-link" aria-label="Direct link to Pipeline definitions" title="Direct link to Pipeline definitions">​</a></h3><p><strong>EBNF grammar:</strong></p><div class="language-ebnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ebnf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline             = &quot;define&quot; &quot;pipeline&quot; artefact_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       [ &quot;args&quot; argument_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       &quot;pipeline&quot; pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       &quot;end&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">artefact_id           = id     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">argument_list         = required_no_default | required_with_default ) [ &quot;,&quot; argument_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">required_no_default   = id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">required_with_default = id &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline              = &lt;tremor-pipeline&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The statement declares a user defined pipeline definition based on a
user defined inline tremor query and bound to a user defined id.
A set of specification arguments with required and optionally defaulted parameters can be provided in the <code>args</code> clause.</p><p>This statement does not support a <code>with</code> clause as there are no intrinsic
artefacts being extended or parameterised by this type of definition.</p><p>The <code>args</code> specification is the users parameterization of the user defined
pipeline. It declares the intended interface to users of the pipeline.</p><p>Whitespace and newlines are not significant in the BNF grammar.</p><p><strong>Example:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define pipeline my_pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Specifies the `my_http` user defined connector interface</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">args</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    required_argument,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional_arg_with_default = &quot;default value&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # An inline tremor query ( trickle ) script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    use std::datetime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    define tumbling window fifteen_secs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        interval = datetime::with_seconds(args.required_argument),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select { &quot;count&quot;: aggr::stats::count(event) } from in[fifteen_secs] into out having event.count &gt; 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flow-definitions">Flow definitions<a href="#flow-definitions" class="hash-link" aria-label="Direct link to Flow definitions" title="Direct link to Flow definitions">​</a></h3><p><strong>EBNF grammar:</strong></p><div class="language-ebnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ebnf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connector       = &quot;define&quot; &quot;flow&quot; artefact_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  [ &quot;args&quot; argument_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  &quot;flow&quot; flow_stmts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  &quot;end&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">artefact_id     = id     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">argument_list   = required_no_default | required_with_default ) [ &quot;,&quot; argument_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">required_no_default = id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">required_with_default = id &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow_stmts            = flow_stmt [ &quot;;&quot; flow_stmts ]*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow_stmt             = flow_create | flow_connect</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow_create           = &quot;create&quot; create_kind instance_id &quot;from&quot; modular_target [ with_block ]? &quot;end&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create_kind           = &quot;connector&quot; | &quot;pipeline&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">instance_id           = id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">modular_target        = [ id &quot;::&quot; ]* id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with_block            = &quot;with&quot; assignment_list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment_list       = assignment [ &quot;,&quot; assignment_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment            = let_path &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let_path              = id [ &quot;.&quot; id ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow_connect          = &quot;connect&quot; connect_endpoint &quot;to&quot; connect_endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect_endpoint      = system_endpoint | troy_endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">system_endpoint       = &lt;stringified-url&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">troy_endpoint         = id [ &quot;/&quot; port_id ]?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">port_id               = id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The statement declares a user defined flow specification. Flow specifications replace the <code>binding</code> and <code>mapping</code> constructs in the legacy YAML syntax. In
the legacy syntax the <code>binding</code> section specified how artefacts linked with each other to form a flow graph, and the <code>mapping</code> section specified how instances of the referenced artefacts were created at runtime.</p><p>Both were required to define a useful event flow graph at runtime. Production users of tremor who have been with the project from the beginning have outgrown these primitives as they are now building significant, complex, non-trivial streaming applications on top of tremor.</p><p>The YAML syntax is not modular and outside of simpler deployments the separation of instance management and interlinking doesn&#x27;t work well for larger applications based on tremor.</p><p>Medium to large streaming applications were niche 18 months ago. They are
normal today.</p><p>A set of specification arguments with required and optionally defaulted parameters can be provided in the <code>args</code> clause.</p><p>Flow specifications unify the creation of artefact instances and their interlinking in a hygienic fashion with potential to enhance the model in future by allowing sub flows to be defined, interlinked and instanciated in future revisions of troy.</p><p>Whitespace and newlines are not significant in the BNF grammar.</p><p><strong>Example:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define flow my_eventflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">args</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    required_arg,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional_arg = &quot;default value&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Create instances required by this flow specification</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create connector my_source from my_http_connector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create pipeline my_pipeline from passthrough</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      required_argument = 15 # 15 second aggregation interfals</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create connector my_sink from my_file;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Interlink instances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect &quot;tremor://connector/my_source/{required_arg}/out&quot; to </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    my_pipeline:in;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    connect my_pipeline:out to my_sink:in;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flow-create-statements">Flow Create Statements<a href="#flow-create-statements" class="hash-link" aria-label="Direct link to Flow Create Statements" title="Direct link to Flow Create Statements">​</a></h4><p>Every artefact that has a definition via <code>define</code> that is in scope in a flow
specification can be created, optionally passing parameters using a <code>with</code> clause:</p><p><strong>EBNF Grammar:</strong></p><div class="language-bnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bnf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">create          = &quot;create&quot;  flow_id &quot;from&quot; modular_target</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  [ &quot;with&quot; assignment_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  &quot;end&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow_id         = id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">modular_target  = [ id &quot;::&quot; ]* id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment_list = assignment [ &quot;,&quot; assignment_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment      = let_path &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let_path        = id [ &quot;.&quot; id ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The instance_id provided in the definition coupled with the computed modular scope of the flow definition it is created within and the troy file it is created from are used to create the internal representation.</p><p>The <code>create</code> statement can be used with <code>connector</code> or <code>pipeline</code> definitions but not <code>flow</code> definitions in this iteration of the troy language.</p><p><strong>Example:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">create pipeline my_pipeline from passthrough</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  required_argument = 15 # 15 second aggregation interfals</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flow-connect-statements">Flow Connect Statements<a href="#flow-connect-statements" class="hash-link" aria-label="Direct link to Flow Connect Statements" title="Direct link to Flow Connect Statements">​</a></h4><p>Flow <code>connect</code> statements allow artefact instances created in the same flow to be interlinked or artefacts that from a tremor deployment that are already deployed to be interlinked with a flow.</p><p><strong>EBNF Grammar:</strong></p><div class="language-bnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bnf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">flow_connect          = &quot;connect&quot; connect_endpoint &quot;to&quot; connect_endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect_endpoint      = system_endpoint | troy_endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">system_endpoint       = &lt;stringified-url&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">troy_endpoint         = id [ &quot;/&quot; port_id ]?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">port_id               = id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>connect</code> statement links artefact instance specifications. A <code>from</code> and <code>to</code> endpoint is required. Both the <code>from</code> and <code>to</code> endpoints need to resolve to either pre-existing instances already running in termor, or instances that are defined in the context of the flow definition they are defined within.</p><p>There are two basic forms of endpoint:</p><p><strong>Troy Native Connect Flow Form</strong></p><p>This form uses the creation id&#x27;s from the flow specification to create a reference to the target instance. If no port specification is provided then the default <code>in</code> and <code>out</code> ports are inferred automatically.</p><p>The short form:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect passthrough to my_pipeline</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Is equivalent to the longer form:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect passthrough/out to my_pipeline/in</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Runtime Flow Connect Form:</strong></p><p>The alternative form can be used to link with artefact instances that are defined external to the flow specification that is currently in context.</p><p>For example, we can connect to the tremor runtime provided default passthrough flow pipeline as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect my_http_connector/out to &quot;/pipeline/system::passthrough/system/in&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-flows">Deploying Flows<a href="#deploying-flows" class="hash-link" aria-label="Direct link to Deploying Flows" title="Direct link to Deploying Flows">​</a></h3><p>Flow definitions are a specification. They define how artefacts interconnect and they specify instances to be created if required. They can also reference
pre-existing instances via their tremor URLs.</p><p>To deploy a flow into the tremor runtime and start, run and active any
connectors, pipelines and flow graph connections defined in a flow we must
use the <code>deploy</code> statement.</p><p>A unit of deployment in <code>troy</code> is a flow specification.</p><p><strong>EBNF Grammar:</strong></p><div class="language-bnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bnf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">create          = &quot;deploy&quot;  deployment_id &quot;from&quot; modular_target</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  [ &quot;with&quot; assignment_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  &quot;end&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deployment_id   = id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">modular_target  = [ id &quot;::&quot; ]* id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment_list = assignment [ &quot;,&quot; assignment_list ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">assignment      = let_path &quot;=&quot; expr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let_path        = id [ &quot;.&quot; id ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>deploy</code> statement references a <code>flow</code> to be deployed using
the <code>from</code> clause and may use a <code>with</code> clause to override the
default flow configuration specified for that flow, if required.</p><h1>Drawbacks</h1><ul><li><p>YAML is widely known especially within cloud-native environments.</p></li><li><p>Troy is new DSL in tremor, but it builds on the same mechanisms as the query and script DSLs and leverages the same namspace and modularity mechanisms</p></li><li><p>Introducing a new DSL steepens the learning curve for new tremor users.</p></li></ul><h1>Rationale and alternatives</h1><ul><li><p>The query language <code>trickle</code> was once defined in YAML. The query language
was designed to provide a better user experience, hygienic easy to interpret error reporting and a syntax and semantics that was designed to
meet the needs of tremor continuous streaming query authors.</p></li><li><p>By embedding the <code>tremor</code> script language via the query <code>script</code> operator
the unification reduced the deployment and operational complexity and led
to easier to develop queries.</p></li><li><p>By following the same proven and well-trodden path with <code>troy</code>, and building on the idioms and conventions introduced with <code>trickle</code> this
should hold true for <code>troy</code>. Early indications from tremor production users is that it is a significant improvement over the YAML based deployment model.</p></li><li><p>Lastly, removing the remaining YAML serialization, deserialization and supporting code from tremor runtime enables refactoring of complex internals that are far-reaching and affect rust-lifetimes and other performance critical or user facing parts of tremor that haven&#x27;t evolved since the earliest version of tremor when YAML was introduced to tremor as a stop-gap solution at the very beginning of the project.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="versions-we-considered-and-discarded">Versions we considered and discarded<a href="#versions-we-considered-and-discarded" class="hash-link" aria-label="Direct link to Versions we considered and discarded" title="Direct link to Versions we considered and discarded">​</a></h2><p>One initial draft contained <code>with</code> as a keyword for starting a key-value mapping (a record in tremor-script)
as a special case only used in configuration contexts:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define connector artefact ws_conn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  type = ws,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # nested record</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  config with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    host = &quot;localhost&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    port = 8080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  codec = my_json with ... end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  interceptors = ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This was discarded because <code>with</code> as a keyword doesn&#x27;t really work as keyword for a key-value mapping. To be consistent with tremor-script, it should be <code>record</code>.</p><p>The first name for <code>flow</code> was <code>deployment</code> but it was an oversimplification. In a <code>flow</code> we specify the required artefact instances and interlinking. So <code>flow</code> is better suited and the design is richer and more expressive than the constrained syntax offered by
the YAML based <code>binding</code> and <code>mapping</code> configuration scopes.</p><p>Also, separating the runtime commands such as <code>deploy</code> from the specifications to be deployed or that are subject to lifecycle management
interactions was quickly established as a requirement when brainstorming the structure and semantics of the language and comparing it with
production use cases where the needs are very well understood.</p><h1>Prior art</h1><p>Environments like <code>terraform</code> from <code>HashiCorp</code> are a good example of resource or state management in the form of configuration as code
and the scheduler and tooling that moves a runtime from one planned state to another. In <code>troy</code> we separate out <code>definitions</code> or specifications from <code>flow</code> - which captures the runtime model and interlinking from deployment commands such as <code>deploy</code> which are commands
to the runtime to execute a change to deploye state.</p><p>Another environment worth exploring is the Erlang REPL. Erlang is unique as a language and runtime in that the REPL can be used to
navigate, explore and alter the running state of a live clustered deployemnt. In contrast to the <code>terraform</code> model, in Erlang and
other actor-based or inspired systems the runtime topology can be modified live.</p><p>Both are useful models that inspired and influenced the evolution of <code>troy</code> as documented in this RFC.</p><h1>Unresolved questions</h1><ul><li><p>Should we use Tremor URLs in <code>create</code> statements?
Disposition: The simpler <code>connect</code> model is seen as sufficient at this time.</p></li><li><p>Should we add means to refer to artefacts by their attributes (host, artefact-type, artefact-id, configuration , module path)?
Disposition: There are no use cases that we know of that would benefit from this flexibility at this time.</p></li><li><p>Should we allow users to create dormant, non-deployed and non-referenced artefacts or instances?
Disposition: Whilst powerful, this is not seen a need at this time, and tradeoffs would need to be carefully considered.</p></li></ul><h1>Future possibilities</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-artefacts-using-script-blocks">Configure Artefacts using Script blocks<a href="#configure-artefacts-using-script-blocks" class="hash-link" aria-label="Direct link to Configure Artefacts using Script blocks" title="Direct link to Configure Artefacts using Script blocks">​</a></h2><p>Given the plan is to implement the with block as syntax sugar around a tremor-script block with a <code>multi-let</code> expression, we could enable the feature to use a more complex script block to define the configuration record. E.g. if we need to dispatch on som arguments and chose different config entries based on that, this would not be possible using a <code>with</code> block.</p><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define file connector my_file_connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">args </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dispatch_arg = &quot;default&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    match dispatch_arg of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        case &quot;snot&quot; =&gt; {&quot;snot&quot;: true, &quot;arg&quot;: dispatch_arg}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        case &quot;badger&quot; =&gt; {&quot;badger&quot;: true, &quot;arg&quot;: dispatch_arg}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        default =&gt; {&quot;default&quot;: true}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="graceful-operations">Graceful Operations<a href="#graceful-operations" class="hash-link" aria-label="Direct link to Graceful Operations" title="Direct link to Graceful Operations">​</a></h2><p>We could add statement variants for create that fail if an instance with the same id already exists or that gracefully do nothing if that is the case. This graceful behavior needs to be able to verify that the existing instance is from the very same artefact, and for this might be checking the artefact content too, not just its name.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="non-string-tremor-urls">Non-String Tremor-URLs<a href="#non-string-tremor-urls" class="hash-link" aria-label="Direct link to Non-String Tremor-URLs" title="Direct link to Non-String Tremor-URLs">​</a></h2><p>It would be nice for static analysis of troy scripts to have tremor urls in connect statements to not be strings,
but to have them use ids as references to defined artefacts or already created artefact instances. string urls allow references
outside the context of the current troy script though, which might or might not be valid based on the state of the registry at the point of creation. So maybe, an id based syntax for tremor-urls might help with error detection in troy scripts but would only work when referencing artefacts and instances is limited to the current troy script (including imports).</p><p>Some ideas to spawn discussion:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline:my_pipeline/instance_id:in</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we change the requirement for artefact ids to be globally unique, not only per artefact type, we wouldnt even need to prefix them with their artefact type every time:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">my_pipeline/instance_id:in</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-codecs-and-interceptors-aka-pre--and-post-processors">Define Codecs and interceptors (a.k.a pre- and post-processors)<a href="#define-codecs-and-interceptors-aka-pre--and-post-processors" class="hash-link" aria-label="Direct link to Define Codecs and interceptors (a.k.a pre- and post-processors)" title="Direct link to Define Codecs and interceptors (a.k.a pre- and post-processors)">​</a></h2><p>It might be nice to be able to define codecs and interceptors as well in the deployment language.
That will mean:</p><ul><li>builtin codecs and interceptors are predefined in something like a Troy stdlib:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">intrinsic codec json;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>codecs and interceptors can be provided with configuration and be referencable under a unique name.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define codec pretty_json from json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pretty = true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    indent = 4,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will solve the current problem that <code>pre-</code> and <code>postprocessors</code> are not configurable.
It will nonetheless introduce another type of <code>artefact</code> that actually isnt a proper artefact, and so applying the language concepts to it might not fully work out and lead to confusion.</p><p>Also it is not possible to fully define codecs and interceptors inside troy. They are all written in rust for performance reasons. The only thing we can do is to configure them and associate a codec/interceptor with its configuration and make this pair referencable within the language.</p><p>Think about what the natural extension and evolution of your proposal would
be and how it would affect Tremor as a whole in a holistic way. Try to use
this section as a tool to more fully consider all possible interactions with the
project in your proposal. Also consider how the this all fits into the roadmap for
the project and of the relevant sub-team.</p><p>This is also a good place to &quot;dump ideas&quot;, if they are out of scope for the
RFC you are writing but otherwise related.</p><p>If you have tried and cannot think of any future possibilities,
you may simply state that you cannot think of anything.</p><p>Note that having something written down in the future-possibilities section
is not a reason to accept the current or a future RFC; such notes should be
in the section on motivation or rationale in this or subsequent RFCs.
The section merely provides additional information.</p><h1>Errata</h1><h4 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-sugar-for-let-expressions-in-with-blocks">Syntax sugar for let expressions in with blocks<a href="#syntax-sugar-for-let-expressions-in-with-blocks" class="hash-link" aria-label="Direct link to Syntax sugar for let expressions in with blocks" title="Direct link to Syntax sugar for let expressions in with blocks">​</a></h4><p>In order to make defining config entries in tremor-script convenient, we introduced the <code>with</code> block. We need to add a few features to tremor-script to make this work reasonably well in a configuration context, where all we want is to return a record value without too much fuss and ceremony:</p><ul><li><p>Add multi-let statements, that combine multiple <code>let</code>s inside a single statement whcih defined the variables therein and returns a record value with all those definitions.</p></li><li><p>Add auto-creation of intermediary path segments in let stetements:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">let config.nested.value = 1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case if <code>config.nested</code> does not exist we would auto-create it as part of this let as an empty record. This statement would fail, if we would try to <em>nest</em> into an existing field that is not a record.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="reference-an-external-trickle-file-for-pipeline-definitions">Reference an external trickle file for pipeline definitions<a href="#reference-an-external-trickle-file-for-pipeline-definitions" class="hash-link" aria-label="Direct link to Reference an external trickle file for pipeline definitions" title="Direct link to Reference an external trickle file for pipeline definitions">​</a></h4><p>It might be interesting to be able to load a trickle query from a trickle file. To that end we add new config directives to trickle that can define arguments and their default values.</p><div class="language-trickle codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-trickle codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!config arg my_arg = &quot;foo&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!config arg required_arg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flow-connect-statement-sugar">Flow Connect Statement Sugar<a href="#flow-connect-statement-sugar" class="hash-link" aria-label="Direct link to Flow Connect Statement Sugar" title="Direct link to Flow Connect Statement Sugar">​</a></h4><p>Connect statements describe the very primitive operation needed to establish an event flow from sources/connectors via pipelines towards sinks/connectors. Defining each single connection manually might be a bit too verbose. That is why we will provide some more convenient versions that basically all encode <code>connect</code> statements, but are much more concise and expressive.</p><p>We call them <code>arrow</code> statements. Both the LHS and the RHS are Tremor URL string. The LHS of a simple <code>arrow</code> statement is the &quot;sender&quot; of events, the RHS is the &quot;receiver&quot;. The direction of the arrow describes the flow direction. If no port is provided, the LHS uses the <code>out</code> port, the RHS uses the <code>in</code> port, so users dont need to specify them in the normal case.</p><p>Examples:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># without ports</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/stdin&quot; -&gt; &quot;/pipeline/pipe&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/pipeline/pipe/err&quot; -&gt; &quot;/sink/system::stderr&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># with ports</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/pipeline/pipe:err&quot; -&gt; &quot;/sink/my_error_file:in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Arrow</code> statements also support chaining. This works as follows: As <code>arrow</code> statements when used as expression, will expose its RHS if used as LHS and its LHS if it is used as RHS. The arrow statements handle other arrow statements as LHS and RHS separately. In effect chaining <code>arrow</code> statements is just writing multiple TremorURLs connected via <code>arrows</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/system::stdin&quot; -&gt; &quot;/pipeline/system::passthrough&quot; -&gt; &quot;/sink/system::stderr&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is equivalent to the following, when adding explicit parens to show precedence:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&quot;/source/system::stdin/out&quot; -&gt; &quot;/pipeline/system::passthrough/in&quot;) -&gt; &quot;/sink/system::stderr/in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Which resolves via desugaring:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect &quot;/source/system::stdin/out&quot; to &quot;/pipeline/system::passthrough/in&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect &quot;/pipeline/system::passthrough/out&quot; to &quot;/sink/system::stderr/in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Arrow</code> statements also support tuples of Tremor URLs or tuples of other <code>Arrow</code> statements. These describe branching and joining
at the troy level.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/system::stdin/out&quot; -&gt; (&quot;/pipeline/system::passthrough&quot;, &quot;/pipeline/my_pipe&quot; ) -&gt; &quot;/sink/system::stderr/in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This desugars to:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/system::stdin/out&quot; -&gt; &quot;/pipeline/system::passthrough&quot; -&gt; &quot;/sink/system::stderr/in&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/system::stdin/out&quot; -&gt; &quot;/pipeline/my_pipe&quot; -&gt; &quot;/sink/system::stderr/in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we have multiple tuples within a statement, we create statements for each combination of them. Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># full sugar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&quot;/source/my_file&quot;, &quot;/source/my_other_file&quot;) -&gt; (&quot;/pipeline/pipe1&quot;, &quot;/pipeline/pipe2&quot;) -&gt; &quot;/sink/system::stderr&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># desugars to:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/my_file&quot; -&gt; &quot;/pipeline/pipe1&quot; -&gt; &quot;/sink/system::stderr&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/my_file&quot; -&gt; &quot;/pipeline/pipe2&quot; -&gt; &quot;/sink/system::stderr&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/my_other_file&quot; -&gt; &quot;/pipeline/pipe1&quot; -&gt; &quot;/sink/system::stderr&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;/source/my_other_file&quot; -&gt; &quot;/pipeline/pipe2&quot; -&gt; &quot;/sink/system::stderr&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The immediate win in terseness is obvious, we hope.</p><p>It will be very interesting to explore how to expose the same sugar to trickle select queries. This is a future possibility.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="top-level-connect-statements">Top level connect statements<a href="#top-level-connect-statements" class="hash-link" aria-label="Direct link to Top level connect statements" title="Direct link to Top level connect statements">​</a></h4><p>Connect statements have been introduced as part of <code>flow</code> definitions. It will greatly simplify setting up tremor installations if we could write them at the top level of a troy script.</p><p>The process of describing a tremor deployment would then consist conceptually of the following steps:</p><ol><li>define artefacts to be connected</li><li>connect those artefacts</li></ol><p>These steps describe a good intuition about setting up a graph of nodes for events to flow through.</p><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">define file connector my-file-connector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  source = &quot;/my-file.json&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  codec = &quot;json&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect &quot;/connector/my-file-connector/out&quot; to &quot;/pipeline/system::passthrough/in&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connect &quot;/pipeline/system::passthrough/out&quot; to &quot;/connector/system::stderr/in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For setting up tremor with this script, the conecpt of a <code>flow</code> doesnt event need to be introduced. Escpecially for getting started and
trying out simple setups in a local dev environment or for tutorials and workshops, this removes friction and descreases <code>time-to-get-something-running-and-have-fun-understanding</code>.</p><p>What is going on under the hood here to make this work?</p><p>Those connect statements will be put into a synthetic <code>flow</code> artefact with the artefact id being the file in which they are declared. There is exactly one such synthetic <code>flow</code> artefact for a troy file, but only if at least 1 globale <code>connect</code> statement is given. The <code>flow</code> instance id will be <code>default</code>.
This <code>flow</code> artefact is defined and created without args upon deployment of the troy script file.</p><p>Following this route it sounds reasonable to also add <code>disconnect</code> statements as the dual of <code>connect</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">disconnect &quot;/connector/my-file-connector/out&quot; from &quot;/pipeline/system::passthrough/in&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With <code>flows</code> we would destroy the whole <code>flow</code> instance to delete the connections therein at once. With top level <code>connect</code> statements,
we cannot reference any such instance, unless we reference it using the naming scheme above. But we would lose the power to modify single connections if we&#x27;d refrain from looking into <code>disconnect</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tremor-rs/tremor-www/tree/main/rfc/accepted/0020-troy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rfc/accepted/binary-type"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">binary-type</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rfc/implemented/remove-actix-from-tremor-runtime"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Remove Actix</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#artefact-definitions" class="table-of-contents__link toc-highlight">Artefact definitions</a><ul><li><a href="#connector-definitions" class="table-of-contents__link toc-highlight">Connector definitions</a></li><li><a href="#pipeline-definitions" class="table-of-contents__link toc-highlight">Pipeline definitions</a></li><li><a href="#flow-definitions" class="table-of-contents__link toc-highlight">Flow definitions</a></li><li><a href="#deploying-flows" class="table-of-contents__link toc-highlight">Deploying Flows</a></li></ul></li><li><a href="#versions-we-considered-and-discarded" class="table-of-contents__link toc-highlight">Versions we considered and discarded</a></li><li><a href="#configure-artefacts-using-script-blocks" class="table-of-contents__link toc-highlight">Configure Artefacts using Script blocks</a></li><li><a href="#graceful-operations" class="table-of-contents__link toc-highlight">Graceful Operations</a></li><li><a href="#non-string-tremor-urls" class="table-of-contents__link toc-highlight">Non-String Tremor-URLs</a></li><li><a href="#define-codecs-and-interceptors-aka-pre--and-post-processors" class="table-of-contents__link toc-highlight">Define Codecs and interceptors (a.k.a pre- and post-processors)</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCg1hxwEjh9szpYg8SxL0U7Q" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
          Copyright © 2025, Tremor Authors | Documentation Distributed under CC-BY-4.0.<br><br>
              <p style="font-size: smaller;">Hosted by: <a href="https://www.netlify.com/" rel="noreferrer noopener" aria-label="Netlify"><img src="/img/netlify-full-logo.svg" alt="CNCF" style="width: 3%;"></a>
              &nbsp;&nbsp;&nbsp;&nbsp;
              Project of: <a href="https://www.cncf.io/" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 5%;"></a></p>
        <small>© 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.</small>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a24082e.js"></script>
<script src="/assets/js/main.fe542851.js"></script>
</body>
</html>