<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-rfc docs-doc-id-implemented/modularity">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Modularity | Tremor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.tremor.rs/rfc/implemented/modularity"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="Modularity | Tremor"><meta data-rh="true" name="description" content="- Feature Name: rfc-0010-modularity"><meta data-rh="true" property="og:description" content="- Feature Name: rfc-0010-modularity"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.tremor.rs/rfc/implemented/modularity"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/rfc/implemented/modularity" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.tremor.rs/rfc/implemented/modularity" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8fde9d3c.css">
<link rel="preload" href="/assets/js/runtime~main.0a24082e.js" as="script">
<link rel="preload" href="/assets/js/main.fe542851.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/0.12/getting-started/">Getting Started</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" positition="left" href="/docs/0.12">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/0.12/guides/">Guides</a></li><li><a class="dropdown__link" href="/docs/0.12/reference/">Reference Documentation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.12/">0.12</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/edge/">edge</a></li><li><a class="dropdown__link" href="/docs/0.12/">0.12</a></li><li><a class="dropdown__link" href="/docs/0.11/">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-0.12,docs-rfc-current"></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rfc/">RFCs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/rfc/accepted/pipeline-state-mechanism">Accepted</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/rfc/implemented/remove-actix-from-tremor-runtime">Implemented</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/remove-actix-from-tremor-runtime">Remove Actix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/linked-transports">Linked Transports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/circuit-breaker-mechanism">Circuit Breaker Mechanism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/pipeline-optimizations">Pipeline Optimisations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/onramp-postgres">Onramp Postgres</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rfc/implemented/modularity">Modularity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/string-interpolation">String Interpolation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/correlation">Correlation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/modular-queries">Modular Queries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/rfc/process/template">RFC Process</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Implemented</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Modularity</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Modularity</h1><ul><li>Feature Name: rfc-0010-modularity</li><li>Start Date: 2020-04-02</li><li>Tremor Issue: <a href="https://github.com/tremor-rs/tremor-runtime/pull/174" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-runtime#0174</a></li><li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/0021" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0021</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>Provide mechanisms for sharing, reuse and composition of user-defined logic in Tremor.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2><p>As user-defined logic deployed with Tremor script and query pipelines become more complex and larger (by significant lines of code), mechanisms that favour better composition, reuse and sharing of user-defined logic and queries are needed.</p><p>Currently, the unit of modularity and unit of deployment in Tremor are indivisible blobs of code- be they scripts or queries. This has worked very well to date, but as the complexity and size of solutions built with Tremor grows, this is no longer tenable in the long term.</p><p>Identified requirements:</p><ul><li><p>As Tremor has multiple DSLs, the building blocks for reusing units of
code from the file system should be common across DSLs.</p></li><li><p>For tremor-script, code should be modularisable through the
introduction of functions.</p></li><li><p>For tremor-query, code should be modularisable through modular
definitions and/or reusable sub-queries.</p></li><li><p>Modules should be nestable on the file system, and within DSLs with
a consistent means to reference units of code or values defined
within nested modules, regardless of their origin (within the same
unit of code, from some external module).</p></li><li><p>There should be a mechanism to load external libraries or packages
of code from well-known locations.</p></li><li><p>The module mechanism should be usable by multiple DSLs with minimal
effort and with the same basic behaviour and structure. However, this
RFC does not place constraints on any DSL specifics per se.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guide-level-explanation">Guide-level Explanation<a href="#guide-level-explanation" class="hash-link" aria-label="Direct link to Guide-level Explanation" title="Direct link to Guide-level Explanation">​</a></h2><p>Elements of modular user-defined logic in the Tremor project.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-path">Module Path<a href="#module-path" class="hash-link" aria-label="Direct link to Module Path" title="Direct link to Module Path">​</a></h3><p>A module path is a set of URLs (normatively directories on a file system) that form the root of a set of related modules.</p><p>On Linux/Unix, module paths are provided via the TREMOR_PATH environment variable, and they are separated by &#x27;:&#x27; (colon). Paths that are not readable or that do not exist are ignored.</p><p>Example path:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">TREMOR_PATH</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/etc/tremor/lib:/opt/shared/framework/lib:/opt/myproject/mylib&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modules">Modules<a href="#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules">​</a></h3><p>Modules in Tremor are the lowest unit of compilation available to developers to modularise Tremor logic across multiple logical namespaces. On the filesystem, modules are rooted at a base path and are nested with folders. Within a file nesting is via the mod clause.</p><p>In tremor-script, only the top-level module can capture events or or mutate state. Modules loaded via the module system are restricted to const, fn, and intrinsic expressions. By design constraint at this time, tremor-script is biased towards pure side-effect free functional programming.</p><p>In tremor-query, only the top-level module can create nodes in the active query pipeline graph. A module logically encapsulates a reusable sub-graph in a query pipeline. The definitions of windows, operators or scripts can be reused. Within embedded scripts, modules used in scripts are constrained to the rules for modules for tremor-script. In addition, tremor-script modules can be included in trickle files to expose their functions and constants for use in <code>select</code>, <code>group by</code>, <code>having</code> and <code>where</code>.</p><p>In both the tremor-script and tremor-query DSLs, modules can be defined physically on the file system. For example, given the following modular hierarchy configured on the module path:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  +-- foo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    +-- bar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      +-- snot.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    +-- baz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      +-- badger.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A modular tremor-script can refer to the constant values as follows:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use foo::bar::snot; # snot is a ref to &#x27;foo/bar/snot.tremor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use foo::baz::badger; # badger is a ref to &#x27;foo/bar/badger.tremor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let c = &quot;{snot::snot}{badger::badger}&quot;; # fully qualified references</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The same module hierarchy can be created in a Tremor file directly as
follows:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mod foo with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  mod bar with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const snot = &quot;beep&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  mod baz with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const badger = &quot;boop&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let snot = foo::bar::snot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let badger = foo::baz::badger;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;{snot}-{badger}&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modules can be loaded via the <code>use</code> clause which in turn loads a module from the physical file system via the module path.</p><p>Inline and externalised modules can be used separately or together, as appropriate.</p><p>Where there are existing references, a module can be aliased to avoid clashes in the local scope:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use foo::bar as fleek;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Hello {fleek::snot}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modules in Tremor query follow the same semantics and behaviour with respect to physical versus inline definition, aliasing to avoid naming scope clashes.</p><p>It is to be noted that inclusion via <code>use</code> will prevent circular inclusion as in
file <code>a.tremor</code> can use <code>b.tremor</code>, but at that point, <code>b.tremor</code> can no longer
use <code>a.tremor</code> as this would create a circle. This is a restriction of the current implementation, and may or may not be relaxed in the future.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preprocessor">Preprocessor<a href="#preprocessor" class="hash-link" aria-label="Direct link to Preprocessor" title="Direct link to Preprocessor">​</a></h3><p>In order to support the module mechanism with minimal changes to the API and runtime, a preprocessor loads all externally referenced modules used in Tremor logic defined in tremor-script or tremor-query, and loads them inline into a preprocessed file.</p><p>It is an error to attempt to deploy a tremor-script or tremor-query file that uses the module mechanism as source. The API only accepts non-modular files for backward compatibility or preprocessed files. The latter constraint is to ensure that logic deployed into the runtime is always traceable to source loaded by a user. Tremor explicitly avoids possibilities of modular logic changing at runtime.</p><p>The preprocessor defends this guarantee on behalf of our users.</p><p>This PR introduces two preprocessor directives:</p><ol><li><p><code>#!line &lt;byte offset&gt; &lt;line&gt; &lt;column&gt; &lt;compilation unit&gt; &lt;filename&gt;</code></p><blockquote><p>This directive tells the preprocessor that it is
now in a logically different position of the file.</p><p>For each folder/directory that an included source traverses, a
module statement is injected into the consolidated source.</p><p>The #!line macro is a implementation detail mentioned here for the same
of completeness, and not meant to be used or relied on by end users. It
may, without prior warning, be removed in the future.</p></blockquote></li><li><p><code>#!config &lt;key&gt; = &lt;const-expr&gt;</code></p><blockquote><p>Pipeline-level configuration in trickle, this allows setting
compile time pipeline configuration such as <code>metrics_interval_s</code>.</p></blockquote></li></ol><p>Preprocessing our script from the module section produces a single consolidated source file as follows:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!line 0 0 0 1 ./foo/bar/snot.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mod snot with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!line 0 0 0 1 ./foo/bar/snot.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const snot = &quot;beep&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!line 19 1 0 0 script.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!line 0 0 0 2 ./foo/baz/badger.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mod badger with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!line 0 0 0 2 ./foo/baz/badger.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const badger = &quot;boop&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!line 41 1 0 0 script.tremor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let c = &quot;{snot::snot}{badger::badger}&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">emit c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="functions">Functions<a href="#functions" class="hash-link" aria-label="Direct link to Functions" title="Direct link to Functions">​</a></h3><p>While constants in modules offer the ability to have reusable data, functions allow for reusable logic.</p><p>Functions are expression-based- so every function returns a data value. Functions cannot manipulate or mutate events, metadata or state. Side effecting operations to the data flow through a script such as the <code>emit</code> or <code>drop</code> keywords are also not allowed in functions.</p><p>Recursion, specifically tail recursion, is supported in functions but a maximum recursion depth (of currently 1024 by default) is imposed. The limit can be changed in tremor-server using the <code>--recursion-limit LIMIT</code> argument. As Tremor is primarily an event processing engine, there are no facilities for user-defined logic to loop or recurse infinitely. Recursion is indicated by the <code>recur</code> expression that gets passed data from the current iteration as arguments for the following invocation. Functions may access constants, but cannot access external mutable state.</p><p>Functions are limited to only call functions that were defined prior to themselves; this limits the risk of cyclic recursion between multiple functions and ensures that every call is guaranteed to terminate.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="functions-come-in-multiple-forms">Functions Come in Multiple Forms:<a href="#functions-come-in-multiple-forms" class="hash-link" aria-label="Direct link to Functions Come in Multiple Forms:" title="Direct link to Functions Come in Multiple Forms:">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="intrinsic-functions">Intrinsic functions<a href="#intrinsic-functions" class="hash-link" aria-label="Direct link to Intrinsic functions" title="Direct link to Intrinsic functions">​</a></h5><p>Intrinsic functions provide the signature of a builtin function. These are provided for documentation purposes and so that API documentation can be provided for builtin functions in the same way as user-defined functions.</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">### The `test` module is used for writing tremor unit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### tests.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">## Runs an assertion for a test, ensures that `expected` and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">## `got` are the</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">## same. If not errors.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">##</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">## **WARNING**: Do not run assertions in production code!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">##</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">## Returns an `bool`.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">intrinsic fn assert(name, expected, got) as test::assert;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ordinary-functions">Ordinary Functions<a href="#ordinary-functions" class="hash-link" aria-label="Direct link to Ordinary Functions" title="Direct link to Ordinary Functions">​</a></h5><p>Of the form <code>fn &lt;name&gt;([&lt;args&gt;][,...]) with</code> provide named arguments with
optional variable arguments through the ellipses <code>...</code> or varargs operator.
Varargs are stored in the <code>args</code> array.</p><p>The ordinary form does not support partial functions.</p><p>An ordinary function wrapping a call to a tail recursive fibonacci function:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn fib(n) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fib_(0, 1, n)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fib(7); # Call locally defined function fib</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="matching-functions">Matching Functions<a href="#matching-functions" class="hash-link" aria-label="Direct link to Matching Functions" title="Direct link to Matching Functions">​</a></h5><p>Matching functions using <code>fn &lt;name&gt;(&lt;args&gt;) of</code> followed by case expressions, and an optional default statement that match.</p><p>The matching function form imposes a default case requirement so that unmatches cases have error handling defined. Unlike match expressions, the default case in user-defined functions must not (and can not) be omitted.</p><p>A contrived example showing math functions with value matching, extractor matching and function case guards:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use std::type;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn snottify(s) of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case (&quot;badger&quot;) =&gt; &quot;snot badger, hell yea!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case (\~ json||) =&gt; let s.snot = true, s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case (s) when type::is_string(s) =&gt; &quot;snot {s}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  default =&gt; &quot;snot caller, you can&#x27;t snottify that!&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="recursive-functions">Recursive Functions<a href="#recursive-functions" class="hash-link" aria-label="Direct link to Recursive Functions" title="Direct link to Recursive Functions">​</a></h5><p>Tail recursive functions follow the signature of the function over which recursion is being invoked and use a <code>recur(&lt;args&gt;)</code> call expression.</p><p>If the signature of a recursive call supports partial function semantics, then this is respected under tail recursion.</p><p>If the signature of a recursive call supports varargs semantics, then this is respected under tail recursion.</p><p>A tail-recursive implementation of fibonacci called by fib(n) above:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn fib_(a, b, n) of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case (a, b, n) when n &gt; 0 =&gt; recur(b, a + b, n - 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  default =&gt; a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-and-constraints">Limitations and Constraints:<a href="#limitations-and-constraints" class="hash-link" aria-label="Direct link to Limitations and Constraints:" title="Direct link to Limitations and Constraints:">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="functions-can-only-be-defined-with-singular-arity">Functions Can Only be Defined with Singular Arity<a href="#functions-can-only-be-defined-with-singular-arity" class="hash-link" aria-label="Direct link to Functions Can Only be Defined with Singular Arity" title="Direct link to Functions Can Only be Defined with Singular Arity">​</a></h5><p>Functions currently can not be redefined with multiple arities. So, a function <code>foo(n)</code> precludes a second definition of a function called <code>foo</code> with two or more arguments. However the function <code>foo(n,...)</code> defines a function that can take one or more arguments. This constraint may be lifted in the future once usage and adoption favour enhancing functionality.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="higher-order-functions-are-not-supported">Higher Order Functions are not Supported<a href="#higher-order-functions-are-not-supported" class="hash-link" aria-label="Direct link to Higher Order Functions are not Supported" title="Direct link to Higher Order Functions are not Supported">​</a></h5><p>As the type system underpinning tremor-script and tremor-query does not support expression or function references, higher order functions are thus not supported at this time.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="hardcoded-recursion-depth">Hardcoded Recursion Depth<a href="#hardcoded-recursion-depth" class="hash-link" aria-label="Direct link to Hardcoded Recursion Depth" title="Direct link to Hardcoded Recursion Depth">​</a></h5><p>Although functions are tail-recursive and stack limits are not a functional concern, the Tremor event processing system is primarily designed for event streaming applications. A recursion depth is imposed to prevent functions from recursing indefinitely and blocking event streams from progressing.</p><p>This is a feature, not a constraint. But it is important to be aware of when developing well-behaved functions.</p><p>At this point in time, the maximum depth is 1024, and can not be changed without recompiling Tremor.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tuple-patterns">Tuple patterns<a href="#tuple-patterns" class="hash-link" aria-label="Direct link to Tuple patterns" title="Direct link to Tuple patterns">​</a></h3><p>As a side effect of adding functions, this RFC introduces tuple patterns. Internally, they are used to implement Matching functions but are available for use in match statements as well.</p><p>Tuple patterns are written in the form of <code>%(&lt;pattern 1&gt;, &lt;pattern 2&gt;)</code> for
patterns with a fixed number of elements or <code>%(&lt;pattern 1&gt;, &lt;pattern 2&gt;, ...)</code>
with literal <code>...</code> for open patterns.</p><p>Tuple patterns with a fixed number of elements match arrays, with the same
number of elements, where each element matches the pattern in the same place. So
the first pattern must match the first element of the array, the second pattern
the second element and so on.</p><p>An open pattern matches an array that is at lest the same number of elements as
the pattern, but can have more, otherwise the rules are the same.</p><p>There is also a new pattern introduced to predicate patterns which is the &quot;I
don&#x27;t care&quot; pattern <code>_</code>, which will match every element on an array.</p><p>So:</p><div class="language-tremor codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tremor codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">let o = origin::as_uri_record();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">match o of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # matches for the path:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # &quot;/api/v1/get/&lt;something&gt;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # &quot;/api/v1/get/&lt;something&gt;/snot&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # &quot;/api/v1/get/&lt;something&gt;/snot/badger&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # and so one</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  case %(&quot;api&quot;, &quot;v1&quot;, &quot;get&quot;, _, ...) =&gt; &quot;get request&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference-level-explanation">Reference-level Explanation<a href="#reference-level-explanation" class="hash-link" aria-label="Direct link to Reference-level Explanation" title="Direct link to Reference-level Explanation">​</a></h2><p>The module path, modules and <code>use</code> rule provide the language and runtime agnostic core facilities that allow queries in tremor-query and code in tremor-script to be namespaced logically via the <code>mod</code> syntax and physically on file systems.</p><p>A new lexical preprocessing phase parses out occurrences of <code>use</code> rules in scripts, queries and embedded scripts replacing them with preprocessing directives and the contents of referenced modules.</p><p>The parser in modular scripts and queries must now keep track of relative and absolute module scope. As support for both logical namespaces via the <code>mod</code> syntax and physical isolation through the file system and module path is supported, an external module effectively defines a module namespace. So, a source file <code>foo.trickle</code> at the root of the module path would ordinarily be used to include definitions into another query with a <code>use foo;</code> declaration at the head of the file.</p><p>Nested directories also form namespaces so <code>bar/baz/snot.trickle</code> would be declared for use as <code>use bar::baz::snot</code>. The same layout and rules apply for scripts so <code>bar/baz/snot.trickle</code> would be declared for use as <code>use bar::baz::snot</code>.</p><p>Where modules of the same base name in the physical file system such as &#x27;badger.tremor&#x27; and &#x27;badger.trickle&#x27; are present in the same module path, the behaviour of the runtime is currently undefined. The prototype implementation of modules in Tremor that accompanies this RFC gracefully handle the situation for embedded Tremor scripts within trickle query files.</p><p>As a convenience to developers, developer tools such as <code>tremor-tool</code>, <code>tremor-script</code> and <code>tremor-query</code> automatically included the current working directory as a mount point in the module path. If a <code>TREMOR_PATH</code> environment variable is set then it overrides any default behaviour.</p><p>In tremor-server, <code>TREMOR_PATH</code> is required to be set or no include path will be available. This is reflected in the Docker image.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="drawbacks">Drawbacks<a href="#drawbacks" class="hash-link" aria-label="Direct link to Drawbacks" title="Direct link to Drawbacks">​</a></h2><p>Modularising logic in Tremor increases complexity of the engine and runtime, however the relative increase in complexity is perceived as negligible given the value gained by developers by introducing the facility.</p><p>At this time, higher order functions are not supported as the Tremor-type system is constrained to JSON compatible value types and introducing module or function references would make the type system asymmetric with JSON. This is left for a future RFC.</p><p>At this time, the query language supports only modularising definitions of windows, operators or scripts. The creation of query language pipeline graph nodes or link of nodes in a graph is not supported in external modules.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rationale-and-alternatives">Rationale and Alternatives<a href="#rationale-and-alternatives" class="hash-link" aria-label="Direct link to Rationale and Alternatives" title="Direct link to Rationale and Alternatives">​</a></h2><p>The design of the module mechanism and its application to tremor-script and tremor-query provide the highest degree of reuse whilst imposing the lowest runtime impact today and without closing off opportunities for evolving and improving the mechanisms in future.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prior-art">Prior art<a href="#prior-art" class="hash-link" aria-label="Direct link to Prior art" title="Direct link to Prior art">​</a></h2><p>This RFC and it&#x27;s implementation draws inspiration from the C preprocessor as well as the application of <code>use</code> in Rust, and the functional pattern matching style from the Erlang programming language.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="unresolved-questions">Unresolved Questions<a href="#unresolved-questions" class="hash-link" aria-label="Direct link to Unresolved Questions" title="Direct link to Unresolved Questions">​</a></h2><p>None.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-possibilities">Future Possibilities<a href="#future-possibilities" class="hash-link" aria-label="Direct link to Future Possibilities" title="Direct link to Future Possibilities">​</a></h2><p>Currently var arg functions do not combine with either match or recursion or matching functions. This presents a good future opportunity for extending functions.</p><p>Another future possibility is to expand the capabilities of use in trickle to include full sub queries.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tremor-rs/tremor-www/tree/main/rfc/implemented/0010-modularity.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rfc/implemented/onramp-postgres"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Onramp Postgres</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rfc/implemented/string-interpolation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">String Interpolation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#guide-level-explanation" class="table-of-contents__link toc-highlight">Guide-level Explanation</a><ul><li><a href="#module-path" class="table-of-contents__link toc-highlight">Module Path</a></li><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a></li><li><a href="#preprocessor" class="table-of-contents__link toc-highlight">Preprocessor</a></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a></li><li><a href="#tuple-patterns" class="table-of-contents__link toc-highlight">Tuple patterns</a></li></ul></li><li><a href="#reference-level-explanation" class="table-of-contents__link toc-highlight">Reference-level Explanation</a></li><li><a href="#drawbacks" class="table-of-contents__link toc-highlight">Drawbacks</a></li><li><a href="#rationale-and-alternatives" class="table-of-contents__link toc-highlight">Rationale and Alternatives</a></li><li><a href="#prior-art" class="table-of-contents__link toc-highlight">Prior art</a></li><li><a href="#unresolved-questions" class="table-of-contents__link toc-highlight">Unresolved Questions</a></li><li><a href="#future-possibilities" class="table-of-contents__link toc-highlight">Future Possibilities</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCg1hxwEjh9szpYg8SxL0U7Q" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
          Copyright © 2025, Tremor Authors | Documentation Distributed under CC-BY-4.0.<br><br>
              <p style="font-size: smaller;">Hosted by: <a href="https://www.netlify.com/" rel="noreferrer noopener" aria-label="Netlify"><img src="/img/netlify-full-logo.svg" alt="CNCF" style="width: 3%;"></a>
              &nbsp;&nbsp;&nbsp;&nbsp;
              Project of: <a href="https://www.cncf.io/" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 5%;"></a></p>
        <small>© 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.</small>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a24082e.js"></script>
<script src="/assets/js/main.fe542851.js"></script>
</body>
</html>