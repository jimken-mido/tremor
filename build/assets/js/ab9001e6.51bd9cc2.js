"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[8065],{72862:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>f,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var t=r(58168),o=(r(96540),r(15680)),a=r(40281);const i={sidebar_label:"wal (Write Ahead Log)",sidebar_position:1},s="The wal Connector",c={unversionedId:"reference/connectors/wal",id:"version-0.12/reference/connectors/wal",title:"The wal Connector",description:"The wal connector provides a write-ahead log implementation for use with transactional streams",source:"@site/versioned_docs/version-0.12/reference/connectors/wal.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/wal",permalink:"/docs/0.12/reference/connectors/wal",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/wal.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"wal (Write Ahead Log)",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"unix_socket",permalink:"/docs/0.12/reference/connectors/unix_socket"},next:{title:"ws (Web Sockets)",permalink:"/docs/0.12/reference/connectors/ws"}},l={},d=[{value:"Configuration",id:"configuration",level:2},{value:"How do I configure a recoverable TCP server?",id:"how-do-i-configure-a-recoverable-tcp-server",level:2},{value:"Exercises",id:"exercises",level:2},{value:"Notes",id:"notes",level:2}],p={toc:d},g="wrapper";function f(e){let{components:n,...r}=e;return(0,o.yg)(g,(0,t.A)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"the-wal-connector"},"The ",(0,o.yg)("inlineCode",{parentName:"h1"},"wal")," Connector"),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"wal")," connector provides a write-ahead log implementation for use with transactional streams\nto deliver guaranteed delivery between a source and a downstream connected target system."),(0,o.yg)("p",null,"The connector detects and responds to circuit breaker and event acknowledgements to provide the\nguarantee of delivery through a persistent write ahead log it maintains and updates for each\nuser event it sees."),(0,o.yg)("h2",{id:"configuration"},"Configuration"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor"},'define connector my_wal from wal\nwith\n  "config": {\n    # required - directory where WAL storage is configured\n    "path" = "state",\n\n    # Maximum chunk size in bytes\n    "chunk_size" = 1024,\n\n    # Retention based on maximum number of chunks\n    "max_chunks" = 100,\n  }\nend;\n')),(0,o.yg)("h2",{id:"how-do-i-configure-a-recoverable-tcp-server"},"How do I configure a recoverable TCP server?"),(0,o.yg)("p",null,"In this example we modify the ",(0,o.yg)("inlineCode",{parentName:"p"},"server")," flow from the ",(0,o.yg)("a",{parentName:"p",href:"./tcp"},"TCP")," connector reference\necho server and introduce the ",(0,o.yg)("inlineCode",{parentName:"p"},"wal")," for persistence of events."),(0,o.yg)(a.K,{chart:"graph LR\n    A{TCP Server} --\x3e|receive event| B(before_gd)\n    B --\x3e|store| C{Event Store}\n    C --\x3e|forward| D(after_gd)\n    D --\x3e|echo| A{TCP Server}",mdxType:"Mermaid"}),(0,o.yg)("p",null,"We replace the ",(0,o.yg)("inlineCode",{parentName:"p"},"pipelines::passthrough")," stage in the original flow with an\ninbound passthrough before the write-ahead log persistance and after rewiring\nthe flow accordingly."),(0,o.yg)("p",null,"The reconfigured flow for the ",(0,o.yg)("inlineCode",{parentName:"p"},"server")," definition now looks as follows:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor"},'define flow server\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n\n  define connector tcp_server from tcp_server\n  with\n    preprocessors = ["separate"],\n    postprocessors = ["separate"],\n    codec = "json",\n    config = {\n      "url": "0.0.0.0:65535",\n      "buf_size": 1024,\n    }\n  end;\n\n  # Configure the WAL with a `state` directory for indexed persisted events in an\n  # isntance of a write-ahead-log with retention for up to 100 events of no more\n  # than 1K in data size\n  define connector my_wal from wal\n  with\n    config = {\n      "path": "server_state",\n      "chunk_size":  1024,\n      "max_chunks": 100,\n    }\n  end;\n\n  create connector server_out from integration::write_file\n  with\n    file = "server_out.log"\n  end;\n  create connector stdio from connectors::console;\n  create connector tcp_server;\n\n  # Create an instance of our wal in the `server` flow\n  create connector wal from my_wal;\n\n  # Process events through our WAL\n  create pipeline before_gd from pipelines::passthrough;\n  create pipeline gd from pipelines::passthrough;\n  create pipeline after_gd from pipelines::passthrough;\n\n  create pipeline debug from pipelines::passthrough;\n\n  # flow from tcp_server to file\n  connect /connector/tcp_server to /pipeline/before_gd;\n  connect /pipeline/before_gd to /connector/wal;\n  connect /connector/wal to /pipeline/after_gd;\n  connect /connector/tcp_server/err to /pipeline/debug;\n  connect /pipeline/after_gd to /connector/server_out;\n\n  # aaaand echo it back\n  connect /pipeline/after_gd to /connector/tcp_server;\n\n  # debugging\n  connect /pipeline/debug to /connector/stdio;\nend;\n\ndefine flow client\nflow\n  # unchanged ...\nend;\n\ndeploy flow server;\ndeploy flow client;\n')),(0,o.yg)("h2",{id:"exercises"},"Exercises"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Split the ",(0,o.yg)("a",{parentName:"li",href:"./tcp"},"TCP")," flow into separately deployable client ",(0,o.yg)("inlineCode",{parentName:"li"},"client.troy")," and server ",(0,o.yg)("inlineCode",{parentName:"li"},"server.troy")," flows",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Change the server flow as above"),(0,o.yg)("li",{parentName:"ul"},"Add a client state folder ( ",(0,o.yg)("inlineCode",{parentName:"li"},"mkdir client_state")," ) and add the WAL to the client state"))),(0,o.yg)("li",{parentName:"ul"},"Replace the client flow with a metronome producing events periodically",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Arbitrarily stop the client and server"))),(0,o.yg)("li",{parentName:"ul"},"Modify other flows to use the ",(0,o.yg)("inlineCode",{parentName:"li"},"wal")," connector and test recovery despite failure of upstream and downstream connectors\nor restarts of the ",(0,o.yg)("inlineCode",{parentName:"li"},"tremor")," processes"),(0,o.yg)("li",{parentName:"ul"},"Use a ",(0,o.yg)("inlineCode",{parentName:"li"},"best effort")," connector like the ",(0,o.yg)("a",{parentName:"li",href:"./udp"},"UDP")," connector to test the limits of guaranteed delivery"),(0,o.yg)("li",{parentName:"ul"},"Use a high quality transactional connector like ",(0,o.yg)("a",{parentName:"li",href:"./kafka"},"Kafka")," to test the upper limits of guaranteed delivery")),(0,o.yg)("h2",{id:"notes"},"Notes"),(0,o.yg)("p",null,"Recovery ",(0,o.yg)("strong",{parentName:"p"},"WILL")," ordinarily result in duplicate events. Investigate strategies for de-duplicating events and be aware\nof this behaviour when designing systems that leverage guaranteed delivery."))}f.isMDXComponent=!0}}]);