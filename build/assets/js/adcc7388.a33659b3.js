"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[2320],{77293:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=a(58168),i=(a(96540),a(15680));const r={title:"Case Study - Data Distribution",tags:["case-study","wayfair"],author:"The Tremor Team",author_url:"https://github.com/tremor-rs",author_image_url:"https://avatars.githubusercontent.com/u/60009416?s=200&v=4",image:"./media/wayfair.png",draft:!1,hide_table_of_contents:!1},o="Data Distribution with Tremor",s={permalink:"/blog/2021/11/03/data-distribution",editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/blog/2021-11-03-data-distribution.md",source:"@site/blog/2021-11-03-data-distribution.md",title:"Case Study - Data Distribution",description:"Happened Before",date:"2021-11-03T00:00:00.000Z",formattedDate:"November 3, 2021",tags:[{label:"case-study",permalink:"/blog/tags/case-study"},{label:"wayfair",permalink:"/blog/tags/wayfair"}],readingTime:5.355,hasTruncateMarker:!1,authors:[{name:"The Tremor Team",url:"https://github.com/tremor-rs",imageURL:"https://avatars.githubusercontent.com/u/60009416?s=200&v=4"}],frontMatter:{title:"Case Study - Data Distribution",tags:["case-study","wayfair"],author:"The Tremor Team",author_url:"https://github.com/tremor-rs",author_image_url:"https://avatars.githubusercontent.com/u/60009416?s=200&v=4",image:"./media/wayfair.png",draft:!1,hide_table_of_contents:!1},prevItem:{title:"Case Study - Data Flow with Tremor",permalink:"/blog/2021/11/04/data-flow"},nextItem:{title:"Case Study - Traffic Shaping",permalink:"/blog/2021/11/02/traffic-shaping"}},l={image:a(21697).A,authorsImageUrls:[void 0]},d=[{value:"Happened Before",id:"happened-before",level:2},{value:"Identified Need",id:"identified-need",level:2},{value:"Required Outcome",id:"required-outcome",level:2},{value:"Characteristics",id:"characteristics",level:3},{value:"Solution",id:"solution",level:3},{value:"Conclusion",id:"conclusion",level:2}],c={toc:d},m="wrapper";function u(e){let{components:t,...r}=e;return(0,i.yg)(m,(0,n.A)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h2",{id:"happened-before"},"Happened Before"),(0,i.yg)("p",null,"After the initial production success of tremor as a point solution for capacity\nmanagement during our peak trading cycles at Wayfair, the focus shifted a little\nto the next key set of issues with our traditional observability platforms."),(0,i.yg)("p",null,"The simplified architecture of our logging systems is currently:  "),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"old pipeline",src:a(29194).A,width:"598",height:"168"})),(0,i.yg)("p",null,"The traffic shaping use case was a huge win for Wayfair's SRE and operational\nteams who manage our production estate."),(0,i.yg)("h2",{id:"identified-need"},"Identified Need"),(0,i.yg)("p",null,"But we could do a lot better. The development lifecycle to capture, normalize,\nenrich, enhance and standardize logs from 1000's of engineers, 1000's of applications\nbuilt in a diversity of programming languages was a have task for our observability\nengineers."),(0,i.yg)("p",null,"Their environment still looks pretty grim:"),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"new pipeline",src:a(9912).A,width:"598",height:"168"})),(0,i.yg)("p",null,"Displace and replace a plethora of in-house, open-source and commercial\noff the shelf log capture, metrics capture and data distribution\ntechnologies with a single cost-effective at hyperscale dynamically\nload-adaptive solution."),(0,i.yg)("p",null,"The decision was taken to expand the processing capabilities of tremor beyond\ntraffic shaping, classification and rate limiting rules to general purpose\ndata processing of unstructured hierarchic JSON-like data streams. The shape\nof data most common within the observability domain we were focused upon."),(0,i.yg)("h2",{id:"required-outcome"},"Required Outcome"),(0,i.yg)("p",null,"Our systems specialists and service reliability engineers can\nconsolidate knowledge and tune to a unified operating experience and\ncenter of excellence in our production estate based on a single well\nknown and cost efficient easy to operate alternative."),(0,i.yg)("h3",{id:"characteristics"},"Characteristics"),(0,i.yg)("p",null,"It is understood that data will be captured from and distributed to a\ndiverse and ever-changing set of production systems - built in many\nprogramming languages and environments and distributed to an unknowable\nset of destination systems.  "),(0,i.yg)("p",null,"These systems include, but are not limited to: Graylog Extended Log\nFormat, Syslog,",(0,i.yg)("br",{parentName:"p"}),"\n","Kafka, TCP, UDP, Telegraf, Influx Line Protocol, ElasticSearch and many\nmore..."),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"Connectivity must be flexible enough to capture data from and\ndistributed data to synchronous, asynchronous protocols, transports\nand systems without developers needing to learn or integrate with a\nnew technology. The solution must be invisible to developers.")),(0,i.yg)("p",null,"The unit economics of the existing system is hard to measure, hard to\nplan and hard to remediate; especially given the rising year on year\nfirehose volumetrics, with rising velocity and rising peak loads."),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"99% of the data either originates as JSON, or is transformed to JSON\njust in time.")),(0,i.yg)("p",null,"The target systems for displacement and replacement have very well\nunderstood and extract, load, transform, enrichment and normalization\nalgorithms that are coded and configured differently in each system.\nThis is difficult to maintain, enhance and evolve in an environment\nwhere infrastructure and services are continuously evolving."),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"A rich set of ETL and data manipulation and mutation primitives are\nrequired so that all existing methods used for data processing across\nthe target systems can be replaced by a single easy to understand,\neasy to program and optimized alternative.")),(0,i.yg)("h3",{id:"solution"},"Solution"),(0,i.yg)("p",null,"Tremor has already established itself in the traffic shaping domain in\nthe logging and metrics domains - adding just-in-time traffic shaping\ncapabilities when needed; and preserving the original system\u2019s\noperational semantics and behaviours during normal operating conditions\nwhen the system is operating within planned capacity constraints."),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"new pipeline",src:a(78177).A,width:"598",height:"168"})),(0,i.yg)("p",null,"The mandate now expands to replacing many of our event capture systems\ndeployed on on-premise and cloud-native operating environments across\nmultiple data-centres globally."),(0,i.yg)("p",null,"Instead of our operations and service reliability teams needing to learn\nand manage the service deployment and administrative lifecycle of\nmultiple components in this evolution we displace and replace those\nsystems - typically operating as sidecars on source systems where our\napplications run on virtual machines, bare metal or containerized\nenvironments with tremor."),(0,i.yg)("p",null,"The relatively primitive domain specific language developed as part of\nthe initial solution for traffic shaping is replaced with a new domain\nspecific language ",(0,i.yg)("inlineCode",{parentName:"p"},"tremor-script")," designed for expressive data\nfiltration, extraction, enrichment and transformation to support:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Classification, Categorization and rate limiting for Traffic Shaping"),(0,i.yg)("li",{parentName:"ul"},"Enrichment, Normalization and micro-format parsing"),(0,i.yg)("li",{parentName:"ul"},"Structural pattern matching over hierarchical nested JSON-like data"),(0,i.yg)("li",{parentName:"ul"},"The ability to patch, merge and iterate over JSON-like data"),(0,i.yg)("li",{parentName:"ul"},"A familiar expression language like in regular programming languages\nwith arithmetic, multiplicative and other common operations on\nnumeric and string data"),(0,i.yg)("li",{parentName:"ul"},"Testing string encoded data for regular expression and other\nmicro-formats such as the logstash ",(0,i.yg)("inlineCode",{parentName:"li"},"grok"),", ",(0,i.yg)("inlineCode",{parentName:"li"},"dissect"),", ",(0,i.yg)("inlineCode",{parentName:"li"},"kv"),"\nor stringified embedded json")),(0,i.yg)("p",null,"The resulting language and interpreter for ",(0,i.yg)("inlineCode",{parentName:"p"},"tremor-script")," forms the\nbasis of the solution and is largely designed around the needs of the\nlogging domain - but delivered in a more generally useful incarnation\nthat is more widely applicable to other domains - such as in flight data\nanalytics, in flight ETL or processing metrics to name a few."),(0,i.yg)("p",null,"Most of the in-flight events are JSON or JSON-like. Inspired by a tweet\nthe tremor team happens upon the work of Daniel Lemire et al and\nSIMD-accelerated JSON processing. Heinz ports this to rust and tremor\u2019s\nsister project and organization simd-lite is born. The tremor team also\nmaintains the rust port of simd-json with other maintainers interested\nin fast and efficient data parallel parsing of JSON."),(0,i.yg)("p",null,"Finally, tremor undergoes a steady pace of innovation with benchmark\ndriven performance optimizations. The combined effect of an efficient\ninterpreter, the ability to easily benchmark synthetic analogs of real\nworld use cases in our benchmark system, and the adoption of more\nworkload appropriate and efficient low level memory allocators such as\n",(0,i.yg)("inlineCode",{parentName:"p"},"jemalloc"),", then ",(0,i.yg)("inlineCode",{parentName:"p"},"mimalloc"),", then ",(0,i.yg)("inlineCode",{parentName:"p"},"snmalloc")," by Microsoft Research\nresults an order of magnitude level of infrastructure cost savings. The\nproduction estate shrinks by 10x in terms of the number of deployed\nsystems, the compute capacity required, and the committed memory\nrequired when compared to the displaced and replaced systems.  "),(0,i.yg)("p",null,"Further - tremor uses far less memory and resources on the source\nsystems making it a much improved sidecar on our source hosts."),(0,i.yg)("h2",{id:"conclusion"},"Conclusion"),(0,i.yg)("p",null,"Tremor\u2019s core mission and mandate now extends from high quality of\nservice data distribution with load-adaptive traffic management for the\n1% ( and typically less ) of time our systems are under-resourced; and,\nthe other 99% of the time is 10x more cost efficient."),(0,i.yg)("p",null,"Tremor preserves its facility to remain invisible to developers during\nthis phase of expansion whilst drastically improving the lives of our\noperational engineers and service reliability engineers. The measured\nand validated cost-efficiencies offer compounding value that further\ndrives the mandate of the project and pushes it into its next phase of\nevolution."))}u.isMDXComponent=!0},29194:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/image1-638996ab9adf5b141b60cdeb4ab8a2de.png"},78177:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/image2-546e9398e3b74c01fefca8fa7450da0e.png"},9912:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/image3-931314084952fca9c5dc4a5d63edad3d.png"},21697:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/wayfair-b0bafac5cf230fcd5e29c8cb4560c334.png"}}]);