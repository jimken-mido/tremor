"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[9485],{79553:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=t(58168),o=(t(96540),t(15680)),i=t(40281);const a={sidebar_label:"udp",sidebar_position:1},s="The udp Connector",l={unversionedId:"reference/connectors/udp",id:"version-0.12/reference/connectors/udp",title:"The udp Connector",description:"The udp connector allows UDP based datagram clients and servers to be integrated with tremor.",source:"@site/versioned_docs/version-0.12/reference/connectors/udp.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/udp",permalink:"/docs/0.12/reference/connectors/udp",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/udp.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"udp",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"tcp",permalink:"/docs/0.12/reference/connectors/tcp"},next:{title:"unix_socket",permalink:"/docs/0.12/reference/connectors/unix_socket"}},c={},d=[{value:"Configuration",id:"configuration",level:2},{value:"Client",id:"client",level:3},{value:"Server",id:"server",level:3},{value:"UDP configuration example",id:"udp-configuration-example",level:2},{value:"JSON file over UDP as base64 encoded YAML",id:"json-file-over-udp-as-base64-encoded-yaml",level:3},{value:"UDP server that logs base64 encoded YAML as one string per line to a file",id:"udp-server-that-logs-base64-encoded-yaml-as-one-string-per-line-to-a-file",level:3},{value:"Notes",id:"notes",level:2},{value:"Running as an integration test",id:"running-as-an-integration-test",level:3},{value:"Running as long running service",id:"running-as-long-running-service",level:3},{value:"Running as a long running service, with pretty printed JSON output",id:"running-as-a-long-running-service-with-pretty-printed-json-output",level:3},{value:"Exercises",id:"exercises",level:3}],g={toc:d},p="wrapper";function u(e){let{components:n,...t}=e;return(0,o.yg)(p,(0,r.A)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"the-udp-connector"},"The ",(0,o.yg)("inlineCode",{parentName:"h1"},"udp")," Connector"),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"udp")," connector allows UDP based datagram clients and servers to be integrated with tremor."),(0,o.yg)("h2",{id:"configuration"},"Configuration"),(0,o.yg)("h3",{id:"client"},"Client"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector `udp-out` from udp_client\nwith\n  codec = "yaml",\n  postprocessors = ["base64"],\n  config = {\n    "url": "localhost:4242",\n  }\nend;\n')),(0,o.yg)("h3",{id:"server"},"Server"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector `udp-in` from udp_server\nwith\n  codec = "string",\n  config = { \n    "url": "localhost:4242",\n  }\nend;\n')),(0,o.yg)("h2",{id:"udp-configuration-example"},"UDP configuration example"),(0,o.yg)("p",null,"This is a relatively simple client server system that replays JSON formatted lines of data\nfrom a text file over UDP to a server. The JSON data is transformed to base64 encoded YAML\nbefore sending to the UDP server. The server receives UDP datagrams and writes them to a\nlog file encoding the log entries as naked string data."),(0,o.yg)("p",null,"The client and server are implemented as treomr flows."),(0,o.yg)("p",null,"A high level summary of the overall flow:"),(0,o.yg)(i.K,{chart:"graph LR\n    A[JSON File] --\x3e|read line by line| B(UDP Client)\n    B --\x3e|base64 encoded YAML| C{UDP Server}\n    C{UDP Server} --\x3e|receive UDP datagrams| D(select event from in into out)\n    D --\x3e|string encoded data| E[Log file]",mdxType:"Mermaid"}),(0,o.yg)("h3",{id:"json-file-over-udp-as-base64-encoded-yaml"},"JSON file over UDP as base64 encoded YAML"),(0,o.yg)("p",null,"A tremor flow that consumes JSON formatted data line by line\nfrom a file and sends each event as a base64 encoded YAML formatted\nevent via UDP to a UDP service."),(0,o.yg)("p",null,"High level flow summary:"),(0,o.yg)(i.K,{chart:"graph LR\n    A[JSON File] --\x3e|read line by line| B(UDP Client)\n    B --\x3e|base64 encoded YAML| C{UDP Server}",mdxType:"Mermaid"}),(0,o.yg)("p",null,"In deployable form"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define flow main\nflow\n  use tremor::connectors;\n  use integration;\n\n\n  define connector in from file\n  with codec = "json",\n    preprocessors = ["lines"],\n    config = {\n        "path": "in.json",\n        "mode": "read"\n    }\n  end;\n\n  define connector `udp-out` from udp_client\n  with\n    codec = "yaml",\n    postprocessors = ["base64"],\n    config = {\n      "url": "localhost:4242",\n    }\n  end;\n  \n  create pipeline main from integration::out_or_exit;\n  create connector in;\n  create connector `udp-out`;\n  create connector exit from connectors::exit;\n\n  connect /connector/in/out to /pipeline/main/in;\n  connect /pipeline/main/out to /connector/`udp-out`/in;\n  connect /pipeline/main/exit to /connector/exit/in;\nend;\n\ndeploy flow main;\n')),(0,o.yg)("h3",{id:"udp-server-that-logs-base64-encoded-yaml-as-one-string-per-line-to-a-file"},"UDP server that logs base64 encoded YAML as one string per line to a file"),(0,o.yg)("p",null,"A tremor flow that consumes UDP datagram events and writes them\nto a file encoding as raw strings."),(0,o.yg)("p",null,"High level flow summary:"),(0,o.yg)(i.K,{chart:"graph LR\n    A{UDP Server} --\x3e|receive UDP datagrams| B(select event from in into out)\n    B --\x3e|string encoded data| C[Log file]",mdxType:"Mermaid"}),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define flow main\nflow\n  use tremor::connectors;\n  use integration;\n  \n  # Encapsulate a UDP server that processes datagrams as strings\n  define connector `udp-in` from udp_server\n  with\n    codec = "string",\n    config = { \n      "url": "localhost:4242",\n    }\n  end;\n\n  # Encapsualte a file based sink that stores events per line as a string\n  define connector out from file\n  with\n    codec = "string",\n    postprocessors = ["lines"],\n    config = {\n      "path": "../gen.log",\n      "mode": "truncate"\n    }\n  end;\n\n\n  create pipeline main from integration::out_or_exit;\n  create connector `udp-in`;\n  create connector debug from connectors::console;\n  create connector exit from connectors::exit;\n  create connector out;\n\n  connect /connector/`udp-in` to /pipeline/main/in;\n  connect /pipeline/main/out to /connector/out;\n  connect /pipeline/main/out to /connector/debug;\n  connect /pipeline/main/exit to /connector/exit/in;\nend;\n\ndeploy flow main;\n')),(0,o.yg)("h2",{id:"notes"},"Notes"),(0,o.yg)("h3",{id:"running-as-an-integration-test"},"Running as an integration test"),(0,o.yg)("p",null,"This is how we run this test sceanario within our integration test suite."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor test integration .\n")),(0,o.yg)("h3",{id:"running-as-long-running-service"},"Running as long running service"),(0,o.yg)("p",null,"The logic can be used as starting point for your own client or service via ",(0,o.yg)("inlineCode",{parentName:"p"},"tremor server run"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy\n")),(0,o.yg)("h3",{id:"running-as-a-long-running-service-with-pretty-printed-json-output"},"Running as a long running service, with pretty printed JSON output"),(0,o.yg)("p",null,"During development, pretty printing the JSON output on standard output might be useful."),(0,o.yg)("p",null,"We typically use the wonderful ",(0,o.yg)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},(0,o.yg)("inlineCode",{parentName:"a"},"jq"))," for this purpose"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy | jq\n")),(0,o.yg)("h3",{id:"exercises"},"Exercises"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Modularise the solution allowing the following combinations",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Deploy the client and server in separate tremor instances"),(0,o.yg)("li",{parentName:"ul"},"Deploy the client and server in a single tremor instance"),(0,o.yg)("li",{parentName:"ul"},"Use the ",(0,o.yg)("inlineCode",{parentName:"li"},"msgpack")," codec instead of ",(0,o.yg)("inlineCode",{parentName:"li"},"base64")," encoded YAML"),(0,o.yg)("li",{parentName:"ul"},"Unpack the ",(0,o.yg)("inlineCode",{parentName:"li"},"base64")," encoded YAML and write to a log file as line-delimited JSON"),(0,o.yg)("li",{parentName:"ul"},"Add compression and decmopression")))))}u.isMDXComponent=!0}}]);