"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[8799],{26035:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var o=t(58168),r=(t(96540),t(15680));t(40281);const s={},a="CNCF OpenTelemetry Passthrough",i={unversionedId:"recipes/otel_passthrough/index",id:"version-0.11/recipes/otel_passthrough/index",title:"CNCF OpenTelemetry Passthrough",description:"All the application code here is available from the docs git repository.",source:"@site/versioned_docs/version-0.11/recipes/40_otel_passthrough/index.md",sourceDirName:"recipes/40_otel_passthrough",slug:"/recipes/otel_passthrough/",permalink:"/docs/0.11/recipes/otel_passthrough/",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/recipes/40_otel_passthrough/index.md",tags:[],version:"0.11",frontMatter:{},sidebar:"version-0.11/tutorialSidebar",previous:{title:"Ingesting documents from kafka into elastic",permalink:"/docs/0.11/recipes/kafka_elastic_correlation/"},next:{title:"CNCF OpenTelemetry Zipkin Interworking",permalink:"/docs/0.11/recipes/otel_zipkin/"}},l={},p=[{value:"Environment",id:"environment",level:2},{value:"Business Logic",id:"business-logic",level:2},{value:"Command line testing during logic development",id:"command-line-testing-during-logic-development",level:2},{value:"Docker",id:"docker",level:2}],c={toc:p},d="wrapper";function m(e){let{components:n,...s}=e;return(0,r.yg)(d,(0,o.A)({},c,s,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"cncf-opentelemetry-passthrough"},"CNCF OpenTelemetry Passthrough"),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"All the application code here is available from the docs ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/recipes/40_otel_passthrough/index.md"},"git repository"),".")),(0,r.yg)("p",null,"This example is the simplest possible configuration of tremor with support for CNCF OpenTelemetry\ninterception and distribution. It shows the very basic building blocks:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"CNCF OpenTelemetry Onramp"),(0,r.yg)("li",{parentName:"ul"},"CNCF OpenTelemetry Offramp"),(0,r.yg)("li",{parentName:"ul"},"Deployment configuration file")),(0,r.yg)("p",null,"External open telemetry clients can use port ",(0,r.yg)("inlineCode",{parentName:"p"},"4316")," to send OpenTelemetry logs, traces and metrics\nthrough tremor. Tremor prints the json mapping to standard out and forwards the events to the\nOpenTelemetry collector."),(0,r.yg)("h2",{id:"environment"},"Environment"),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{target:"_blank",href:t(24961).A},"onramp")," we use is the ",(0,r.yg)("inlineCode",{parentName:"p"},"otel")," CNCF OpenTeletry onramp listening on\na non-standard CNCF OpenTelemetry port ",(0,r.yg)("inlineCode",{parentName:"p"},"4316"),", it receives protocol buffer messages over gRPC on this\nport. The log, metric and trace events received are converted to tremor's value system and passed through\na passthrough pipeline to the CNCF OpenTelemetry sink. The sink will try to connect to a downstream CNCF\nOpenTelemetry endpoint. In this workshop we will use the well known OpenTelemetry port of ",(0,r.yg)("inlineCode",{parentName:"p"},"4317")," for our\nsink and run the standard OpenTelemetry collector on this port using a ",(0,r.yg)("a",{target:"_blank",href:t(99915).A},"collector configuration"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'onramp:\n  - id: otlp\n    type: otel # Use the OpenTelemetry gRPC listener source\n    codec: json # Json is the only supported value\n    config:\n      port: 4316 # The TCP port to listen on\n      host: "0.0.0.0" # The IP address to bind on ( all interfaces in this case )\n')),(0,r.yg)("p",null,"It connects to a passthrough pipeline. This pipeline forwards any received\nobservability events downstream unchanged."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-trickle"},"select event from in into out;\n")),(0,r.yg)("p",null,"We connect the passthrough output events into an OpenTelemetry sink which distributes them to\na downstream OpenTelemetry service."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: otlp\n    type: otel\n    codec: json # Jsn is the only supported value\n    config:\n      host: "0.0.0.0"\n      port: 4317\n')),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{target:"_blank",href:t(38394).A},"binding")," expresses these relations and gives deployment connectivity graph."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"binding:\n  - id: example\n    links:\n      '/onramp/otlp/{instance}/out':\n       - '/pipeline/example/{instance}/in'\n      '/pipeline/example/{instance}/out':\n       - '/offramp/stdout/{instance}/in'\n       - '/offramp/otlp/{instance}/in'\n")),(0,r.yg)("p",null,"Finally the ",(0,r.yg)("a",{target:"_blank",href:t(7272).A},"mapping")," instanciates the binding with the given name and instance variable to activate the elements of the binding."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'mapping:\n  /binding/example/passthrough:\n    instance: "passthrough"\n')),(0,r.yg)("h2",{id:"business-logic"},"Business Logic"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-trickle"},"select event from in into out\n")),(0,r.yg)("h2",{id:"command-line-testing-during-logic-development"},"Command line testing during logic development"),(0,r.yg)("p",null,"Use any compliant OpenTelemetry instrumented application and configure the\nserver to our source on port ",(0,r.yg)("inlineCode",{parentName:"p"},"4316")," instead of the default ",(0,r.yg)("inlineCode",{parentName:"p"},"4317"),"."),(0,r.yg)("h2",{id:"docker"},"Docker"),(0,r.yg)("p",null,"For convenience, use the provided ",(0,r.yg)("a",{target:"_blank",href:t(89716).A},"docker-compose.yaml")," to\nstart and stop tremor and the opentelemetry collector as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# Start\n$ docker compose up\n\n# Stop\n$ docker compose stop\n")))}m.isMDXComponent=!0},89716:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/files/docker-compose-3281555bd80804f51ee292c4db4aaafd.yaml"},99915:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/files/collector-config-2d8d08bfe178670bd9729be750de7fb0.yaml"},24961:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/files/00_ramps-f3ec739bb6b0c551cffe3f94725b9f9a.yaml"},38394:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/files/01_binding-7d6c2c8727298377446379c886448d73.yaml"},7272:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/files/02_mapping-9c81a0870131ab67e86b0f001460a101.yaml"}}]);