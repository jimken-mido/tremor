"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[558],{74439:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>m});var o=t(58168),r=(t(96540),t(15680));t(40281);const i={sidebar_label:"metrics (Tremor metrics)",sidebar_position:1},s="The metrics Connector",c={unversionedId:"reference/connectors/metrics",id:"version-0.12/reference/connectors/metrics",title:"The metrics Connector",description:"The metrics connector collects and forwards system metrics and can be used by user defined",source:"@site/versioned_docs/version-0.12/reference/connectors/metrics.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/metrics",permalink:"/docs/0.12/reference/connectors/metrics",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/metrics.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"metrics (Tremor metrics)",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"kv (Key/Value Store)",permalink:"/docs/0.12/reference/connectors/kv"},next:{title:"metronome (Periodic messages)",permalink:"/docs/0.12/reference/connectors/metronome"}},a={},m=[{value:"Configuration",id:"configuration",level:2},{value:"Format",id:"format",level:2},{value:"How do i capture system metrics to standard output?",id:"how-do-i-capture-system-metrics-to-standard-output",level:2},{value:"Exercises",id:"exercises",level:2}],l={toc:m},p="wrapper";function d(e){let{components:n,...t}=e;return(0,r.yg)(p,(0,o.A)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"the-metrics-connector"},"The ",(0,r.yg)("inlineCode",{parentName:"h1"},"metrics")," Connector"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"metrics")," connector collects and forwards system metrics and can be used by user defined\nlogic to expand on the set of metrics collected."),(0,r.yg)("h2",{id:"configuration"},"Configuration"),(0,r.yg)("p",null,"We use the standard definition of the metrics connector from the standard library"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor"},"use tremor::connectors;\n\ncreate connector metrics from connectors::metrics;\n\n...\n \n# Redirect system metrics to a user defined pipeline\nconnect /connector/metrics to /pipeline/my_metrics\n\n...\n\n")),(0,r.yg)("h2",{id:"format"},"Format"),(0,r.yg)("p",null,"The general form of metrics events is as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor"},'{"measurement":"connector_events","tags":{"connector":"in","port":"err"},"fields":{"count":0},"timestamp":1650402845610254000}\n{"measurement":"events","tags":{"pipeline":"main","node":"out","direction":"input","port":"in"},"fields":{"count":7},"timestamp":1650402845610254000}\n{"measurement":"events","tags":{"pipeline":"main","node":"process","direction":"output","port":"out"},"fields":{"count":7},"timestamp":1650402845610254000}\n{"measurement":"connector_events","tags":{"connector":"out","port":"in"},"fields":{"count":8},"timestamp":1650402845610254000}\n')),(0,r.yg)("p",null,"Where:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor"},'{ \n  "measurement":"connector_events",       # The name of the measure\n  "tags":{"connector":"out","port":"in"}, # Measure specific tags or labels\n  "fields":{"count":20},                  # Measure specific fields\n  "timestamp":1650402945610254000}        # Optional Timestamp\n}\n')),(0,r.yg)("h2",{id:"how-do-i-capture-system-metrics-to-standard-output"},"How do i capture system metrics to standard output?"),(0,r.yg)("p",null,"Capture and redirect system metrics and redirect to standard output"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="capture.troy"',title:'"capture.troy"'},'define flow main\nflow\n  use integration;\n  use std::time::nanos;\n  use tremor::connectors;\n\n  # connector definitions\n  define connector in from metronome\n  with\n    metrics_interval_s = 3,\n    config = { "interval": nanos::from_seconds(1) }\n  end;\n\n  define connector out from file\n  with\n    metrics_interval_s = 3,\n    codec = "json-sorted",\n    postprocessors = ["separate"],\n    config = {\n      "path": "events.log",\n      "mode": "write"\n    }\n  end;\n\n  # pipeline definitions\n  define pipeline main\n  args\n    metrics_interval_s = 3\n  pipeline\n    #!config metrics_interval_s = 3\n\n    select event from in into out;\n  end;\n  \n  define pipeline metrics\n  into \n    out, err, exit\n  pipeline\n    define script process\n    script\n      # exit if we have at least 10 events\n      match state of\n        case %{ measurement == "exit" } => # exit hook via a poisoned measurement name\n          # Won\'t fire via the `metronome`\n          emit {"EXIT": "NOW"} => "exit"\n        default =>\n          event # emit state => "out"\n      end\n    end;\n\n    create script process;\n\n    select event from in into process;\n    select event from process/out into out;\n    select event from process/exit into exit;\n    select event from process/err into err;\n\n  end;\n\n  # creating connectors\n  create connector in;\n  create connector out;\n\n  create connector exit from connectors::exit;\n  create connector metrics from connectors::metrics;\n  create connector stdio from connectors::console;\n\n  # creating pipelines\n  create pipeline main;\n  create pipeline metrics;\n\n  # connects\n  connect /connector/in to  /pipeline/main;\n  connect /pipeline/main/out to /connector/out;\n\n  connect /connector/metrics to /pipeline/metrics;\n  # catching other outputs, just in case\n  connect /pipeline/metrics/out to /connector/stdio/stdout;\n  connect /pipeline/metrics/err to /connector/stdio/stderr;\n\n  # exit when we have all events\n  connect /pipeline/metrics/exit to /connector/exit;\n  connect /pipeline/metrics/exit to /connector/stdio/stdout;\n\nend;\n\ndeploy flow main;\n')),(0,r.yg)("h2",{id:"exercises"},"Exercises"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Referring to the ",(0,r.yg)("a",{parentName:"li",href:"#format"},"format")," generate synthetiic metrics and publish them\nto the metrics ",(0,r.yg)("inlineCode",{parentName:"li"},"in")," port"),(0,r.yg)("li",{parentName:"ul"},"Reformat the metrics based on the influx line protocol format and publish to an\n",(0,r.yg)("inlineCode",{parentName:"li"},"influx")," compatible endpoint such as InfluxDB, QuestDB or TDEngine or another TSDB"),(0,r.yg)("li",{parentName:"ul"},"Replace the ",(0,r.yg)("inlineCode",{parentName:"li"},"metronome")," source with ",(0,r.yg)("inlineCode",{parentName:"li"},"stdin")," or a file to further explore the metrics\nfacility.")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The logic above includes an ",(0,r.yg)("inlineCode",{parentName:"p"},"exit")," hook via a special measurement named ",(0,r.yg)("inlineCode",{parentName:"p"},"exit"),".\nThis logic should be removed in a system designed for long running in production!")))}d.isMDXComponent=!0}}]);