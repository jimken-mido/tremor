"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[2273],{43707:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>g,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var i=t(58168),a=(t(96540),t(15680));t(40281);const l={},r="Filter",o={unversionedId:"recipes/filter/index",id:"version-0.11/recipes/filter/index",title:"Filter",description:"All the application code here is available from the docs git repository.",source:"@site/versioned_docs/version-0.11/recipes/01_filter/index.md",sourceDirName:"recipes/01_filter",slug:"/recipes/filter/",permalink:"/docs/0.11/recipes/filter/",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/recipes/01_filter/index.md",tags:[],version:"0.11",frontMatter:{},sidebar:"version-0.11/tutorialSidebar",previous:{title:"Passthrough",permalink:"/docs/0.11/recipes/passthrough/"},next:{title:"Transform",permalink:"/docs/0.11/recipes/transform/"}},s={},p=[{value:"Environment",id:"environment",level:2},{value:"Business Logic",id:"business-logic",level:2},{value:"Command line testing during logic development",id:"command-line-testing-during-logic-development",level:2},{value:"Discussion",id:"discussion",level:3},{value:"Where clause",id:"where-clause",level:4},{value:"Having clause",id:"having-clause",level:4},{value:"Where and Having clauses",id:"where-and-having-clauses",level:4}],c={toc:p},d="wrapper";function g(e){let{components:n,...l}=e;return(0,a.yg)(d,(0,i.A)({},c,l,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"filter"},"Filter"),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"All the application code here is available from the docs ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/recipes/01_filter/index.md"},"git repository"),".")),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"filter")," builds on the ",(0,a.yg)("a",{parentName:"p",href:"/docs/0.11/recipes/passthrough/"},"passthrough example")," and extends the ",(0,a.yg)("a",{target:"_blank",href:t(59e3).A},(0,a.yg)("code",null,"example.trickle"))," by adding a filter\non the field ",(0,a.yg)("inlineCode",{parentName:"p"},"selected"),". Only if this field is set to true the event will pass."),(0,a.yg)("h2",{id:"environment"},"Environment"),(0,a.yg)("p",null,"It connects to the pipeline ",(0,a.yg)("inlineCode",{parentName:"p"},"example")," in the ",(0,a.yg)("a",{target:"_blank",href:t(59e3).A},(0,a.yg)("code",null,"example.trickle"))," file using the trickle query language to express the filtering logic."),(0,a.yg)("p",null,"All other configuration is the same as per the passthrough example, and is elided here for brevity."),(0,a.yg)("h2",{id:"business-logic"},"Business Logic"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-trickle"},"select event from in where event.selected into out\n")),(0,a.yg)("h2",{id:"command-line-testing-during-logic-development"},"Command line testing during logic development"),(0,a.yg)("p",null,"Now let us consider this sample input."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},'$ cat inputs.txt \n{ "hello": "world", "selected": false }\n{ "hello": "again", "selected": true }\n')),(0,a.yg)("p",null,"Deploy the solution into a docker environment"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},'$ docker-compose up\n{"hello": "again", "selected": true}\n')),(0,a.yg)("p",null,"Inject test messages via ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/vi/websocat"},"websocat")),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"Can be installed via ",(0,a.yg)("inlineCode",{parentName:"p"},"cargo install websocat")," for the lazy/impatient amongst us")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"$ cat inputs.txt | websocat ws://localhost:4242\n...\n")),(0,a.yg)("h3",{id:"discussion"},"Discussion"),(0,a.yg)("p",null,"Filters in tremor query ( ",(0,a.yg)("inlineCode",{parentName:"p"},"trickle")," ) can be any legal predicate expression ( boolean returning\nexpression or function call ). For example:"),(0,a.yg)("h4",{id:"where-clause"},"Where clause"),(0,a.yg)("p",null,"Events are selected on the inbound event if the ",(0,a.yg)("inlineCode",{parentName:"p"},"numeric")," field on the inbound event is less than or equal to ",(0,a.yg)("inlineCode",{parentName:"p"},"10")," or greater than or equal to ",(0,a.yg)("inlineCode",{parentName:"p"},"100"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-trickle"},"select event\nfrom in\nwhere event.numeric <= 10 or event.numeric >= 100\ninto out\n")),(0,a.yg)("h4",{id:"having-clause"},"Having clause"),(0,a.yg)("p",null,"Events are selected after processing them if the ",(0,a.yg)("inlineCode",{parentName:"p"},"selected")," field on the outbound event is true."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-trickle"},"select event\nfrom in\ninto out\nhaving event.selected\n")),(0,a.yg)("h4",{id:"where-and-having-clauses"},"Where and Having clauses"),(0,a.yg)("p",null,"Events are selected on the inbound event if the ",(0,a.yg)("inlineCode",{parentName:"p"},"numeric")," field on the inbound event is less than or equal to ",(0,a.yg)("inlineCode",{parentName:"p"},"10")," or\ngreater than or equal to ",(0,a.yg)("inlineCode",{parentName:"p"},"100")," and after processing them, the ",(0,a.yg)("inlineCode",{parentName:"p"},"selected")," field on the outbound event is true."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-trickle"},"select event\nfrom in\nwhere event.numeric <= 10 or event.numeric >= 100\ninto out\nhaving event.selected\n")),(0,a.yg)("admonition",{type:"tip"},(0,a.yg)("p",{parentName:"admonition"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"where")," clause has to be located after the ",(0,a.yg)("inlineCode",{parentName:"p"},"from")," section in a trickle select expression!     The ",(0,a.yg)("inlineCode",{parentName:"p"},"where")," clause is evaluated on the incoming event."),(0,a.yg)("p",{parentName:"admonition"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"having")," clause can be used to filter events, but it has to appear after the ",(0,a.yg)("inlineCode",{parentName:"p"},"into"),"     expression and will be evaluated on the resulting produced event prior to passing it on."),(0,a.yg)("p",{parentName:"admonition"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"where")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"having")," clauses are optional in trickle select query statements.")))}g.isMDXComponent=!0},59e3:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/files/example-7487e5aa3277ee71c5131cb4c6284089.trickle"}}]);