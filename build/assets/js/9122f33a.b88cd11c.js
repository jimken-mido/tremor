"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[2304],{36986:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>g,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=t(58168),r=(t(96540),t(15680));t(40281);const i={sidebar_label:"otel (Open Telemetry)",sidebar_position:1},a="The otel Connector",l={unversionedId:"reference/connectors/otel",id:"version-0.12/reference/connectors/otel",title:"The otel Connector",description:"This connector adds support for the CNCF OpenTelemetry specification",source:"@site/versioned_docs/version-0.12/reference/connectors/otel.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/otel",permalink:"/docs/0.12/reference/connectors/otel",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/otel.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"otel (Open Telemetry)",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"metronome (Periodic messages)",permalink:"/docs/0.12/reference/connectors/metronome"},next:{title:"s3 (AWS S3 object store)",permalink:"/docs/0.12/reference/connectors/s3"}},s={},c=[{value:"Configuration",id:"configuration",level:2},{value:"How do I configure the connector as an OpenTelemetry client?",id:"how-do-i-configure-the-connector-as-an-opentelemetry-client",level:3},{value:"How do I configure the connector as an OpenTelemetry service?",id:"how-do-i-configure-the-connector-as-an-opentelemetry-service",level:3},{value:"Full example - An OpenTelemetry Echo service",id:"full-example---an-opentelemetry-echo-service",level:2},{value:"Running as an integration test",id:"running-as-an-integration-test",level:3},{value:"Running as long running service",id:"running-as-long-running-service",level:3},{value:"Running as a long running service, with pretty printed JSON output",id:"running-as-a-long-running-service-with-pretty-printed-json-output",level:3},{value:"Standard Library",id:"standard-library",level:3}],p={toc:c},u="wrapper";function g(e){let{components:n,...t}=e;return(0,r.yg)(u,(0,o.A)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"the-otel-connector"},"The ",(0,r.yg)("inlineCode",{parentName:"h1"},"otel")," Connector"),(0,r.yg)("p",null,"This connector adds support for the ",(0,r.yg)("a",{parentName:"p",href:"https://opentelemetry.io/"},"CNCF OpenTelemetry")," specification\nallowing tremor to expose OpenTelemetry capable endpoints and to act as an OpenTelemetry client."),(0,r.yg)("h2",{id:"configuration"},"Configuration"),(0,r.yg)("p",null,"The connector can be configured as a client to a remote OpenTelemetry service, as a\nserver exposing a gRPC based OpenTelemetry service endpoint - or as a combination of\nboth depending on use case."),(0,r.yg)("h3",{id:"how-do-i-configure-the-connector-as-an-opentelemetry-client"},"How do I configure the connector as an OpenTelemetry client?"),(0,r.yg)("p",null,"Configurating as a client to a local or remote OpenTelemetry service:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="example.troy"',title:'"example.troy"'},'define connector my_otel from otel_client\nwith\n  config = {\n    "url": "127.0.0.1:4317",  # Connect to localhost via gRPC to port 4317\n  },\n  reconnect = {\n    "retry": {\n      "interval_ms": 100, # Retry on disconnect every 100ms\n      "growth_rate": 2,   # Double interval for each attempt\n      "max_retries": 3,   # Try no more than 3 times to reconnect\n\n      # Enable trace event support ( default: true )\n      # "trace": false,\n\n      # Enable metrics event support ( default: true )\n      # "metrics": false,\n\n      # Enable logs event support ( default: true )\n      # "logs": false,\n    }\n  }\nend;\n')),(0,r.yg)("h3",{id:"how-do-i-configure-the-connector-as-an-opentelemetry-service"},"How do I configure the connector as an OpenTelemetry service?"),(0,r.yg)("p",null,"Configurating as a server exposing an OpenTelemetry service to local or remote clients:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="example.troy"',title:'"example.troy"'},'define connector my_otelfrom otel_server\nwith\n  config = {\n    "url": "127.0.0.1:4317",    # Expose an OpenTelemetry gRPC endpoint on localhost port 4317\n  }\nend;\n')),(0,r.yg)("h2",{id:"full-example---an-opentelemetry-echo-service"},"Full example - An OpenTelemetry Echo service"),(0,r.yg)("p",null,"We define an echo style service within our integration tests as a validation that the client\nand server connectors are fully functional that we run as part of our continuous integration\ntests."),(0,r.yg)("p",null,"The entire echo application is as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'# Encapsulation of the server side logic - our otel o11y `echo` service\ndefine flow server\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n\n  # Expose an otel service on localhost port 4317\n  define connector otel_server from otel_server\n  with\n    config = {\n      "url": "127.0.0.1:4317",\n    }\n  end;\n\n  #  Our application logic\n  define pipeline instrument\n  into out, exit\n  pipeline\n    # Forward received OpenTelemetry events\n    select event from in into out;\n    \n    # Quiescence - if the first span in the first item in a trace message\n    # has a `http.target` attribute - trigger an exit and stop this test\n    select { "exit": 0, "delay": 10 } from in \n    where present event.trace[0].instrumentation_library_spans[0].spans[0].attributes.`http.target`\n    into exit;\n  end;\n\n  # Instances of connectors to run for this flow\n  create connector data_out from integration::write_file;\n  create connector exit from integration::exit;\n  create connector otels from otel_server;\n  create connector stdio from connectors::console;\n\n  # Query pipelines to execute for this flow\n  create pipeline echo from instrument;\n  create pipeline passthrough from pipelines::passthrough;\n\n  # Echo otel server: <otel:req> -> server -> server_side -> <file>\n  connect /connector/otels to /pipeline/echo;\n  connect /connector/otels to /pipeline/passthrough;\n\n  # Wire up pipeline outputs to downstream connectors\n  connect /pipeline/passthrough to /connector/stdio;\n  connect /pipeline/echo to /connector/data_out;\n  connect /pipeline/echo/exit to /connector/exit;\nend;\n\n# Encapsulation of the client side logic - in a real world application\n# the client is more likely going to be via otel instrumentation from\n# an opentelemetry instrumented application, or an upstream tremor\n# service - perhaps distributing opentelemetry events via other protocols\n# or transforming legacy o11y events to otel events\n#\ndefine flow client\nflow\n  use integration;\n  use tremor::pipelines;\n\n  define connector otel_client from otel_client\n  with\n    config = {\n      "url": "127.0.0.1:4317",\n    },\n    reconnect = {\n      "retry": {\n        "interval_ms": 100,\n        "growth_rate": 2,\n        "max_retries": 3,\n      }\n    }\n  end;\n\n  # Instances of connectors to run for this flow\n  create connector data_in from integration::read_file;\n  create connector otelc from otel_client;\n  create pipeline replay from pipelines::passthrough;\n   \n  # Wire up connectors asd pipelines\n  connect /connector/data_in to /pipeline/replay;\n  connect /pipeline/replay to /connector/otelc;\nend;\n\n# Deploy the server flow\ndeploy flow server;\n\n# Deploy the client flow\ndeploy flow client;\n')),(0,r.yg)("h3",{id:"running-as-an-integration-test"},"Running as an integration test"),(0,r.yg)("p",null,"This is how we run this test sceanario within our integration test suite."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor test integration .\n")),(0,r.yg)("h3",{id:"running-as-long-running-service"},"Running as long running service"),(0,r.yg)("p",null,"The logic can be used as starting point for your own client or service via ",(0,r.yg)("inlineCode",{parentName:"p"},"tremor server run"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy\n")),(0,r.yg)("h3",{id:"running-as-a-long-running-service-with-pretty-printed-json-output"},"Running as a long running service, with pretty printed JSON output"),(0,r.yg)("p",null,"During development, pretty printing the JSON output on standard output might be useful."),(0,r.yg)("p",null,"We typically use the wonderful ",(0,r.yg)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},(0,r.yg)("inlineCode",{parentName:"a"},"jq"))," for this purpose"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy | jq\n")),(0,r.yg)("h3",{id:"standard-library"},"Standard Library"),(0,r.yg)("p",null,"The OpenTelemetry connector ships with a ",(0,r.yg)("a",{parentName:"p",href:"../stdlib/cncf/otel"},"module")," of convenience functions and\ndefinitions that make working with, consuming and producing OpenTelemetry event streams easier."))}g.isMDXComponent=!0}}]);