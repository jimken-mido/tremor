"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[3708],{90547:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var i=a(58168),t=(a(96540),a(15680));a(40281);const o={},r="Configuring Tremor",l={unversionedId:"operations/configuration",id:"version-0.11/operations/configuration",title:"Configuring Tremor",description:"This is a short canned synopsis of tremor configuration.",source:"@site/versioned_docs/version-0.11/operations/configuration.md",sourceDirName:"operations",slug:"/operations/configuration",permalink:"/docs/0.11/operations/configuration",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/operations/configuration.md",tags:[],version:"0.11",frontMatter:{},sidebar:"version-0.11/tutorialSidebar",previous:{title:"Configuration Walkthrough",permalink:"/docs/0.11/operations/configuration-walkthrough"},next:{title:"Circuit Breakers and Guaranteed Delivery",permalink:"/docs/0.11/operations/gdcb"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Deployment Types",id:"deployment-types",level:2},{value:"Using the docker image",id:"using-the-docker-image",level:2},{value:"Static or Bootstrap deployments",id:"static-or-bootstrap-deployments",level:2},{value:"Interactive or Operational deployments",id:"interactive-or-operational-deployments",level:2}],m={toc:p},d="wrapper";function c(e){let{components:n,...a}=e;return(0,t.yg)(d,(0,i.A)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,t.yg)("h1",{id:"configuring-tremor"},"Configuring Tremor"),(0,t.yg)("p",null,"This is a short canned synopsis of tremor configuration."),(0,t.yg)("p",null,"Tremor supports dynamic reconfiguration since v0.4."),(0,t.yg)("h2",{id:"introduction"},"Introduction"),(0,t.yg)("p",null,"The tremor runtime is internally structured with repositories and registries of configurable elements or artefacts. These artefacts can be one of:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("p",{parentName:"li"},"Onramp - Specify to tremor ",(0,t.yg)("em",{parentName:"p"},"how")," to connect to the outside world to ingest or consume external data. For example, the Kafka onramp consumes data from Kafka topics.")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("p",{parentName:"li"},"Offramp - Specify to tremor ",(0,t.yg)("em",{parentName:"p"},"how")," to connect to the outside world to publish data to external systems For example, the Elastic offramp pushes data to ElasticSearch via its bulk upload REST/HTTP API endpoint")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("p",{parentName:"li"},"Pipeline - Specify to tremor ",(0,t.yg)("em",{parentName:"p"},"what")," operations to perform on data ingested ( from any connected upstream source ) and ",(0,t.yg)("em",{parentName:"p"},"what")," to contribute or publish downstream ( to any connected downstream target ).")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("p",{parentName:"li"},"Binding - A binding is a specification of how to interconnect Onramps, Offramps and Pipelines. Binding specifications can be thought of a type of wiring harness")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("p",{parentName:"li"},"Mapping - A mapping instantiated multiple bindings and fills in template variables."))),(0,t.yg)("p",null,"Specifications for onramps, offramps, pipelines and bindings in tremor should be considered templates. They are stored in an internal tremor ",(0,t.yg)("em",{parentName:"p"},"repository"),". A tremor repository stores artefacts, much like git repositories code."),(0,t.yg)("p",null,"Live onramps, offramps and pipelines in tremor are in a runnable state. They consume typically network bandwidth and some compute in the case of onramps and offramps. They consume compute bandwidth in the case of pipelines."),(0,t.yg)("p",null,"In order to create live instances of onramps, offramps and pipelines, a binding must be ",(0,t.yg)("em",{parentName:"p"},"deployed"),". This is done by specifying a ",(0,t.yg)("inlineCode",{parentName:"p"},"mapping")," which consists of a mapping from binding instance url to the template values to fill in placeholders in the Binding specification. For each entry in the ",(0,t.yg)("inlineCode",{parentName:"p"},"mapping")," a binding instance is created and all referenced connected onramps, pipelines and offramps are instantiated with it."),(0,t.yg)("p",null,"Live ",(0,t.yg)("em",{parentName:"p"},"instances")," of tremor artefacts are stored in a ",(0,t.yg)("em",{parentName:"p"},"registry"),". A tremor registry can be thought of similarly to the Domain Name Service or DNS."),(0,t.yg)("p",null,"All 'live' or 'deployed' instances in tremor ( onramps, offramps, pipelines ) are managed by a finite state machine."),(0,t.yg)("h2",{id:"deployment-types"},"Deployment Types"),(0,t.yg)("p",null,"In this section we explore the two basic types of deployment in tremor."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-text"},'\n+------------+      "publish"      +--------------+     "bind/deploy"     +--------------+\n|            +--------------------\x3e+              +----------------------\x3e+              |\n|            |                     |              |                       |              |\n|  Artefact  |   onramp, pipeline  |   Artefact   |       mapping         |  Instance    |\n|            |   offramp, binding  |  Repository  |                       |  Registry    |\n|            |                     |              |                       |              |\n|            +<--------------------+              +<----------------------+              |\n+------------+       "find"        +--------------+    "unbind/undeploy"  +--------------+\n\n')),(0,t.yg)("p",null,"Tremor leverages the registry/repository and publish-find-bind Service Oriented Architecture patterns to drive its configuration model. Onramp, Offramp and Pipeline configurations can be published as template specifications along with how they should be interconnected as binding specifications."),(0,t.yg)("p",null,"As all artefacts in tremor are named, when a mapping is published, it deploys all the required onramps, offramps and pipelines automatically. This also means that when a mapping is deleted, that the corresponding live instances are undeployed."),(0,t.yg)("p",null,"All live or running artefacts have a corresponding state machine that manages its deployment lifecycle. The FSM is a simplified version of the POA worker activator lifecycle from CORBA and other Application Server Platforms."),(0,t.yg)("h2",{id:"using-the-docker-image"},"Using the docker image"),(0,t.yg)("p",null,"When using the tremor docker image configuration is loaded from the folder ",(0,t.yg)("inlineCode",{parentName:"p"},"/etc/tremor")," this folder should be mounted into the docker container to propagate the data."),(0,t.yg)("p",null,"The following files are looked for:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"/etc/tremor/logger.yaml")," a ",(0,t.yg)("a",{parentName:"li",href:"https://docs.rs/log4rs/*/log4rs/"},"log4rs")," configuration file to control logging in tremor."),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"/etc/tremor/config/")," : All ",(0,t.yg)("inlineCode",{parentName:"li"},"*.trickle")," files in this directory and its subdirectories will be loaded as trickle pipelines - trickle pipelines are always loaded before yaml configuration! The file name in this case (the part before ",(0,t.yg)("inlineCode",{parentName:"li"},".trickle"),") is the pipeline id which you can use in places like the binding configuration. The ",(0,t.yg)("inlineCode",{parentName:"li"},'#!config id = "name"')," preprocessor directive can be used to overwrite the naming."),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"/etc/tremor/config/"),": All ",(0,t.yg)("inlineCode",{parentName:"li"},"*.yml")," and ",(0,t.yg)("inlineCode",{parentName:"li"},"*.yaml")," files will be loaded as configuration files and evaluated in order (so mappings cannot refer to artefacts in later files!) - NOTE: defining pipelines in yaml is deprecated and trickle pipelines should be used.")),(0,t.yg)("p",null,"By default tremor is looking into ",(0,t.yg)("inlineCode",{parentName:"p"},"/usr/local/share/tremor")," for custom ",(0,t.yg)("inlineCode",{parentName:"p"},"tremor-script")," modules and libraries that can be included in your scripts and ",(0,t.yg)("inlineCode",{parentName:"p"},"trickle")," files via ",(0,t.yg)("inlineCode",{parentName:"p"},"use"),".  See ",(0,t.yg)("a",{parentName:"p",href:"/docs/0.11/tremor-script/modules"},(0,t.yg)("inlineCode",{parentName:"a"},"tremor-script")," modules")," and ",(0,t.yg)("a",{parentName:"p",href:"/docs/0.11/tremor-query/modules"},(0,t.yg)("inlineCode",{parentName:"a"},"tremor-query")," modules"),". To adapt the places tremor is looking for your modules, append to the ",(0,t.yg)("inlineCode",{parentName:"p"},"TREMOR_PATH")," environment variable:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-sh"},'export TREMOR_PATH="/my/custom/tremor_modules:$TREMOR_PATH"\n')),(0,t.yg)("h2",{id:"static-or-bootstrap-deployments"},"Static or Bootstrap deployments"),(0,t.yg)("p",null,"Static or Bootstrap deployment allows tremor to be configured at startup with its registry and repository pre-populated with out of the box user defined configuration."),(0,t.yg)("p",null,"For example, in the following example, tremor is started with a registry and repository that runs a micro benchmark on startup"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"target/debug/tremor server run -f repo.yaml reg.yaml\n")),(0,t.yg)("p",null,"The repository:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},'# File: repo.yaml\n\n# define a blaster that replays data from an archived JSON log file\nonramp:\n  - id: blaster\n    type: blaster\n    config:\n      source: ./demo/data/data.json.xz\n\n# define a blackhole that runs a 40 second benchmark and then stops\nofframp:\n  - id: blackhole\n    type: blackhole\n    config:\n      warmup_secs: 10\n      stop_after_secs: 40\n      significant_figures: 2\n\n# define a passthrough pipeline for benchmarking\npipeline:\n  - id: main\n    interface:\n      inputs:\n        - in\n      outputs:\n        - out\n    nodes:\n      - id: passthrough\n        op: passthrough\n    links:\n      in: [passthrough]\n      passthrough: [out]\n\n# define how blaster, the pipeline under test, and blackhole interconnect\nbinding:\n  - id: default\n    links:\n      "/onramp/blaster/{instance}/out": ["/pipeline/main/{instance}/in"]\n      "/pipeline/main/{instance}/out": ["/offramp/blackhole/{instance}/in"]\n')),(0,t.yg)("p",null,"Static deployments support multiple configurations. You can specify multiple configurations by using a list in the config instead of specifying one item as illustrated below:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"onramp:\n  - id: kafka-in\n    type: kafka\n    codec: json\n    config:\n      brokers:\n        - kafka:9092\n      topics:\n        - demo\n      group_id: demo\n  - id: kafka-again\n    type: kafka\n    codec: json\n    config:\n      brokers:\n        - kafka:9092\n      topics:\n        - snotbadger\n      group_id: demo\n")),(0,t.yg)("p",null,"This file 'loads' the repository on startup with various specifications or templates, but it doesn't do anything. For that, we need to define one or many instances for tremor to deploy. This is done in the reg.yaml file:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"mapping:\n  /binding/default/01: # deployment '01'\n    instance: \"01\" # .. deploys, blaster/01, blackhole/01, pipeline/main/01\n")),(0,t.yg)("h2",{id:"interactive-or-operational-deployments"},"Interactive or Operational deployments"),(0,t.yg)("p",null,"Tremor's registry and repository can be configured dynamically via tremor's REST API, and via the tremor-cli tool. For example:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"tremor api onramp create blaster.yaml\ntremor api offramp create offramp.yaml\ntremor api pipeline create main.yaml\ntremor api binding create benchmark.yaml\n")),(0,t.yg)("p",null,"Or via curl:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"curl --data-binary @deployment.yaml http://localhost:9898/binding/default/01\n")))}c.isMDXComponent=!0}}]);