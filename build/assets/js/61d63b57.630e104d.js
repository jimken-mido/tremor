"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[7049],{97937:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var o=t(58168),a=(t(96540),t(15680));t(40281);const r={sidebar_label:"kv (Key/Value Store)",sidebar_position:1},i="The kv Connector",l={unversionedId:"reference/connectors/kv",id:"version-0.12/reference/connectors/kv",title:"The kv Connector",description:"The kv connector provides a key value storate facility for tremor-based",source:"@site/versioned_docs/version-0.12/reference/connectors/kv.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/kv",permalink:"/docs/0.12/reference/connectors/kv",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/kv.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"kv (Key/Value Store)",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"kafka",permalink:"/docs/0.12/reference/connectors/kafka"},next:{title:"metrics (Tremor metrics)",permalink:"/docs/0.12/reference/connectors/metrics"}},s={},d=[{value:"Configuration",id:"configuration",level:2},{value:"How do I get values from the <code>kv</code> store?",id:"how-do-i-get-values-from-the-kv-store",level:2},{value:"How do I put values into the <code>kv</code> store?",id:"how-do-i-put-values-into-the-kv-store",level:2},{value:"How do I swap values in the <code>kv</code> store?",id:"how-do-i-swap-values-in-the-kv-store",level:2},{value:"How do I scan values in the <code>kv</code> store?",id:"how-do-i-scan-values-in-the-kv-store",level:2},{value:"How do I delete values in the <code>kv</code> store?",id:"how-do-i-delete-values-in-the-kv-store",level:2},{value:"Application",id:"application",level:2},{value:"Correlation",id:"correlation",level:2},{value:"Conditioning",id:"conditioning",level:2}],p={toc:d},c="wrapper";function u(e){let{components:n,...t}=e;return(0,a.yg)(c,(0,o.A)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"the-kv-connector"},"The ",(0,a.yg)("inlineCode",{parentName:"h1"},"kv")," Connector"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," connector provides a key value storate facility for tremor-based\napplications allowing shared state across pipelines. The facility is useful\nwhen in memory state via the ",(0,a.yg)("inlineCode",{parentName:"p"},"state")," mechanism is not useful as the state is\nnot shared across pipeline instances or flows."),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," service allows state to be shared to multiple pipelines within a a\nsingle flow definition or unit of deployment."),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," storage is persistent. A storage directory needs to be provided."),(0,a.yg)("admonition",{type:"warning"},(0,a.yg)("p",{parentName:"admonition"},"If not found, the storage directory will be auto-created, or an error will be propagated.")),(0,a.yg)("h2",{id:"configuration"},"Configuration"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'define my_kv from kv\nwith\n  "path" = "state",\nend;\n')),(0,a.yg)("h2",{id:"how-do-i-get-values-from-the-kv-store"},"How do I get values from the ",(0,a.yg)("inlineCode",{parentName:"h2"},"kv")," store?"),(0,a.yg)("p",null,"We use the ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," ",(0,a.yg)("inlineCode",{parentName:"p"},"get")," command for this purpose."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'let $kv = { "get": "snot" };\nlet event = null;\n')),(0,a.yg)("p",null,"This will result in either ",(0,a.yg)("inlineCode",{parentName:"p"},"null")," when  not found or the stored value"),(0,a.yg)("h2",{id:"how-do-i-put-values-into-the-kv-store"},"How do I put values into the ",(0,a.yg)("inlineCode",{parentName:"h2"},"kv")," store?"),(0,a.yg)("p",null,"We use the ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," ",(0,a.yg)("inlineCode",{parentName:"p"},"put")," command for this purpose."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'let $kv = { "put": "snot",  };\nlet event = "badger";\n')),(0,a.yg)("p",null,"This will result in either ",(0,a.yg)("inlineCode",{parentName:"p"},"null")," when not found or the stored value"),(0,a.yg)("h2",{id:"how-do-i-swap-values-in-the-kv-store"},"How do I swap values in the ",(0,a.yg)("inlineCode",{parentName:"h2"},"kv")," store?"),(0,a.yg)("p",null,"We use the ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," ",(0,a.yg)("inlineCode",{parentName:"p"},"cas")," command for this purpose."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'let $kv = {"cas": "heinz", "old": "gies"}\nlet event = "ketchup";\n')),(0,a.yg)("p",null,"This will result in either ",(0,a.yg)("inlineCode",{parentName:"p"},"null")," on success, or an event on the ",(0,a.yg)("inlineCode",{parentName:"p"},"err")," stream upon failure"),(0,a.yg)("h2",{id:"how-do-i-scan-values-in-the-kv-store"},"How do I scan values in the ",(0,a.yg)("inlineCode",{parentName:"h2"},"kv")," store?"),(0,a.yg)("p",null,"We use the ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," ",(0,a.yg)("inlineCode",{parentName:"p"},"scan")," command for this purpose."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'let $kv = {"scan": "", "end": "heinz"};\nlet event = 9;\n')),(0,a.yg)("p",null,"This will return a value for each match in the specified scan range."),(0,a.yg)("h2",{id:"how-do-i-delete-values-in-the-kv-store"},"How do I delete values in the ",(0,a.yg)("inlineCode",{parentName:"h2"},"kv")," store?"),(0,a.yg)("p",null,"We use the ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," ",(0,a.yg)("inlineCode",{parentName:"p"},"delete")," command for this purpose."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'let $kv = { "delete": "heinz" };\nlet event = null;\n')),(0,a.yg)("h2",{id:"application"},"Application"),(0,a.yg)("p",null,"Assuming the ",(0,a.yg)("inlineCode",{parentName:"p"},"$kv")," metadata and event are as above, the following query connected to\nan instance of the kv connector should suffice:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},"select event from in into out;\n")),(0,a.yg)("h2",{id:"correlation"},"Correlation"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"$correlation")," metadata key can be set so that a request and response from the\n",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," facility can be traced:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'let $correlation = "some-correlating-unique-data";\n')),(0,a.yg)("h2",{id:"conditioning"},"Conditioning"),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"To avoid write errors when other streams are writing to the same kv store we provide the\nold value as a comparand so that the swap only occurs if the value hasn't changed independently\nin the intervening time since we last read from the store for this key.")))}u.isMDXComponent=!0}}]);