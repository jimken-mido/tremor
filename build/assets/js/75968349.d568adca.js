"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[4128],{2652:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>g,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var r=t(58168),o=(t(96540),t(15680));t(40281);const i={sidebar_label:"unix_socket",sidebar_position:1},s="The unix_socket Connector",c={unversionedId:"reference/connectors/unix_socket",id:"version-0.12/reference/connectors/unix_socket",title:"The unix_socket Connector",description:"The unix_socket:client allows clients and servers based on UNIX sockets to be integrated with tremor.",source:"@site/versioned_docs/version-0.12/reference/connectors/unix_socket.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/unix_socket",permalink:"/docs/0.12/reference/connectors/unix_socket",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/unix_socket.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"unix_socket",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"udp",permalink:"/docs/0.12/reference/connectors/udp"},next:{title:"wal (Write Ahead Log)",permalink:"/docs/0.12/reference/connectors/wal"}},a={},l=[{value:"Configuration",id:"configuration",level:2},{value:"Client",id:"client",level:3},{value:"Server",id:"server",level:3},{value:"How do i?",id:"how-do-i",level:2},{value:"Running as an integration test",id:"running-as-an-integration-test",level:3},{value:"Running as long running service",id:"running-as-long-running-service",level:3},{value:"Running as a long running service, with pretty printed JSON output",id:"running-as-a-long-running-service-with-pretty-printed-json-output",level:3}],u={toc:l},p="wrapper";function g(e){let{components:n,...t}=e;return(0,o.yg)(p,(0,r.A)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"the-unix_socket-connector"},"The ",(0,o.yg)("inlineCode",{parentName:"h1"},"unix_socket")," Connector"),(0,o.yg)("p",null,"The unix_socket:client allows clients and servers based on UNIX sockets to be integrated with tremor."),(0,o.yg)("h2",{id:"configuration"},"Configuration"),(0,o.yg)("p",null,"A UNIX socket based line delimited JSON client"),(0,o.yg)("h3",{id:"client"},"Client"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector client from unix_socket_client\nwith\n  postprocessors = ["lines"],\n  preprocessors = ["lines"],\n  codec = "json",\n  config = {\n    # required - Path to socket file for this client\n    "path": "/tmp/unix-socket.sock",\n    # required - Size of buffer for data IO\n    "buf_size": 1024,\n  },\n  # Configure basic reconnection QoS for clients - max 3 retries starting with 100ms reconnect attempt interval\n  reconnect = {\n    "retry": {\n      "interval_ms": 100,\n      "growth_rate": 2,\n      "max_retries": 3,\n    }\n  }\nend;\n')),(0,o.yg)("h3",{id:"server"},"Server"),(0,o.yg)("p",null,"A UNIX socket based line delimited JSON server"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector server from unix_socket_server\nwith\n  # Server produces/consumes line delimited JSON data\n  preprocessors = ["lines"],\n  postprocessors = ["lines"],\n  codec = "json",\n\n  # UNIX socket specific configuration\n  config = {\n    # required - Path to socket file for this server\n    "path": "/tmp/unix-socket.sock",\n    # required - Permissions are read/write for the user running the server only\n    "permissions": "=600",\n    # required - Use a 1K buffer - this should be tuned based on data value space requirements\n    "buf_size": 1024,\n  }\nend;\n')),(0,o.yg)("h2",{id:"how-do-i"},"How do i?"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'# Encapsulate a UNIX socket based server\ndefine flow server\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n\n  define connector server from unix_socket_server\n  with\n    # Server produces/consumes line delimited JSON data\n    preprocessors = ["lines"],\n    postprocessors = ["lines"],\n    codec = "json",\n\n    # UNIX socket specific configuration\n    config = {\n      # Path to socket file for this server\n      "path": "/tmp/unix-socket.sock",\n      # Permissions are read/write for the user running the server only\n      "permissions": "=600",\n      # Use a 1K buffer - this should be tuned based on data value space requirements\n      "buf_size": 1024,\n    }\n  end;\n\n  # Log to file\n  create connector server_out from integration::write_file\n  with\n    file = "server_out.log"\n  end;\n  create connector stdio from connectors::console;\n  create connector server;\n\n  create pipeline server_side from pipelines::passthrough;\n  create pipeline debug from pipelines::passthrough;\n\n  # Flow from tcp_server to file\n  connect /connector/server to /pipeline/server_side;\n  connect /connector/server/err to /pipeline/debug;\n  connect /pipeline/server_side to /connector/server_out;\n\n  # Echo it back\n  connect /pipeline/server_side to /connector/server/in;\n\n  # Debugging\n  connect /pipeline/debug to /connector/stdio;\n\nend;\n\n# Encapsulate a UNIX socket based client\ndefine flow client\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n  use std::time::nanos;\n\n  define connector client from unix_socket_client\n  with\n    postprocessors = ["lines"],\n    preprocessors = ["lines"],\n    codec = "json",\n    config = {\n      "path": "/tmp/unix-socket.sock",\n      "buf_size": 1024,\n    },\n    # Configure basic reconnection QoS for clients - max 3 retries starting with 100ms reconnect attempt interval\n    reconnect = {\n      "retry": {\n        "interval_ms": 100,\n        "growth_rate": 2,\n        "max_retries": 3,\n      }\n    }\n  end;\n\n  # create connector instances\n  create connector in from integration::read_file;\n  create connector client;\n  create connector client_out from integration::write_file\n  with\n    file = "client_out.log"\n  end;\n  create connector stdio from connectors::console;\n  create connector exit from integration::exit;\n\n  # create pipeline instances\n  create pipeline request from pipelines::passthrough;\n  create pipeline debug from pipelines::passthrough;\n\n  create pipeline response from integration::out_or_exit;\n\n  # connect everything together\n  # from file to unix domain client\n  connect /connector/in to /pipeline/request;\n  connect /pipeline/request to /connector/client;\n\n  # send out any responses\n  connect /connector/client to /pipeline/response;\n  connect /pipeline/response to /connector/client_out;\n  connect /pipeline/response/exit to /connector/exit;\n  connect /pipeline/response/out to /connector/stdio;\n\n  # debugging\n  connect /connector/in/err to /pipeline/debug;\n  connect /connector/client/err to /pipeline/debug;\n  connect /pipeline/debug to /connector/stdio;\nend;\n\ndeploy flow server;\ndeploy flow client;\n')),(0,o.yg)("h3",{id:"running-as-an-integration-test"},"Running as an integration test"),(0,o.yg)("p",null,"This is how we run this test sceanario within our integration test suite."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor test integration .\n")),(0,o.yg)("h3",{id:"running-as-long-running-service"},"Running as long running service"),(0,o.yg)("p",null,"The logic can be used as starting point for your own client or service via ",(0,o.yg)("inlineCode",{parentName:"p"},"tremor server run"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy\n")),(0,o.yg)("h3",{id:"running-as-a-long-running-service-with-pretty-printed-json-output"},"Running as a long running service, with pretty printed JSON output"),(0,o.yg)("p",null,"During development, pretty printing the JSON output on standard output might be useful."),(0,o.yg)("p",null,"We typically use the wonderful ",(0,o.yg)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},(0,o.yg)("inlineCode",{parentName:"a"},"jq"))," for this purpose"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy | jq\n")))}g.isMDXComponent=!0}}]);