"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[6709],{99173:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var n=a(58168),i=(a(96540),a(15680));a(40281);const s={},r="Validate",o={unversionedId:"recipes/validate/index",id:"version-0.11/recipes/validate/index",title:"Validate",description:"All the application code here is available from the docs git repository.",source:"@site/versioned_docs/version-0.11/recipes/03_validate/index.md",sourceDirName:"recipes/03_validate",slug:"/recipes/validate/",permalink:"/docs/0.11/recipes/validate/",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/recipes/03_validate/index.md",tags:[],version:"0.11",frontMatter:{},sidebar:"version-0.11/tutorialSidebar",previous:{title:"Transform",permalink:"/docs/0.11/recipes/transform/"},next:{title:"Logstash",permalink:"/docs/0.11/recipes/logstash/"}},l={},d=[{value:"Environment",id:"environment",level:2},{value:"Business Logic",id:"business-logic",level:2},{value:"Command line testing during logic development",id:"command-line-testing-during-logic-development",level:2},{value:"Discussion",id:"discussion",level:3}],p={toc:d},c="wrapper";function g(e){let{components:t,...s}=e;return(0,i.yg)(c,(0,n.A)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"validate"},"Validate"),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"All the application code here is available from the docs ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.11/recipes/03_validate/index.md"},"git repository"),".")),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"validate")," example adds the concept of scripts to the trickle file. In this script we validate the schema of the input json against some requirements and only let events through that do satisfy them. Other events are dropped. Those changes are entirely inside the ",(0,i.yg)("a",{target:"_blank",href:a(88670).A},(0,i.yg)("code",null,"example.trickle")),"."),(0,i.yg)("h2",{id:"environment"},"Environment"),(0,i.yg)("p",null,"In the ",(0,i.yg)("a",{target:"_blank",href:a(88670).A},(0,i.yg)("code",null,"example.trickle"))," we define a script that validates the schema that the field ",(0,i.yg)("inlineCode",{parentName:"p"},"hello")," is a string and the field ",(0,i.yg)("inlineCode",{parentName:"p"},"selected")," is a boolean. If both conditions are true we pass it on, otherwise it'll drop."),(0,i.yg)("p",null,"All other configuration is the same as per the previous example, and is elided here for brevity."),(0,i.yg)("h2",{id:"business-logic"},"Business Logic"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-tremor"},"define script validate                                                          # define the script\nscript\n  match event of\n    case %{ present hello, present selected }                                   # Record pattern, validating field presence\n        when type::is_string(event.hello) and type::is_bool(event.selected)     # guards\n            => emit event                                                       # propagate if valid\n    default => drop                                                             # discard or reroute\n  end\nend;\n")),(0,i.yg)("h2",{id:"command-line-testing-during-logic-development"},"Command line testing during logic development"),(0,i.yg)("p",null,"Run a the query against a sample input.json"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},'$ tremor run -i input.json example.trickle\n>> {"hello": "world"}\n')),(0,i.yg)("p",null,"Deploy the solution into a docker environment"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},'$ docker-compose up\n>> {"hello": "again", "selected": true}\n')),(0,i.yg)("p",null,"Inject test messages via ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/vi/websocat"},"websocat")),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"Can be installed via ",(0,i.yg)("inlineCode",{parentName:"p"},"cargo install websocat")," for the lazy/impatient amongst us")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"$ cat inputs.txt | websocat ws://localhost:4242\n...\n")),(0,i.yg)("p",null,"Injecting bad messages to verify validation."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"$ cat invalids.txt | websocat ws://localhost:4242\n...\n")),(0,i.yg)("h3",{id:"discussion"},"Discussion"),(0,i.yg)("p",null,"We introduce the ",(0,i.yg)("inlineCode",{parentName:"p"},"declare script")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"create script")," query language features. ",(0,i.yg)("inlineCode",{parentName:"p"},"declare script")," lets declare a template for a script to be run while ",(0,i.yg)("inlineCode",{parentName:"p"},"create script")," instantiates it as a part of the graph. ",(0,i.yg)("inlineCode",{parentName:"p"},"create script")," takes an additional ",(0,i.yg)("inlineCode",{parentName:"p"},"as <name>")," argument, which if omitted, will cause the operator to have the same name as the declaration."),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"Scripts themselves can not connect to elements inside the graph, a ",(0,i.yg)("inlineCode",{parentName:"p"},"select")," statement is needed to glue scripts and other logic together.")))}g.isMDXComponent=!0},88670:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/files/example-6823b48f5bf4299ac64a456bfb415ad4.trickle"}}]);