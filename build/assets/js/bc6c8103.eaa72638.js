"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[9765],{68846:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var i=t(58168),r=(t(96540),t(15680));t(40281);const o={},a="Monitoring",s={unversionedId:"operations/monitoring",id:"version-0.12/operations/monitoring",title:"Monitoring",description:"Monitoring tremor is done using tremor itself. This has some interesting implications.",source:"@site/versioned_docs/version-0.12/operations/monitoring.md",sourceDirName:"operations",slug:"/operations/monitoring",permalink:"/docs/0.12/operations/monitoring",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/operations/monitoring.md",tags:[],version:"0.12",frontMatter:{},sidebar:"indexSidebar",previous:{title:"Configuring Tremor",permalink:"/docs/0.12/operations/configuration"},next:{title:"index",permalink:"/docs/0.12/api/"}},l={},p=[{value:"Metrics",id:"metrics",level:2},{value:"Pipeline metrics",id:"pipeline-metrics",level:3},{value:"Connector metrics",id:"connector-metrics",level:3},{value:"Operator level metrics",id:"operator-level-metrics",level:3},{value:"Logging",id:"logging",level:2}],c={toc:p},m="wrapper";function g(e){let{components:n,...t}=e;return(0,r.yg)(m,(0,i.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"monitoring"},"Monitoring"),(0,r.yg)("p",null,"Monitoring tremor is done using tremor itself. This has some interesting implications."),(0,r.yg)("p",null,"Each connector and each pipeline emit metrics, they can be subscribed to using the ",(0,r.yg)("a",{parentName:"p",href:"/docs/0.12/reference/connectors/metrics"},"metrics connector"),". This allows to both write these messages to a destination system such as InfluxDB, as well as to a message queue such as Kafka."),(0,r.yg)("p",null,"The rate at which metrics are published can be defined for each connector and pipeline."),(0,r.yg)("p",null,"By default metrics are turned off."),(0,r.yg)("p",null,"Metrics are formatted following the same structure as the ",(0,r.yg)("a",{parentName:"p",href:"/docs/0.12/reference/codecs/influx"},"Influx Codec"),"."),(0,r.yg)("h2",{id:"metrics"},"Metrics"),(0,r.yg)("p",null,"Tremor allows collecting it's own metrics and processing them, this enables us to send metrics to any system tremor can connect to and not force our users into a specific ecosystem. "),(0,r.yg)("p",null,"An example can be found in the ",(0,r.yg)("a",{parentName:"p",href:"/docs/0.12/guides/metrics#tremor-metrics"},"metrics guide")),(0,r.yg)("h3",{id:"pipeline-metrics"},"Pipeline metrics"),(0,r.yg)("p",null,"Configuring metrics for pipelines is done with the config directive:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"#!config metrics_interval_s = <seconds>\n")),(0,r.yg)("p",null,"This directive determines the interval in seconds at which metrics events are emitted from the pipeline into the metrics connector."),(0,r.yg)("p",null,"Example pipeline definition:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor"},"define pipeline with_metrics\npipeline\n  #!config metrics_interval_s = 5\n  select event from in into out;\nend;\n")),(0,r.yg)("p",null,"This pipeline will emit a metrics event every 5 seconds."),(0,r.yg)("p",null,"Each pipeline will emit 1 metrics event per interval with a count of the events it received on its input port (Usually ",(0,r.yg)("inlineCode",{parentName:"p"},"in"),")."),(0,r.yg)("p",null,"Example metrics event:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "measurement": "events",\n  "tags": {\n    "direction": "output",\n    "node": "in",\n    "pipeline": "main",\n    "port": "out"\n  },\n  "fields": { "count": 20 },\n  "timestamp": 1553077007898214000\n}\n')),(0,r.yg)("p",null,"In ",(0,r.yg)("a",{parentName:"p",href:"/docs/0.12/reference/codecs/influx"},"influx")," format:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-influx"},"events,port=out,direction=output,node=in,pipeline=main count=20 1553077007898214000\n")),(0,r.yg)("p",null,"In this structure ",(0,r.yg)("inlineCode",{parentName:"p"},"measurement")," is always ",(0,r.yg)("inlineCode",{parentName:"p"},"events")," as that is what this is measuring. The number of events is always in the field ",(0,r.yg)("inlineCode",{parentName:"p"},"count")," as we are counting them."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"tags")," section explains where this measurement was taken:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"direction")," means if this event came into the node ",(0,r.yg)("inlineCode",{parentName:"li"},'"input"')," or came out of the node ",(0,r.yg)("inlineCode",{parentName:"li"},'"output"')),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"node")," is the ",(0,r.yg)("inlineCode",{parentName:"li"},"id")," of the node in a given pipeline"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"pipeline")," is the ",(0,r.yg)("inlineCode",{parentName:"li"},"id")," of the pipeline"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"port")," is the point the event was received or send from")),(0,r.yg)("p",null,"The example above measures all events that left the ",(0,r.yg)("inlineCode",{parentName:"p"},"in")," of pipeline ",(0,r.yg)("inlineCode",{parentName:"p"},"main"),"."),(0,r.yg)("p",null,"In addition to the general pipeline metrics, some operators do generate their own metrics, for details please check on the documentation for the operator in question."),(0,r.yg)("h3",{id:"connector-metrics"},"Connector metrics"),(0,r.yg)("p",null,"For connectors metrics can be configured with the argument ",(0,r.yg)("inlineCode",{parentName:"p"},"metrics_interval_s = <time>")," in the ",(0,r.yg)("inlineCode",{parentName:"p"},"with")," part of the connector definition."),(0,r.yg)("p",null,"Example connector definition:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor"},'define connector with_metrics from stdio\nwith\n  metrics_interval_s = 7,\n  codec = "string",\n  preprocessors = ["separate"],\n  postprocessors = ["separate"]\nend;\n')),(0,r.yg)("p",null,"This connector will emit 1 metrics event for each port. ",(0,r.yg)("inlineCode",{parentName:"p"},"in")," for received events, ",(0,r.yg)("inlineCode",{parentName:"p"},"out")," for emitted events and ",(0,r.yg)("inlineCode",{parentName:"p"},"err")," for emitted error events (e.g. if a codec failed to decode an event)."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "measurement": "connector_events",\n  "tags": {\n    "port": "out",\n    "connector": "example_connector"\n  },\n  "fields": { "count": 42 },\n  "timestamp": 1576215344378248634\n}\n')),(0,r.yg)("p",null,"In ",(0,r.yg)("a",{parentName:"p",href:"/docs/0.12/reference/codecs/influx"},"influx")," format:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-influx"},"connector_events,port=out,ramp=example_connector count=42 1576215344378248634\n")),(0,r.yg)("p",null,"In this structure ",(0,r.yg)("inlineCode",{parentName:"p"},"measurement")," is always ",(0,r.yg)("inlineCode",{parentName:"p"},"connector_events")," as that is what this is measuring. The number of events is always in the field ",(0,r.yg)("inlineCode",{parentName:"p"},"count")," as we are counting them."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"tags")," section explains where this measurement was taken:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"connector")," is the ",(0,r.yg)("inlineCode",{parentName:"li"},"id")," of the connector"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"port")," is one of ",(0,r.yg)("inlineCode",{parentName:"li"},"in"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"out")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"err")," (or any other port used by the connector)")),(0,r.yg)("p",null,"The example above measures all events that were emitted out by the connector ",(0,r.yg)("inlineCode",{parentName:"p"},"example_connector"),"."),(0,r.yg)("p",null,"Notes:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Preprocessor and codec level errors count as errors for connector metrics."),(0,r.yg)("li",{parentName:"ul"},"If your pipeline is using the ",(0,r.yg)("a",{parentName:"li",href:"../reference/operators#genericbatch"},"batch operator")," and connector is receiving events from it, no of events tracked at connector is going to be dictated by the batching config.")),(0,r.yg)("h3",{id:"operator-level-metrics"},"Operator level metrics"),(0,r.yg)("p",null,"In addition to the metrics provided by the pipeline itself, some operators can generate additional metrics."),(0,r.yg)("p",null,"The details are documented on a per operator level. Currently the following operators provide custom metrics:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/docs/0.12/reference/operators/bucket"},"grouper::bucket"))),(0,r.yg)("h2",{id:"logging"},"Logging"),(0,r.yg)("p",null,"Tremor uses the ",(0,r.yg)("a",{parentName:"p",href:"https://docs.rs/log4rs"},"log4rs")," this allows a rather flexible configuration that can be changed without restarting tremor. An alternative is setting ",(0,r.yg)("inlineCode",{parentName:"p"},"RUST_LOG")," for global lgo levels as provided by ",(0,r.yg)("a",{parentName:"p",href:"https://docs.rs/env_logger"},"env_logger"),"."),(0,r.yg)("p",null,"The log4rs config yaml is passed in over the ",(0,r.yg)("inlineCode",{parentName:"p"},"-l")," arugment. An example would be:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"refresh_rate: 30 seconds\n\nappenders:\n  stdout:\n    kind: console\n\nroot:\n  level: warn\n  appenders:\n    - stdout\n\nloggers:\n  tremor_runtime:\n    level: debug\n    appenders:\n      - stdout\n    additive: false\n  tremor:\n    level: debug\n    appenders:\n      - stdout\n    additive: false\n")),(0,r.yg)("p",null,"More about the format can be found ",(0,r.yg)("a",{parentName:"p",href:"https://docs.rs/log4rs/latest/log4rs/"},"in the documentation"),"."))}g.isMDXComponent=!0}}]);