"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[6598],{73415:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var o=n(58168),r=(n(96540),n(15680));const a={title:"Connectors for Streaming to AWS S3",author:"Daksh",author_title:"Tremor 2021 Fall Mentee",author_url:"https://www.linkedin.com/in/dak-x",tags:["connectors","s3","mentorship","cncf"],draft:!1,description:"Daksh's Mentorship summary report"},s=void 0,i={permalink:"/blog/2021/12/04/LFX-Blog-Daksh",editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/blog/2021-12-04-LFX-Blog-Daksh.md",source:"@site/blog/2021-12-04-LFX-Blog-Daksh.md",title:"Connectors for Streaming to AWS S3",description:"Daksh's Mentorship summary report",date:"2021-12-04T00:00:00.000Z",formattedDate:"December 4, 2021",tags:[{label:"connectors",permalink:"/blog/tags/connectors"},{label:"s3",permalink:"/blog/tags/s-3"},{label:"mentorship",permalink:"/blog/tags/mentorship"},{label:"cncf",permalink:"/blog/tags/cncf"}],readingTime:3.295,hasTruncateMarker:!1,authors:[{name:"Daksh",title:"Tremor 2021 Fall Mentee",url:"https://www.linkedin.com/in/dak-x"}],frontMatter:{title:"Connectors for Streaming to AWS S3",author:"Daksh",author_title:"Tremor 2021 Fall Mentee",author_url:"https://www.linkedin.com/in/dak-x",tags:["connectors","s3","mentorship","cncf"],draft:!1,description:"Daksh's Mentorship summary report"},prevItem:{title:"Collaboration - Using Redpanda with Tremor",permalink:"/blog/2021/12/13/redpanda"},nextItem:{title:"Case Study - Dead Code Detection in PHP",permalink:"/blog/2021/11/09/php-dead-code-detection"}},l={authorsImageUrls:[void 0]},p=[{value:"Introduction",id:"introduction",level:3},{value:"Learning about Tremor",id:"learning-about-tremor",level:3},{value:"My Project",id:"my-project",level:3},{value:"AWS S3 Connectors",id:"aws-s3-connectors",level:4},{value:"s3demo.troy",id:"s3demotroy",level:6},{value:"sample.json",id:"samplejson",level:6},{value:"Ending Thoughts",id:"ending-thoughts",level:4}],d={toc:p},c="wrapper";function m(e){let{components:t,...a}=e;return(0,r.yg)(c,(0,o.A)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h3",{id:"introduction"},"Introduction"),(0,r.yg)("p",null,"Hi folks, I'm Daksh, a senior year CS student at Indian Institute of Technology, Jammu. This blog talks about my project and experience contributing to ",(0,r.yg)("a",{parentName:"p",href:"https://www.tremor.rs"},"Tremor")," as part of LFX Mentorship Program Fall 2021."),(0,r.yg)("h3",{id:"learning-about-tremor"},"Learning about Tremor"),(0,r.yg)("p",null,"I came across ",(0,r.yg)("a",{parentName:"p",href:"https://www.rust-lang.org/"},"rust")," in early 2020, and I absolutely loved its design,  the syntax and how approachable it was to a beginner. I discovered Tremor while looking for open source projects written in rust. Tremor is an event processing system (think kafka) for unstructured data with rich support for structural pattern-matching, filtering and transformation. Over the summers, I did a few minor PR's. Going through the examples and the ",(0,r.yg)("a",{parentName:"p",href:"https://www.tremor.rs/docs/index/"},"docs")," I could set up Tremor and start hacking on!!"),(0,r.yg)("h3",{id:"my-project"},"My Project"),(0,r.yg)("p",null,"It is very common in event processing to stream data to a persistent storage engine for later processing or archival purposes. My job was to add connectors to stream data to AWS S3. You may find more information in the github ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/tremor-rs/tremor-runtime/issues/1176"},"issue"),"."),(0,r.yg)("p",null,"So what is a connector?\nA connector is the component of an Event Processing System that provides the functionality of communicating with the outside world. This would enable current, and future users of Tremor to now connect and stream events to any endpoint which supports the S3 API."),(0,r.yg)("h4",{id:"aws-s3-connectors"},"AWS S3 Connectors"),(0,r.yg)("p",null,"I would explain the sink via an example. To connect to S3, one would require the s3 credentials. Due to lack of support from the sdk only public-secret key credentials are supported ",(0,r.yg)("em",{parentName:"p"},"(to be extended once the sdk supports other means for credentials)"),".\nTremor would read the key names specified in the config from the environment."),(0,r.yg)("h6",{id:"s3demotroy"},"s3demo.troy"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'define flow s3demo\nflow\n    define connector s3conn from s3 with\n    codec="json",\n    config={\n        "aws_access_token": "AWS_ACCESS_KEY_ID",\n        "aws_secret_access_key": "AWS_SECRET_ACCESS_KEY",\n        "aws_region": "AWS_REGION",\n        "bucket": "tremordemo",\n        "min_part_size": 5242880,\n    }\n    end;\n\n    define connector files3 from file with\n    code="json",\n    config={\n        "mode": "read",\n        "path": "sample.json",\n    },\n    preprocessors=["lines"]\n    end;\n\n    define pipeline s3pipe\n    pipeline\n        define script s3Event\n            script\n            let e = event;\n            let $s3 = {\n                "key": e.key\n                };\n            let payload = e.payload;\n            payload\n            end;\n\n        create script s3Event;\n\n        select event from in into s3Event;\n        select event from s3Event into out;\n\n    end;\n\n    create connector s3conn;\n    create connector files3;\n    create pipeline s3pipe;\n\n    connect /connector/files3 to /pipeline/s3pipe;\n    connect /pipeline/s3pipe to /connector/s3conn;\n\nend;\n\ndeploy flow s3demo;\n')),(0,r.yg)("h6",{id:"samplejson"},"sample.json"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{"key": "key1", "payload": {"event1": "hello1", "key2":[1,2,3,4,5]} }\n{"key": "key2", "payload": {"event3": {"nested Obj": ["vec1", "vec2", "vec3"]}} }\n{"key": "key3", "payload": {"event3": null}}\n')),(0,r.yg)("p",null,"This configuration reads the file ",(0,r.yg)("inlineCode",{parentName:"p"},"sample.json")," ",(0,r.yg)("em",{parentName:"p"},"delimited by lines")," for events. The ",(0,r.yg)("inlineCode",{parentName:"p"},"s3pipe")," pipeline destructures the line contents to set the ",(0,r.yg)("inlineCode",{parentName:"p"},"data")," for the object to upload and its ",(0,r.yg)("inlineCode",{parentName:"p"},"key")," as meta-data. The s3-sink would then upload the data to AWS S3 with key set to $key inside the bucket ",(0,r.yg)("inlineCode",{parentName:"p"},"tremordemo")," ",(0,r.yg)("em",{parentName:"p"},"or anything that is given in the config")),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Sample Working",src:n(81098).A,width:"626",height:"217"})),(0,r.yg)("p",null,"The sink also has the ",(0,r.yg)("inlineCode",{parentName:"p"},"min_part_size")," configuration parameter. S3 support uploading larger objects in multiple parts. One can send multiple events with the same ",(0,r.yg)("strong",{parentName:"p"},"key")," consecutively, and Tremor would append the content of all those events, and whenever the content size gets larger than the ",(0,r.yg)("strong",{parentName:"p"},"min_part_size"),", a part is uploaded to s3. Whenever the key changes or Tremor stops, the upload for the previous key is completed."),(0,r.yg)("h4",{id:"ending-thoughts"},"Ending Thoughts"),(0,r.yg)("p",null,'I had a very productive and fun time with the Tremor Community. The Tremor principle of "never ',(0,r.yg)("strong",{parentName:"p"},"worry"),' about it" has helped me to deal with clueless moments during this mentorship. I would like to express my regards and gratitude to Matthias, Heinz, and Darach for giving me this wonderful opportunity and helping me develop as an open-source contributor and as a joyful person. A special thanks to Matthias for being there to clarify my doubts and fix my mistakes and for being really helpful.\nI would continue to be a part of the Tremor Community and hope to engage with more newcomers to open-source. I would wish to be part of future CNCF events. You may see me around at the Tremor ',(0,r.yg)("a",{parentName:"p",href:"https://chat.tremor.rs"},"Discord"),"."))}m.isMDXComponent=!0},81098:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/s3diagram-295f6786ca081822d2571d86683d629d.png"}}]);