"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[4143],{44842:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var t=r(58168),o=(r(96540),r(15680));r(40281);const i={sidebar_label:"ws (Web Sockets)",sidebar_position:1},s="The ws Connector",c={unversionedId:"reference/connectors/ws",id:"version-0.12/reference/connectors/ws",title:"The ws Connector",description:"The ws connector provides support for the WebSocket protocol specification.",source:"@site/versioned_docs/version-0.12/reference/connectors/ws.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/ws",permalink:"/docs/0.12/reference/connectors/ws",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/ws.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"ws (Web Sockets)",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"wal (Write Ahead Log)",permalink:"/docs/0.12/reference/connectors/wal"},next:{title:"bench (Benchmarking)",permalink:"/docs/0.12/reference/connectors/bench"}},l={},a=[{value:"Configuration",id:"configuration",level:2},{value:"Insecure Client",id:"insecure-client",level:3},{value:"Secure Client",id:"secure-client",level:3},{value:"Insecure Server",id:"insecure-server",level:3},{value:"Secure Server",id:"secure-server",level:3},{value:"A secure websocket echo service supporting line delimited JSON",id:"a-secure-websocket-echo-service-supporting-line-delimited-json",level:2},{value:"Running as an integration test",id:"running-as-an-integration-test",level:3},{value:"Running as long running service",id:"running-as-long-running-service",level:3},{value:"Running as a long running service, with pretty printed JSON output",id:"running-as-a-long-running-service-with-pretty-printed-json-output",level:3}],u={toc:a},p="wrapper";function g(e){let{components:n,...r}=e;return(0,o.yg)(p,(0,t.A)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"the-ws-connector"},"The ",(0,o.yg)("inlineCode",{parentName:"h1"},"ws")," Connector"),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"ws")," connector provides support for the WebSocket protocol specification."),(0,o.yg)("p",null,"Tremor can expose a client or server connection."),(0,o.yg)("p",null,"Text and binary frames can be used."),(0,o.yg)("h2",{id:"configuration"},"Configuration"),(0,o.yg)("h3",{id:"insecure-client"},"Insecure Client"),(0,o.yg)("p",null,"An annotated example of a non-tls plain WS cient configuration leveraging defaults."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define my_wsc out from ws_client\nwith\n  postprocessors = ["lines"],\n  codec = "json",\n  config = {\n    # Connect to port 4242 on the loopback device\n    "url": "ws://127.0.0.1:4242/"\n\n    # Optional Transport Level Security configuration\n    # "tls" = { ... }\n\n    # Optional tuning of the Nagle algorithm ( default: true )\n    # - By default no delay is preferred\n    # "no_delay" = false\n  }\nend;\n')),(0,o.yg)("h3",{id:"secure-client"},"Secure Client"),(0,o.yg)("p",null,"An annotated example of a secure WS client configuration with\nreconnection quality of service configured."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector ws_client from ws_client\nwith\n  postprocessors = ["lines"],\n  codec = "json",\n  config = {\n    # Listen on all interfaces on TCP port 65535\n    "url": "wss://0.0.0.0:65535",\n\n    # Prefer delay and enable the TCP Nagle algorithm\n    "no_delay": false,\n\n    # Enable SSL/TLS\n    "tls": {\n      # CA certificate\n      "cafile": "./before/localhost.cert",\n      # Domain\n      "domain": "localhost",\n    }\n  },\n  # Reconnect starting at half a second, backoff by doubling, maximum of 3 tries before circuit breaking\n  reconnect = {\n    "retry": {\n      "interval_ms": 500,\n      "growth_rate": 2,\n      "max_retries": 3,\n    }\n  }\nend;\n')),(0,o.yg)("h3",{id:"insecure-server"},"Insecure Server"),(0,o.yg)("p",null,"An annotated example of a tls plain WS cient configuration leveraging defaults.."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector in from ws_server\nwith\n  preprocessors = [{"name": "lines", "config":{"buffered": false}}],\n  codec = "json",\n  config = {\n    "url": "127.0.0.1:4242",\n  }\nend;\n')),(0,o.yg)("h3",{id:"secure-server"},"Secure Server"),(0,o.yg)("p",null,"An annotated example of a secure WS server configuration."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector ws_server from ws_server\nwith\n  preprocessors = ["lines"],\n  codec = "json",\n  config = {\n    "url": "0.0.0.0:65535",\n    "tls": {\n      # Security certificate for this service endpoint\n      "cert": "./before/localhost.cert",\n      # Security key\n      "key": "./before/localhost.key",\n    }\n  }\nend;\n')),(0,o.yg)("h2",{id:"a-secure-websocket-echo-service-supporting-line-delimited-json"},"A secure websocket echo service supporting line delimited JSON"),(0,o.yg)("p",null,"Single or multiple JSON lines of data can be transferred from client to\nserver with the server echoing the client message back to the client"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define flow main\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n\n  define connector ws_client from ws_client\n  with\n    postprocessors = ["lines"],\n    codec = "json",\n    config = {\n      "url": "wss://0.0.0.0:65535",\n      "no_delay": false,\n      "tls": {\n        "cafile": "./before/localhost.cert",\n        "domain": "localhost",\n      }\n    },\n    reconnect = {\n      "retry": {\n        "interval_ms": 500,\n        "growth_rate": 2,\n        "max_retries": 3,\n      }\n    }\n  end;\n\n  define connector ws_server from ws_server\n  with\n    preprocessors = ["lines"],\n    codec = "json",\n    config = {\n      "url": "0.0.0.0:65535",\n      "tls": {\n        "cert": "./before/localhost.cert",\n        "key": "./before/localhost.key",\n      }\n    }\n  end;\n\n  # Instances of connectors for each instance of this flow\n  create connector in from integration::read_file;\n  create connector out from integration::write_file;\n  create connector exit from integration::exit;\n  create connector stdio from connectors::console;\n  create connector ws_client;\n  create connector ws_server;\n\n  # Pipeline instances for this flow\n  create pipeline server_side from integration::out_or_exit;\n  create pipeline to_client from pipelines::passthrough;\n  create pipeline debug from pipelines::passthrough;\n\n  # Wiring\n\n  connect /connector/in to /pipeline/to_client;\n  connect /connector/in/err to /pipeline/debug;\n  connect /pipeline/to_client to /connector/ws_client;\n  # send out any responses to stdout\n  connect /connector/ws_client to /pipeline/debug;\n  connect /connector/ws_client/err to /pipeline/debug;\n  connect /pipeline/debug to /connector/stdio;\n  # flow from ws_server to file\n  connect /connector/ws_server to /pipeline/server_side;\n  connect /connector/ws_server/err to /pipeline/debug;\n  connect /pipeline/server_side to /connector/out;\n  # aaaand echo it back\n  connect /pipeline/server_side to /connector/ws_server;\n  connect /pipeline/server_side to /connector/exit;\n\nend;\n\n# Deploy the client, server and logic into the host tremor runtime\ndeploy flow main;\n')),(0,o.yg)("h3",{id:"running-as-an-integration-test"},"Running as an integration test"),(0,o.yg)("p",null,"This is how we run this test sceanario within our integration test suite."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor test integration .\n")),(0,o.yg)("h3",{id:"running-as-long-running-service"},"Running as long running service"),(0,o.yg)("p",null,"The logic can be used as starting point for your own client or service via ",(0,o.yg)("inlineCode",{parentName:"p"},"tremor server run"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy\n")),(0,o.yg)("h3",{id:"running-as-a-long-running-service-with-pretty-printed-json-output"},"Running as a long running service, with pretty printed JSON output"),(0,o.yg)("p",null,"During development, pretty printing the JSON output on standard output might be useful."),(0,o.yg)("p",null,"We typically use the wonderful ",(0,o.yg)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},(0,o.yg)("inlineCode",{parentName:"a"},"jq"))," for this purpose"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy | jq\n")))}g.isMDXComponent=!0}}]);