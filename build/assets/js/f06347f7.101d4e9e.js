"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[8150],{55181:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(58168),r=(n(96540),n(15680));n(40281);const i={sidebar_label:"cb (Circuit Breaker)",sidebar_position:101},o="The cb Connector",l={unversionedId:"reference/connectors/cb",id:"version-0.12/reference/connectors/cb",title:"The cb Connector",description:"This connector is not intended for production use, but for testing the Tremor runtime itself. To enable it pass --debug-connectors to tremor.",source:"@site/versioned_docs/version-0.12/reference/connectors/cb.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/cb",permalink:"/docs/0.12/reference/connectors/cb",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/cb.md",tags:[],version:"0.12",sidebarPosition:101,frontMatter:{sidebar_label:"cb (Circuit Breaker)",sidebar_position:101},sidebar:"indexSidebar",previous:{title:"null (No messages)",permalink:"/docs/0.12/reference/connectors/null"},next:{title:"exit",permalink:"/docs/0.12/reference/connectors/exit"}},p={},c=[{value:"Ports",id:"ports",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Example",id:"example",level:3},{value:"Expected Data Format",id:"expected-data-format",level:2},{value:"Examples",id:"examples",level:3},{value:"Example usage",id:"example-usage",level:2}],s={toc:c},d="wrapper";function g(e){let{components:t,...n}=e;return(0,r.yg)(d,(0,a.A)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"the-cb-connector"},"The ",(0,r.yg)("inlineCode",{parentName:"h1"},"cb")," Connector"),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"This connector is not intended for production use, but for testing the Tremor runtime itself. To enable it pass ",(0,r.yg)("inlineCode",{parentName:"p"},"--debug-connectors")," to tremor.")),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"cb")," connector is for testing circuit breaker internals."),(0,r.yg)("p",null,"The connector expects a circuit breaker event for each event propagated\nand then, the latest after a configurable ",(0,r.yg)("inlineCode",{parentName:"p"},"timeout")," has been exceeded,\nit halts or exits the tremor process and reports on the validation result via stdout."),(0,r.yg)("p",null,"Most of the time it is used to test the behaviour of the whole runtime when it comes to the circuit breaker and guaranteed delivery (ack/fail) mechanisms. To that end use the connector as source and sink of events by connecting your tremor pipeline application with the ",(0,r.yg)("inlineCode",{parentName:"p"},"in")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"out")," port of this connector.\nIt can also be used to test the behaviour of connectors acting as event sinks, checking if they handle all events correctly, in this case connect the ",(0,r.yg)("inlineCode",{parentName:"p"},"in")," port of the connector to test against to the ",(0,r.yg)("inlineCode",{parentName:"p"},"out")," port of the ",(0,r.yg)("inlineCode",{parentName:"p"},"cb")," connector via a pipeline of your choice."),(0,r.yg)("h2",{id:"ports"},"Ports"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"in"),": This Connector is expecting events that trigger certain Circuit Breaker and/or Event acknowledge/fail behaviour. See ",(0,r.yg)("a",{parentName:"li",href:"#expected-input-data"},"Expected Input Data"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"out"),": When configured with ",(0,r.yg)("a",{parentName:"li",href:"#configuration"},(0,r.yg)("inlineCode",{parentName:"a"},"path"))," this connector will emit events on the ",(0,r.yg)("inlineCode",{parentName:"li"},"out")," port.")),(0,r.yg)("h2",{id:"configuration"},"Configuration"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Config Option"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Possible Values"),(0,r.yg)("th",{parentName:"tr",align:null},"Required / Optional"),(0,r.yg)("th",{parentName:"tr",align:null},"Default Value"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"path"),(0,r.yg)("td",{parentName:"tr",align:null},"Path to the file to load data from. The file will be split into lines and each will form one event. Only required for the source part."),(0,r.yg)("td",{parentName:"tr",align:null},"file path"),(0,r.yg)("td",{parentName:"tr",align:null},"Only required for the source part."),(0,r.yg)("td",{parentName:"tr",align:null})),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"timeout"),(0,r.yg)("td",{parentName:"tr",align:null},"Timeout in nanoseconds to wait for circuit breaker messages after all events from the ",(0,r.yg)("inlineCode",{parentName:"td"},"path")," file have been sent. After this timeout is expired the Tremor process will be stopped."),(0,r.yg)("td",{parentName:"tr",align:null},"positive integer"),(0,r.yg)("td",{parentName:"tr",align:null},"optional"),(0,r.yg)("td",{parentName:"tr",align:null},"10_000_000_000 (10 seconds)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"expect_batched"),(0,r.yg)("td",{parentName:"tr",align:null},"When set to ",(0,r.yg)("inlineCode",{parentName:"td"},"true")," changes verifcation mode for testing applications involving ",(0,r.yg)("a",{parentName:"td",href:"/docs/0.12/reference/operators/batch"},"batching"),". That means only not all events are required to be acknowledged, only all batches."),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"optional"),(0,r.yg)("td",{parentName:"tr",align:null},"false")))),(0,r.yg)("h3",{id:"example"},"Example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="cb_example.troy"',title:'"cb_example.troy"'},'define flow cb_example\nflow\n  use tremor::pipelines;\n  use std::time::nanos;\n\n  define connector my_cb from cb\n  with\n    codec = "json",     # Events are line delimited JSON\n    config = {\n      "path": "in.json",    # File from which to replay events\n      "timeout": nanos::from_seconds(1)\n    }\n  end;\n  create connector my_cb;\n\n  create pipeline passthrough from pipelines::passthrough;\n\n  # connect both the `out` and the `in` port of the connector \n  # via a simple passthrough pipeline.\n  # (The ports can also be omitted for brevity)\n  connect /connector/my_cb/out to /pipeline/passthrough/in;\n  connect /pipeline/passthrough/out to /connector/my_cb/in;\nend;\n\ndeploy flow cb_example;\n')),(0,r.yg)("h2",{id:"expected-data-format"},"Expected Data Format"),(0,r.yg)("p",null,"This connector expects events that can trigger certain Circuit Breaker and Event acknowledgement behaviour via its ",(0,r.yg)("inlineCode",{parentName:"p"},"in")," port."),(0,r.yg)("p",null,"The event can contain the ",(0,r.yg)("inlineCode",{parentName:"p"},"cb")," specific payload in either the event metadata or the event payload."),(0,r.yg)("p",null,"The expected is a JSON document with a string or array beneath the key ",(0,r.yg)("inlineCode",{parentName:"p"},'"cb"'),"."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},'"cb"')," values can be one of the following (or multiple):"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"ack"),(0,r.yg)("td",{parentName:"tr",align:null},"Send a runtime-internal message upstream in order to ",(0,r.yg)("strong",{parentName:"td"},"acknowledge the event"),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"fail"),(0,r.yg)("td",{parentName:"tr",align:null},"Send a runtime-internal message upstream in order to ",(0,r.yg)("strong",{parentName:"td"},"fail the event"),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"close / trigger"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("em",{parentName:"td"},"Close")," or ",(0,r.yg)("em",{parentName:"td"},"trigger")," the circuit breaker, so that all upstream connectors stop sending events until it is opened again.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"open / restore"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("em",{parentName:"td"},"Open")," or ",(0,r.yg)("em",{parentName:"td"},"restore")," the circuit breaker, so that all upstream connectors start sending events again.")))),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"Only 1 value of the pairs ",(0,r.yg)("inlineCode",{parentName:"p"},"ack")," - ",(0,r.yg)("inlineCode",{parentName:"p"},"fail")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"open")," / ",(0,r.yg)("inlineCode",{parentName:"p"},"restore")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"close")," / ",(0,r.yg)("inlineCode",{parentName:"p"},"trigger")," will be considered.")),(0,r.yg)("h3",{id:"examples"},"Examples"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'{ "cb": "ack" }    // this will acknowledge the event\n{ "cb": "open" }   // this will open the circuit breaker\n{ "cb": ["fail", "trigger"] } // this will fail the event and close the circuit breaker\n')),(0,r.yg)("h2",{id:"example-usage"},"Example usage"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/tremor-rs/tremor-runtime/tree/main/tremor-cli/tests/integration/cb-drop-dead-ends"},"Validate dead ends are dropped")),(0,r.yg)("td",{parentName:"tr",align:null},"All required circuit breaker events are received and processed correctly")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/tremor-rs/tremor-runtime/tree/main/tremor-cli/tests/integration/cb-pipeline-to-pipeline"},"Validate pipeline to pipeline")),(0,r.yg)("td",{parentName:"tr",align:null},"All required circuit breaker events are received and processed correctly")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/tremor-rs/tremor-runtime/tree/main/tremor-cli/tests/integration/cb-with-auto-ack-sink"},"Validate auto-acknowledged sinks")),(0,r.yg)("td",{parentName:"tr",align:null},"All required circuit breaker events are received and processed correctly")))))}g.isMDXComponent=!0}}]);