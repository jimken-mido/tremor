"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[6111],{16558:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var t=o(58168),r=(o(96540),o(15680));o(40281);const i={sidebar_label:"s3 (AWS S3 object store)",sidebar_position:1},s="The AWS s3 Connector",a={unversionedId:"reference/connectors/s3",id:"version-0.12/reference/connectors/s3",title:"The AWS s3 Connector",description:"The Amazon Web Services s3 provides integration with the AWS Simple Storage Service or",source:"@site/versioned_docs/version-0.12/reference/connectors/s3.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/s3",permalink:"/docs/0.12/reference/connectors/s3",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/s3.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"s3 (AWS S3 object store)",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"otel (Open Telemetry)",permalink:"/docs/0.12/reference/connectors/otel"},next:{title:"stdio (Standard IO)",permalink:"/docs/0.12/reference/connectors/stdio"}},c={},l=[{value:"Reader",id:"reader",level:2},{value:"Writer",id:"writer",level:2},{value:"Example",id:"example",level:2},{value:"A MinIO storage service",id:"a-minio-storage-service",level:3},{value:"NOTES",id:"notes",level:2}],d={toc:l},p="wrapper";function m(e){let{components:n,...o}=e;return(0,r.yg)(p,(0,t.A)({},d,o,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"the-aws-s3-connector"},"The AWS ",(0,r.yg)("inlineCode",{parentName:"h1"},"s3")," Connector"),(0,r.yg)("p",null,"The Amazon Web Services ",(0,r.yg)("inlineCode",{parentName:"p"},"s3")," provides integration with the AWS Simple Storage Service or\ndrop-in compatible replacements such as ",(0,r.yg)("a",{parentName:"p",href:"https://www.min.io"},"MinIO"),"."),(0,r.yg)("h2",{id:"reader"},"Reader"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector s3_reader from s3_reader\nwith\n  codec = "json",\n  preprocessors = ["lines"],\n  postprocessors = ["lines"],\n  config = {\n    # The name of the AWS region to connect to\n    "aws_region":  "eu-central-1",\n\n    # The S3 or compatible URL endpoint\n    "endpoint": "",\n\n    # The name of the S3 bucket for this connector\n    "bucket": "",\n\n    # optional - The chunk size for multi-part related uploads/downloads\n    # Defaults to 8MB\n    # multipart_chunksize: 16 * 1024 * 1024,\n\n    # optional - The size threshold over which multipart-related uploads/downloads kicks in\n    multipart_threshold: 16 * 1024 * 1024,\n\n    # optional - The maximum number of in-flight concurrent connections\n    # Defaults to 10 connections\n    max_connections: 1,\n  },\nend;\n')),(0,r.yg)("h2",{id:"writer"},"Writer"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'  define connector s3_writer from s3-writer\n  with\n    codec = "json",\n    preprocessors = ["lines"],\n    postprocessors = ["lines"],\n    config = {\n      # The name of the AWS region to connect to\n      "aws_region":  "<region-name>",\n\n      # The S3 or compatible URL endpoint\n      "endpoint": "localhost:9000",\n\n      # The name of the S3 bucket for this connector\n      "bucket": "snot",\n\n      # optional - The minimum size for multipart-related\n      # Defaults to 5MB ( must be no less than )\n      # min_part_size : 10 * 1024 * 1024,\n    },\n  end;\n')),(0,r.yg)("h2",{id:"example"},"Example"),(0,r.yg)("p",null,"The following examples used a ",(0,r.yg)("inlineCode",{parentName:"p"},"MinIO")," docker image which can be launched as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'$ docker run \\\n  -p 9000:9000 \\\n  -p 9001:9001 \\\n  -e "MINIO_REGION=eu-central-1" \\\n  -e "MINIO_ROOT_USER=SNOTIOSFODNN7EXAMPLE" \\\n  -e "MINIO_ROOT_PASSWORD=wJBadger/K7MDENG/bPxRfiCYEXAMPLEKEY" \\\n  quay.io/minio/minio server /data --console-address ":9001"\n')),(0,r.yg)("h3",{id:"a-minio-storage-service"},"A MinIO storage service"),(0,r.yg)("p",null,"In this example a JSON line-delimited file's content are replayed to a Minio Service mimicking AWS S3."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define flow main\nflow  \n  use tremor::connectors;\n  use integration;\n\n  define connector out_s3 from s3-writer\n  with\n    codec = "json",\n    preprocessors = ["separate"],\n    postprocessors = ["separate"],\n    config = {\n      # The name of the AWS region to connect to\n      "aws_region":  "eu-central-1",\n\n      # The S3 or compatible URL endpoint\n      "endpoint": "http://127.0.0.1:9000/",\n\n      # The name of the S3 bucket for this connector - should already exist as WILL NOT be created\n      "bucket": "snot",\n    },\n  end;\n\n  define connector in_file from file\n  with \n    codec = "json",\n    preprocessors = ["separate"],\n    config = {\n      "path": "in.json",\n      "mode": "read"\n    },\n  end;\n\n#  define connector out_s3 from s3-reader\n#  end;\n\n  define connector out_file from file\n  with \n    codec = "json",\n    preprocessors = ["separate"],\n    config = {\n      "path": "out.json",\n      "mode": "truncate"\n    },\n  end;\n\n  define pipeline s3_store\n  from in\n  into out, exit\n  pipeline\n    define script set_s3_key\n    script\n      use tremor;\n      # derive a unique s3 key for each `event`\n      let $ = { "s3": { "key": "snot_#{tremor::system::ingest_ns()}" }};\n      event\n    end;\n\n    create script set_s3_key from set_s3_key;\n\n    select event from in where event != "exit" into set_s3_key;\n    select event from set_s3_key into out;\n    select {"exit": 0, "delay": 1 } from in where event == "exit" into exit;\n  end;\n\n  create connector in_file;\n  create connector out_s3 from out_s3;\n  create connector exit from connectors::exit;\n  create pipeline main from s3_store;\n\n  connect /connector/in_file to /pipeline/main;\n  connect /pipeline/main to /connector/out_s3;\n  connect /pipeline/main/exit to /connector/exit;\n  \nend;\ndeploy flow main;\n')),(0,r.yg)("h2",{id:"notes"},"NOTES"),(0,r.yg)("p",null,"Environment variables should be set according to the AWS ",(0,r.yg)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html"},"environment variable")," - however, the access key, shared access key and region ",(0,r.yg)("strong",{parentName:"p"},"MAY")," differ on Minio from AWS."),(0,r.yg)("p",null,"A bucket called ",(0,r.yg)("inlineCode",{parentName:"p"},"snot")," will need to be available."),(0,r.yg)("p",null,"The region in Minio settings should be the same as configured in the server startup."))}m.isMDXComponent=!0}}]);