"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[9318],{20125:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(58168),o=(t(96540),t(15680)),i=t(40281);const a={sidebar_label:"tcp",sidebar_position:1},c="The tcp Connector",s={unversionedId:"reference/connectors/tcp",id:"version-0.12/reference/connectors/tcp",title:"The tcp Connector",description:"The tcp connector allows TCP-based clients and servers to be integrated with tremor.",source:"@site/versioned_docs/version-0.12/reference/connectors/tcp.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/tcp",permalink:"/docs/0.12/reference/connectors/tcp",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/tcp.md",tags:[],version:"0.12",sidebarPosition:1,frontMatter:{sidebar_label:"tcp",sidebar_position:1},sidebar:"indexSidebar",previous:{title:"stdio (Standard IO)",permalink:"/docs/0.12/reference/connectors/stdio"},next:{title:"udp",permalink:"/docs/0.12/reference/connectors/udp"}},l={},p=[{value:"Configuration",id:"configuration",level:2},{value:"Client",id:"client",level:3},{value:"Server",id:"server",level:3},{value:"TCP configuration example",id:"tcp-configuration-example",level:2},{value:"JSON file over TCP as base64 encoded YAML",id:"json-file-over-tcp-as-base64-encoded-yaml",level:3},{value:"TCP server that logs base64 encoded YAML as one string per line to a file",id:"tcp-server-that-logs-base64-encoded-yaml-as-one-string-per-line-to-a-file",level:3},{value:"Notes",id:"notes",level:2},{value:"Running as an integration test",id:"running-as-an-integration-test",level:3},{value:"Running as long running service",id:"running-as-long-running-service",level:3},{value:"Running as a long running service, with pretty printed JSON output",id:"running-as-a-long-running-service-with-pretty-printed-json-output",level:3},{value:"Exercises",id:"exercises",level:3}],d={toc:p},g="wrapper";function u(e){let{components:n,...t}=e;return(0,o.yg)(g,(0,r.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"the-tcp-connector"},"The ",(0,o.yg)("inlineCode",{parentName:"h1"},"tcp")," Connector"),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"tcp")," connector allows TCP-based clients and servers to be integrated with tremor."),(0,o.yg)("h2",{id:"configuration"},"Configuration"),(0,o.yg)("h3",{id:"client"},"Client"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector `tcp-out` from tcp_client\nwith\n  codec = "yaml",\n  postprocessors = ["base64"],\n  config = {\n    "url": "localhost:4242",\n\n    # Optional Transport Level Security configuration\n    # "tls" = { ... },\n\n    # Optional tuning of the Nagle algorithm ( default: true )\n    # - By default no delay is preferred\n    # "no_delay" = false,\n\n    # Data buffer size ( default: 8K, limits maximum message size )\n    # "buf_size" = "16K",\n  }\nend;\n')),(0,o.yg)("h3",{id:"server"},"Server"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define connector `tcp-in` from tcp_server\nwith\n  codec = "string",\n  config = { \n    "url": "localhost:4242",\n\n    # Optional Transport Level Security configuration\n    # "tls" = { ... }\n\n    # Data buffer size ( default: 8K, limits maximum message size )\n    # "buf_size" = "16K",\n  }\nend;\n')),(0,o.yg)("h2",{id:"tcp-configuration-example"},"TCP configuration example"),(0,o.yg)("p",null,"This is a relatively simple client server system that replays JSON formatted lines of data\nfrom a text file over TCP to a server. The JSON data is transformed to ",(0,o.yg)("inlineCode",{parentName:"p"},"base64")," encoded YAML\nbefore sending to the TCP server. The server receives TCP datagrams and writes them to a\nlog file encoding the log entries as naked string data."),(0,o.yg)("p",null,"The client and server are implemented as treomr flows."),(0,o.yg)("p",null,"A high level summary of the overall flow:"),(0,o.yg)(i.K,{chart:"graph LR\n    A[JSON File] --\x3e|read line by line| B(TCP Client)\n    B --\x3e|base64 encoded YAML| C{TCP Server}\n    C{TCP Server} --\x3e|receive TCP datagrams| D(select event from in into out)\n    D --\x3e|string encoded data| E[Log file]",mdxType:"Mermaid"}),(0,o.yg)("h3",{id:"json-file-over-tcp-as-base64-encoded-yaml"},"JSON file over TCP as base64 encoded YAML"),(0,o.yg)("p",null,"A tremor flow that consumes JSON formatted data line by line\nfrom a file and sends each event as a ",(0,o.yg)("inlineCode",{parentName:"p"},"base64")," encoded YAML formatted\nevent via TCP to a TCP service."),(0,o.yg)("p",null,"High level flow summary:"),(0,o.yg)(i.K,{chart:"graph LR\n    A[JSON File] --\x3e|read line by line| B(TCP Client)\n    B --\x3e|base64 encoded YAML| C{TCP Server}",mdxType:"Mermaid"}),(0,o.yg)("p",null,"In deployable form"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define flow main\nflow\n  use tremor::connectors;\n  use integration;\n\n\n  define connector in from file\n  with codec = "json",\n    preprocessors = ["lines"],\n    config = {\n        "path": "in.json",\n        "mode": "read"\n    }\n  end;\n\n  define connector `tcp-out` from tcp_client\n  with\n    codec = "yaml",\n    postprocessors = ["base64"],\n    config = {\n      "url": "localhost:4242",\n    }\n  end;\n  \n  create pipeline main from integration::out_or_exit;\n  create connector in;\n  create connector `tcp-out`;\n  create connector exit from connectors::exit;\n\n  connect /connector/in/out to /pipeline/main/in;\n  connect /pipeline/main/out to /connector/`tcp-out`/in;\n  connect /pipeline/main/exit to /connector/exit/in;\nend;\n\ndeploy flow main;\n')),(0,o.yg)("h3",{id:"tcp-server-that-logs-base64-encoded-yaml-as-one-string-per-line-to-a-file"},"TCP server that logs base64 encoded YAML as one string per line to a file"),(0,o.yg)("p",null,"A tremor flow that consumes TCP datagram events and writes them\nto a file encoding as raw strings."),(0,o.yg)("p",null,"High level flow summary:"),(0,o.yg)(i.K,{chart:"graph LR\n    A{TCP Server} --\x3e|receive TCP datagrams| B(select event from in into out)\n    B --\x3e|string encoded data| C[Log file]",mdxType:"Mermaid"}),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-tremor",metastring:'title="config.troy"',title:'"config.troy"'},'define flow server\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n\n  define connector tcp_server from tcp_server\n  with\n    preprocessors = ["lines"],\n    postprocessors = ["lines"],\n    codec = "json",\n    config = {\n      "url": "0.0.0.0:65535",\n      "buf_size": 1024,\n    }\n  end;\n\n  create connector server_out from integration::write_file\n  with\n    file = "server_out.log"\n  end;\n  create connector stdio from connectors::console;\n  create connector tcp_server;\n\n  create pipeline server_side from pipelines::passthrough;\n  create pipeline debug from pipelines::passthrough;\n\n  # flow from tcp_server to file\n  connect /connector/tcp_server to /pipeline/server_side;\n  connect /connector/tcp_server/err to /pipeline/debug;\n  connect /pipeline/server_side to /connector/server_out;\n\n  # aaaand echo it back\n  connect /pipeline/server_side to /connector/tcp_server;\n\n  # debugging\n  connect /pipeline/debug to /connector/stdio;\nend;\n\ndefine flow client\nflow\n  use integration;\n  use tremor::pipelines;\n  use tremor::connectors;\n\n  define connector tcp_client from tcp_client\n  with\n    preprocessors = ["lines"],\n    postprocessors = ["lines"],\n    codec = "json",\n    config = {\n      "url": "127.0.0.1:65535",\n      "no_delay": false,\n      "buf_size": 1024,\n    },\n    reconnect = {\n      "retry": {\n        "interval_ms": 100,\n        "growth_rate": 2,\n        "max_retries": 3,\n      }\n    }\n  end;\n\n  create connector in from integration::read_file;\n  create connector client_out from integration::write_file\n  with\n    file = "client_out.log"\n  end;\n  create connector exit from integration::exit;\n  create connector stdio from connectors::console;\n  create connector tcp_client;\n\n  create pipeline to_client from pipelines::passthrough;\n  create pipeline from_client from integration::out_or_exit;\n  create pipeline debug from pipelines::passthrough;\n\n  connect /connector/in to /pipeline/to_client;\n  connect /connector/in/err to /pipeline/debug;\n  connect /pipeline/to_client to /connector/tcp_client;\n\n  # send out any responses to the client to file `client_out.log`\n  connect /connector/tcp_client to /pipeline/from_client;\n  connect /connector/tcp_client/err to /pipeline/debug;\n  connect /pipeline/from_client/out to /connector/client_out;\n  connect /pipeline/from_client/exit to /connector/exit;\n\n  # debugging\n  connect /pipeline/debug to /connector/stdio;\n\nend;\n\ndeploy flow server;\ndeploy flow client;\n')),(0,o.yg)("h2",{id:"notes"},"Notes"),(0,o.yg)("h3",{id:"running-as-an-integration-test"},"Running as an integration test"),(0,o.yg)("p",null,"This is how we run this test sceanario within our integration test suite."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor test integration .\n")),(0,o.yg)("h3",{id:"running-as-long-running-service"},"Running as long running service"),(0,o.yg)("p",null,"The logic can be used as starting point for your own client or service via ",(0,o.yg)("inlineCode",{parentName:"p"},"tremor server run"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy\n")),(0,o.yg)("h3",{id:"running-as-a-long-running-service-with-pretty-printed-json-output"},"Running as a long running service, with pretty printed JSON output"),(0,o.yg)("p",null,"During development, pretty printing the JSON output on standard output might be useful."),(0,o.yg)("p",null,"We typically use the wonderful ",(0,o.yg)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},(0,o.yg)("inlineCode",{parentName:"a"},"jq"))," for this purpose"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ export TREMOR_PATH=/path/to/tremor-runtime/tremor-script/lib:/path/to/tremor-runtime/tremor-cli/tests/lib\n$ tremor server run config.troy | jq\n")),(0,o.yg)("h3",{id:"exercises"},"Exercises"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Modularise the solution allowing the following combinations",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Deploy the client and server in separate tremor instances"),(0,o.yg)("li",{parentName:"ul"},"Deploy the client and server in a single tremor instance"),(0,o.yg)("li",{parentName:"ul"},"Use the ",(0,o.yg)("inlineCode",{parentName:"li"},"msgpack")," codec instead of ",(0,o.yg)("inlineCode",{parentName:"li"},"base64")," encoded YAML"),(0,o.yg)("li",{parentName:"ul"},"Unpack the ",(0,o.yg)("inlineCode",{parentName:"li"},"base64")," encoded YAML and write to a log file as line-delimited JSON"),(0,o.yg)("li",{parentName:"ul"},"Add compression and decmopression")))))}u.isMDXComponent=!0}}]);