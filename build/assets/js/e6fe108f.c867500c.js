"use strict";(self.webpackChunktremor_website=self.webpackChunktremor_website||[]).push([[544],{29734:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=t(58168),a=(t(96540),t(15680));t(40281);const o={},i="Connectors",l={unversionedId:"reference/connectors/index",id:"version-0.12/reference/connectors/index",title:"Connectors",description:"This section introduces Tremor connectors.",source:"@site/versioned_docs/version-0.12/reference/connectors/index.md",sourceDirName:"reference/connectors",slug:"/reference/connectors/",permalink:"/docs/0.12/reference/connectors/",draft:!1,editUrl:"https://github.com/tremor-rs/tremor-www/tree/main/versioned_docs/version-0.12/reference/connectors/index.md",tags:[],version:"0.12",frontMatter:{},sidebar:"indexSidebar",previous:{title:"Reference",permalink:"/docs/0.12/reference/"},next:{title:"crononome (Scheduled messages)",permalink:"/docs/0.12/reference/connectors/crononome"}},s={},c=[{value:"Overview",id:"overview",level:2},{value:"Formats and Types",id:"formats-and-types",level:3},{value:"Codecs",id:"codecs",level:3},{value:"Preprocessors",id:"preprocessors",level:3},{value:"Postprocessors",id:"postprocessors",level:3},{value:"Quality of Service",id:"quality-of-service",level:3},{value:"Connector Types",id:"connector-types",level:2},{value:"Client &amp; Server",id:"client--server",level:3},{value:"Reader &amp; Writer",id:"reader--writer",level:3},{value:"Consumer &amp; Producer",id:"consumer--producer",level:3},{value:"Unique",id:"unique",level:3},{value:"Development Only Connectors",id:"development-only-connectors",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Reconnect config",id:"reconnect-config",level:3},{value:"none",id:"none",level:4},{value:"retry",id:"retry",level:4},{value:"Example",id:"example",level:3},{value:"Examples",id:"examples",level:2},{value:"Writing to a local file on the file system",id:"writing-to-a-local-file-on-the-file-system",level:3}],d={toc:c},p="wrapper";function m(e){let{components:n,...t}=e;return(0,a.yg)(p,(0,r.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"connectors"},"Connectors"),(0,a.yg)("p",null,"This section introduces Tremor connectors."),(0,a.yg)("h2",{id:"overview"},"Overview"),(0,a.yg)("p",null,"In Tremor, a ",(0,a.yg)("inlineCode",{parentName:"p"},"connector")," is how external event streams are integrated with tremor.\nConnectors can be clients ( such as TCP or UDP clients ), servers ( such as an embedded HTTP or gRPC\nserver ), or services such as the ",(0,a.yg)("inlineCode",{parentName:"p"},"kv")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"wal")," connectors or an abstraction over an API such as the\n",(0,a.yg)("inlineCode",{parentName:"p"},"discord")," connector."),(0,a.yg)("h3",{id:"formats-and-types"},"Formats and Types"),(0,a.yg)("p",null,"Internally, tremor represents data as a set of heirarchic values with support for the\nprimitive types ",(0,a.yg)("inlineCode",{parentName:"p"},"null"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"integer"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"binary"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"boolean"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"floating point")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"string")," and the\nstructural types of ",(0,a.yg)("inlineCode",{parentName:"p"},"array")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"record"),". The syntax is backwards compatible with JSON\nbut not symmetric."),(0,a.yg)("p",null,"A tremor value can include raw binary data but JSON cannot."),(0,a.yg)("p",null,"Connectors translate external data formats, over external protocols to tremor internals.\nFormats are transformed to the tremor value type system. And protocol, transport and API\ninteractions are translated to streams of event commands, event data and query streams."),(0,a.yg)("p",null,"Tremor supports a suite of ",(0,a.yg)("inlineCode",{parentName:"p"},"codecs")," for common format transformations to and from external\ndata formats such as for ",(0,a.yg)("inlineCode",{parentName:"p"},"json"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"yaml")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"csv"),". Further, tremor can preprocess data before\nit is transformed. So gzip compressed data can be decompressed before a codec is used to\nconvert the external data to a tremor value. If data is line delimited, the events can be\nprocessed line by line."),(0,a.yg)("p",null,"We call transformation from an external data format to the tremor value type ",(0,a.yg)("inlineCode",{parentName:"p"},"preprocessing"),"."),(0,a.yg)("p",null,"We call transformation from the tremor value system to an external data format ",(0,a.yg)("inlineCode",{parentName:"p"},"postprocessing"),"."),(0,a.yg)("p",null,"Codecs and processors can be blended together with connectors to compose a working solution."),(0,a.yg)("p",null,"So, a TCP connector, with a line by line processor can produce and consume line delimited\nbatch events. The source might be ",(0,a.yg)("inlineCode",{parentName:"p"},"json")," and the target ( also ) tcp could be ",(0,a.yg)("inlineCode",{parentName:"p"},"yaml")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"csv"),"."),(0,a.yg)("p",null,"This allows for a relatively small set of ",(0,a.yg)("inlineCode",{parentName:"p"},"connectors"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"codecs")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"processors")," to be\nvery widely applicable in production."),(0,a.yg)("h3",{id:"codecs"},"Codecs"),(0,a.yg)("p",null,"Codecs convert data from external data formats to the native tremor value type system\nand vice versa."),(0,a.yg)("p",null,"Check the ",(0,a.yg)("a",{parentName:"p",href:"../codecs"},"codec guide")," to see the supported codecs."),(0,a.yg)("h3",{id:"preprocessors"},"Preprocessors"),(0,a.yg)("p",null,"Preprocessor chains transform inbound chunks of streaming data before a configured\ncodec in a connector converts them to the native Tremor value type representation."),(0,a.yg)("p",null,"Check the ",(0,a.yg)("a",{parentName:"p",href:"../preprocessors"},"preprocessor guide")," to see the supported codecs."),(0,a.yg)("h3",{id:"postprocessors"},"Postprocessors"),(0,a.yg)("p",null,"Postprocessor chains transform outbound chunks of streaming data after a codec\nconverts them from native Tremor value type representation to the external form\nindicated by the configured codec of a connector."),(0,a.yg)("p",null,"Check the ",(0,a.yg)("a",{parentName:"p",href:"../postprocessors"},"postprocessor guide")," to see the supported codecs."),(0,a.yg)("h3",{id:"quality-of-service"},"Quality of Service"),(0,a.yg)("p",null,"Connectors are built so they maintain a usable connection to the system they connect to. This can be a remote server, a remote cluster, a local socket or file or a std stream.\nWhen a connector encounters an error that hints at a broken connection, it attempts to re-establish the connectivity.\nIf configured, it will wait and retry if it doesn't succeed on its first attempt."),(0,a.yg)("p",null,"The following connector will attempt at maximum 10 reconnects before it goes into a failing state. Between each retry it will wait for the given ",(0,a.yg)("inlineCode",{parentName:"p"},"interval_ms")," which grows by the ",(0,a.yg)("inlineCode",{parentName:"p"},"growth_rate")," multiplied by a random value between 0 and 1.\nSo the formula boils down to:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"wait_interval = wait_interval * (growth_rate * random(0, 1))\n\n")),(0,a.yg)("p",null,"Example:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'define connector my_http from http_client\nwith\n    reconnect = {\n        "retry": {\n            interval_ms: 1000,\n            growth_rate: 2.0,\n            max_retries: 10,\n            randomized: true\n        }\n    },\n    config = {\n        "url": "http://localhost:80/api"\n    }\nend;\n')),(0,a.yg)("p",null,"Some connectors provide transactional events, that will only be considered handled if a downstream connector handled it successfully. The runtimes Contraflow mechanism is used for propagating event acknowledgment or failure notification back to the originating connector. E.g. in case of ",(0,a.yg)("a",{parentName:"p",href:"/docs/0.12/reference/connectors/kafka#consumer"},"Kafka")," a successful acknowledgement of an event will commit the offset of the message that contained the successfully handled event."),(0,a.yg)("h2",{id:"connector-types"},"Connector Types"),(0,a.yg)("p",null,"Connectors can be grouped in a number of categories that roughly provide the same pattern with different implementations."),(0,a.yg)("h3",{id:"client--server"},"Client & Server"),(0,a.yg)("p",null,"This are connectors that handle the kind of connections that usually are used for implementing, as the category suggests, clients and servers. ",(0,a.yg)("a",{parentName:"p",href:"tcp"},"TCP"),", ",(0,a.yg)("a",{parentName:"p",href:"http"},"HTTP"),", but also ",(0,a.yg)("a",{parentName:"p",href:"ws"},"WebSockets")," or ",(0,a.yg)("a",{parentName:"p",href:"unix_socket"},"UNIX Sockets")," fall into this categort."),(0,a.yg)("p",null,"They all provide matching pairs of ",(0,a.yg)("inlineCode",{parentName:"p"},"_client")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"_server")," implementations where the ",(0,a.yg)("inlineCode",{parentName:"p"},"_client")," is the side that initiates a contact, while the ",(0,a.yg)("inlineCode",{parentName:"p"},"_server")," is the side that awaits to be contacted."),(0,a.yg)("h3",{id:"reader--writer"},"Reader & Writer"),(0,a.yg)("p",null,"This set of connectors deals with connections that rougly resamble files access. ",(0,a.yg)("a",{parentName:"p",href:"file"},"File")," is the obvious one, but others like ",(0,a.yg)("a",{parentName:"p",href:"s3"},"AWS S3")," follow this model."),(0,a.yg)("p",null,"They generally have a ",(0,a.yg)("inlineCode",{parentName:"p"},"reader")," and a ",(0,a.yg)("inlineCode",{parentName:"p"},"writer")," side."),(0,a.yg)("h3",{id:"consumer--producer"},"Consumer & Producer"),(0,a.yg)("p",null,"This set of connectos connects to different messaging systems where there are two unidirecional connectiosn. One to ",(0,a.yg)("inlineCode",{parentName:"p"},"produce")," new messages, and one to ",(0,a.yg)("inlineCode",{parentName:"p"},"consume")," new messages."),(0,a.yg)("p",null,"The most prominent example here is ",(0,a.yg)("a",{parentName:"p",href:"kafka"},"Kafka Producer/Consumer"),"."),(0,a.yg)("p",null,"They generally have a ",(0,a.yg)("inlineCode",{parentName:"p"},"_producer")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"_consumer")," implementaiton."),(0,a.yg)("h3",{id:"unique"},"Unique"),(0,a.yg)("p",null,"Some connectors don't fall into the above categories or are one sided. The ",(0,a.yg)("a",{parentName:"p",href:"discord"},"Discord")," or ",(0,a.yg)("a",{parentName:"p",href:"dns"},"DNS")," connector is a client but there is no server. The ",(0,a.yg)("a",{parentName:"p",href:"kv"},"KV")," or ",(0,a.yg)("a",{parentName:"p",href:"gbq"},"Google Big Query")," connector is a database connector, and connectors like the ",(0,a.yg)("a",{parentName:"p",href:"wal"},"WAL")," are different again."),(0,a.yg)("h2",{id:"development-only-connectors"},"Development Only Connectors"),(0,a.yg)("p",null,"These connectors are generally intended for contributors to tremor and are\navailable only during development for debug builds of tremor."),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Connector Name"),(0,a.yg)("th",{parentName:"tr",align:null},"Description"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},(0,a.yg)("a",{parentName:"td",href:"cb"},"cb")),(0,a.yg)("td",{parentName:"tr",align:null},"Explain")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},(0,a.yg)("a",{parentName:"td",href:"bench"},"bench")),(0,a.yg)("td",{parentName:"tr",align:null},"Explain")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},(0,a.yg)("a",{parentName:"td",href:"null"},"null")),(0,a.yg)("td",{parentName:"tr",align:null},"Explain")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},(0,a.yg)("a",{parentName:"td",href:"exit"},"exit")),(0,a.yg)("td",{parentName:"tr",align:null},"Allow terminating the runtime")))),(0,a.yg)("h2",{id:"configuration"},"Configuration"),(0,a.yg)("p",null,"Connectors are configured via the deployment syntax in a Tremor ",(0,a.yg)("inlineCode",{parentName:"p"},".troy")," file.\nAs all other entities in Tremor, connectors need to be defined and created to be usable for forming an event flow."),(0,a.yg)("p",null,"Configuration is done in the Connector Definition. Every Connector has a set of specific configuration values, that need to be provided with the ",(0,a.yg)("inlineCode",{parentName:"p"},"config")," option. All other options are common for all Connectors."),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Option"),(0,a.yg)("th",{parentName:"tr",align:null},"Description"),(0,a.yg)("th",{parentName:"tr",align:null},"Type"),(0,a.yg)("th",{parentName:"tr",align:null},"Required"),(0,a.yg)("th",{parentName:"tr",align:null},"Default Value"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"codec"),(0,a.yg)("td",{parentName:"tr",align:null},"The ","[Codec]"," to apply to incoming raw data and outgoing events."),(0,a.yg)("td",{parentName:"tr",align:null},"[Codec]"," name as a string or ","[Codec]"," configuration as object"),(0,a.yg)("td",{parentName:"tr",align:null},"Depends on the Connector."),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"metrics_interval_s"),(0,a.yg)("td",{parentName:"tr",align:null},"The interval in seconds in which to emit metrics events to the ",(0,a.yg)("a",{parentName:"td",href:"/docs/0.12/reference/connectors/metrics"},"metrics connector")),(0,a.yg)("td",{parentName:"tr",align:null},"Integer"),(0,a.yg)("td",{parentName:"tr",align:null},"optional"),(0,a.yg)("td",{parentName:"tr",align:null},"If omitted, no metrics events will be emitted.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"postprocessors"),(0,a.yg)("td",{parentName:"tr",align:null},"A list of ","[Postprocessors]"," to be executed on the encoded outgoing event data in the order specified here."),(0,a.yg)("td",{parentName:"tr",align:null},"A list of ","[Postprocessor]"," names or configuration objects"),(0,a.yg)("td",{parentName:"tr",align:null},"optional"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"preprocessors"),(0,a.yg)("td",{parentName:"tr",align:null},"A list of ","[Preprocessors]"," to be executed on the raw incoming data in the order specified."),(0,a.yg)("td",{parentName:"tr",align:null},"A list of ","[Preprocessor]"," names or configuration objects"),(0,a.yg)("td",{parentName:"tr",align:null},"optional"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"reconnect"),(0,a.yg)("td",{parentName:"tr",align:null},"A Reconnect configuration, defining how often and at which intervals to reconnect on connection loss"),(0,a.yg)("td",{parentName:"tr",align:null},"See ",(0,a.yg)("a",{parentName:"td",href:"#reconnect-config"},"Reconnect config")),(0,a.yg)("td",{parentName:"tr",align:null},"optional"),(0,a.yg)("td",{parentName:"tr",align:null},'"none"')))),(0,a.yg)("h3",{id:"reconnect-config"},"Reconnect config"),(0,a.yg)("p",null,"By default Connectors will attempt to re-establish a failed connection, so that connectivity is preserved in the face of small recoverable glitches. But the connectors machinery inside the runtime also supports more involved retry strategies, because sometimes it makes sense to just wait out a small downtime."),(0,a.yg)("h4",{id:"none"},"none"),(0,a.yg)("p",null,"Only attempt to reconnect once if an established connection fails. Do not retry. This the the ",(0,a.yg)("strong",{parentName:"p"},"Default")," ",(0,a.yg)("inlineCode",{parentName:"p"},"reconnect")," configuration, if not explicitly specified."),(0,a.yg)("h4",{id:"retry"},"retry"),(0,a.yg)("p",null,"Attempt to reconnect when a previous attempt failed. The retries an be limited to ",(0,a.yg)("inlineCode",{parentName:"p"},"max_retries"),", by default tremor will retry infinitely. An interval can be configured between retries, that can grow by a fixed rate or a randomized rate for implementing exponential random backoff."),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Option"),(0,a.yg)("th",{parentName:"tr",align:null},"Description"),(0,a.yg)("th",{parentName:"tr",align:null},"Type"),(0,a.yg)("th",{parentName:"tr",align:null},"Required"),(0,a.yg)("th",{parentName:"tr",align:null},"Default Value"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"interval_ms"),(0,a.yg)("td",{parentName:"tr",align:null},"Interval to wait between retries in milliseconds"),(0,a.yg)("td",{parentName:"tr",align:null},"Unsigned Integer"),(0,a.yg)("td",{parentName:"tr",align:null},"yes"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"max_retries"),(0,a.yg)("td",{parentName:"tr",align:null},"The maximum number of retries to execute"),(0,a.yg)("td",{parentName:"tr",align:null},"Unsigned Integer"),(0,a.yg)("td",{parentName:"tr",align:null},"no"),(0,a.yg)("td",{parentName:"tr",align:null},"If not specified, the Tremor runtime will retry until the connection could be established again.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"growth_rate"),(0,a.yg)("td",{parentName:"tr",align:null},"The growth rate, by which the actual wait interval of the last attempt is multiplied."),(0,a.yg)("td",{parentName:"tr",align:null},"Floating point number"),(0,a.yg)("td",{parentName:"tr",align:null},"no"),(0,a.yg)("td",{parentName:"tr",align:null},"1.5")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"randomized"),(0,a.yg)("td",{parentName:"tr",align:null},"Whether or not to multiply the growth rate by a random float between 0.0 and 1.0 to introduce randomized wait intervals between retries"),(0,a.yg)("td",{parentName:"tr",align:null},"boolean"),(0,a.yg)("td",{parentName:"tr",align:null},"no"),(0,a.yg)("td",{parentName:"tr",align:null},"true")))),(0,a.yg)("h3",{id:"example"},"Example"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'define connector my_file from tcp_client\nwith\n    config = {\n        "url": "http://example.org\n    },\n    codec = "json",\n    postprocessors = ["gzip"]\n    reconnect = {\n        "retry": {\n            "interval_ms": 100,\n            "max_retries": 10,\n            "growth_rate": 2.0\n        }\n    }\nend;\n')),(0,a.yg)("p",null,"This example configuration will attempt a maximum of 10 retries (if reconnect attempts fail), after waiting for an initial 100ms which is growing by a randomized rate of 2.0, so that wait times increase but not all instances will retry at the exact same time to avoid a thundering herd problem."),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"Use the ",(0,a.yg)("inlineCode",{parentName:"p"},"retry")," reconnect config with care! Too many retries can hurt downstream systems and hurt the overall systems liveness in case of errors.")),(0,a.yg)("h2",{id:"examples"},"Examples"),(0,a.yg)("h3",{id:"writing-to-a-local-file-on-the-file-system"},"Writing to a local file on the file system"),(0,a.yg)("p",null,"To write received events in tremor to the local file system we can use\nthe builtin ",(0,a.yg)("inlineCode",{parentName:"p"},"file")," connector, and configure the target file as the ",(0,a.yg)("inlineCode",{parentName:"p"},"file"),"\nargument to the connector."),(0,a.yg)("p",null,"We can override default connector provided internal processing via reparameterizing\nthe default arguments specified in the connectors implementation. For example, where\nwe are writing JSON formatted data to a file, we may desire that fields in record\nstructures are always in a consistent and normalized serialization order through\nreplacing the default ",(0,a.yg)("inlineCode",{parentName:"p"},"json")," codec with the ",(0,a.yg)("inlineCode",{parentName:"p"},"json-sorted")," codec."),(0,a.yg)("p",null,"We may also wish to override the conditions under which a file is created, appended\nto or overwritten when tremor is started. We can modify the write mode by setting the\n",(0,a.yg)("inlineCode",{parentName:"p"},"mode")," accordingly."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tremor"},'define connector write_file from file\nargs\n    file = "out.log"\nwith\n    codec = "json-sorted",  # Normalize record fields in serialized JSON by switching to the `json-sorted` codec\n    config = {\n        "path": args.file,  # Use the file argument from the arguments specification for the target file path\n        "mode": "truncate"  # Truncate the file, or create a new file when the connector starts\n    },\n    postprocessors = ["lines"]  # Ensure entire JSON documents are one per line ( UNIX-style ) in the serialized file\nend;\n\n[Codec]: ../codecs/index.md\n[Postprocessors]: ../postprocessors/index.md\n[Postprocessor]: ../postprocessors/index.md\n[Preprocessors]: ../preprocessors/index.md\n[Preprocessor]: ../preprocessors/index.md\n')))}m.isMDXComponent=!0}}]);